this.Global=this.Global||{},function(){"use strict";Global={autoFit:function(){var t=1280,i=720;_autoFit=function(){var e=window.innerWidth,n=window.innerHeight,s=e/t,a=n/i,o=s>a?a:s;o=o>1?1:o;var r=$("#main"),h=$("#gameplayStage"),d=(e-1e3*o)/2;return h.css({width:t*o,height:i*o,left:d+"px"}),r.css("zoom",o),{zoom:o}},_autoFit(),window.removeEventListener("resize",_autoFit,!0),window.addEventListener("resize",_autoFit,!0)},getParameterByName:function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+t+"=([^&#]*)"),e=i.exec(location.search);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))},numberWithDot:function(t){if(isNaN(t))return 0;var i=t.toString().split(".");i[0]=i[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),i[1]&&(i[1]=i[1].substring(0,3));for(var e=i.join(".");(e.length>i[0].length||i[0].length<=3)&&e.length>3;)e=e.substring(0,e.length-1);return"."==e[e.length-1]&&(e=e.substring(0,e.length-1)),e},numberWithDot2:function(t){if(isNaN(t))return t;var i,e,n=Math.abs(t);return n>=1e8?(i=Global.numberWithDot(Math.floor(n/1e6)),e="M"):n>=1e3?(i=Global.numberWithDot(Math.floor(n/1e3)),e="K"):(i=Global.numberWithDot(n),e=""),0>t&&(i="-"+i),i+e},numberWithDot3:function(t){if(isNaN(t))return t;var i,e,n=Math.abs(t);return n>=1e6?(i=Global.numberWithDot(n/1e6),e="M"):n>=1e3?(i=Global.numberWithDot(n/1e3),e="K"):(i=Global.numberWithDot(n),e=""),0>t&&(i="-"+i),i+e},shuffle:function(t){for(var i,e,n=t.length;0!==n;)e=Math.floor(Math.random()*n),n-=1,i=t[n],t[n]=t[e],t[e]=i;return t},_generateUniqueId:function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}()},getUniqueId:function(){var t=localStorage.getItem("___uniqueId___");return t||(t=this._generateUniqueId(),localStorage.setItem("___uniqueId___",t)),t},converEsObject:function(t){var i=t.data;if(i||(i=t),i){var e="{";for(var n in i){"{"!=e&&(e+=",");var s=i[n];e=e+'"'+n+'":'+JSON.stringify(s.value)}return e+="}",JSON.parse(e)}},convertData:function(t){var i={};for(var e in t)i[AppKeysConvert[e]?AppKeysConvert[e]:e]=t[e];return i},md5Avatar:function(t){var i=md5(t);return parseInt((i.match(/\d+/)[0]||1)[0])},convertBettingToChip:function(t,i){if(isNaN(t)||isNaN(i))return[1];var e=Math.floor(t/i),n=ChipRatio.findIndex(function(t){return e>=t});0>n&&(n=ChipRatio.length);for(var s=[],a=ChipRatio.length;a>0;a--){var o=Math.floor(e/ChipRatio[a-1]);o>0&&s.push({type:a-1,number:o})}return s}}}(),function(t){"use strict";function i(t,i){var e=(65535&t)+(65535&i),n=(t>>16)+(i>>16)+(e>>16);return n<<16|65535&e}function e(t,i){return t<<i|t>>>32-i}function n(t,n,s,a,o,r){return i(e(i(i(n,t),i(a,r)),o),s)}function s(t,i,e,s,a,o,r){return n(i&e|~i&s,t,i,a,o,r)}function a(t,i,e,s,a,o,r){return n(i&s|e&~s,t,i,a,o,r)}function o(t,i,e,s,a,o,r){return n(i^e^s,t,i,a,o,r)}function r(t,i,e,s,a,o,r){return n(e^(i|~s),t,i,a,o,r)}function h(t,e){t[e>>5]|=128<<e%32,t[(e+64>>>9<<4)+14]=e;var n,h,d,u,c,l=1732584193,p=-271733879,f=-1732584194,m=271733878;for(n=0;n<t.length;n+=16)h=l,d=p,u=f,c=m,l=s(l,p,f,m,t[n],7,-680876936),m=s(m,l,p,f,t[n+1],12,-389564586),f=s(f,m,l,p,t[n+2],17,606105819),p=s(p,f,m,l,t[n+3],22,-1044525330),l=s(l,p,f,m,t[n+4],7,-176418897),m=s(m,l,p,f,t[n+5],12,1200080426),f=s(f,m,l,p,t[n+6],17,-1473231341),p=s(p,f,m,l,t[n+7],22,-45705983),l=s(l,p,f,m,t[n+8],7,1770035416),m=s(m,l,p,f,t[n+9],12,-1958414417),f=s(f,m,l,p,t[n+10],17,-42063),p=s(p,f,m,l,t[n+11],22,-1990404162),l=s(l,p,f,m,t[n+12],7,1804603682),m=s(m,l,p,f,t[n+13],12,-40341101),f=s(f,m,l,p,t[n+14],17,-1502002290),p=s(p,f,m,l,t[n+15],22,1236535329),l=a(l,p,f,m,t[n+1],5,-165796510),m=a(m,l,p,f,t[n+6],9,-1069501632),f=a(f,m,l,p,t[n+11],14,643717713),p=a(p,f,m,l,t[n],20,-373897302),l=a(l,p,f,m,t[n+5],5,-701558691),m=a(m,l,p,f,t[n+10],9,38016083),f=a(f,m,l,p,t[n+15],14,-660478335),p=a(p,f,m,l,t[n+4],20,-405537848),l=a(l,p,f,m,t[n+9],5,568446438),m=a(m,l,p,f,t[n+14],9,-1019803690),f=a(f,m,l,p,t[n+3],14,-187363961),p=a(p,f,m,l,t[n+8],20,1163531501),l=a(l,p,f,m,t[n+13],5,-1444681467),m=a(m,l,p,f,t[n+2],9,-51403784),f=a(f,m,l,p,t[n+7],14,1735328473),p=a(p,f,m,l,t[n+12],20,-1926607734),l=o(l,p,f,m,t[n+5],4,-378558),m=o(m,l,p,f,t[n+8],11,-2022574463),f=o(f,m,l,p,t[n+11],16,1839030562),p=o(p,f,m,l,t[n+14],23,-35309556),l=o(l,p,f,m,t[n+1],4,-1530992060),m=o(m,l,p,f,t[n+4],11,1272893353),f=o(f,m,l,p,t[n+7],16,-155497632),p=o(p,f,m,l,t[n+10],23,-1094730640),l=o(l,p,f,m,t[n+13],4,681279174),m=o(m,l,p,f,t[n],11,-358537222),f=o(f,m,l,p,t[n+3],16,-722521979),p=o(p,f,m,l,t[n+6],23,76029189),l=o(l,p,f,m,t[n+9],4,-640364487),m=o(m,l,p,f,t[n+12],11,-421815835),f=o(f,m,l,p,t[n+15],16,530742520),p=o(p,f,m,l,t[n+2],23,-995338651),l=r(l,p,f,m,t[n],6,-198630844),m=r(m,l,p,f,t[n+7],10,1126891415),f=r(f,m,l,p,t[n+14],15,-1416354905),p=r(p,f,m,l,t[n+5],21,-57434055),l=r(l,p,f,m,t[n+12],6,1700485571),m=r(m,l,p,f,t[n+3],10,-1894986606),f=r(f,m,l,p,t[n+10],15,-1051523),p=r(p,f,m,l,t[n+1],21,-2054922799),l=r(l,p,f,m,t[n+8],6,1873313359),m=r(m,l,p,f,t[n+15],10,-30611744),f=r(f,m,l,p,t[n+6],15,-1560198380),p=r(p,f,m,l,t[n+13],21,1309151649),l=r(l,p,f,m,t[n+4],6,-145523070),m=r(m,l,p,f,t[n+11],10,-1120210379),f=r(f,m,l,p,t[n+2],15,718787259),p=r(p,f,m,l,t[n+9],21,-343485551),l=i(l,h),p=i(p,d),f=i(f,u),m=i(m,c);return[l,p,f,m]}function d(t){var i,e="";for(i=0;i<32*t.length;i+=8)e+=String.fromCharCode(t[i>>5]>>>i%32&255);return e}function u(t){var i,e=[];for(e[(t.length>>2)-1]=void 0,i=0;i<e.length;i+=1)e[i]=0;for(i=0;i<8*t.length;i+=8)e[i>>5]|=(255&t.charCodeAt(i/8))<<i%32;return e}function c(t){return d(h(u(t),8*t.length))}function l(t,i){var e,n,s=u(t),a=[],o=[];for(a[15]=o[15]=void 0,s.length>16&&(s=h(s,8*t.length)),e=0;16>e;e+=1)a[e]=909522486^s[e],o[e]=1549556828^s[e];return n=h(a.concat(u(i)),512+8*i.length),d(h(o.concat(n),640))}function p(t){var i,e,n="0123456789abcdef",s="";for(e=0;e<t.length;e+=1)i=t.charCodeAt(e),s+=n.charAt(i>>>4&15)+n.charAt(15&i);return s}function f(t){return unescape(encodeURIComponent(t))}function m(t){return c(f(t))}function g(t){return p(m(t))}function v(t,i){return l(f(t),f(i))}function T(t,i){return p(v(t,i))}function C(t,i,e){return i?e?v(i,t):T(i,t):e?m(t):g(t)}"function"==typeof define&&define.amd?define(function(){return C}):"object"==typeof module&&module.exports?module.exports=C:t.md5=C}(this),this.TWIST=this.TWIST||{},function(){"use strict";function t(){this._isInited=!1,this.settings,this._queue=[]}var i=t.prototype;i.init=function(t){t=t||{},this.settings=t&&t.settings||{};var i=(t&&t.assetPath||TWIST.assetPath||"../src/themes/gb-web/")+"sounds/";createjs.Sound.registerSounds(this._sounds,i),this._isInited=!0},i.play=function(t,i){if(this._isInited){var e=createjs.Sound.play(t,i);return e.volume="undefined"==typeof this.settings.volume?1:this.settings.volume,e}},i.playQueue=function(t,i){function e(a){if(t[s]){var o=n.play(t[s],i);o.on("complete",function(){s++,e(s)})}}var n=this,s=0;e(s)},i.stop=function(t){createjs.Sound.stop(t)},i._sounds=[{id:"card/chia_bai",src:"card/chia_bai.ogg"},{id:"card/danh_bai",src:"card/danh_bai.ogg"},{id:"card/open_card",src:"card/open_card.ogg"},{id:"chip/call2",src:"chip/call2.ogg"},{id:"chip/multichip",src:"chip/multichip.ogg"},{id:"chip/singlechip",src:"chip/singlechip.ogg"},{id:"inroomgame/join_room",src:"inroomgame/join_room.ogg"},{id:"minigame/BetChips",src:"minigame/BetChips.ogg"},{id:"minigame/bonus_spin",src:"minigame/bonus_spin.ogg"},{id:"minigame/BoostWin",src:"minigame/BoostWin.ogg"},{id:"minigame/ButtonClick",src:"minigame/ButtonClick.ogg"},{id:"minigame/coin_spin",src:"minigame/coin_spin.ogg"},{id:"minigame/CollectChips",src:"minigame/CollectChips.ogg"},{id:"minigame/Common_Click",src:"minigame/Common_Click.ogg"},{id:"minigame/Common_Popup",src:"minigame/Common_Popup.ogg"},{id:"minigame/DoubleOrNothing",src:"minigame/DoubleOrNothing.ogg"},{id:"minigame/FlipCard",src:"minigame/FlipCard.ogg"},{id:"minigame/FlyingCard",src:"minigame/FlyingCard.ogg"},{id:"minigame/GotLevelUp",src:"minigame/GotLevelUp.ogg"},{id:"minigame/HoldCard",src:"minigame/HoldCard.ogg"},{id:"minigame/Nhac nen khi quay chiec non ky dieu 1 - CNKD",src:"minigame/Nhac nen khi quay chiec non ky dieu 1 - CNKD.ogg"},{id:"minigame/NormalWin",src:"minigame/NormalWin.ogg"},{id:"minigame/quay bai",src:"minigame/quay bai.ogg"},{id:"minigame/slot_result",src:"minigame/slot_result.ogg"},{id:"minigame/_GameTheme",src:"minigame/_GameTheme.ogg"},{id:"rotate/lucky_wheel",src:"rotate/lucky_wheel.ogg"},{id:"status/losing",src:"status/losing.ogg"},{id:"status/winning",src:"status/winning.ogg"},{id:"news/ahihi",src:"news/ahihi.ogg"},{id:"news/anhoidatcuoc",src:"news/anhoidatcuoc.ogg"},{id:"news/anroi",src:"news/anroi.ogg"},{id:"news/bat",src:"news/bat.ogg"},{id:"news/batdaudatcuoc",src:"news/batdaudatcuoc.ogg"},{id:"news/bellopen",src:"news/bellopen.ogg"},{id:"news/betS",src:"news/betS.ogg"},{id:"news/bich",src:"news/bich.ogg"},{id:"news/boba",src:"news/boba.ogg"},{id:"news/boi",src:"news/boi.ogg"},{id:"news/call2",src:"news/call2.ogg"},{id:"news/cao",src:"news/cao.ogg"},{id:"news/chan",src:"news/chan.ogg"},{id:"news/chia_bai",src:"news/chia_bai.ogg"},{id:"news/choithiepchu",src:"news/choithiepchu.ogg"},{id:"news/choitiepchu",src:"news/choitiepchu.ogg"},{id:"news/chuon",src:"news/chuon.ogg"},{id:"news/chuyen_view",src:"news/chuyen_view.ogg"},{id:"news/co",src:"news/co.ogg"},{id:"news/countDownS",src:"news/countDownS.ogg"},{id:"news/culu",src:"news/culu.ogg"},{id:"news/cuu",src:"news/cuu.ogg"},{id:"news/dam",src:"news/dam.ogg"},{id:"news/danh_bai",src:"news/danh_bai.ogg"},{id:"news/datcuocdianh",src:"news/datcuocdianh.ogg"},{id:"news/ddungdatcuoc",src:"news/ddungdatcuoc.ogg"},{id:"news/den",src:"news/den.ogg"},{id:"news/denthoidovanthe",src:"news/denthoidovanthe.ogg"},{id:"news/do",src:"news/do.ogg"},{id:"news/doi",src:"news/doi.ogg"},{id:"news/dong",src:"news/dong.ogg"},{id:"news/donghoa",src:"news/donghoa.ogg"},{id:"news/DoubleOrNothing",src:"news/DoubleOrNothing.ogg"},{id:"news/dungdatcuoc",src:"news/dungdatcuoc.ogg"},{id:"news/end_vongquay",src:"news/end_vongquay.ogg"},{id:"news/gia",src:"news/gia.ogg"},{id:"news/haidoi",src:"news/haidoi.ogg"},{id:"news/join_room",src:"news/join_room.ogg"},{id:"news/khongan",src:"news/khongan.ogg"},{id:"news/laithangroi",src:"news/laithangroi.ogg"},{id:"news/le",src:"news/le.ogg"},{id:"news/losing",src:"news/losing.ogg"},{id:"news/luc",src:"news/luc.ogg"},{id:"news/lucky_wheel",src:"news/lucky_wheel.ogg"},{id:"news/mini_betchip",src:"news/mini_betchip.ogg"},{id:"news/mini_caothapRoutate",src:"news/mini_caothapRoutate.ogg"},{id:"news/mini_clickButton",src:"news/mini_clickButton.ogg"},{id:"news/mini_flyCard",src:"news/mini_flyCard.ogg"},{id:"news/mini_holdCard",src:"news/mini_holdCard.ogg"},{id:"news/mini_nohu",src:"news/mini_nohu.ogg"},{id:"news/mini_route",src:"news/mini_route.ogg"},{id:"news/mini_slotLost",src:"news/mini_slotLost.ogg"},{id:"news/mobat",src:"news/mobat.ogg"},{id:"news/moidatcuoc",src:"news/moidatcuoc.ogg"},{id:"news/multichip",src:"news/multichip.ogg"},{id:"news/ngu",src:"news/ngu.ogg"},{id:"news/ngua4",src:"news/ngua4.ogg"},{id:"news/nhat",src:"news/nhat.ogg"},{id:"news/nhi",src:"news/nhi.ogg"},{id:"news/nohu",src:"news/nohu.ogg"},{id:"news/NormalWin",src:"news/NormalWin.ogg"},{id:"news/open_card",src:"news/open_card.ogg"},{id:"news/ro",src:"news/ro.ogg"},{id:"news/sanh",src:"news/sanh.ogg"},{id:"news/sanhrong",src:"news/sanhrong.ogg"},{id:"news/sanhtoi",src:"news/sanhtoi.ogg"},{id:"news/singlechip",src:"news/singlechip.ogg"},{id:"news/so_0",src:"news/so_0.ogg"},{id:"news/so_1",src:"news/so_1.ogg"},{id:"news/so_10",src:"news/so_10.ogg"},{id:"news/so_15",src:"news/so_15.ogg"},{id:"news/so_16",src:"news/so_16.ogg"},{id:"news/so_17",src:"news/so_17.ogg"},{id:"news/so_18",src:"news/so_18.ogg"},{id:"news/so_2",src:"news/so_2.ogg"},{id:"news/so_3",src:"news/so_3.ogg"},{id:"news/so_4",src:"news/so_4.ogg"},{id:"news/so_5",src:"news/so_5.ogg"},{id:"news/so_6",src:"news/so_6.ogg"},{id:"news/so_7",src:"news/so_7.ogg"},{id:"news/so_8",src:"news/so_8.ogg"},{id:"news/so_9",src:"news/so_9.ogg"},{id:"news/so_at",src:"news/so_at.ogg"},{id:"news/so_j",src:"news/so_j.ogg"},{id:"news/so_k",src:"news/so_k.ogg"},{id:"news/so_q",src:"news/so_q.ogg"},{id:"news/so_xi",src:"news/so_xi.ogg"},{id:"news/space",src:"news/space.ogg"},{id:"news/tai",src:"news/tai.ogg"},{id:"news/tam",src:"news/tam.ogg"},{id:"news/tattay",src:"news/tattay.ogg"},{id:"news/tep",src:"news/tep.ogg"},{id:"news/thang",src:"news/thang.ogg"},{id:"news/thapj",src:"news/thapj.ogg"},{id:"news/thaps",src:"news/thaps.ogg"},{id:"news/thats",src:"news/thats.ogg"},{id:"news/thu",src:"news/thu.ogg"},{id:"news/thua",src:"news/thua.ogg"},{id:"news/thuaroi",src:"news/thuaroi.ogg"},{id:"news/thung",src:"news/thung.ogg"},{id:"news/thungphasanh",src:"news/thungphasanh.ogg"},{id:"news/tong",src:"news/tong.ogg"},{id:"news/tu",src:"news/tu.ogg"},{id:"news/tuquy",src:"news/tuquy.ogg"},{id:"news/tyquy",src:"news/tyquy.ogg"},{id:"news/winning",src:"news/winning.ogg"},{id:"news/xam",src:"news/xam.ogg"},{id:"news/xamco",src:"news/xamco.ogg"},{id:"news/xap1",src:"news/xap1.ogg"},{id:"news/xap2",src:"news/xap2.ogg"},{id:"news/xap3",src:"news/xap3.ogg"},{id:"news/xap4",src:"news/xap4.ogg"},{id:"news/xiu",src:"news/xiu.ogg"},{id:"news/yeah",src:"news/yeah.ogg"},{id:"tone/bellopen",src:"tone/bellopen.ogg"},{id:"tone/chuyen_view",src:"tone/chuyen_view.ogg"},{id:"tone/end_vongquay",src:"tone/end_vongquay.ogg"}],TWIST.Sound=new t}(),this.TWIST=this.TWIST||{},function(){"use strict";TWIST.Observer=new EventEmitter,TWIST.Observer._canvasList=[],TWIST.imagePath="../src/themes/jarvanIV/images/"}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(i,e){return this instanceof t?(this.card=e,this.parent=this.card.parent,this.value=this.card.getValue(),this.index=this.parent.getChildIndex(this.card),this.rank=this.getRank(this.value),this.handCards=this.parent.children,void(this.cardsFire=i)):new t(i,e)}var i=t.prototype;i.getCards=function(){var t,i=this,e=i.cardsFire;return i.value>i._getMinPush()&&2!=e.length&&1!=e.length?[]:(e.sort(function(t,i){return t>i}),1!==e.length?this.getRank(e[0])==this.getRank(e[1])?(t=this.getPhomSpecial(e),t>0?i._getArrSpecialSuit(t):2==e.length&&e[0]>47?i._getChatDoi2():i._getSelectNgang()):this._getDoc():e[0]>=48?i._getCardsChat2():[])},i._getCardsChat2=function(){var t=this._getTuQuy();return 0==t.length&&(t=this._getDoithong(4)),0==t.length&&(t=this._getDoithong(3)),t},i._getChatDoi2=function(){var t=this._getTuQuy();return 0==t.length&&(t=this._getDoithong(4)),t},i._getTuQuyTohon=function(){var t=this.cardsFire[0];return this.getRank(t)>this.rank?[]:this._getTuQuy()},i._getMinPush=function(){return this.handCards[this.handCards.length-1].getValue()},i._getSodoithongChon=function(t){return this.getRank(this.cardsFire[0])>this.rank?void 0:this._getDoithong(t)},i._getTuQuy=function(){var t=this,i=_.filter(t.handCards,function(i){return t.getRank(i.getValue())==t.rank});return i.length<4&&(i=[]),i},i._getDoithong=function(t){for(var i=[],e=this.rank,n=(this.index,0);t>n;n++){for(var s=0,a=0;a<this.handCards.length&&(this.getRank(this.handCards[a].getValue())!=e||(s++,i.push(this.handCards[a]),2!=s));a++);if(2>s){i=[];break}e++}return i.length/2!=t&&(i=[]),i},i._getArrSpecialSuit=function(t){var i=[];switch(t){case 3:i=this._getDoithong(t),0==i.length&&(i=this._getTuQuy());break;case 4:i=this._getDoithong(t);break;case 5:i=this._getTuQuyTohon(),0==i.length&&(i=this._getDoithong(3))}return i},i._getSelectNgang=function(){var t=this,i=[],e=t.cardsFire.length;if(i=t.getCartsByRank(t.rank),i.length<e.length)return[];if(2==e&&this.getRank(t.cardsFire[0])==t.rank){var n=t.cardsFire[1]%4,s=i[0].getValue()%4,a=i[1].getValue()%4;a>s&&(s=a),n>s&&(i=[])}else t.rank>this.getRank(t.cardsFire[0])?(i=i.slice(0,e-1),-1==i.indexOf(t.card)&&i.push(t.card)):i=[];return i},i.getCartByRank=function(t){var i=this;return _.find(this.handCards,function(e){return i.getRank(e.getValue())==t})},i.getCartsByRank=function(t){var i=this;return _.filter(this.handCards,function(e){return i.getRank(e.getValue())==t})},i.isUndefined=function(t){return"undefined"==typeof t},i._getDoc=function(){var t=this,i=[],e=t.card,n=t.rank,s=this.getRank(t.cardsFire[0]);if(s>n)return[];i.push(e);for(var a=1;a<this.cardsFire.length;a++){if(n++,e=_.find(t.handCards,function(i){var e=t.getRank(i.getValue());if(12==e)return!1;if(t.getRank(i.getValue())==n){if(a!=t.cardsFire.length-1)return!0;if(i.getValue()>t.cardsFire[a])return!0}return!1}),this.isUndefined(e))return[];i.push(e)}return i},i.getRank=function(t){return Math.floor(t/4)},i.getPhomSpecial=function(t){var i,e,n=0;switch(t.length){case 4:i=this.getRank(t[0]),e=this.getRank(t[1]),i==e&&(n=5);break;case 6:i=this.getRank(t[0]),e=this.getRank(t[2]),i==e-1&&(n=3);break;case 8:i=this.getRank(t[0]),e=this.getRank(t[2]),i==e-1&&(n=4)}return n},TWIST.TLMNLogic=t}(),this.TWIST=this.TWIST||{},function(){var t,i;t=52,i=[100,1e3,1e4,1e5];var e=new EventEmitter,n=e;n.generateMap=function(i){for(var e=[],n=0;5>n;n++)e[n]=i?i[n]:Math.floor(Math.random()*t);return e},TWIST.MiniPokerLogic=e}(),this.FATE=this.FATE||{},function(){"use strict";function t(t,e){return i?i:void this.init()}var i,e=t.prototype;e.init=function(){this.rooms=[]},FATE.MockupServer=t}(),function(){window.TWIST=window.TWIST||{},TWIST.HTMLTemplate={canvas:'<canvas class="gameCanvas" width="1280" height="720" ></canvas>',errorPanel:'<div class="error-panel">\r\n    \r\n</div>',"buttonBar/callSamButton":'<div class="button fourth blue" id="call-sam">Báo sâm</div>',"buttonBar/eatCardButton":'<div class="button second yellow" id="eat-card">Ăn</div>',"buttonBar/entiretyButton":'<div class="button second yellow" id="entirety-card">Ù</div>',"buttonBar/foldSamButton":'<div class="button third white" id="fold-sam">Bỏ sâm</div>',"buttonBar/foldTurnButton":'<div class="button second white" id="fold-turn">Bỏ lượt</div>\r\n',"buttonBar/getCardButton":'<div class="button first blue" id="get-card">Bốc bài</div>',"buttonBar/hitButton":'<div class="button first yellow" id="hit-card">Đánh bài</div>',"buttonBar/openCardButton":'<div class="button first blue" id="start-button">Bắt đầu</div>',"buttonBar/sendCardButton":'<div class="button second blue" id="send-card">Gửi bài</div>',"buttonBar/showPhomButton":'<div class="button second yellow" id="eat-card">Hạ bài</div>',"buttonBar/sortCardButton":'<div class="button third blue" id="sort-card">Xắp xếp</div>',"buttonBar/startButton":'<div class="button first yellow" id="start-button">Bắt đầu</div>',"buttonBar/wrapper":'<div class="button-bar"></div>',"effect/explodePot":'<div class="explorer-pot">\r\n    <span class="effect"></span>\r\n    <span class="txt"></span>\r\n</div>\r\n<div class="money-falling">\r\n    <div class="text-light pos-1">\r\n        <i class="l-obj lobj-1"></i>\r\n        <i class="l-obj lobj-2"></i>\r\n        <i class="l-obj lobj-3"></i>\r\n        <i class="l-obj lobj-4"></i>\r\n        <i class="l-obj lobj-5"></i>\r\n        <i class="l-obj lobj-6"></i>\r\n        <i class="l-obj lobj-7"></i>\r\n        <i class="l-obj lobj-8"></i>\r\n    </div>\r\n    <div class="text-light pos-2">\r\n        <i class="l-obj lobj-1"></i>\r\n        <i class="l-obj lobj-2"></i>\r\n        <i class="l-obj lobj-3"></i>\r\n        <i class="l-obj lobj-4"></i>\r\n        <i class="l-obj lobj-5"></i>\r\n        <i class="l-obj lobj-6"></i>\r\n        <i class="l-obj lobj-7"></i>\r\n        <i class="l-obj lobj-8"></i>\r\n    </div>\r\n    <div class="text-light pos-3">\r\n        <i class="l-obj lobj-1"></i>\r\n        <i class="l-obj lobj-2"></i>\r\n        <i class="l-obj lobj-3"></i>\r\n        <i class="l-obj lobj-4"></i>\r\n        <i class="l-obj lobj-5"></i>\r\n        <i class="l-obj lobj-6"></i>\r\n        <i class="l-obj lobj-7"></i>\r\n        <i class="l-obj lobj-8"></i>\r\n    </div>\r\n    <div class="text-light pos-4">\r\n        <i class="l-obj lobj-1"></i>\r\n        <i class="l-obj lobj-2"></i>\r\n        <i class="l-obj lobj-3"></i>\r\n        <i class="l-obj lobj-4"></i>\r\n        <i class="l-obj lobj-5"></i>\r\n        <i class="l-obj lobj-6"></i>\r\n        <i class="l-obj lobj-7"></i>\r\n        <i class="l-obj lobj-8"></i>\r\n    </div>\r\n</div>',"effect/wrapper":'<div class="effect"></div>',"hightLow/bottom":'<div class="bottom">\r\n    <div class="profile-hight-low">\r\n\r\n    </div>\r\n    <div class="chips-hight-low">\r\n\r\n    </div>\r\n    <div class="new-turn-button">Lượt mới</div>\r\n</div>\r\n',"hightLow/center":'<div class="center">\r\n    <div class="text-support">Quân bài tiếp theo là cao hay thấp ?</div>\r\n    <div class="remain-time"></div>\r\n    <div class="canvas-wrapper">\r\n        <div class="game-button left-button">\r\n            <div class="low-button"></div>\r\n            <div class="low-value">0</div>\r\n        </div>\r\n        <div class="game-button right-button">\r\n            <div class="hight-button"></div>\r\n            <div class="hight-value">0</div>\r\n        </div>\r\n        <div class="virtual-card">\r\n            <div class="new-turn-text">\r\n                Bốc bài\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n',"hightLow/top":'<div class="top">\r\n    <div class="pot">\r\n        <div class="title">Hũ thưởng</div>\r\n        <div class="pot-value">0</div>\r\n    </div>\r\n    <div class="bank">\r\n        <div class="title">Bank</div>\r\n        <div class="bank-value">0</div>\r\n    </div>\r\n    <div class="pot-cards">\r\n        <div class="pot-card"></div>\r\n        <div class="pot-card"></div>\r\n        <div class="pot-card"></div>\r\n    </div>\r\n</div>\r\n',"hightLow/wrapper":'<div class="hight-low"></div>\r\n',"inviteList/inviteItem":'<div class="invite-item">\r\n    <div class="invite-item-inner"></div>\r\n</div>\r\n',"inviteList/wrapper":'<div class="invite-wrapper">\r\n    \r\n</div>\r\n',"miniPoker/autospin":'<div class="autospin">\r\n    <input id="autospin" type="checkbox" />\r\n    <label for="autospin"></label>\r\n    <span>Tự động quay</span>\r\n</div>\r\n',"miniPoker/button":'<div class="button-spin"></div>',"miniPoker/chips":'<div class="chip-group">\r\n    <div class="chip violet">1K</div>\r\n    <div class="chip green">10k</div>\r\n    <div class="chip blue">100k</div>\r\n</div>\r\n',"miniPoker/errorPanel":'<div class="error-panel-mini">\r\n    \r\n</div>',"miniPoker/pot":'<div class="pot">\r\n    Hũ thưởng\r\n    <div class="pot-value"></div>\r\n</div>',"miniPoker/resultItem":'<div class="result-mini-item">\r\n    <span class="icon"></span>\r\n    <%- name %> \r\n    <div class="value"><%- value %> </div>\r\n</div>',"miniPoker/resultTab":'<div class="result-mini-poker-tab"></div>',"miniPoker/resultText":'<div class="result-text"></div>',"miniPoker/sessionId":'<div class="session-id"></div>',"miniPoker/user":'<div class="profile">\r\n    <div class="profile-left">\r\n        <div class="user avatar" ></div>\r\n    </div>\r\n    <div class="profile-right">\r\n        <div class="username "></div>\r\n        <div class="money "></div>\r\n    </div>\r\n</div>',"miniPoker/winMoney":'<div class="win-money"></div>',"miniPoker/wrapper":'<div class="mini-poker-bg"></div>\r\n',"resultPanel/card":'<div class="card card<%- id %>"></div>',"resultPanel/user":'<div class="result-item <%- isWinnerClass %>">\r\n    <div class="result-item-info"> \r\n        <div class="result-item-username"><%- username %> </div>\r\n        <div class="result-item-result-info">\r\n            <span class="result-item-money"><%- moneyChange %></span>\r\n            <div class="user-result-string"x><%- resultText %></div>\r\n        </div>\r\n    </div>\r\n    <div class="result-card-list-container">\r\n        <%= cardList %>\r\n    </div>\r\n</div>',"resultPanel/wrapper":'<div class="game-result">\r\n    <div class="global-mask"></div>\r\n    <div class="game-result-popup">\r\n        <div class="popup-header">\r\n            <div class="popup-icon"></div> \r\n            <div class="close-popup">X</div>\r\n        </div>\r\n        <div class="popup-content">\r\n            <div class="container">\r\n                <div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>',"taiXiu/bettingPosition":'<div class="name"></div>\r\n<div class="ratio"></div>\r\n<div class="betting-number-wrapper">\r\n    <div class="betting-number-inner">\r\n        <div class="mine-betting">\r\n            0\r\n        </div><div class="total-betting">\r\n            0\r\n        </div>\r\n    </div>\r\n</div>\r\n',"taiXiu/buttons":'<div class="button-bar taixiu-button-bar">\r\n    <div class="button blue  xocdia-button  button-bottom" id="cancelBetting">Hủy cược</div>\r\n    <div class="button orange xocdia-button  button-bottom" id="sellOdd">Bán cửa</div>\r\n    <div class="button blue xocdia-button  button-bottom" id="resignation">Hủy cái</div>\r\n    <div class="button orange xocdia-button  button-bottom" id="reBetting">Đặt lại</div>\r\n    <!--<div class="button blue button-top" id="sellEven">Bán cửa chẵn</div>-->\r\n    <div class="button orange xocdia-button  button-top" id="getHost">Xin cái</div>\r\n</div>',"taiXiu/changeMoney":'<div class="change-money"></div>\r\n',"taiXiu/chips":'<div class="chip-group">\r\n    <div class="chip chip-1st">1</div>\r\n    <div class="chip chip-2nd">2</div>\r\n    <div class="chip chip-3rd">4</div>\r\n    <div class="chip chip-4th">10</div>\r\n</div>\r\n',"taiXiu/coin-item":'<div class="coin-item"></div>',"taiXiu/history-item":'<div class="history-item">\r\n    <div class="history-item-number"></div>\r\n    <div class="history-item-type"></div>\r\n    <div class="history-item-dices">\r\n        <div class="history-item-dice" id="dice-position0"></div>\r\n        <div class="history-item-dice" id="dice-position1"></div>\r\n        <div class="history-item-dice" id="dice-position2"></div>\r\n    </div>\r\n</div>\r\n',"taiXiu/history-old":'<div class="taixiu-history">\r\n    <div class="taixiu-history-title">Lịch sử</div>\r\n    <div class="taixiu-history-content">\r\n        <div class="taixiu-history-content-inner"></div>\r\n    </div>\r\n</div> \r\n',"taiXiu/history":'<div class="history-wrapper">\r\n<!--    <div class="history-odd"></div>\r\n    <div class="history-event"></div>-->\r\n    <div class="history">\r\n    </div>\r\n</div>\r\n',"taiXiu/host":'<div class="host-wrapper">\r\n    <div class="host-background"></div>\r\n    <div class="host">\r\n        <div class="host-name">\r\n            Doreamon\r\n        </div>\r\n        <div class="chat-box">\r\n            <div class="chat-box-inner">\r\n                Thời gian cái thừa  thiếu.  \r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>',"taiXiu/listPlayer":'<div class="list-player"></div>',"taiXiu/resultChip":'<div class="result-chip">\r\n    <div class="inner-chip">\r\n        \r\n    </div>\r\n</div>',"taiXiu/resultChipColumn":'<div class="result-chip-column">\r\n    \r\n</div>',"taiXiu/sellPopup":'<div class="sell-popup">\r\n    <div class="sell-popup-background"></div>\r\n    <div class="sell-popup-center">\r\n        <div class="sell-popup-title"></div>\r\n        <div class="sell-popup-close"></div>\r\n        <div class="sell-popup-content">\r\n            <div class="sell-popup-minus"></div>\r\n            <div class="sell-popup-plus"></div>\r\n            <div class="sell-popup-dragbar" id="sell-popup-drag-container">\r\n                <div class="sell-popup-dragbar-inner"></div>\r\n                <div class="sell-popup-scroller" id="scroller"> \r\n                    <div class="sell-popup-scroller-content">\r\n                        0 V\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class="sell-popup-button-bar">\r\n                <div class="sell-popup-button" id="cancel">HỦY BỎ</div>\r\n                <div class="sell-popup-button" id="accept">ĐỒNG Ý</div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>',"taiXiu/table":'<div class="table">\r\n    \r\n</div>',"taiXiu/totalTable":'<div class="total-table">\r\n    <div class="total-table-betting">0</div>\r\n    <div class="total-table-win">0</div>\r\n</div>',"taiXiu/user":'<div class="profile">\r\n    <div class="profile-left">\r\n        <div>\r\n            <div class="username "></div>\r\n            <div class="money "></div>\r\n        </div>\r\n    </div>\r\n    <div class="profile-right">\r\n        <div class="user avatar avatar1" ></div>\r\n    </div>\r\n</div>',"taiXiu/vitualBetting":'<div class="vitual-betting-position">\r\n</div>\r\n',"taiXiu/wrapper":'<div class="taixiu-wrapper"></div>',"tinyHightLow/bottom":'<div class="bottom">\r\n    <div class="profile-hight-low">\r\n\r\n    </div>\r\n    <div class="chips-hight-low">\r\n\r\n    </div>\r\n    <div class="new-turn-button"></div>\r\n    <div class="get-card"></div>\r\n    <div class="button-close"></div>\r\n    <div class="button-history"></div>\r\n    <div class="button-help"></div>\r\n</div>\r\n',"tinyHightLow/center":'<div class="center">\r\n    <div class="text-support">Quân bài tiếp theo là cao hay thấp ?</div>\r\n    <div class="remain-time"></div>\r\n    <div class="canvas-wrapper">\r\n        <div class="game-button left-button">\r\n            <div class="low-button"></div>\r\n            <div class="low-value">0</div>\r\n        </div>\r\n        <div class="game-button right-button">\r\n            <div class="hight-button"></div>\r\n            <div class="hight-value">0</div>\r\n        </div>\r\n        <div class="virtual-card">\r\n            <div class="new-turn-text">\r\n                Bốc bài\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n',"tinyHightLow/top":'<div class="top">\r\n    <div class="pot">\r\n        <div class="pot-value">0</div>\r\n    </div>\r\n    <div class="bank">\r\n        <div class="bank-value">0</div>\r\n    </div>\r\n    <div class="pot-cards">\r\n        <div class="pot-card"></div>\r\n        <div class="pot-card"></div>\r\n        <div class="pot-card"></div>\r\n    </div>\r\n</div>\r\n',"tinyHightLow/wrapper":'<div class="tiny-hight-low tiny-mini-poker-bg "></div>\r\n',"tinyMiniPoker/autospin":'<div class="autospin">\r\n    <input id="autospin" type="checkbox" />\r\n    <label for="autospin"></label>\r\n    <span>Tự động quay</span>\r\n</div>\r\n',"tinyMiniPoker/buttonClose":'<div class="button-close"></div>',"tinyMiniPoker/buttonHelp":'<div class="button-help"></div>',"tinyMiniPoker/buttonHistory":'<div class="button-history"></div>',"tinyMiniPoker/buttonSpin":'<div class="button-spin"></div>',"tinyMiniPoker/canvasWrapper":'<div class="tinyMiniPokerCanvasSVG">\r\n    <svg height="0" width="0">\r\n    <defs>\r\n    <clipPath id="tinyMiniPokerCanvasSVG">\r\n        <path d="M138.891,4.438H617.9A153.257,153.257,0,0,1,771.156,157.7V262.952a9.579,9.579,0,0,1-9.579,9.579H138.891A134.047,134.047,0,0,1,4.844,138.484v0A134.047,134.047,0,0,1,138.891,4.438Z"/>\r\n    </clipPath>\r\n    </defs>\r\n    </svg>\r\n\r\n</div> \r\n',"tinyMiniPoker/chips":'<div class="chip-group">\r\n    <div class="chip">1K</div>\r\n    <div class="chip">10k</div>\r\n    <div class="chip">100k</div>\r\n\r\n    <svg height="0" width="0">\r\n    <defs>\r\n    <clipPath id="tinyMiniPokerChip1">\r\n        <path d="M92.082,135.187A124.371,124.371,0,0,1,111,101.092c12.027-15.371,13.184-36.546,2.291-52.735L82.239,2.21a212.043,212.043,0,0,0-79.72,99.054Z"/>\r\n    </clipPath>\r\n    <clipPath id="tinyMiniPokerChip2">\r\n        <path d="M98.6,75.669h0a123.988,123.988,0,0,1,6.228-38.849L15.155,2.856a210.943,210.943,0,0,0-2.21,139.306L102.9,108.091A124.187,124.187,0,0,1,98.6,75.669Z"/>\r\n    </clipPath>\r\n    <clipPath id="tinyMiniPokerChip3">\r\n        <path d="M91.954,2.8L2.173,36.8A211.869,211.869,0,0,0,80.741,139.733l31.685-45.111c11.184-15.924,11.2-37.348-.562-52.851A124.156,124.156,0,0,1,91.954,2.8Z" />\r\n    </clipPath>\r\n    </defs>\r\n    </svg>\r\n</div>',
"tinyMiniPoker/errorPanel":'<div class="error-panel-mini">\r\n    \r\n</div>',"tinyMiniPoker/pot":'<div class="pot">\r\n    Hũ thưởng\r\n    <div class="pot-value"></div>\r\n</div>',"tinyMiniPoker/resultItem":'<div class="result-mini-item">\r\n    <span class="icon"></span>\r\n    <%- name %> \r\n    <div class="value"><%- value %> </div>\r\n</div>',"tinyMiniPoker/resultTab":'<div class="result-mini-poker-tab"></div>',"tinyMiniPoker/resultText":'<div class="result-text"></div>',"tinyMiniPoker/sessionId":'<div class="session-id"></div>',"tinyMiniPoker/user":'<div class="profile">\r\n    <div class="profile-left">\r\n        <div class="user avatar" ></div>\r\n    </div>\r\n    <div class="profile-right">\r\n        <div class="username "></div>\r\n        <div class="money "></div>\r\n    </div>\r\n</div>',"tinyMiniPoker/winMoney":'<div class="win-money"></div>',"tinyMiniPoker/wrapper":'<div class="tiny-mini-poker-bg"></div> \r\n',"tinyVideoPoker/button":'<div class="button-spin"></div>',"tinyVideoPoker/buttonClose":'<div class="button-close"></div>',"tinyVideoPoker/buttonHelp":'<div class="button-help"></div>',"tinyVideoPoker/buttonHistory":'<div class="button-history"></div>',"tinyVideoPoker/canvasWrapper":'<div class="tinyVideoPokerCanvasSVG">\r\n    <svg height="0" width="0">\r\n    <defs>\r\n    <clipPath id="tinyVideoPokerCanvasSVG">\r\n        <path d="M138.891,4.438H617.9A153.257,153.257,0,0,1,771.156,157.7V262.952a9.579,9.579,0,0,1-9.579,9.579H138.891A134.047,134.047,0,0,1,4.844,138.484v0A134.047,134.047,0,0,1,138.891,4.438Z"/>\r\n    </clipPath>\r\n    </defs>\r\n    </svg>\r\n\r\n</div> \r\n',"tinyVideoPoker/chips":'<div class="chip-group">\r\n    <div class="chip">1K</div>\r\n    <div class="chip">10k</div>\r\n    <div class="chip">100k</div>\r\n\r\n    <svg height="0" width="0">\r\n    <defs>\r\n    <clipPath id="tinyMiniPokerChip1">\r\n        <path d="M92.082,135.187A124.371,124.371,0,0,1,111,101.092c12.027-15.371,13.184-36.546,2.291-52.735L82.239,2.21a212.043,212.043,0,0,0-79.72,99.054Z"/>\r\n    </clipPath>\r\n    <clipPath id="tinyMiniPokerChip2">\r\n        <path d="M98.6,75.669h0a123.988,123.988,0,0,1,6.228-38.849L15.155,2.856a210.943,210.943,0,0,0-2.21,139.306L102.9,108.091A124.187,124.187,0,0,1,98.6,75.669Z"/>\r\n    </clipPath>\r\n    <clipPath id="tinyMiniPokerChip3">\r\n        <path d="M91.954,2.8L2.173,36.8A211.869,211.869,0,0,0,80.741,139.733l31.685-45.111c11.184-15.924,11.2-37.348-.562-52.851A124.156,124.156,0,0,1,91.954,2.8Z" />\r\n    </clipPath>\r\n    </defs>\r\n    </svg>\r\n</div>',"tinyVideoPoker/doubleButton":'<div class="button-spin double-button"></div>',"tinyVideoPoker/errorPanel":'<div class="error-panel-mini">\r\n    \r\n</div>',"tinyVideoPoker/getWinButton":'<div class="get-win-button">\r\n    <!--Nhận thưởng-->\r\n</div>',"tinyVideoPoker/moveChip":'<div class="move-chip">\r\n    <i class="chip1"></i>\r\n    <i class="chip2"></i>\r\n    <i class="chip3"></i>\r\n    <i class="chip4"></i>\r\n    <i class="chip5"></i>\r\n    <i class="chip6"></i>\r\n    <i class="chip7"></i>\r\n    <i class="chip8"></i>\r\n</div>',"tinyVideoPoker/pot":'<div class="pot">\r\n    Hũ thưởng\r\n    <div class="pot-value"></div>\r\n</div>',"tinyVideoPoker/resultItem":'<div class="result-mini-item">\r\n    <span class="icon"></span>\r\n    <%- name %> \r\n    <div class="value"><%- value %> </div>\r\n</div>',"tinyVideoPoker/resultTab":'<div class="result-mini-poker-tab"></div>',"tinyVideoPoker/resultText":'<div class="result-text"></div>',"tinyVideoPoker/sessionId":'<div class="session-id"></div>',"tinyVideoPoker/supportText":'<div class="support-text"></div>',"tinyVideoPoker/user":'<div class="profile">\r\n    <div class="profile-left">\r\n        <div class="user avatar" ></div>\r\n    </div>\r\n    <div class="profile-right">\r\n        <div class="username "></div>\r\n        <div class="money "></div>\r\n    </div>\r\n</div>',"tinyVideoPoker/virtualCards":'<div class="virtualCards">\r\n    <div class="card vitualCard1">\r\n        \r\n    </div>\r\n    <div class="card vitualCard2">\r\n        \r\n    </div>\r\n    <div class="card vitualCard3">\r\n        \r\n    </div>\r\n    <div class="card vitualCard4">\r\n        \r\n    </div>\r\n    <div class="card vitualCard5">\r\n        \r\n    </div>\r\n</div>',"tinyVideoPoker/wrapper":'<div class="tiny-mini-poker-bg tiny-video-poker"></div>\r\n',"videoPoker/button":'<div class="button-spin"></div>',"videoPoker/chips":'<div class="chip-group">\r\n    <div class="chip violet">1K</div>\r\n    <div class="chip green">10k</div>\r\n    <div class="chip blue">100k</div>\r\n</div>\r\n',"videoPoker/doubleButton":'<div class="button-spin double-button"></div>',"videoPoker/errorPanel":'<div class="error-panel-mini">\r\n    \r\n</div>',"videoPoker/getWinButton":'<div class="get-win-button">\r\n    Nhận thưởng\r\n</div>',"videoPoker/moveChip":'<div class="move-chip">\r\n    <i class="chip1"></i>\r\n    <i class="chip2"></i>\r\n    <i class="chip3"></i>\r\n    <i class="chip4"></i>\r\n    <i class="chip5"></i>\r\n    <i class="chip6"></i>\r\n    <i class="chip7"></i>\r\n    <i class="chip8"></i>\r\n</div>',"videoPoker/pot":'<div class="pot">\r\n    Hũ thưởng\r\n    <div class="pot-value"></div>\r\n</div>',"videoPoker/resultItem":'<div class="result-mini-item">\r\n    <span class="icon"></span>\r\n    <%- name %> \r\n    <div class="value"><%- value %> </div>\r\n</div>',"videoPoker/resultTab":'<div class="result-mini-poker-tab"></div>',"videoPoker/resultText":'<div class="result-text"></div>',"videoPoker/sessionId":'<div class="session-id"></div>',"videoPoker/supportText":'<div class="support-text"></div>',"videoPoker/user":'<div class="profile">\r\n    <div class="profile-left">\r\n        <div class="user avatar" ></div>\r\n    </div>\r\n    <div class="profile-right">\r\n        <div class="username "></div>\r\n        <div class="money "></div>\r\n    </div>\r\n</div>',"videoPoker/virtualCards":'<div class="virtualCards">\r\n    <div class="card vitualCard1">\r\n        \r\n    </div>\r\n    <div class="card vitualCard2">\r\n        \r\n    </div>\r\n    <div class="card vitualCard3">\r\n        \r\n    </div>\r\n    <div class="card vitualCard4">\r\n        \r\n    </div>\r\n    <div class="card vitualCard5">\r\n        \r\n    </div>\r\n</div>',"videoPoker/wrapper":'<div class="mini-poker-bg video-poker"></div>\r\n',"xocDia/bettingPosition":'<div class="betting-position">\r\n    <div class="coin-tittle"></div>\r\n    <div class="name"></div>\r\n    <div class="mine-betting">\r\n        0\r\n    </div>\r\n    <div class="total-betting">\r\n        0\r\n    </div>\r\n</div>\r\n',"xocDia/buttons":'<div class="button-bar xocdia-button-bar">\r\n    <div class="button blue xocdia-button button-bottom" id="cancelBetting">Hủy cược</div>\r\n    <div class="button orange xocdia-button button-bottom" id="sellOdd">Bán cửa lẽ</div>\r\n    <div class="button blue xocdia-button button-bottom" id="resignation">Hủy cái</div>\r\n    <div class="button orange xocdia-button button-top" id="reBetting">Đặt lại</div>\r\n    <div class="button orange xocdia-button button-top" id="sellEven">Bán cửa chẵn</div>\r\n    <div class="button orange xocdia-button button-top" id="getHost">Xin cái</div>\r\n</div>',"xocDia/changeMoney":'<div class="change-money"></div>\r\n',"xocDia/chips":'<div class="chip-group">\r\n    <div class="chip chip-1st">1</div>\r\n    <div class="chip chip-2nd">2</div>\r\n    <div class="chip chip-3rd">4</div>\r\n    <div class="chip chip-4th">10</div>\r\n</div>\r\n',"xocDia/coin-item":'<div class="coin-item"></div>',"xocDia/history":'<div class="history-wrapper">\r\n<!--    <div class="history-odd"></div>\r\n    <div class="history-event"></div>-->\r\n    <div class="history">\r\n    </div>\r\n</div>\r\n',"xocDia/host":'<div class="host-wrapper">\r\n    <div class="host-background"></div>\r\n    <div class="host">\r\n        <div class="host-name">\r\n            Doreamon\r\n        </div>\r\n        <div class="chat-box">\r\n            <div class="chat-box-inner">\r\n                Thời gian cái thừa  thiếu.  \r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>',"xocDia/listPlayer":'<div class="list-player">1</div>',"xocDia/resultChip":'<div class="result-chip">\r\n    <div class="inner-chip">\r\n        \r\n    </div>\r\n</div>',"xocDia/resultChipColumn":'<div class="result-chip-column">\r\n    \r\n</div>',"xocDia/sellPopup":'<div class="sell-popup">\r\n    <div class="sell-popup-background"></div>\r\n    <div class="sell-popup-center">\r\n        <div class="sell-popup-title"></div>\r\n        <div class="sell-popup-close"></div>\r\n        <div class="sell-popup-content">\r\n            <div class="sell-popup-minus"></div>\r\n            <div class="sell-popup-plus"></div>\r\n            <div class="sell-popup-dragbar" id="sell-popup-drag-container">\r\n                <div class="sell-popup-dragbar-inner"></div>\r\n                <div class="sell-popup-scroller" id="scroller"> \r\n                    <div class="sell-popup-scroller-content">\r\n                        0 V\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class="sell-popup-button-bar">\r\n                <div class="sell-popup-button" id="cancel">HỦY BỎ</div>\r\n                <div class="sell-popup-button" id="accept">ĐỒNG Ý</div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>',"xocDia/totalTable":'<div class="total-table">\r\n    <div class="total-table-betting">0</div>\r\n    <div class="total-table-win">0</div>\r\n</div>',"xocDia/user":'<div class="profile">\r\n    <div class="profile-left">\r\n        <div>\r\n            <div class="username "></div>\r\n            <div class="money "></div>\r\n        </div>\r\n    </div>\r\n    <div class="profile-right">\r\n        <div class="user avatar avatar1" ></div>\r\n    </div>\r\n</div>',"xocDia/vitualBetting":'<div class="vitual-betting-position">\r\n</div>\r\n',"xocDia/wrapper":'<div class="xocdia-wrapper"></div>'}}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t){("number"!=typeof t||0>t||t>51)&&(t=-1),this.initialize(t)}function i(t){var i=Math.floor(t/4),e=Math.floor(t%4);return(0>t||t>=52)&&(i=-1,e=4),{rank:i,suite:e}}var e=location.origin+location.pathname+"../src/images/";t.size={width:90,height:123},t.userCard={width:90,height:123,cardDraggable:!0,selectedHeight:20,scale:.6,seperator:91},t.userCard.scale=t.userCard.width/t.size.width,t.playerCard={width:45,height:61.5,seperator:0,cardDraggable:!1,scale:.33},t.playerCard.scale=t.playerCard.width/t.size.width,t.deckCard={width:45,height:61.5,seperator:.1},t.deckCard.scale=t.deckCard.width/t.size.width,t.draftCard={width:45,height:61.5,seperator:46},t.draftCard.scale=t.draftCard.width/t.size.width,t.demlaDraftCard={width:70,height:95,seperator:72},t.demlaDraftCard.scale=t.demlaDraftCard.width/t.size.width,t.phomDraftCard={width:64,height:82,seperator:67},t.phomDraftCard.scale=t.phomDraftCard.width/t.size.width,t.threeCards={width:54,height:73.8,seperator:55,scale:.6},t.threeCards.scale=t.threeCards.width/t.size.width,t.threeCardsBanker={width:63,height:86.1,seperator:64,scale:.7},t.threeCardsBanker.scale=t.threeCardsBanker.width/t.size.width,t.miniPoker={width:115,height:153},t.miniPoker.scale=t.miniPoker.width/t.size.width,t.shadow=new createjs.Shadow("#0ff",0,0,10),t.Suite={3:0,2:1,1:3,0:2,4:4},t.NumberCardInHand=13,t.SuitMap=["♠","♣","♦","♥"],t.SuitNameMap=["b","t","r","c"],t.SuitImageIndex=["♠","♣","♦","♥"];var n=t.prototype=new createjs.Container;n.container_initialize=n.initialize,n.initialize=function(t){this.container_initialize(),this._init(),this.setValue(t)},n._init=function(){var i=new Image;this.image=i,i.src=(TWIST.imagePath||e)+"card/cards.png";var n=new createjs.Bitmap(i);this.bg=n,n.sourceRect=$.extend({},t.size),n.sourceRect.x=0,n.sourceRect.y=t.size.height*t.SuitNameMap.length,this.inPhom=new createjs.Bitmap(i),this.inPhom.sourceRect={width:25,height:25,x:100,y:524},this.inPhom.set({x:55,y:10}),this.inPhom.visible=!1,this.eatEffect=this.border=new createjs.Bitmap(i),this.eatEffect.sourceRect={width:t.size.width+4,height:t.size.height+3,x:2*t.size.width,y:t.size.height*t.SuitNameMap.length},this.eatEffect.set({x:-2,y:-1.5}),this.eatEffect.visible=this.showEatEffect,this.addChild(n,this.inPhom,this.eatEffect)},n.setValue=function(e){var n=i(e);this.cardValue=e,this.rank=n.rank,this.suite=n.suite;var s=this.bg;if(-1!==e){t.RankMapIndex=t.RankMapIndex||["1","2","3","4","5","6","7","8","9","10","11","12","13"];var a=t.RankMapIndex[n.rank];t.SuitMap[n.suite];s.sourceRect.x=(a-1)*t.size.width,s.sourceRect.y=n.suite*t.size.height}else s.sourceRect.x=0,s.sourceRect.y=t.size.height*t.SuitNameMap.length},n.getValue=function(){return this.cardValue},n.removeAllSelected=function(){this.parent.children.forEach(function(t,i){t.setSelected(!1)})},n.openCard=function(i,e){var n=this.x;return e=e||t.userCard,createjs.Tween.get(this).to({scaleX:.1,x:n+e.width/2},150).call(function(){this.setValue(i),this.cardValue=i;try{this.updateCache()}catch(t){}}).to({scaleX:e.scale,scaleY:e.scale,x:n},150).call(function(){this.isTracking&&TWIST.Observer.emit("cardOpened",this),this.setInPhom(this.isInPhom)})},n.upSideDown=function(i){var e=this.x;return i=i||t.userCard,createjs.Tween.get(this).to({scaleX:.1,x:e+i.width/2},150).call(function(){this.cardValue=-1,this.setValue(-1);try{this.updateCache()}catch(t){}}).to({scaleX:i.scale,scaleY:i.scale,x:e},150).call(function(){})},n.tipOff=function(){if(this.IsFlip!==!1){var i=this.x;return this.removeAllEventListeners(),createjs.Tween.get(this).to({scaleX:.1,x:i+this.width/2},150).call(function(){this.setValue(-1)}).to({scaleX:t.draftCard.scale,x:i},150).call(function(){this.filters=[new createjs.ColorMatrixFilter(new createjs.ColorMatrix(0,0,0,0))];try{this.updateCache()}catch(t){console.log(t)}})}},n.movePosition=function(t){this.parent&&createjs.Tween.get(this).to({x:t.x,y:t.y},150).call(function(){})},n.setSelected=function(i){if(i){var e=-t.userCard.selectedHeight;createjs.Tween.get(this).to({y:e},100).call(function(){this.selected=!0})}else this.selected=!1,this.y=0},n.toggedSelected=function(){var t=this;if(this.isSelected)this.isSelected=!1,this.y=this.y+15,t.parent.swapCardX=void 0,t.parent.swapCardY=void 0,t.parent.selectedCard=void 0;else{var i=this.y-15;t.parent.setChildIndex(t,12),t.isSelected=!0,createjs.Tween.get(this).to({y:i},100).call(function(){t.parent.selectedCard=t})}},n.setDraggable=function(t){var i=this;this.removeAllEventListeners("mousedown"),this.removeAllEventListeners("pressmove"),this.removeAllEventListeners("pressup"),t&&(this.addEventListener("mousedown",function(t){i.startPositionX=i.x,i.startPositionY=i.y,i.startMousePositionX=t.stageX,i.startMousePositionY=t.stageY,i.parent.addChild(i)}),this.addEventListener("pressmove",function(t){i.parent.addChild(i);var e=t.stageX-i.startMousePositionX,n=t.stageY-i.startMousePositionY;if(!(Math.abs(e)+Math.abs(n)<=10)){i.isDragging=!0,i.x=i.startPositionX+e,i.y=i.startPositionY+n;var s=i.parent,a=s.indexLeft,o=s.globalToLocal(t.stageX-a,t.stageY);if(o.y>0&&o.y<=i.height){var r=Math.floor(o.x/i.seperator);if(r=0>r?0:r>=s.children.length-1?s.children.length-1:r,r!=i.position){var h=(Math.abs(r-i.position),(r-i.position)/Math.abs(r-i.position));s.children.forEach(function(t,e){(t.position-r)*(t.position-i.position)<=0&&t.position!=i.position&&(t.position-=h,t.moveToPosition(t.position))})}i.position=r}}}),this.addEventListener("pressup",function(t){i.isDragging&&(i.selected=!1,i.moveToPosition(i.position),i.parent.children.sort(function(t,i){return t.position-i.position})),i.isDragging=!1}))},n.moveTo=function(t,i,e){createjs.Tween.get(this).to({x:t,y:i},100,createjs.Ease.sineOut()).call(function(){})},n.moveToPosition=function(i,e){i=i||this.position||0;var n=this.parent.indexLeft||0,s=this.seperator||t.userCard.seperator,a=n+s*i;this.moveTo(a,0,e)},n.setInPhom=function(t){t?this.inPhom.visible=!0:this.inPhom.visible=!1;try{this.updateCache()}catch(i){}},n.setClick=function(t){this.removeAllEventListeners("click"),t&&this.addEventListener("click",function(t){var i=t.target.parent;i.isDragging||(i.parent.selectedCard&&i.parent.selectedCard.cardValue!=i.cardValue?($rootScope.playerEvent={evt:"swapSelected",data:[i.parent.selectedCard.cardValue,i.cardValue]},$rootScope.digest()):i.toggedSelected())})},n.bindMouseOver=function(t){return this.removeAllEventListeners("mouseover"),this.removeAllEventListeners("mouseout"),t?void this.addEventListener("mouseover",function(t){}):void 0},n.bindEventListener=function(){this.removeAllEventListeners("click");var t=this;this.addEventListener("click",function(i){t.isDragging||(t.selected||TWIST.Observer.emit("cardSelected",t),t.setSelected(!t.selected))})},n.bindOpenCard=function(){this.removeAllEventListeners("click");var t=this;this.addEventListener("click",function(i){try{t.isDragging||t.openCard(t.cardValue)}catch(i){console.warn(i)}})},n.Overlay=function(){this.isOverlay=!0,this.filters=[new createjs.ColorMatrixFilter(new createjs.ColorMatrix(0,-60,0,0))],this.cache(0,0,t.size.width,t.size.height);try{this.updateCache()}catch(i){}},n.UnOverlay=function(){this.isOverlay=!1,this.filters=[new createjs.ColorMatrixFilter(new createjs.ColorMatrix(0,0,0,0))];try{this.updateCache()}catch(t){}},n.addMouseMoveEvent=function(){this.card.IsDraggable&&!this.card.IsInPhom&&(this.addEventListener("mouseover",function(t){}),this.addEventListener("mouseout",function(t){}))},n.hightLight=function(){this.showEatEffect=!0,this.eatEffect.visible=!0},n.unHightLight=function(){this.showEatEffect=!1,this.eatEffect.visible=!1},TWIST.Card=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t){this.initialize(t)}location.origin+location.pathname+"../src/images/";t.playerPositions={4:[{x:12,y:560},{x:1110,y:275},{x:590,y:54},{x:71,y:275}],2:[{x:12,y:560},{x:590,y:54}],5:[{x:12,y:560},{x:1110,y:275},{x:783,y:54},{x:383,y:54},{x:71,y:275}],9:[{x:380,y:550},{x:970,y:540},{x:1090,y:320},{x:1e3,y:140},{x:783,y:67},{x:383,y:67},{x:170,y:140},{x:70,y:320},{x:160,y:540}],6:[{x:550,y:550},{x:970,y:540},{x:1090,y:320},{x:783,y:67},{x:70,y:320},{x:160,y:540}]},t.handPositions={center:{x:150,y:-110,align:"center"},left:{x:-50,y:20,align:"left"},right:{x:150,y:-110,align:"center"}},t.draftPositionList={};var i=t.prototype=new createjs.Container;i.container_initialize=i.initialize,t.width=1280,t.height=720,t.position={x:t.width/2,y:t.height/2},t.draftPosition={x:t.width/2,y:t.height/4,rotateDeg:0},i.initialize=function(t){this.container_initialize();this.gameType=t||{},this.config={},this.initPosition(t);var i=this.createDeckCard(),e=this.createRemainingTime(),n=this.createRemainingCard(),s=this.createDraftCards();this.addChild(i,s,e,n)},i.createDeckCard=function(){return this.deckCard=new createjs.Container,this.deckCard.set({x:t.position.x,y:t.position.y,visible:!1}),this.deckCard},i.createRemainingTime=function(){return this.remainingTimeText=new createjs.Text("","bold 50px Roboto Condensed","white"),this.remainingTimeText.set({x:t.position.x,y:t.position.y,visible:!1,textAlign:"center",textBaseLine:"top"}),this.remainingTimeText},i.createRemainingCard=function(){return this.remainingCard=new createjs.Text("","bold 30px Roboto Condensed","greenyellow"),this.remainingCard.set({x:t.position.x,y:t.position.y,textAlign:"center",textBaseline:"middle"}),this.remainingCard},i.showRemainingDeckCard=function(t){var i;if("undefined"==typeof t)var i=this.deckCard.children.length;else this.deckCard.children.length=i=t;this.remainingCard.text=i||""},i.createDraftCards=function(){return this.draftCards=new createjs.Container,this.draftCards.set({x:t.draftPosition.x,y:t.draftPosition.y}),this.draftCards},i.initPosition=function(i){for(var e=i.maxPlayers||4,n=new Array(e),s=new Array(e),a=new Array(e),o=0;e>o;o++)s[o]={x:63,y:30,align:"left"},a[o]={x:s[o].x+1.5*TWIST.Card.draftCard.width,y:s[o].y};n=t.playerPositions[e],s[0]={x:150,y:-50,align:"center"},4===e&&(s[1]={x:6,y:30,align:"center"},a[0]={x:t.width/2-2*TWIST.Card.draftCard.width-n[0].x,y:-100,align:"left"},a[1].x=-340,a[1].align="right",a[2]={x:t.width/2-2*TWIST.Card.draftCard.width-n[2].x,y:120,align:"left"}),this.config.playerPositions=n,this.config.handPositions=s,this.config.draftPositions=a},i.generateCards=function(t,i){var e=this.deckCard.children.length,n=t-e;i=i||TWIST.Card.playerCard;var s=i.scale;if(console.log("cardType",i,this.deckCard),n>0)for(var a=0;n>a;a++){var o=new TWIST.Card;o.set({scaleX:s,scaleY:s,x:-i.width/2,y:-i.height/2}),this.deckCard.addChild(o)}else this.deckCard.children.splice(0,-n);this.deckCard.visible=!0},i.createLastDraftCards=function(t,i){var e=this.draftCards,i=i||TWIST.Card.demlaDraftCard;t.forEach(function(n,s){var a=new TWIST.Card(n);a.set({x:(s-.5*t.length)*i.seperator,y:.8*i.height,rotation:30*(Math.random()-.5),scaleX:i.scale,scaleY:i.scale}),e.addChild(a)})},i.scaleDeckCard=function(t){for(var i=this.deckCard.children,e=0;e<i.length;e++){var n=i[e];n.set({scaleX:.3,scaleY:.3})}},i.renderDraftCards=function(t){for(var i=0;i<t.length;i++){var e=new TWIST.Card(t[i]),n=TWIST.Card.baiDraft.seperator*i,s=0;e.set({x:n,y:s,scaleX:TWIST.Card.baiDraft.width/TWIST.Card.image.width,scaleY:TWIST.Card.baiDraft.height/TWIST.Card.image.height}),TWIST.Card.addChild(e)}},i.getCard=function(){var t;return t=this.deckCard.children.pop(),t&&t.set({x:this.deckCard.x,y:this.deckCard.y}),t},i.setRemainingTime=function(t,i){var e=this,n=t>100?t:1e3*t,s=(new Date).getTime(),a=this.remainingTimeText;$.extend(a,i),a.visible=!0,n>=0?(this.remainingTimeTween&&this.remainingTimeTween.removeAllEventListeners(),a.text="",this.remainingTimeTween=createjs.Tween.get(a,{override:!0}).to({},n,createjs.Ease.linear).call(function(){e.remainingTimeTween.removeAllEventListeners(),a.text=""}),this.remainingTimeTween.addEventListener("change",function(){var t=(new Date).getTime(),i="",e=n-(t-s);e>0&&(i=Math.floor(e/1e3)),a.text=i})):(this.remainingTimeTween&&this.remainingTimeTween.removeAllEventListeners(),a.text="");var e=this},i.clearRemainingTime=function(){this.remainingTimeTween&&this.remainingTimeTween.removeAllEventListeners(),this.remainingTime.text=""},i.clear=function(){this.deckCard.removeAllChildren(),this.draftCards.removeAllChildren(),this.deckCard.visible=!1,this.remainingCard.text=""},i.tipOff=function(){for(var t=this.draftCards.children,i=0;i<t.length;i++)t[i].cardValue>-1&&t[i].tipOff()},i.overlayDraftCards=function(){for(var t=this.draftCards.children,i=0;i<t.length;i++)t[i].cardValue>-1&&t[i].Overlay()},i.removeOverlayCards=function(){for(var t=this.draftCards.children,i=0,e=t.length;e>i;i++)t[i]&&t[i].isOverlay&&(t.splice(i,1),i--)},i.setZeroVetical=function(){var t=(this.draftCard,this.draftCards.children);t.forEach(function(t,i){t.moveTo(t.x,0)})},i.createTimer=function(t){this.timer=new TWIST.Timer(t),this.addChild(this.timer)},i.setCicleTime=function(t,i){t=t||3e4,50>t&&(t*=1e3),i=i||3e4,50>i&&(i*=1e3),this.timer.startTimer(i,t)},i.clearTimer=function(t,i){this.timer.clearTimer()},TWIST.Desk=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t){this.set({startTime:0,totalTime:0,remainingTime:0,currentTimer:0}),this.initialize(t)}var i=t.prototype=new createjs.Container;i.Container_initialize=i.initialize,i.initialize=function(t){this.Container_initialize(),$.extend(this,t),this.timerLine=new createjs.Shape,this.timerBg=new createjs.Shape,this.initBg(),this.addChild(this.timerBg,this.timerLine),this.startAngle=0,this.endAngle=0},i.initBg=function(){this.__type&&(this.startAngle=-.5*Math.PI,this.endAngle=1.5*Math.PI,this.timerBg.graphics.s("#000000").ss(this.strokeThick).arc(this.radius,this.radius,this.radius,this.startAngle,this.endAngle,!1),this.timerBg.alpha=.18,this.timerBg.visible=!1)},i.drawPercentRect=function(t){this.timerLine.graphics.clear(),this.startAngle=3*Math.PI/2-t*Math.PI*2,this.endAngle=3*Math.PI/2,this.timerLine.graphics.s("#fee802").ss(this.strokeThick).arc(this.radius,this.radius,this.radius,this.startAngle,this.endAngle,!1)},i.setCounter=function(t,i){this.timerBg.visible=!0,this.timerLine.visible=!0,this.totalTime=t||2e4,this.remainingTime=i||2e4,this.startTime=(new Date).getTime()-(this.totalTime-this.remainingTime),this.currentTimer=(this.totalTime-this.remainingTime)/this.totalTime},i.clearTimer=function(){this.tween&&(this.tween.pause(),this.tween.removeAllEventListeners()),createjs.Tween.get(this.timerLine,{override:!0}),this.timerLine.graphics.clear(),this.timerLine.visible=!1,this.timerBg.visible=!1,this.totalTime=0,this.remainingTime=0,this.currentTimer=0,this.callback&&delete this.callback},i.tick=function(){return this.currentTimer=((new Date).getTime()-this.startTime)/this.totalTime,this.currentTimer>=1?void this.clearTimer():void this.drawPercentRect(this.currentTimer)},i.startTimer=function(t,i){i>t&&(i=t),this.clearTimer(),this.setCounter(t,i);var e=this;this.tween=createjs.Tween.get(this.timerLine,{override:!0}).to({},i).call(function(){e.clearTimer()});var e=this;this.tween.addEventListener("change",function(){e.tick()})},TWIST.Timer=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t){this.initialize(t)}var i=location.origin+location.pathname+"../src/images/",e=300,n=TWIST.Desk;t.Defaults={UserName:"username",Position:0},t.usernameConfig={x:0,y:100,width:120,height:50},t.avatarConfig={x:15,y:0,radius:45,innerRadius:43,AvatarDefault:i+"avatars/1.png"},t.handConfig={x:100,y:100},t.draftCardsConfig={x:100,y:100,align:"left"};var s=t.prototype=new createjs.Container;s.contructor_initialize=s.initialize,s.initialize=function(t){this.contructor_initialize(),$.extend(this,t),this.initCanvas()},s.initCanvas=function(){var i=this,e=this.config||{},n=$.extend(t.avatarConfig,e.avartar);this.initUsername(e,i),this.initAvatar(e,i),this.initDraftCards(e,i),this.initHandCards(e,i),this.initChatMessage(e,i),this.initMoneyEffect(e,i),this.initStatus(e,i),this.timer=new TWIST.Timer({x:n.x,y:n.y,radius:n.radius,strokeThick:10}),this.addChild(this.timer,this.avatarContainer,this.usernameContainer,this.draftCards,this.hand,this.status,this.chat,this.moneyChangeEffect),this.render()},s.initUsername=function(i,e){var n=new createjs.Container,s=i.username||t.usernameConfig;$.extend(n,s);var a=new createjs.Text(this.username,"18px Roboto Condensed","white");a.set({x:60,y:25,textAlign:"center",textBaseline:"bottom"});var o=new createjs.Text(this.money,"14px Roboto Condensed","#f3ba04");o.set({x:60,y:45,textAlign:"center",textBaseline:"bottom"});var r=new createjs.Shape;r.graphics.beginFill("black").drawRoundRectComplex(0,0,s.width,s.height,10,10,10,10),r.alpha=.2,n.addChild(r,a,o),this.usernameContainer=n},s.initAvatar=function(e,n){var s=new createjs.Container,a=$.extend(t.avatarConfig,e.avartar),o=2*a.innerRadius;$.extend(s,a);var r=new Image,h=Global.md5Avatar(this.username)||10;r.src=this.avatarSrc||(TWIST.imagePath||i)+"player/avatars/"+h+".png";var d=new createjs.Bitmap(r);r.onload=function(){d.set({width:o,height:o,scaleX:o/r.width,scaleY:o/r.height})},d.set({x:a.radius-a.innerRadius,y:a.radius-a.innerRadius});var u=new createjs.Shape;u.graphics.drawCircle(a.radius,a.radius,a.innerRadius),d.mask=u;var c=new createjs.Shape;c.graphics.beginFill("#000").drawCircle(a.radius,a.radius,a.radius),c.set({alpha:.7});var l=new Image;l.src=(TWIST.imagePath||i)+"player/icon_chuphong.png";var p=new createjs.Bitmap(l);p.set({x:.7*o,y:.7*o,name:"roomMaster",visible:this.isRoomMaster});var f=.3*o;l.onload=function(){p.set({width:f,height:f,scaleX:f/l.width,scaleY:f/l.height})};var m=new createjs.Shape;m.graphics.beginFill("#fff").drawRect(0,0,o,o),s.hitArea=m,s.addChild(c,d,p),this.avatarContainer=s},s.initDraftCards=function(i,e){var n=i.draftPositions||t.draftCardsConfig;this.draftCards=new createjs.Container,$.extend(this.draftCards,n)},s.initHandCards=function(i,e){var n=i.handPositions||t.handConfig;this.hand=new createjs.Container,$.extend(this.hand,n);var s=TWIST.Card.playerCard,a=(s.width-3)/2;this.handCards=new createjs.Container,this.numberOfCards=new createjs.Container,this.numberOfCards.set({x:0,y:0});var o=new createjs.Shape;o.graphics.beginFill("#000").drawCircle(s.width/2,s.height/2,a),o.set({alpha:.3,visible:!1});var r=new createjs.Text("",1.5*a+"px Roboto Condensed","#7fc100");r.set({x:s.width/2,y:s.height/2,textAlign:"center",visible:!1,name:"numberOfCard",textBaseline:"middle"}),this.numberOfCards.addChild(o,r),this.hand.addChild(this.handCards,this.numberOfCards)},s.initChatMessage=function(t,i){this.chat=new createjs.Container,this.chat.set({name:"chat"});var e=new createjs.Text("","22px Roboto Condensed","#000");e.set({textAlign:"center",textBaseline:"bottom"});var n=new createjs.Shape;this.chat.addChild(n,e)},s.initMoneyEffect=function(t,i){this.moneyChangeEffect=new createjs.Container,this.moneyChangeEffect.set({name:"moneyChangeEffect",x:50,y:50});var e=new createjs.Text("","bold 24px Roboto Condensed","black");e.set({x:1,y:11,textAlign:"center",textBaseline:"bottom"});var n=new createjs.Text("","bold 24px Roboto Condensed");n.set({x:0,y:10,textAlign:"center",textBaseline:"bottom"}),n.shadow=new createjs.Shadow("#000",0,0,10),this.moneyChangeEffect.addChild(e,n)},s.initStatus=function(i,e){this.status=new createjs.Container;var n=i.avartar||t.avatarConfig,s=n.radius;this.status.set({x:n.x+s,y:n.y+s});var a=new createjs.Text,o=new createjs.Text;this.status.addChild(a,o)},s.render=function(){this.setPlayerName(this.username),this.setMoney(this.money),this.setRoomMaster(this.isRoomMaster)},s.setRemainingTime=function(t,i){t=t||2e4,50>t&&(t*=1e3),i=i||2e4,50>i&&(i*=1e3),this.timer.startTimer(i,t)},s.clearTimer=function(t,i){this.timer.clearTimer()},s.setPlayerName=function(i){var e=this.usernameContainer,n=e.getChildAt(1);n.text=i;var s=n.getMeasuredWidth(),a=t.usernameConfig.width;if(s>a){var o=a/s,r=Math.round(n.text.length*o)-3;n.text=n.text.substring(0,r)+"..."}},s.setMoney=function(t){var i=this.usernameContainer;this.money=parseInt(t);var e=i.getChildAt(2);e.text=Global.numberWithDot(t)},s.setRoomMaster=function(t,i){void 0===typeof t?t=this.isRoomMaster:this.isRoomMaster=t;var n=this.avatarContainer.getChildByName("roomMaster");if(n.visible=t,t){var s={scaleX:n.scaleX,scaleY:n.scaleY};n.set({scaleX:1,scaleY:1});var a=n.globalPosition=n.globalToLocal(0,0);if(n.set(s),i){var o={x:n.x,y:n.y},r={x:o.x+a.x-i.x,y:o.y+a.y-i.y};n.set(r),createjs.Tween.get(n).to({x:o.x,y:o.y},e).call(function(){})}}return n},s.clearHand=function(){this.handCards.removeAllChildren();var t=this.numberOfCards.getChildAt(0),i=this.numberOfCards.getChildAt(1);t.visible=!1,i.visible=!1},s.clearDraftCards=function(){this.draftCards&&this.draftCards.removeAllChildren()},s.clearShowPhomArea=function(){this.showPhomArea&&this.showPhomArea.removeAllChildren()},s.setPlayerStatus=function(t,i){var e=this.status,n=e.getChildAt(1),s=e.getChildAt(0);i=i||{},e["default"]="undefined"==typeof i["default"]?e["default"]:i["default"],t=t||e["default"],e.visible=!!t,i.color=i.color||"yellowgreen",i.font=i.font||"bold 20px Roboto Condensed",i.x=i.x||0,i.y=i.y||10,i.textAlign=i.textAlign||"center",i.textBaseline=i.textBaseline||"bottom",$.extend(n,i),$.extend(s,i),n.text=s.text=t,n.shadow=new createjs.Shadow("black",0,0,10),s.x=i.x+1,s.y=i.y+1,s.color="black"},s.renderCards=function(t){var i=this.hand;i.visible=!0,this._renderHandCards(this.handCards.cardList,t);var e=this;this.showCardLength?setTimeout(function(){e.setNumberCards(e.handCards.cardList.length)},1e3):this.numberOfCards.visible=!1},s._renderHandCards=function(t,i){i=i||{},this.handCards.removeAllChildren();for(var e,n=(this.handCards,i.cardType||(0==this.position?TWIST.Card.userCard:TWIST.Card.playerCard),t.length),s=this.parent.parent.getChildByName("desk"),a=150,o=30,r=!("undefined"==typeof i.reSort),h=0;n>h;h++){var d;t[h];d=s.getCard(),d||(d=new TWIST.Card),d.cardValue=t[h],d.position=h,
e=a+h*o,$.extend(i,{animationTime:e}),h!=n-1||r||(i.reSort=!0),this.addHandCards(d,i)}},s.setNumberCards=function(t){var i=this.numberOfCards.getChildAt(0),e=this.numberOfCards.getChildAt(1);0!==this.position&&t>0?(i.visible=!0,e.visible=!0,e.text=t):(i.visible=!1,e.visible=!1)},s.addHandCards=function(t,i){var n=i.animationTime||e,s=i.reSort||!1,a=this.handCards,o=this,r=TWIST.Card.draftCard,h=(t.pos||a.children.length,t.x,t.y,i.cardType||(0===this.position?TWIST.Card.userCard:TWIST.Card.playerCard));if(t.set({x:t.x-this.x-this.hand.x,y:t.y-this.y-this.hand.y,scaleX:r.scale,scaleY:r.scale}),this.listPhom&&this.listPhom.length&&!isNaN(t.cardValue)&&0==this.position){var d=[];this.listPhom.forEach(function(t,i){d=d.concat(t)}),t.isInPhom=d.indexOf(t.cardValue)>-1}a.addChild(t),createjs.Tween.get(t).to({x:isNaN(i.x)?h.seperator*a.getNumChildren():i.x,y:isNaN(i.y)?0:i.y,width:h.width,height:h.height,position:a.getNumChildren()-1,seperator:h.seperator,scaleX:h.scale,scaleY:h.scale},n,createjs.Ease.sineOut()).call(function(){0==o.position?(i.sideDown?this.bindOpenCard():(this.bindEventListener(),i.dragable&&this.setDraggable(!0)),i.sideDown||this.openCard(this.cardValue),i.sortPhom&&o.sortPhom(),s&&o.sortCard()):(this.visible=o.showPlayerCard,i.openCard&&this.openCard(this.cardValue))})},s.showThreeCards=function(){for(var t=this.handCards.children,i=0;i<t.length;i++){var e=t[i];e.openCard(e.cardValue),e.removeAllEventListeners()}},s.getDeckCard=function(t,i){i=i||{};var e=this.parent.parent.getChildByName("desk"),n=e.getCard();n.cardValue=t,$.extend(i,{animationTime:200,reSort:!0,dragable:!0}),this.addHandCards(n,i),this.markEatedCard()},s.getChuong=function(t){var i=this;t=t||{};var n=this.avatarContainer,s=n.getChildByName("chuongIcon");if(t.isChuong){var a=s.x,o=s.y,r=t.x||640,h=t.y||360,d=r-this.x-this.avatarContainer.x,u=h-this.y-this.avatarContainer.y;s.set({x:d,y:u,visible:!0}),createjs.Tween.get(s).to({x:a,y:o},e).call(function(){i.playerModel.isBanker=!0})}else i.playerModel.isBanker=!1,s.set({visible:!1})},s.draftCardsInHand=function(t,i){var i=i||{},e=[],n=i.cardType||TWIST.Card.draftCard,e=this.getCardsInHand(t),s=i.draftCards||this.draftCards,a=i.position||{x:s.children.length*n.seperator,y:0};"right"!==this.draftCards.align||i.position||(a.x=300-a.x);for(var o=0,r=e.length;r>o;o++){var h=e[o];h.cardValue=t[o];var d=$.extend(i,{draftCards:s,position:a,reSort:o===r-1});this.draftSingleCard(h,d),"right"!=this.draftCards.align||i.position?a.x+=n.seperator:a.x-=n.seperator}this.setNumberCards(this.handCards.children.length)},s.draftSingleCard=function(t,i){t.visible=!0,t.removeAllEventListeners();var n=this,s=i.cardType||TWIST.Card.draftCard,a=i.draftCards||this.draftCards,o=a.localToGlobal(0,0);t.set({x:t.x+this.hand.x+this.x-o.x,y:t.y+this.hand.y+this.y-o.y,rotation:i.rotateAble?30*(Math.random()-.5):0,scaleX:s.scale,scaleY:s.scale}),a.addChild(t),createjs.Tween.get(t).to({scaleX:1.2*t.scaleX,scaleY:1.2*t.scaleY},1*e/2).to({x:i.position.x,y:i.position.y,width:s.width,height:s.height,scaleX:s.scale,scaleY:s.scale},1*e/2).call(function(){0!==n.position?this.openCard(this.cardValue,s):i.reSort&&(this.setInPhom(!1),n.sortCard())})},s.sortDraftCards=function(){for(var t=this.draftCards.children,i=t.length,s=(n.width-i*TWIST.Card.draftCard.seperator-2*(this.draftCards.x+this.x))/2,a=0;a<t.length;a++){var o=t[a],r=s+a*TWIST.Card.draftCard.seperator;createjs.Tween.get(o).to({x:r},e,createjs.Ease.sineOut()).call(function(){})}},s.getCardsInHand=function(t){if(t){var i=[],e=this.handCards.children,n=e.map(function(t){return t.cardValue});if(0!=this.position)for(var s=0;s<t.length;s++){var a=t[s],n=e.map(function(t){return t.cardValue}),o=n.indexOf(a);if(o>-1)var r=e.splice(o,1);else var r=e.splice(n.indexOf(void 0),1);r[0]||(r[0]=new TWIST.Card),i=i.concat(r)}else for(var s=0;s<t.length;s++)for(var h=0;h<e.length;h++)t[s]==e[h].cardValue&&(i=i.concat(e.splice(h,1)),h--);return e.sort(function(t,i){return t.position-i.position}),e.forEach(function(t,i){t.position=i}),i.sort(function(t,i){return t.cardValue-i.cardValue}),i}},s.getSelectedCards=function(){var t=[],i=this.handCards.children;for(var e in i)i[e]&&1==i[e].selected&&t.push(i[e].cardValue);return t},s.sortPhom=function(t){var i=this.handCards.children,e=[];if(t)e=t.sort(function(t,i){return t-i});else for(var n=this.listPhom||[],s=0;s<n.length;s++){var a=n[s];a.sort(function(t,i){return t-i});for(var o=0;o<a.length;o++)e.push(a[o])}this.handCards.sortType=this.handCards.sortType?"":"rankSort";var r=this;i.forEach(function(t,i){t.setInPhom(e.indexOf(t.cardValue)>-1)}),i.sort(function(t,i){return e.indexOf(t.cardValue)>-1&&!(e.indexOf(i.cardValue)>-1)?!1:e.indexOf(i.cardValue)>-1&&!(e.indexOf(t.cardValue)>-1)?!0:e.indexOf(t.cardValue)>-1&&e.indexOf(i.cardValue)>-1?e.indexOf(t.cardValue)-e.indexOf(i.cardValue):"rankSort"==r.handCards.sortType?t.cardValue-i.cardValue:t.suite==i.suite?t.rank-i.rank:t.suite-i.suite})},s.sortTL=function(){var t=this.handCards.children;this.handCards.sortType=this.handCards.sortType?"":"rankSort";var i=this;t.sort(function(t,e){return"rankSort"==i.handCards.sortType?t.cardValue-e.cardValue:t.suite-e.suite||t.cardValue-e.cardValue}),this.sortCard()},s.sortCard=function(){function t(){var t=i.length,s=(TWIST.Desk.width-t*TWIST.Card.userCard.seperator-2*(n.hand.x+n.x))/2;n.handCards.indexLeft=s;for(var a=0;a<i.length;a++){var o=i[a];o.isDragging&&(o.isDragging=!1),o.selected=!1;var r=s+a*TWIST.Card.userCard.seperator;o.position=a,createjs.Tween.get(o).to({y:0,x:r},e,createjs.Ease.sineOut()).call(function(){})}}var i=this.handCards.children,n=this;setTimeout(t,100)},s.preparedShowPhom=function(t){for(var i=this.handCards.children,e=0;e<i.length;e++)e<t.length?!function(t){setTimeout(function(){t.setSelected(!0)},500)}(i[e]):i[e].setSelected(!1)},s.preparedSendCard=function(t){for(var i=this.handCards.children,e=0;e<i.length;e++){i[e].setSelected(!1);for(var n=0;n<t.length;n++)i[e].cardValue==t[n]&&!function(t){setTimeout(function(){t.setSelected(!0)},500)}(i[e])}},s.getLastDraftCards=function(t){for(var i=this.draftCards.children,e=0;e<i.length;e++)if(t==i[e].cardValue){var n=i[e].localToGlobal(0,0);this.rePositionDraftCards(e),i[e].x=n.x,i[e].y=n.y;var s=i.splice(e,1)[0];return s}},s.rePositionDraftCards=function(t){var i=this.draftCards.children;i.forEach(function(e,n){n>t&&e.set({x:i[n-1].x})})},s.getDraftCardsAbsolutePosition=function(){return{x:this.x+this.draftCards.x,y:this.y+this.draftCards.y}},s.eatCard=function(t,i,n){this.numberEatedCard=this.numberEatedCard||0,this.numberEatedCard++;var s=0==this.position?TWIST.Card.userCard:TWIST.Card.draftCard;if(t.hightLight(),0==this.position)this.addHandCards(t,{animationTime:200,reSort:!0,sortPhom:!0,dragable:!0});else{var a=s.seperator*this.draftCards.children.length,o=0;this.handCards.addChild(t),t.set({x:t.x-this.hand.x-this.x,y:t.y-this.hand.y-this.y}),2==this.position?(a=0-this.hand.x+100+s.seperator*(this.numberEatedCard-1),o=0):(o=-TWIST.Card.draftCard.height-10,a="right"==this.draftCards.align?0-this.hand.x+this.draftCards.x+300-(this.numberEatedCard-1)*s.seperator:0-this.hand.x+this.draftCards.x+s.seperator*(this.numberEatedCard-1)),console.log("newY",o),createjs.Tween.get(t).to({x:a,y:o,width:s.width,height:s.height,scaleX:s.scale,scaleY:s.scale},e,createjs.Ease.sineOut()).call(function(){})}},s.markEatedCard=function(){var t=[];if(this.listPhom){this.listPhom.forEach(function(i,e){t=t.concat(i)});for(var i=this.handCards.children,e=0;e<i.length;e++)i[e].isInPhom=t.indexOf(i[e].cardValue)>-1,i[e].setInPhom(i[e].isInPhom)}},s.moveDraftCard=function(t,i){var n=TWIST.Card.draftCard,s=this,a=this.draftCards.localToGlobal(0,0),o=n.seperator*this.draftCards.children.length,r=0;"right"==this.draftCards.align&&(o=300-n.seperator*this.draftCards.children.length),t.set({x:t.x-a.x,y:t.y-a.y}),s.draftCards.addChild(t),createjs.Tween.get(t).to({x:o,y:r,width:n.width,height:n.height,scaleX:n.scale,scaleY:n.scale},e,createjs.Ease.sineOut())},s.showPhom=function(t){for(var i=0;i<t.length;i++){var e=t[i];this.showSinglePhom(e,i)}var n=this;setTimeout(function(){n.sortPhomArea()},550)},s.addShowPhomArea=function(t){var i=this.parent.parent.getChildByName("desk"),e=i.config.draftPositions[this.position],n=0,s=0;0==this.position?(n=e.y-TWIST.Card.draftCard.height-10,s=e.x):2==this.position?(s=this.hand.x+37,n=this.hand.y):(n=e.y-TWIST.Card.draftCard.height-10,s="right"==this.draftCards.align?this.draftCards.x:this.draftCards.x),this.showPhomArea=new createjs.Container,this.showPhomArea.set({name:"showPhomArea",x:s,y:n}),this.addChild(this.showPhomArea)},s.addChipContainer=function(t){var e=this.parent.parent.getChildByName("desk"),n=e.chipPosition[this.position];this.chipContainer=new createjs.Container,this.chipContainer.set({name:"chipContainer",x:n.x,y:n.y,width:117,height:42,visible:!0});var s=new createjs.Bitmap((TWIST.imagePath||i)+"player/money-container.png"),a=new createjs.Text("0","20px Roboto Condensed","white");a.set({x:45,y:30,textAlign:"center",textBaseline:"bottom"}),this.chipContainer.addChild(s,a),this.addChild(this.chipContainer)},s.pushChip=function(t,i,e){for(var n=this,s=0;i>s;s++){var a=new TWIST.Chip(t);this.chipContainer.addChild(a);var o=this.chipContainer.width-a.width;a.set({x:50-this.chipContainer.x,y:10-this.chipContainer.y}),createjs.Tween.get(a).wait(100*s).to({x:o,y:0},200).call(function(){var i=n.chipContainer.getChildAt(1),e=isNaN(parseInt(i.text))?0:parseInt(i.text);i.text=e+ChipValues[t]})}},s.pushChicken=function(t,i){function e(t,i){for(var e=0;t>e;e++){var o=new TWIST.Chip(i);s.chickenTotal.addChild(o);var r=s.chickenTotal.localToGlobal(0,0),h=n.localToGlobal(50,10);o.set({x:h.x-r.x,y:h.y-r.y}),createjs.Tween.get(o).wait(a+=100).to({x:140,y:50},200).call(function(){s.chickenTotal.removeChild(this);var t=s.chickenTotal.getChildAt(1),e=isNaN(parseInt(t.value))?0:parseInt(t.value);t.value=e+ChipValues[i],t.text="Tổng gà : "+t.value})}}var n=this,s=this.parent.parent.getChildByName("desk"),a=0;s.chickenTotal.visible=!0;for(var o=0;o<t.length;o++)e(t[o].number,t[o].type)},s.showSinglePhom=function(t,i){for(var n=this.getCardsInHand(t),s=0;s<n.length;s++){var a=n[s];a.visible=!0,a.cardValue=t[s];var o=this,r=TWIST.Card.draftCard,h=this.showPhomArea,d=r.seperator*h.children.length,u=0;"right"==this.draftCards.align&&(d=300-r.seperator*h.children.length),this.showPhomArea.addChild(a),a.set({x:a.x+this.hand.x-h.x,y:a.y+this.hand.y-h.y}),a.removeAllEventListeners(),createjs.Tween.get(a,{override:!0}).to({x:d,y:u,width:r.width,height:r.height,scaleX:r.scale,scaleY:r.scale},e,createjs.Ease.sineOut()).call(function(){this.isInPhom=!1,0!=o.position?this.openCard(this.cardValue,r):this.setInPhom(!1)})}return n},s.addCardInShowPhom=function(t,i){var n=this,s=TWIST.Card.draftCard,n=this,a=(t.x,t.y,s.seperator*this.showPhomArea.children.length),o=0,r=this.showPhomArea;"right"==this.draftCards.align&&(a=300-s.seperator*(r.children.length-1));var h=n.showPhomArea.localToGlobal(0,0);t.set({x:t.x-h.x,y:t.y-h.y}),n.showPhomArea.addChild(t),t.removeAllEventListeners(),t.setInPhom(!1),createjs.Tween.get(t).to({x:a,y:o,width:s.width,height:s.height,scaleX:s.scale,scaleY:s.scale},e).call(function(){i&&this.openCard(this.cardValue,s)})},s.sortPhomArea=function(){var t=this.showPhomArea.children,i=t.length,e=TWIST.Card.draftCard,s=e.seperator,a=i*s;this.isCurrent;a>300&&(a=300);var o=0;0==this.position&&(o=(n.width-a-2*(this.showPhomArea.x+this.x))/2);for(var r=0;r<t.length;r++){var h=t[r],d=o+r*a/i;"right"==this.draftCards.align&&(d=300-a/i*r),createjs.Tween.get(h).to({x:d},100,createjs.Ease.sineOut()).call(function(){})}},s.showMoneyExchageEffect=function(t,i,n){var s=this.getChildByName("moneyChangeEffect"),a=n&&n.startY||("lose"===i?100:0),o=n&&n.endY||("lose"===i?0:100);s.set({visible:!0,y:a,alpha:.3});var r=s.getChildAt(0),h=s.getChildAt(1),d=Global.numberWithDot(Math.abs(parseInt(t)));"lose"===i?(h.color="red",r.text=h.text="- "+d):(h.color="yellow",r.text=h.text="+ "+d),createjs.Tween.get(s).to({y:o,alpha:1},e+200).call(function(){setTimeout(function(){s.visible=!1,h.text=""},2e3)})},s.setHandCardsValue=function(t){for(var i=this.handCards.children,e=0;e<t.length;e++){var n=i[e];n&&(n.cardValue=t[e])}},s.getHandCardAbsolutePosition=function(){return{x:this.x+this.hand.x+this.handCards.x,y:this.y+this.hand.y+this.handCards.y}},s.rerenderDraftPhom=function(t){if(t){for(var i=[],e=TWIST.Card.draftCard,n=0;n<t.length;n++){var s=new TWIST.Card(t[n]),a=e.seperator*n,o=0;"right"==this.draftCards.align&&(a=300-e.seperator*n),s.set({x:a,y:o,scaleX:e.scale,scaleY:e.scale}),this.draftCards.addChild(s)}return i}},s.hightLightEatCards=function(t){for(var i=this.handCards.children,e=0;e<i.length;e++)t.indexOf(i[e].cardValue)>-1&&i[e].hightLight();for(var i=this.showPhomArea.children,e=0;e<i.length;e++)t.indexOf(i[e].cardValue)>-1&&i[e].hightLight()},s.reEatCards=function(t){if(t){this.numberEatedCard=0;for(var i=[],e=TWIST.Card.draftCard,n=0;n<t.length;n++){var s=new TWIST.Card(t[n]),a=e.seperator*n,o=0;2==this.position?(a=0-this.hand.x+100+e.seperator*this.numberEatedCard,o=0):(o=-TWIST.Card.draftCard.height-10,a="right"==this.draftCards.align?0-this.hand.x+this.draftCards.x+300-this.numberEatedCard*e.seperator:0-this.hand.x+this.draftCards.x+e.seperator*this.numberEatedCard),s.set({x:a,y:o,scaleX:e.scale,scaleY:e.scale}),this.numberEatedCard++,this.handCards.addChild(s)}return i}},s.showMessage=function(t){var i,n,s=this.getChildByName("chat"),a="rgba(255, 255, 0, 1)",o="rgba(0, 0, 0, 1)",r="rgba(0, 0, 0, 1)",h={};if(n=s.getChildAt(0),i=s.getChildAt(1),n.graphics.c(),i.set({color:a,text:t}),h.x=i.getMeasuredWidth(),h.y=i.getMeasuredHeight(),t&&t.length>28){var d=t.indexOf(" ",25);(25>d||d>35)&&(d=28),t=t.substring(0,d)+"\n"+t.substring(d),i.text=t;var u=i.clone();u.text=t.substring(0,d),h.x=u.getMeasuredWidth(),h.y=i.getMeasuredHeight()}i.set({x:h.x/2,y:(h.y+10)/5+18}),n.graphics.beginFill(o).beginStroke(r).setStrokeStyle(1).drawRoundRect(-10,-10,h.x+20,h.y+20,20);var c=this.hand.x<0?-(h.x+20):120,l=0;s.set({x:c,y:l,visible:!0}),createjs.Tween.get(s).to({alpha:1},e).to({x:c+1,y:l+1},100).to({x:c-1,y:l-2},100).to({x:c+1,y:l+1},100).to({x:c-1,y:l-2},100).to({x:c+1,y:l+1},100).to({x:c-1,y:l-2},100).wait(3500).to({alpha:0,visible:!1},500)},TWIST.Player=t}(),this.gbjs=this.gbjs||{},function(){"use strict";function t(t){this.parent=t,this.oldIndex,this.oldOffset,this.dragObj,this.dragIndex,this.newIndex,this.nextIndex,this.nextObj,this.cloneObj,this.space,t.on("mousedown",this._onDragStart,this),t.on("pressmove",this._onTouchMove,this),t.on("pressup",this._onDragOver,this)}t.active=!1,t.prototype._onDragStart=function(t){var i=t.target;if(this.dragObj=i,this.space)return!0;var e=i.parent.getChildAt(0),n=i.parent.getChildAt(1);e&&n&&(this.space=n.x-e.x)},t.prototype._dragStarted=function(i){var e=i.target;e.offset={x:e.x-i.stageX,y:e.y-i.stageY},e.draggable=!0,t.active=this,this.updateDragIndex(),this.cloneObj=e.clone()},t.prototype.updateDragIndex=function(){var t=this.parent.getChildAt(this.parent.numChildren-1);t!=this.dragObj&&this.parent.addChild(this.dragObj)},t.prototype._onTouchMove=function(i){if(this.dragObj){t.active||this._dragStarted(i);var e=i.target,n=this.parent.children,s=i.stageX+e.offset.x,a=i.stageY+e.offset.y;this.updateDragIndex(),e.x=s,e.y=a,0>s&&(s=0);var o=Math.round(s/this.space);o>=n.length&&(o=n.length-1),o!=this.newIndex&&(this.newIndex=o,this._sort())}},t.prototype._sort=function(){for(var t=this.newIndex,i=this.parent.children,e=this.space,n=0;t>n;n++){var s=i[n];createjs.Tween.get(s).to({x:n*e},100)}for(var n=t;n<i.length-1;n++){var s=i[n];createjs.Tween.get(s).to({x:(n+1)*e},100)}},t.prototype.handleEvent=function(t){},t.prototype._onDragOver=function(i){if(t.active){t.active=!1;var e=i.target;e.parent.addChildAt(e,this.newIndex),e.x=this.newIndex*this.space,e.y=this.cloneObj.y,e.draggable=!1}},t.prototype._onDrop=function(t){},t.prototype.destroy=function(){parent.on("pressmove",this._onTouchMove,this),parent.on("pressup",this._onDragOver,this)},gbjs.Sortable=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(){}var i={width:1280,height:720},e=t.prototype=new EventEmitter;e.initBaseGame=function(t){this.initEvent(),this.initCanvas(),this.wrapper.append(this.canvas),this.initStage(t)},e.initCanvas=function(){var t=$(TWIST.HTMLTemplate.canvas);return t.attr({width:this.options.width||i.width,height:this.options.height||i.height}),this.canvas=t,t},e.initStage=function(t){function i(){n.update()}var e=this,n=new createjs.Stage(this.canvas[0]);$.extend(n,t),TWIST.Observer._canvasList.push(n),n.enableMouseOver(20);var s=n.canvas.getContext("2d");s.mozImageSmoothingEnabled=!0,createjs.Touch.enable(n),createjs.Ticker.setFPS(60),n.width=this.canvas.width,n.height=this.canvas.height,createjs.Ticker.addEventListener("tick",i),this.on("destroy",function(){var t=TWIST.Observer._canvasList.findIndex(function(t,i){return t==n});t>-1&&TWIST.Observer._canvasList.splice(t,1),createjs.Ticker.removeEventListener("tick",i),e.removeAllListeners(),e.timeOutList.forEach(function(t,i){clearTimeout(t)})}),this.stage=n},e.initEvent=function(){this.timeOutList=[],this.on("destroy",function(){TWIST.Sound.stop()})},e.addNumberEffect=function(t,i){var e=t,n=this,s="numberWithDot"+(i||""),a=e.text();return a=parseInt(a.replace(/\./g,"")),isNaN(a)&&(a=0),e.prop("_counter",a),e.runEffect=function(t,i){e.finish(),e.isDone=!0;var n={duration:1e3,step:function(t){e.text(Global[s](Math.ceil(t)))},done:function(){e.endEffect()}};$.extend(n,i),this.animate({_counter:t},n)},e.endEffect=function(){e.finish(),this.isTracking&&(this.isTracking=!1,n.emit("endEffect"))},e},e.addRemainTimeEffect=function(t,i){function e(){var t=o-(new Date).getTime();if(t>0){var i=Math.floor(t/6e4);10>i&&(i="0"+i);var e=Math.floor(t%6e4/1e3);10>e&&(e="0"+e),s.text(i+" : "+e)}else s.endEffect()}var n,s=t,a=this,o=0;return s.options=i,s.runEffect=function(t){clearInterval(n),t=isNaN(parseInt(t))?0:parseInt(t),o=(new Date).getTime()+t,e(),n=setInterval(e,100)},s.endEffect=function(){clearInterval(n),s.text(""),this.isTracking&&(this.isTracking=!1,a.emit("timeOut",s))},s},e.addDisbaleEffect=function(t,i){var e=t,n=this;return e.setDisabled=function(t){e.disabled=t,t?e.addClass("disabled"):e.removeClass("disabled")},e.runEffect=function(){e.setDisabled(!0)},e.endEffect=function(){e.setDisabled(!1),this.isTracking&&(this.isTracking=!1,n.emit("timeOut",e))},e},e.addChipEffect=function(t){var i=this,e=t;return e.runEffect=function(t){this.isDone=!0,this.removeClass("plus decrease");var i=t?"plus":"decrease";this.show();var n=e.find("i").length,s=0;e.find("i").show(),this.addClass(i),e.find("i").each(function(t){$(this).one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(this).hide(),s++,s==n&&e.endEffect()})})},e.endEffect=function(){this.isTracking&&(this.isTracking=!1,i.emit("_moveChipComplete",e))},e},TWIST.BaseGame=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(){}t.statusList={0:"STATUS_WAITING_FOR_PLAYER",1:"STATUS_WAITING_FOR_START",2:"STATUS_PLAYING",3:"STATUS_ENDING",4:"STATUS_WAITING_FOR_READY",6:"STATUS_WAITING_FOR_DEALING",7:"STATUS_DEALING",8:"STATUS_SHAKE_DISK",9:"STATUS_BETTING",10:"STATUS_END_BETTING",11:"STATUS_OPEN_DISK",12:"STATUS_CLOSE_DISK",13:"STATUS_ARRANGING",14:"STATUS_NOTIFY_SAM",15:"STATUS_DEAL_MASTER"};var i=t.prototype=new TWIST.BaseGame;i.statusList=$.extend({},t.statusList),i.initInRoomGame=function(){this.initBaseGame({_transformAble:!0}),this.drawRoom(),this.pushInRoomGameEvent(),this.initInviteList(),this.initErrotPanel(),this.initButtonBar(),this.initResultPanel(),this.observerEvent(),this.userInfo=this.userInfo||{},this.status=this.statusList[0],this.model=this.model||{}},i.initInviteList=function(){function t(t,e){var n=$(TWIST.HTMLTemplate["inviteList/inviteItem"]);i.inviteList.push(n),i.inviteListTemplate.append(n),n.css({top:t.y,left:t.x+11}),e||n.hide(),n.on("click",function(){i.emit("invitePlayer")})}var i=this;this.inviteListTemplate=$(TWIST.HTMLTemplate["inviteList/wrapper"]),this.wrapper.append(this.inviteListTemplate);var e=this.desk.config.playerPositions;this.inviteList=[],e.forEach(function(i,e){t(i,e)})},i.initErrotPanel=function(){this.errorPanel=$(TWIST.HTMLTemplate.errorPanel),this.wrapper.append(this.errorPanel),this.errorList=this.errorList||{},$.extend(this.errorList,{0:"Lỗi hệ thống !",34:"Không được để 2 cuối !",1470:"Chưa chọn cây bài !",91:"Cược vượt quá cho phép",92:"Cửa đặt không xác định",93:"Không đủ tiền để làm nhà cái",94:"User không phải nhà cái",95:"Nhà cái đã tồn tại",96:"Chưa sẵn sàng để đặt cược",97:"Bán chẵn/lẻ không thành công",98:"Bạn đã bán chẵn/lẻ rồi",99:"Số tiền bán chẵn/lẻ không hợp lệ",100:"Hủy cược không thành công",101:"Nhà cái không thể đặt cược",102:"Hủy cái không thành công."})},i.initButtonBar=function(){this.buttonBar=$(TWIST.HTMLTemplate["buttonBar/wrapper"]),this.wrapper.append(this.buttonBar),this.startButton=$(TWIST.HTMLTemplate["buttonBar/startButton"]),this.buttonBar.append(this.startButton),this.buttonBar.hide()},i.drawRoom=function(){var t=this.wrapper.find("canvas");this.wrapper.css("background","url("+TWIST.imagePath+"Desk-bg.png) center no-repeat"),this.playersContainer=new createjs.Container,this.desk=new TWIST.Desk(this.options),this.desk.name="desk",this.stage.addChild(this.desk,this.playersContainer),this.wrapper.css({width:t.width(),height:t.height(),position:"relative"})},i.pushInRoomGameEvent=function(){this.on("userInfo",this.setUserInfo),this.on("gameInfo",this.drawGameInfo),this.on("userJoin",this.addPlayer),this.on("userQuit",this.removePlayer),this.on("error",this.showError),this.on("changeMaster",this.changeRoomMaster),this.on("isolateUpdateMoney",this.isolateUpdateMoney),this.on("userChat",this.userChat),this.on("changeStatus",this.changeStatus),this.on("updateInfo",this.updateInfo),this.on("dealCards",this.dealCards),this.on("endGame",this.endGame),this.on("draftCards",this.onDraftCards),this.on("hitTurn",this.onHitTurn),this.on("reconnect",this.reconnect),this.on("updateUuid",this.updateUuid)},i.setUserInfo=function(t){this.userInfo=$.extend(this.userInfo,t),this.userInfo.uuid=this.userInfo.uuid||this.userInfo.id},i.observerEvent=function(){var t=this;TWIST.Observer.on("cardSelected",function(i){t.handCardSelected(i)})},i.drawGameInfo=function(t){this.model=this.model||{},$.extend(this.model,t);for(var i=this.model.players,e=0,n=i.length;n>e;e++)i[e].username===this.userInfo.username&&(this.userInfo.uuid=i[e].uuid);this.drawPlayers(),t.status&&(this.changeStatus({newStatus:t.status}),"STATUS_PLAYING"===this.status&&this.drawPlayingState(t))},i.removePlayer=function(t){var i=this.getPlayerByUuid(t.uuid);if(i){var e=i.position;this.inviteList[e]&&this.inviteList[e].show(),this.playersContainer.removeChild(i)}this.removePlayerData(t.uuid)},i.showError=function(t){var i=this.errorList[t.code];i=i||t.message;var e=$('<div class="error-item">'+i+"</div>");$(e).css({margin:"0 auto",display:"inline-block"}),this.errorPanel.empty(),this.errorPanel.append(e);e.one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(e).remove()})},i.changeRoomMaster=function(t){for(var i=this.roomMasterIcon.globalPosition,e=t.uuid,n=this.model.players||[],s=0,a=n.length;a>s;s++){var o=n[s],r=this.getPlayerByUuid(o.uuid);o.uuid===e?(o.isRoomMaster=!0,r&&(this.roomMasterIcon=r.setRoomMaster(!0,i)),r.uuid==this.userInfo.uuid&&"STATUS_WAITING_FOR_START"==this.status?this.startButton.show():this.startButton.hide()):(o.isRoomMaster=!1,r&&r.setRoomMaster(!1))}},i.updateInfo=function(t){var i=this.getPlayerDataByUuid(this.userInfo.uuid);$.extend(i,t);var e=this.getPlayerByUuid(this.userInfo.uuid);e&&($.extend(e,t),e.render()),this._listenChangeMoney&&(this._listenChangeMoney=!1,this.userMoney.runEffect(t.money))},i.isolateUpdateMoney=function(t){var i=t.players,e=this;i.forEach(function(t,i){var n=e.getPlayerDataByUuid(t.uuid);if(n){n.money=parseInt(t.money);var s=e.getPlayerByUuid(t.uuid);if(s){s.setMoney(n.money);var a=t.changeMoney<0?"lose":"win";s.showMoneyExchageEffect(t.changeMoney,a)}}})},i.userChat=function(t){var i=this.getPlayerByUuid(t.uuid);i&&i.showMessage(t.message)},i.changeStatus=function(t){this.desk.setRemainingTime(parseInt(t.remainingTime)),this.status=this.statusList[t.newStatus];var i=this[this.status];"function"==typeof i&&i.call(this),this.emit("ping")},i.resetPlayerStatus=function(t){for(var i=this.playersContainer&&this.playersContainer.children||[],e=0,n=i.length;n>e;e++){var s=i[e],a={};t&&(a["default"]=""),s.setPlayerStatus("",a)}},i.STATUS_WAITING_FOR_PLAYER=function(){this.buttonBar.hide()},i.STATUS_WAITING_FOR_START=function(){this.buttonBar.show(),this.buttonBar.find(".button").hide(),this.resetPlayerStatus(!0);var t=this.getPlayerDataByUuid(this.userInfo.uuid);t&&t.isRoomMaster&&this.startButton.show()},i.STATUS_PLAYING=function(){this.buttonBar.show(),this.buttonBar.find(".button").hide();var t=this.model.players||[];t.forEach(function(t,i){t.status="STATUS_PLAYING"}),this.desk.clear();for(var t=this.playersContainer.children,i=0,e=t.length;e>i;i++){var n=t[i];n.setPlayerStatus("")}},i.endGame=function(t){},i.reconnect=function(t){},i.addPlayer=function(t){var i=this.userInfo.indexPosition,e=t.indexPosition-i;0>e&&(e+=this.options.maxPlayers);var n=this.desk.config,s={};for(var a in n)s[a]=n[a][e];t.config=s;var o=this.desk.config.playerPositions;$.extend(t,o[e]),t.position=e,this.model.players.push(t),this.playersContainer.children.length<this.options.maxPlayers&&(this.inviteList[e]&&this.inviteList[e].hide(),this.drawPlayer(t))},i.drawPlayers=function(){var t=this.model.players||[],i=this,e=0;t.forEach(function(t,n){t.uuid===i.userInfo.uuid&&(e=t.indexPosition,$.extend(i.userInfo,t))}),t.sort(function(t,n){var s=t.indexPosition-e;0>s&&(s+=i.options.maxPlayers);var a=n.indexPosition-e;return 0>a&&(a+=i.options.maxPlayers),s-a});var n=this.desk.config;t.forEach(function(t,s){var a={};t.position=t.indexPosition-e,t.position<0&&(t.position+=i.options.maxPlayers);for(var o in n)a[o]=n[o][t.position];t.config=a,$.extend(t,n.playerPositions[t.position])});var s=n.playerPositions;s.forEach(function(e,n){var s=t.find(function(t,i){return n==t.position});s?(i.drawPlayer(s),i.inviteList[n].hide()):i.inviteList[n].show()})},i.setPlayerTurn=function(t,i){for(var e=this.model.turningTime,n=this.playersContainer.children,s=0,a=n.length;a>s;s++){var o=n[s];o&&(o.uuid===t?o.setRemainingTime(i,e):o.clearTimer())}},i.drawPlayer=function(t){t.config=t.config||{},$.extend(t,this.options.playerConfig),t.index=t.index||0;var i=new TWIST.Player(t);return this.playersContainer.addChild(i),t.isRoomMaster&&(this.roomMasterIcon=i.setRoomMaster(!0)),i},i.getPlayerByUuid=function(t){for(var i=this.playersContainer&&this.playersContainer.children||[],e=0,n=i.length;n>e;e++){var s=i[e];if(s.uuid==t)return s}},i.getPlayerDataByUuid=function(t){for(var i=this.model.players||[],e=0,n=i.length;n>e;e++){var s=i[e];if(s.uuid===t)return s}},i.getCurrentPlayer=function(t){var i=this.userInfo.uuid;return this.getPlayerByUuid(i)},i.removePlayerData=function(t){for(var i=this.model.players||[],e=i.length,n=0,s=i.length;s>n;n++){var a=i[n];if(a.uuid===t){e=n;break}}i.splice(e,1)},i.initResultPanel=function(){var t=this;this.resultPanel=$(TWIST.HTMLTemplate["resultPanel/wrapper"]),this.wrapper.append(this.resultPanel);var i=this.resultPanel.find(".container")[0];this.resultPanel.find(".container").css("height","320px"),this.resultPanel.hide(),this.resultPanelScroll=new IScroll(i,{scrollX:!0,freeScroll:!0}),this.resultPanelScroll.refresh();var e=this.resultPanel.find(".close-popup"),n=this.resultPanel.find(".global-mask");e.on("click",function(){t.resultPanel.hide()}),n.on("click",function(){t.resultPanel.hide()})},i.showResult=function(t){this.resultPanel.show();var i=this.resultPanel.find(".popup-icon");t.isWinner?i.removeClass("lose"):i.addClass("lose");var e=this.resultPanel.find(".container>div");e.empty(),t.listPlayers.forEach(function(t,i){var n="",s=t.remainCards;s.forEach(function(t,i){var e=_.template(TWIST.HTMLTemplate["resultPanel/card"]),s=e({id:t});n+=s});var a=_.template(TWIST.HTMLTemplate["resultPanel/user"]),o=a({username:t.username,moneyChange:Global.numberWithDot(t.changeMoney),resultText:t.gameResultString,cardList:n,isWinnerClass:t.isWinner?"winner-player":""});e.append($(o))}),this.resultPanelScroll.refresh()},i.endIngameEvent=function(){this.desk.setRemainingTime(0),this.buttonBar.hide(),this.errorPanel.empty()},i.updateUuid=function(t){var i=t.username;if(this.model&&this.model.players){for(var e=this.model.players,n=0,s=e.length;s>n;n++)e[n].username===i&&(e[n].uuid=t.uuid);for(var a=this.playersContainer.children,n=0,s=a.length;s>n;n++)a[n].username===i&&(a[n].uuid=t.uuid)}},TWIST.InRoomGame=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t,i){}var i=t.prototype=new TWIST.InRoomGame;i.initBaseDemlaGame=function(t){TWIST.Card.RankMapIndex=["3","4","5","6","7","8","9","10","11","12","13","1","2"],this.initInRoomGame(),this.pushTLMNDemlaEvent(),this.bindButton(),this.addCheater()},i.pushTLMNDemlaEvent=function(){this.on("endTurn",this.onEndTurn),this.on("foldTurn",this.foldTurn)},i.handCardSelected=function(t){var i=this.desk.lastDraftCards;if(t&&i&&i.length){var e=TWIST.TLMNLogic(i,t).getCards();e.length>0&&t.removeAllSelected(),e.forEach(function(t,i){t.setSelected(!0)})}},i.drawPlayingState=function(t){var i=t.players||[],e=this,n=t.playingPlayer,s=this.getPlayerByUuid(n.uuid);s&&(s.setRemainingTime(n.remainingTime,this.model.turningTime),s.uuid===this.userInfo.uuid&&(this.hitButton.show(),this.foldTurnButton.show())),t.lastDraftCards&&(this.desk.lastDraftCards=t.lastDraftCards,this.desk.createLastDraftCards(t.lastDraftCards)),i.forEach(function(i,n){var s=[];i.uuid===e.userInfo.uuid?(s=t.userListCard||[],s.sort(function(t,i){return t-i}),s.length>0?e.sortCardButton.show():e.showError({message:"Ván chơi đang diễn ra !"})):s.length=i.numberCardsInHand;var a=e.getPlayerByUuid(i.uuid);a&&(a.handCards.cardList=s,a.renderCards({dragable:!0}))})},i.dealCards=function(t){var i=t.cardList,e=this.model.players,n=0;e.forEach(function(t,i){"STATUS_PLAYING"===t.status&&n++});var s=n*this.options.numberCardsInHand,a=this;this.desk.generateCards(s),e.forEach(function(t,e){var n=[];if("STATUS_PLAYING"===t.status){t.uuid===a.userInfo.uuid&&(n=i,n.sort(function(t,i){return t-i}));var s=a.getPlayerByUuid(t.uuid);s&&(n.length=n.length||a.options.numberCardsInHand,s.handCards.cardList=n,s.renderCards({showPlayerCard:!0,dragable:!0}))}})},i.onHitTurn=function(t){this._hasNewTurn=t._hasNewTurn;var i=(t.uuid,this.getCurrentPlayer());i.handCards.children.length>0&&this.sortCardButton.show(),this.setPlayerTurn(t.uuid),t.uuid===this.userInfo.uuid?(this.hitButton.show(),t._hideFoldButton||this.foldTurnButton.show()):(this.hitButton.hide(),this.foldTurnButton.hide())},i.onNotifyOne=function(t){var i=this.getPlayerByUuid(t.uuid);i.setPlayerStatus("Báo 1 !",{"default":"Báo 1 !"})},i.foldTurn=function(t){var i=this.getPlayerByUuid(t.uuid);i&&(i.clearTimer(),this._hasNewTurn||i.setPlayerStatus("Bỏ lượt !"),t.uuid===this.userInfo.uuid&&(this.hitButton.hide(),this.foldTurnButton.hide()))},i.onDraftCards=function(t){TWIST.Sound.play("danh_bai");var i=t.cardList,e=t.uuid;this.desk.lastDraftCards=t.cardList;var n=this.getPlayerByUuid(e);if(!n)return void this.showError({code:0});e===this.userInfo.uuid&&(this.hitButton.hide(),this.foldTurnButton.hide()),this.desk.removeOverlayCards(),this.desk.setZeroVetical(),this.desk.overlayDraftCards();var s=TWIST.Card.demlaDraftCard,a={};a.x=(TWIST.Desk.width-s.seperator*i.length)/2-TWIST.Desk.draftPosition.x,a.y=.8*s.height,n.draftCardsInHand(i,{cardType:TWIST.Card.demlaDraftCard,draftCards:this.desk.draftCards,position:a,rotateAble:!0})},i.onEndTurn=function(t){t._hasNewTurn=!0,t._hideFoldButton=!0,this.resetPlayerStatus(),
this.desk.lastDraftCards=void 0,this.desk.clear(),this.hitButton.hide(),this.foldTurnButton.hide(),this.onHitTurn(t)},i.bindButton=function(){var t=this;this.startButton.unbind("click"),this.startButton.click(function(){t.emit("start",t.model.players)}),this.hitButton=$(TWIST.HTMLTemplate["buttonBar/hitButton"]),this.buttonBar.append(this.hitButton),this.hitButton.unbind("click"),this.hitButton.click(function(){var i=t.getCurrentPlayer(),e=i.getSelectedCards();return 0===e.length?void t.showError({code:1470}):void t.emit("hitCards",{cards:e})}),this.sortCardButton=$(TWIST.HTMLTemplate["buttonBar/sortCardButton"]),this.buttonBar.append(this.sortCardButton),this.sortCardButton.unbind("click"),this.sortCardButton.click(function(){var i=t.getCurrentPlayer();i.sortTL()}),this.foldTurnButton=$(TWIST.HTMLTemplate["buttonBar/foldTurnButton"]),this.buttonBar.append(this.foldTurnButton),this.foldTurnButton.unbind("click"),this.foldTurnButton.click(function(){t.emit("userFold")})},i.addCheater=function(){console.log("addCheater"),this.cheaterButton=$('<div class="button zero"></div>'),this.wrapper.append(this.cheaterButton),this.cheaterButton.unbind("click"),this.cheaterButton.click(function(){console.log("on click"),$(".cheater").toggle()}),this.cheater=$(TWIST.HTMLTemplate["cheater/wrapper"]),this.wrapper.append(this.cheater)},i.STATUS_ENDING=function(){this.buttonBar.hide(),this.errorPanel.empty(),this.desk.lastDraftCards=void 0,this.setPlayerTurn()},i.endDemlaGame=function(t,i,e){var n=this,s={isWinner:!1,listPlayers:[]};s.listPlayers=t.listPlayers;for(var a=0,o=s.listPlayers.length;o>a;a++){var r=s.listPlayers[a],h=r.remainCards;h.sort(function(t,i){return t-i}),r.gameResultString=i[r.winType],parseInt(r.changeMoney)<0?r.gameResultString=r.gameResultString||"Thua "+(e?h.length+" lá!":" !"):parseInt(r.changeMoney)>0?(r.uuid===this.userInfo.uuid&&(s.isWinner=!0),r.isWinner=!0,r.gameResultString=r.gameResultString||i[t.winType]||"Thắng"):r.gameResultString=r.gameResultString||"Hòa";var d=this.getPlayerByUuid(r.uuid);d&&(d.clearTimer(),d.setMoney(r.money),d.showMoneyExchageEffect(r.changeMoney,parseInt(r.changeMoney)>0?"win":"lose"))}setTimeout(function(){n.showResult(s)},2e3)},TWIST.BaseDemlaGame=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t,e){this.wrapper=$(t),this.options=$.extend(i,e),this.initPhomGame()}var i={maxPlayers:6,numberCardsInHand:3,turnTime:2e4,numberCardsRender:3,renderCardOptions:{showPlayerCard:!0,sideDown:!0,clickOpen:!0}},e=t.prototype=new TWIST.InRoomGame;e.initPhomGame=function(t){TWIST.Card.RankMapIndex=["1","2","3","4","5","6","7","8","9","10","11","12","13"],this.initInRoomGame(),this.bindButton(),this.pushBacayEvent()},e.pushBacayEvent=function(){this.on("playerOpen",function(t){this.player(t)})},e.drawPlayingState=function(t){var e=t.players||[],n=this,s=t.playingPlayer,a=this.getPlayerByUuid(s.uuid);a&&(a.setRemainingTime(s.remainingTime,this.model.turningTime),a.uuid===this.userInfo.uuid&&this.hitButton.show()),this.desk.generateCards(52,TWIST.Card.userCard),e.forEach(function(e,s){var a=[],o=[];e.uuid===n.userInfo.uuid?(a=t.userListCard||[],a.sort(function(t,i){return t-i}),a.length>0?n.sortCardButton.show():n.showError({message:"Ván chơi đang diễn ra !"}),o=t.listPhom):a.length=e.numberCardsInHand||i.numberCardsInHand;var r=n.getPlayerByUuid(e.uuid);r&&(r.handCards.cardList=a,r.listPhom=o,r.renderCards(i.renderCardOptions),0!=r.position&&r.reEatCards(e.eatedCards),r.rerenderDraftPhom(e.drarfCards),e.listPhom&&e.listPhom.forEach(function(t,i){r.showSinglePhom(t),function(t){setTimeout(function(){t.sortPhomArea()},550)}(r)}),e.eatedCards&&r.hightLightEatCards(e.eatedCards))}),this.desk.showRemainingDeckCard(t.deckCardRemain)},e.dealCards=function(t){var e=t.cardList,n=this.model.players,s=this.options.maxPlayers*this.options.numberCardsRender,a=this;this.desk.generateCards(s,TWIST.Card.playerCard),n.forEach(function(t,n){var s=[];if("STATUS_PLAYING"===t.status){t.uuid===a.userInfo.uuid&&e&&(s=e||[]);var o=a.getPlayerByUuid(t.uuid);o&&(s.length=s.length||a.options.numberCardsInHand,o.handCards.cardList=s,o.renderCards(i.renderCardOptions))}}),this.desk.showRemainingDeckCard(t.deckCardRemain)},e.bindButton=function(){var t=this;this.openCardButton=$(TWIST.HTMLTemplate["buttonBar/openCardButton"]),this.buttonBar.append(this.openCardButton),this.openCardButton.unbind("click"),this.openCardButton.click(function(){t.emit("openCard"),t.openCardButton.hide()})},e.handCardSelected=function(t){},e.STATUS_ENDING=function(){this.buttonBar.hide(),this.errorPanel.empty()},e.STATUS_PLAYING=function(){TWIST.InRoomGame.prototype.STATUS_PLAYING.call(this),this.playersContainer.children.forEach(function(t,i){t&&(t.clearHand(),t.setPlayerStatus(""))})},e.endGame=function(t){var i=this,e=t.listPlayers;e.forEach(function(t,e){var n=i.getPlayerByUuid(t);if(n){n.setHandCardsValue(t.handCards),n.showThreeCards(),n.setMoney(t.money);i.getResultTextThreeCards(t.handCards,t.rankOfHands);n.showMoneyExchageEffect(t.moneyExchange,parseInt(t.moneyExchange)>0?"win":"lose"),n.setPlayerStatus(t.resultText,{x:180,y:-70,color:"Greenyellow",font:"bold 40px Roboto Condensed"})}})},TWIST.BaCayGame=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t,i){this.wrapper=$(t),this.options=$.extend(v,i),this.initHightLowGame()}var i,e,n,s,a,o,r,h,d,u,c,l,p,f,m,g,v={resultTab:[]},T=t.prototype=new TWIST.BaseGame;T.initHightLowGame=function(){this.initVariable(),$.extend(this.options,c),this.info={betting:1e3,potData:{1e3:0,1e4:0,1e5:0}},TWIST.Card.RankMapIndex=["1","2","3","4","5","6","7","8","9","10","11","12","13"],this.userInfo={},this.initCanvas(),this.initEvent(),this.initTemplate(),this.draw(),this.pushEventListener(),this.status="pause"},T.initVariable=function(){i=["pause","endding","running"],d=["getCards","selectHightLow"],e=[{value:0,name:"2"},{value:1,name:"3"},{value:2,name:"4"},{value:3,name:"5"},{value:4,name:"6"},{value:5,name:"7"},{value:6,name:"8"},{value:7,name:"9"},{value:8,name:"10"},{value:9,name:"J"},{value:10,name:"Q"},{value:11,name:"K"},{value:12,name:"A"}],n=2.5,s=52,a=[],c={width:800,height:400},l={width:190,height:244},p={width:39,height:48},o=[1e3,1e4,1e5],r=2e3,u=[],h=0,f={},m={width:740,height:70,top:340,left:50},g=0},T.initTemplate=function(){this.wrapperTemplate=$(TWIST.HTMLTemplate["hightLow/wrapper"]),this.wrapper.append(this.wrapperTemplate),this.centerTempalte=$(TWIST.HTMLTemplate["hightLow/center"]),this.wrapperTemplate.append(this.centerTempalte),this.centerTempalte.find(".canvas-wrapper").append(this.canvas),this.initStage(),this.topTempalte=$(TWIST.HTMLTemplate["hightLow/top"]),this.wrapperTemplate.append(this.topTempalte),this.bottomTempalte=$(TWIST.HTMLTemplate["hightLow/bottom"]),this.wrapperTemplate.append(this.bottomTempalte),this._initExplodePot(),this._initPot(),this._initCurrentBetting(),this._initPotCards(),this._initSupportText(),this._initRemainTime(),this._initHightLowButton(),this._initHightLowBettingText(),this._initNewTurnText(),this._initVirtualCard(),this._initProfile(),this._initChipsButton(),this._initSessionId(),this._initNewTurnButton()},T._initExplodePot=function(){var t=this;this.effect=$('<div class="effect">'+TWIST.HTMLTemplate["effect/explodePot"]+"</div>"),this.wrapperTemplate.append(this.effect),this.effect.explorerPot=t.effect.find(".explorer-pot"),this.effect.moneyFalling=t.effect.find(".money-falling"),this.effect.showEffect=function(){t.effect.explorerPot.show(),t.effect.moneyFalling.show()},this.effect.hideEffect=function(){t.effect.explorerPot.hide(),t.effect.moneyFalling.hide()},this.effect.on("click",t.effect.hideEffect)},T._initPot=function(){this.pot=this.topTempalte.find(".pot-value"),this.addNumberEffect(this.pot)},T._initCurrentBetting=function(){this.currentBetting=this.topTempalte.find(".bank-value"),this.addNumberEffect(this.currentBetting)},T._initPotCards=function(){var t=this;this.potCards=[];var i=this.topTempalte.find(".pot-card");i.each(function(i,e){t.potCards.push($(e))}),this.potCards.addActiveCard=function(){var i=t.potCards.find(function(t,i){return!t.active});i&&(i.active=!0,i.addClass("active"))},this.potCards.removeActiveCard=function(){i.removeClass("active"),t.potCards.forEach(function(t,i){t.active=!1,t.removeClass("active")})}},T._initSupportText=function(){this.supportText=this.centerTempalte.find(".text-support"),this.supportText.text("")},T._initRemainTime=function(){this.remainTime=this.centerTempalte.find(".remain-time"),this.addRemainTimeEffect(this.remainTime)},T._initHightLowButton=function(){var t=this;this.lowButton=this.centerTempalte.find(".low-button"),this.addDisbaleEffect(this.lowButton),this.lowButton.runEffect(),this.hightButton=this.centerTempalte.find(".hight-button"),this.addDisbaleEffect(this.hightButton),this.hightButton.runEffect(),this.lowButton.on("click",function(i){t.lowButton.disabled||t.emitHightLow(!1)}),this.hightButton.on("click",function(i){t.hightButton.disabled||t.emitHightLow(!0)})},T._initHightLowBettingText=function(){this.lowBetting=this.centerTempalte.find(".low-value"),this.addNumberEffect(this.lowBetting),this.hightBetting=this.centerTempalte.find(".hight-value"),this.addNumberEffect(this.hightBetting)},T._initVirtualCard=function(){var t=this;this.virtualCard=this.centerTempalte.find(".virtual-card"),this.virtualCard.on("click",function(i){t.checkStart()})},T.checkStart=function(){var t=this;"pause"===t.status&&0===h&&(this.userInfo.money<this.info.betting?this.emit("error","Bạn không đủ tiền !"):(TWIST.Sound.play("minigame/ButtonClick"),TWIST.Sound.play("minigame/coin_spin"),t.emit("start",this.info.betting),this.newTurnText.hide(),this.changeStatus("running"),t.moneyContainer.runEffect(this.userInfo.money-this.info.betting,{duration:500}),this.moveChip.runEffect(!0)))},T.emitHightLow=function(t){var i=this;"pause"===i.status&&1===h&&(TWIST.Sound.play("minigame/ButtonClick"),this.emit("choose",t))},T._initNewTurnText=function(){this.newTurnText=this.centerTempalte.find(".new-turn-text")},T._initProfile=function(){var t=this;this.user=$(TWIST.HTMLTemplate["miniPoker/user"]),this.bottomTempalte.find(".profile-hight-low").append(this.user),this.moneyContainer=this.user.find(".money"),this.addNumberEffect(this.moneyContainer),this.user.renderUserInfo=function(i){$.extend(t.userInfo,i);var e=t.user.find(".avatar"),n=t.user.find(".username"),s=(t.user.find(".money"),Global.md5Avatar(i.avatar));e.addClass("avatar"+s),n.text(i.username),t.moneyContainer.runEffect(i.money,{duration:10})},this.moveChip=$(TWIST.HTMLTemplate["videoPoker/moveChip"]),this.user.append(this.moveChip),this.addChipEffect(this.moveChip),this.moveChip.hide()},T._initChipsButton=function(){var t=this;this.chipWrapper=$(TWIST.HTMLTemplate["miniPoker/chips"]),this.bottomTempalte.find(".chips-hight-low").append(this.chipWrapper),this.chipButtons=[{value:1e3,template:this.chipWrapper.find(".chip.violet")},{value:1e4,template:this.chipWrapper.find(".chip.green")},{value:1e5,template:this.chipWrapper.find(".chip.blue")}],this.chipButtons.forEach(function(i,e){i.template.on("click",function(e){"pause"===t.status&&0===h&&(this.resultSound=TWIST.Sound.play("minigame/Common_Click"),t.setBetting(i))})}),this.setBetting(this.chipButtons[0])},T._initSessionId=function(){this.sessionId=$(TWIST.HTMLTemplate["miniPoker/sessionId"]),this.wrapperTemplate.append(this.sessionId)},T.setBetting=function(t){this.chipWrapper.find(".chip").removeClass("active"),t.template.addClass("active"),this.info.betting=t.value,this.pot.runEffect(this.info.potData[this.info.betting],{duration:200})},T._initNewTurnButton=function(){var t=this;this.newTurnButton=this.bottomTempalte.find(".new-turn-button"),this.addDisbaleEffect(this.newTurnButton),this.newTurnButton.hide(),this.newTurnButton.on("click",function(i){t.newTurnButton.disabled||t.emit("newTurn")})},T.draw=function(){this.mainContainer=new createjs.Container,this.mainContainer.set({x:(c.width-l.width)/2,y:0}),this.winCardContainer=new createjs.Container,this.winCardContainer.set({x:m.left,y:m.top}),this.stage.addChild(this.mainContainer,this.winCardContainer),this.addMainCard(-1)},T.addMainCard=function(t){this.mainContainer.removeAllChildren();var i,e;if(t>-1)e=l.width/TWIST.Card.size.width,i=new TWIST.Card(t),i.set({scaleX:e,scaleY:e});else{var n=new Image;n.src=TWIST.imagePath+"hightLow/card-back.png";var i=new createjs.Bitmap(n)}this.mainContainer.addChild(i)},T.storeMainCard=function(){var t=this,i=this.mainContainer.children[0],e=this.winCardContainer.children.length;this.winCardContainer.addChild(i),i.set({x:i.x+this.mainContainer.x-this.winCardContainer.x,y:i.y+this.mainContainer.y-this.winCardContainer.y}),createjs.Tween.get(i).to({x:10+(p.width+10)*e,y:10,scaleX:p.width/TWIST.Card.size.width,scaleY:p.height/TWIST.Card.size.height},500).call(function(){t.emit("_storeComplete")})},T.drawListCard=function(t){function i(t,i){var n=new TWIST.Card(t);e.winCardContainer.addChild(n),n.set({x:10+(p.width+10)*i,y:10,scaleX:p.width/TWIST.Card.size.width,scaleY:p.height/TWIST.Card.size.height})}var e=this;this.winCardContainer.removeAllChildren(),t.forEach(i)},T.changeStatus=function(t){var i=this;this.clear(),"pause"===t&&this.newTurnButton.setDisabled(!1),"running"===t&&(this.playingInterval=setInterval(function(){i.addMainCard(parseInt(52*Math.random()))},100),u.push(this.playingInterval),this.hightButton.setDisabled(!0),this.lowButton.setDisabled(!0),this.newTurnButton.setDisabled(!0))},T.changeGameState=function(t){h=t,this.clearGameState(),0==h?(this.changeStatus("pause"),this.addMainCard(-1),this.virtualCard.show(),this.newTurnText.show(),this.newTurnButton.hide(),this.hightButton.setDisabled(!0),this.lowButton.setDisabled(!0),this.lowBetting.runEffect(0,{duration:10}),this.hightBetting.runEffect(0,{duration:10}),this.effect.hide()):1==h&&(this.newTurnText.hide(),this.virtualCard.hide(),this.newTurnButton.show())},T.clear=function(){this.supportText.text(""),this.remainTime.endEffect(),u.forEach(function(t){clearTimeout(t)})},T.clearGameState=function(){this.clear(),this.potCards.removeActiveCard(),this.winCardContainer.removeAllChildren(),this.currentBetting.runEffect(0)},T.setNewCard=function(t){this.addMainCard(t.cardId),this.hightButton.setDisabled(!1),this.lowButton.setDisabled(!1),this.hightBetting.runEffect(t.hightMoney,{duration:300}),this.lowBetting.runEffect(t.lowMoney,{duration:300}),t.isPotCard&&this.potCards.addActiveCard(),g=t.currentBetting,this.currentBetting.runEffect(t.currentBetting||0,{duration:300}),t.currentBetting>0?(t.currentBetting!=this.info.betting&&TWIST.Sound.play("minigame/NormalWin"),this.supportText.text("Quân bài tiếp theo là cao hay thấp hơn ?"),this.remainTime.runEffect(t.remainTime||12e4),this.hightButton.setDisabled(!1),this.lowButton.setDisabled(!1),0==t.hightMoney&&this.hightButton.setDisabled(!0),0==t.lowMoney&&this.lowButton.setDisabled(!0),t.explorerPot&&this.effect.showEffect()):(TWIST.Sound.play("minigame/slot_result"),this.supportText.text("Bạn chọn sai, chúc bạn may mắn lần sau !"),this.hightButton.setDisabled(!0),this.lowButton.setDisabled(!0))},T.pushEventListener=function(){var t=this;this.on("userInfo",function(){t.user.renderUserInfo(arguments[0])}),this.on("getFirstCard",function(i){t.getFirstCard(i)}),this.on("updatePots",function(i){t.bindPots(i)}),this.on("newCard",function(i){t.newCard(i)}),this.on("getWin",function(i){t.getWin(i)}),this.on("updateMoney",function(i){t.updateMoney(i)}),this.on("error",function(i){t.showError(i)}),this.on("reconnect",function(i){t.reconnect(i)})},T.getFirstCard=function(t){this.changeGameState(1),this.changeStatus("pause"),t.currentBetting=t.currentBetting||this.info.betting,this.setNewCard(t),this.newTurnButton.setDisabled(!0),this.sessionId.text(t.sessionId)},T.bindPots=function(t){$.extend(this.info.potData,t.pots),this.pot.runEffect(this.info.potData[this.info.betting],{duration:500})},T.newCard=function(t){var i=this;this.storeMainCard(),this.changeStatus("running"),this.once("_storeComplete",function(){i.changeStatus("pause"),i.setNewCard(t)})},T.getWin=function(t){var i=this;this.sessionId.text(""),g>0?(TWIST.Sound.play("minigame/coin_spin"),this.moveChip.isTracking=!0,this.moveChip.runEffect(),this.moneyContainer.runEffect(parseInt(this.userInfo.money)+g,{duration:500}),this.currentBetting.runEffect(0,{duration:500}),this.once("_moveChipComplete",function(){i.changeGameState(0)})):this.changeGameState(0)},T.updateMoney=function(t){this.userInfo.money=t.newMoney},T.showError=function(t){this.supportText.text(t)},T.reconnect=function(t){var i;if(this.chipButtons.forEach(function(e,n){e.value==t.betting&&(i=e)}),this.changeGameState(1),this.setBetting(i),this.setNewCard(t),this.drawListCard(t.listCard),t.listCard.length||this.newTurnButton.setDisabled(!0),t.numberPotCards)for(var e=0;e<t.numberPotCards;e++)this.potCards.addActiveCard()},TWIST.HightLowGame=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t,i){this.wrapper=$(t),this.options=$.extend(C,i),this.initMiniPoker()}var i,e,n,s,a,o,r,h,d,u,c,l,p,f,m,g,v,T,C={resultTab:[{name:"Sảnh rồng(Nỗ hũ)",value:-1,code:"1"},{name:"Thùng phá sảnh",value:1e3,code:"2"},{name:"Tứ quý",value:150,code:"3"},{name:"Cù lũ",value:50,code:"4"},{name:"Thùng",value:20,code:"5"},{name:"Sảnh",value:13,code:"6"},{name:"Ba lá",value:8,code:"7"},{name:"Hai đôi",value:5,code:"8"},{name:"Đôi J hoặc cao hơn",value:2.5,code:"9"},{name:"Không ăn !",value:0,code:"10"}]},w=t.prototype=new TWIST.BaseGame;w.initMiniPoker=function(){this.initVariable(),$.extend(this.options,i),this.info={betting:1e3,potData:{1e3:0,1e4:0,1e5:0}},TWIST.Card.RankMapIndex=["1","2","3","4","5","6","7","8","9","10","11","12","13"],this.userInfo={},this.initCanvas(),this.initEvent(),this.initTemplate(),this.initButton(),this.draw(),this.pushEventListener(),this.status="pause"},w.initVariable=function(){o=["pause","running","ending","effecting"],v=[{value:0,name:"2"},{value:1,name:"3"},{value:2,name:"4"},{value:3,name:"5"},{value:4,name:"6"},{value:5,name:"7"},{value:6,name:"8"},{value:7,name:"9"},{value:8,name:"10"},{value:9,name:"J"},{value:10,name:"Q"},{value:11,name:"K"},{value:12,name:"A"}],r=-1,d=1,e={width:160,height:205,padding:10},i={width:5*e.width,height:e.height,x:5,y:1},n=e.height,s=[],a=2.5,h=52,u={x:100,y:100},l=[],c=[1e3,1e4,1e5],p=2e3,f=0,m=0,g=[],T=!1},w.draw=function(){this.mapData=TWIST.MiniPokerLogic.generateMap();var t=new createjs.Container;this.spinArea=t;for(var n=0;n<i.x;n++){s[n]=new createjs.Container,s[n].set({x:n*e.width,y:0});var a=new createjs.Container;s[n].addChild(a);var o=(this.mapData[n],this.createSlotItem(this.mapData[n],0));a.addChild(o),t.addChild(s[n])}this.stage.addChild(t)},w.initTemplate=function(){var t=this;this.wrapperTemplate=$(TWIST.HTMLTemplate["miniPoker/wrapper"]),this.wrapper.append(this.wrapperTemplate),this.wrapperTemplate.append(this.canvas),this.initStage(),this.resultText=$(TWIST.HTMLTemplate["miniPoker/resultText"]),this.wrapperTemplate.append(this.resultText),this.wrapperTemplate.append($(TWIST.HTMLTemplate["miniPoker/pot"])),this.pot=this.wrapperTemplate.find(".pot-value"),this.buttonSpin=$(TWIST.HTMLTemplate["miniPoker/button"]),this.wrapperTemplate.append(this.buttonSpin);var i=$(TWIST.HTMLTemplate["miniPoker/autospin"]);this.wrapperTemplate.append(i),this.autoSpin=i.find('input[type="checkbox"]'),this.chipWrapper=$(TWIST.HTMLTemplate["miniPoker/chips"]),this.wrapperTemplate.append(this.chipWrapper),this.chipButtons=[{value:1e3,template:this.chipWrapper.find(".chip.violet")},{value:1e4,template:this.chipWrapper.find(".chip.green")},{value:1e5,template:this.chipWrapper.find(".chip.blue")}],this.errorPanel=$(TWIST.HTMLTemplate["miniPoker/errorPanel"]),this.wrapperTemplate.append(this.errorPanel),this.errorPanel.hide(),this.resultTab=$(TWIST.HTMLTemplate["miniPoker/resultTab"]),this.wrapperTemplate.append(this.resultTab),this.resultItemList=[],this.resultItem=_.template(TWIST.HTMLTemplate["miniPoker/resultItem"]),this.options.resultTab.forEach(function(i,e){if("10"!==i.code){var n={code:i.code,template:$(t.resultItem({name:i.name,value:i.value<=0?"":"X"+i.value}))};t.resultTab.append(n.template),t.resultItemList.push(n)}}),this.user=$(TWIST.HTMLTemplate["miniPoker/user"]),this.wrapperTemplate.append(this.user),this.sessionId=$(TWIST.HTMLTemplate["miniPoker/sessionId"]),this.wrapperTemplate.append(this.sessionId),this.effectWrapper=$(TWIST.HTMLTemplate["effect/wrapper"]),this.wrapperTemplate.append(this.effectWrapper),this.explodePot=$(TWIST.HTMLTemplate["effect/explodePot"]),this.effectWrapper.append(this.explodePot),this.money=this.user.find(".money"),this.setBetting(this.chipButtons[0])},w.initButton=function(){var t=this;this.chipButtons.forEach(function(i,e){i.template.on("click",function(e){"pause"!==t.status&&"effecting"!==t.status||(TWIST.Sound.play("minigame/Common_Click"),t.setBetting(i))})}),this.autoSpin.on("change",function(i){t.isAutoSpin=i.target.checked,"pause"!=t.status&&"effecting"!=t.status||t.checkStart()}),this.buttonSpin.on("click",function(i){t.buttonSpin.hasClass("disabled")||t.checkStart()})},w.setBetting=function(t){this.chipWrapper.find(".chip").removeClass("active"),t.template.addClass("active"),this.info.betting=t.value,this.changeNumberEffect(this.pot,this.info.potData[this.info.betting],{duration:200}).runEffect()},w.pushEventListener=function(){var t=this;this.on("endSpin",function(i){t.endSpin(i)}),this.on("userInfo",function(){t.renderUserInfo(arguments[0])}),this.on("spin",function(){t.startSpin()}),this.on("spinCompleted",function(){t.effecting()}),this.on("endEffect",function(){}),this.on("updateMoney",function(i){t.updateMoney(i)}),this.on("updatePots",function(i){t.bindPots(i)}),this.on("error",function(i){t.showError(i)})},w.showError=function(t){var i=$('<div class="error-item-mini">'+t+"</div>"),e=this;this.errorPanel.empty(),this.errorPanel.show(),this.errorPanel.append(i);var e=this;i.one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(i).remove(),e.errorPanel.hide()})},w.checkStart=function(){var t=this;if("pause"===t.status||"effecting"===t.status){var t=this;this.userInfo.money<this.info.betting?this.emit("error","Bạn không đủ tiền !"):("pause"!==t.status&&t.changeStatus("pause"),this.startSound=TWIST.Sound.play("minigame/bonus_spin"),t.emit("spin",this.info.betting),t.changeNumberEffect(t.money,t.userInfo.money-t.info.betting,{duration:200}).runEffect())}},w.renderUserInfo=function(t){$.extend(this.userInfo,t);var i=this.user.find(".avatar"),e=this.user.find(".username"),n=this.user.find(".money"),s=Global.md5Avatar(t.avatar);i.addClass("avatar"+s),e.text(t.username);var a=Global.numberWithDot(t.money);n.text(a)},w.bindPots=function(t){$.extend(this.info.potData,t.pots),this.changeNumberEffect(this.pot,this.info.potData[this.info.betting],{duration:200}).runEffect()},w.changeStatus=function(t){var i=this;if(this.status=t,this.timeOutList.forEach(function(t){clearTimeout(t)}),this.timeOutList=[],"pause"==t){this.result={},f>=l.length&&(f=0);var e=l[f];if(e&&e.length)for(var n=0;n<e.length;n++)e[n].isDone||e[n].endEffect();if(l=[],f=0,this.isAutoSpin){var s=setTimeout(function(){i.status="pause",i.checkStart()},500);this.timeOutList.push(s)}}"running"==t&&(this.resultSound&&this.resultSound.stop(),this.buttonSpin.addClass("disabled"),this.autoSpin.find("input").attr("disabled",!0),this.resultText.text("")),"effecting"==t&&(this.startSound&&this.startSound.stop(),this.isAutoSpin?this.buttonSpin.addClass("disabled"):this.buttonSpin.removeClass("disabled"),this.autoSpin.find("input").attr("disabled",!1))},w.startSpin=function(){r=-1;var t=this,i=s[0].getChildAt(0);this.changeStatus("running"),createjs.Tween.get(i).to({y:-50},150).call(function(){}).to({y:0},150).call(function(){t.spinAllColumns()})},w.spinAllColumns=function(){for(var t=this,e=0;e<i.x;e++)t.spinColumn(e)},w.spinColumn=function(t){var e=this.options.speed||a,o=!1,h=!1;r>-1&&t==Math.floor((10*r+9)/10/i.y)&&r%1==0&&(o=!0,h=r%i.y==i.y);var u,c=this,l=s[t].getChildAt(0);u=o?this.createSlotItem(this.mapData[t],-1):this.createSlotItem(Math.floor(4*Math.random())+52,-1),l.addChild(u);var p=h?createjs.Ease.getBackOut(5):createjs.Ease.linear,f=h?2*n/e:n/e;createjs.Tween.get(l).to({y:n},f,p).call(function(){var t=this.parent.parent.getChildIndex(this.parent);this.set({y:0});var e=this.children;if(e.forEach(function(t,i){t.state++,t.goNextStep()}),this.removeChild(e.find(function(t){return t.state==i.y})),r>-1){Math.floor(Math.floor((r+.9)/i.y));if(t==Math.floor((10*r+9)/10/i.y)){var n=r%i.y==i.y-1;n?d=.2:r%i.y==0&&(d=1),r=(10*r+10*d)/10,n?r=(10*r+10*d)/10:c.spinColumn(t)}else c.spinColumn(t);r>i.x*i.y-1&&c.emit("spinCompleted")}else c.spinColumn(t)})},w.endSpin=function(t){"running"===this.status&&(this.changeStatus("ending"),this.result=this.result||{},$.extend(this.result,t),this.mapData=t.map,this.showSessionId(t.sessionId),r=-.8,d=.2)},w.updateMoney=function(t){this.result=this.result||{},$.extend(this.result,t),this.userInfo.money=t.newMoney},w.effecting=function(){var t=this;this.changeStatus("effecting");var i=this.result;l=[];var e=[],n=this.hightLightWinCards(i.hightLightCards);if(e.push(n),this.showResultText(i.cardListRank,i.rankOfVerticalGroup),1==i.cardListRank){var s=this.explodePotEffect();e.push(s)}if(parseInt(i.winMoney)>0){var a=this.winMoneyEffect(i.winMoney),o=this.changeNumberEffect(this.money,i.newMoney,{duration:p}),r=this.hightlightWinRank(i.cardListRank);e.push(a,o,r),this.resultSound=TWIST.Sound.play("minigame/NormalWin")}else this.resultSound=TWIST.Sound.play("minigame/slot_result");if(e.oneTime=!0,e.forEach(function(t,i){t.isTracking=!0}),l.push(e),this.isAutoSpin){var h=setTimeout(function(){t.checkStart()},2e3);this.timeOutList.push(h)}this.runNextEffect()},w.runNextEffect=function(){function t(){m=0;for(var t=0;t<i.length;t++)i[t].runEffect()}var i=l[f];if(i&&i.length)if(i.oneTime)i.done?(f++,f==l.length&&(T?f=0:this.changeStatus("pause")),"effecting"===this.status):t();else{var e=setTimeout(t,300);this.timeOutList.push(e)}},w.endEffect=function(){var t=this;if(m++,m==(l[f]&&l[f].length)){if(l[f].oneTime&&(l[f].done=!0),f++,f==l.length)if(T)f=0;else if(this.isAutoSpin){var i=setTimeout(function(){t.status="pause",t.checkStart()},500);this.timeOutList.push(i)}else t.status="pause";"effecting"===this.status}},w.createSlotItem=function(t,i){var n=new createjs.Container,s=new TWIST.Card(t);return t>51&&(t-=52,s.bg.sourceRect={width:TWIST.Card.size.width,height:152,x:TWIST.Card.size.width*(9+t),y:4*TWIST.Card.size.height}),s.set({scaleX:TWIST.Card.miniPoker.scale,scaleY:TWIST.Card.miniPoker.scale,x:(e.width-TWIST.Card.miniPoker.width)/2,y:(e.height-TWIST.Card.miniPoker.scale*TWIST.Card.size.height)/2}),n.addChild(s),n.set({x:0,y:e.height*i,state:i}),n.goNextStep=function(){var t=e.height*this.state;this.set({y:t})},n},w.changeNumberEffect=function(t,i,e){var n=$(t),s=this;return n.newValue=i,n.options=e,n.runEffect=function(){n.finish(),n.isDone=!0;var t=this.text(),i={duration:1e3,step:function(t){n.text(Global.numberWithDot(Math.ceil(t)))},done:function(){n.endEffect()}};$.extend(i,n.options),t=parseInt(t.replace(/\,/g,"")),isNaN(t)&&(t=0),this.prop("Counter",t).animate({Counter:n.newValue},i)},n.endEffect=function(){n.finish(),this.isTracking&&(this.isTracking=!1,s.emit("endEffect"))},n},w.explodePotEffect=function(){var t=this,i=$("#effect .explorer-pot");new Date;return i.runEffect=function(){this.show()},i.click(function(){i.isDone=!1,i.endEffect()}),i.endEffect=function(){this.hide(),this.isDone=!0,this.isTracking&&(this.isTracking=!1,t.emit("endEffect"))},i},w.winMoneyEffect=function(t){var i=this,e=$(TWIST.HTMLTemplate["miniPoker/winMoney"]);return e.text(Global.numberWithDot(t)),e.one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){e.endEffect()}),e.runEffect=function(){e.isDone=!1,t>0&&i.user.append(e)},e.endEffect=function(){e.remove(),e.isDone=!0,this.isTracking&&(this.isTracking=!1,i.emit("endEffect"))},e},w.hightlightWinRank=function(t){var i=this,e=this.resultItemList.find(function(i,e){return i.code==t}),n=e?e.template:$("<div></div>");return n.one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){n.endEffect()}),n.runEffect=function(){n.isDone=!1,n.addClass("active"),this.isTracking&&(this.isTracking=!1,i.emit("endEffect"))},n.endEffect=function(){n.removeClass("active"),n.isDone=!0},n},w.hightLightWinCards=function(t){for(var e=this,n=[],a=0;a<i.x;a++){var o=s[a].children[0].children[0].children[0];o.active=t[a],o.border.sourceRect.x=4*TWIST.Card.size.width,n.push(o)}return n.runEffect=function(){n.isDone=!0,n.forEach(function(t,i){parseInt(t.active)?t.hightLight():t.Overlay()}),this.isTracking&&(this.isTracking=!1,e.emit("endEffect"))},n.endEffect=function(){n.isDone=!0},n},w.showResultText=function(t,i){var e=this,n=this.options.resultTab.find(function(i,e){return i.code==t}),s=v.find(function(t,e){return t.value==i}),a=n.name;3!=n.code&&7!=n.code&&9!=n.code||!s||(a=a+" "+s.name,9==n.code&&(a="Đôi "+s.name)),this.resultText.text(a);var o={};return o.runEffect=function(){o.isDone=!1,e.resultText.text(a),this.isTracking&&(this.isTracking=!1,e.emit("endEffect"))},o.endEffect=function(){e.resultText.text(""),o.isDone=!0},o},w.explodePotEffect=function(){var t=this,i=this.explodePot;new Date;return i.runEffect=function(){this.isDone=!1,this.show()},i.click(function(){i.endEffect()}),i.endEffect=function(){this.hide(),this.isDone=!0,this.isTracking&&(this.isTracking=!1,t.emit("endEffect"))},i},w.showSessionId=function(t){this.sessionId.text(t)},TWIST.MiniPoker=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t,e){this.wrapper=$(t),this.options=$.extend(i,e),this.initPhomGame()}var i={maxPlayers:4,numberCardsInHand:9,turnTime:2e4,numberCardsRender:13,renderCardOptions:{showPlayerCard:!0,dragable:!0}},e=t.prototype=new TWIST.InRoomGame;e.initPhomGame=function(t){TWIST.Card.RankMapIndex=["1","2","3","4","5","6","7","8","9","10","11","12","13"],this.initInRoomGame(),this.bindButton(),this.pushPhomEvent()},e.pushPhomEvent=function(){this.on("getTurn",function(t){this.onGetTurn(t)}),this.on("getCardComplete",function(t){this.getCardComplete(t)}),this.on("enableEatCard",function(t){this.enableEatCard(t)}),this.on("enableU",function(t){this.enableU(t)}),this.on("enableShowPhom",function(t){this.enableShowPhom(t)}),this.on("enableSendCard",function(t){this.enableSendCard(t)}),this.on("eatCardSuccess",function(t){this.eatCardSuccess(t)}),this.on("moveDraftCard",function(t){this.moveDraftCard(t)}),this.on("showPhomComplete",function(t){this.showPhom(t)}),this.on("sendCardComplete",function(t){this.sendCard(t)}),this.on("entiretyCard",function(t){this.entiretyCard(t)}),this.on("setRemainCards",function(t){this.setRemainCards(t)})},e.onGetTurn=function(t){var i=(t.uuid,this.getCurrentPlayer());i.handCards.children.length>0&&this.sortCardButton.show(),this.hitButton.hide(),t.uuid===this.userInfo.uuid&&this.getCardButton.show(),this.setPlayerTurn(t.uuid,t.remainingTime)},e.onHitTurn=function(t){var i=(t.uuid,this.getCurrentPlayer());i.handCards.children.length>0&&this.sortCardButton.show(),this.getCardButton.hide(),this.eatCardButton.hide(),t.uuid===this.userInfo.uuid?this.hitButton.show():this.hitButton.hide(),this.setPlayerTurn(t.uuid,t.remainingTime)},e.getCardComplete=function(t){this.getCardButton.hide();var i=t.cardIndex,e=t.uuid,n=t.listPhom,s=this.getPlayerByUuid(e);s.listPhom=n,s.getDeckCard(i,n),this.desk.showRemainingDeckCard(t.deckCardRemain)},e.enableEatCard=function(){this.eatCardButton.show()},e.enableU=function(){this.entiretyButton.show()},e.enableShowPhom=function(t){var i=this,e=this.getCurrentPlayer();e.handCards.sortType="suiteSort",e.sortPhom(t.listCard),setTimeout(function(){e.preparedShowPhom(t.listCard),i.showPhomButton.show()},500)},e.enableSendCard=function(t){var i=this,e=this.getCurrentPlayer();e.preparedSendCard(t.listCard),setTimeout(function(){
i.sendCardButton.show()},500)},e.eatCardSuccess=function(t){this.eatCardButton.hide();var i=this.getPlayerByUuid(t.hitPlayer),e=this.getPlayerByUuid(t.eatPlayer);this.getCurrentPlayer();if(e){var n;n=i?i.getLastDraftCards(t.cardIndex):new TWIST.Card(parseInt(t.cardIndex)),e.listPhom=t.listPhom,e.eatCard(n)}},e.moveDraftCard=function(t){var i=this.getPlayerByUuid(t.fromPlayer),e=this.getPlayerByUuid(t.toPlayer);if(i&&e){var n=i.getLastDraftCards(t.cardIndex);e.moveDraftCard(n,i)}},e.onDraftCards=function(t){TWIST.Sound.play("danh_bai"),this.hitButton.hide(),this.sendCardButton.hide(),this.showPhomButton.hide(),this.entiretyButton.hide();var i=[t.cardIndex],e=t.uuid,n=this.getPlayerByUuid(e);n.listPhom=t.listPhom||n.listPhom,n.draftCardsInHand(i,{cardType:TWIST.Card.draftCard}),n.markEatedCard(),this.desk.lastActivePlayer=t.uuid,this.desk.lastDraftCard=i},e.drawPlayingState=function(t){this._STATUS_PLAYING();var e=t.players||[],n=this,s=t.playingPlayer,a=this.getPlayerByUuid(s.uuid);a&&(a.setRemainingTime(s.remainingTime,this.model.turningTime),a.uuid===this.userInfo.uuid&&this.hitButton.show()),this.desk.generateCards(52,TWIST.Card.deckCard),e.forEach(function(e,s){var a=[],o=[];e.uuid===n.userInfo.uuid?(a=t.userListCard||[],a.sort(function(t,i){return t-i}),a.length>0?n.sortCardButton.show():n.showError({message:"Ván chơi đang diễn ra !"}),o=t.listPhom):a.length=e.numberCardsInHand||i.numberCardsInHand;var r=n.getPlayerByUuid(e.uuid);r&&(r.handCards.cardList=a,r.listPhom=o,r.renderCards(i.renderCardOptions),0!=r.position&&r.reEatCards(e.eatedCards),r.rerenderDraftPhom(e.drarfCards),e.listPhom&&e.listPhom.forEach(function(t,i){r.showSinglePhom(t),function(t){setTimeout(function(){t.sortPhomArea()},550)}(r)}),e.eatedCards&&r.hightLightEatCards(e.eatedCards))}),this.desk.showRemainingDeckCard(t.deckCardRemain)},e.dealCards=function(t){this._STATUS_PLAYING();var e=t.cardList,n=this.model.players,s=this.options.maxPlayers*this.options.numberCardsRender,a=this;this.desk.generateCards(s,TWIST.Card.deckCard),n.forEach(function(n,s){var o=[];if("STATUS_PLAYING"===n.status){n.uuid===a.userInfo.uuid&&e&&(o=e||[],o.sort(function(t,i){return t-i})),t.firstPlayer&&t.firstPlayer.uuid&&n.uuid==t.firstPlayer.uuid&&(o.length=a.options.numberCardsInHand+1);var r=a.getPlayerByUuid(n.uuid);r&&(o.length=o.length||a.options.numberCardsInHand,0==r.position&&(r.listPhom=t.listPhom),r.handCards.cardList=o,r.renderCards(i.renderCardOptions))}}),this.desk.showRemainingDeckCard(t.deckCardRemain)},e.setPlayerTurn=function(t,i){for(var e=this.model.turningTime,n=this.playersContainer.children,s=0,a=n.length;a>s;s++){var o=n[s];o&&(o.uuid===t?o.setRemainingTime(i,e):o.clearTimer())}},e.bindButton=function(){var t=this;this.startButton.unbind("click"),this.startButton.click(function(){t.emit("start",t.model.players)}),this.hitButton=$(TWIST.HTMLTemplate["buttonBar/hitButton"]),this.buttonBar.append(this.hitButton),this.hitButton.unbind("click"),this.hitButton.click(function(){var i=t.getCurrentPlayer(),e=i.getSelectedCards();return 0===e.length?void t.showError({code:1470}):void t.emit("hitCards",{cards:e})}),this.sortCardButton=$(TWIST.HTMLTemplate["buttonBar/sortCardButton"]),this.buttonBar.append(this.sortCardButton),this.sortCardButton.unbind("click"),this.sortCardButton.click(function(){var i=t.getCurrentPlayer();i.sortPhom(),i.sortCard()}),this.getCardButton=$(TWIST.HTMLTemplate["buttonBar/getCardButton"]),this.buttonBar.append(this.getCardButton),this.getCardButton.unbind("click"),this.getCardButton.click(function(){t.emit("getCard")}),this.eatCardButton=$(TWIST.HTMLTemplate["buttonBar/eatCardButton"]),this.buttonBar.append(this.eatCardButton),this.eatCardButton.unbind("click"),this.eatCardButton.click(function(){t.emit("eatCard")}),this.entiretyButton=$(TWIST.HTMLTemplate["buttonBar/entiretyButton"]),this.buttonBar.append(this.entiretyButton),this.entiretyButton.unbind("click"),this.entiretyButton.click(function(){t.emit("entirety")}),this.sendCardButton=$(TWIST.HTMLTemplate["buttonBar/sendCardButton"]),this.buttonBar.append(this.sendCardButton),this.sendCardButton.unbind("click"),this.sendCardButton.click(function(){var i=t.getCurrentPlayer(),e=i.getSelectedCards();return 0===e.length?void t.showError({code:1470}):void t.emit("sendCard",{cards:e})}),this.showPhomButton=$(TWIST.HTMLTemplate["buttonBar/showPhomButton"]),this.buttonBar.append(this.showPhomButton),this.showPhomButton.unbind("click"),this.showPhomButton.click(function(){var i=t.getCurrentPlayer(),e=i.getSelectedCards();return 0===e.length?void t.showError({code:1470}):void t.emit("showPhom",{cards:e})})},e.handCardSelected=function(t){},e.STATUS_ENDING=function(){this.buttonBar.hide(),this.errorPanel.empty(),this.desk.lastDraftCards=void 0,this.setPlayerTurn()},e.showPhom=function(t){var i=t.phoms,e=t.uuid,n=this.getPlayerByUuid(e);n.showPhom(i),0==n.position&&n.sortCard(),this.showPhomButton.hide()},e.drawPlayer=function(t){var i=TWIST.InRoomGame.prototype.drawPlayer.call(this,t);i.addShowPhomArea()},e.sendCard=function(t){for(var i=t.cardsSend,e=this.getPlayerByUuid(t.cardsSend[0].transFrom),n=0!=e.position,s=0;s<i.length;s++){var a=i[s],o=this.getPlayerByUuid(a.transTo);if(o&&e){var r=e.getCardsInHand(a.cardList);r.forEach(function(t,i){t.set({x:t.x+e.x+e.hand.x,y:t.y+e.y+e.hand.y}),t.cardValue=a.cardList[i],o.addCardInShowPhom(t,n)})}}this.playersContainer.children.forEach(function(t,i){setTimeout(function(){t.sortPhomArea()},700)}),0==e.position&&e.sortCard(),this.sendCardButton.hide()},e.entiretyCard=function(t){var i=t.phoms,e=t.uuid,n=this.getPlayerByUuid(e);n.showPhom(i),n.setPlayerStatus("Ù"),this.buttonBar.children().hide();setTimeout(function(){n.sortPhomArea()},550)},e.setRemainCards=function(t){t.remainCards;this.desk.showRemainingDeckCard(t.remainCards)},e.STATUS_PLAYING=function(){},e._STATUS_PLAYING=function(){TWIST.InRoomGame.prototype.STATUS_PLAYING.call(this),this.playersContainer.children.forEach(function(t,i){t&&(t.clearDraftCards(),t.clearHand(),t.clearShowPhomArea(),t.setPlayerStatus(""),t.numberEatedCard=0)})},e.endGame=function(t,i,e){function n(t){return t>7?t-8:t+44}var s=this,a={isWinner:!1,listPlayers:[]};a.listPlayers=t.listPlayers;for(var o=0,r=a.listPlayers.length;r>o;o++){var h=a.listPlayers[o],d=h.remainCards;d.sort(function(t,i){return t-i}),h.remainCards=d.map(n),parseInt(h.changeMoney)<0?h.gameResultString=h.playerResult:parseInt(h.changeMoney)>0?(h.gameResultString=h.playerResult,h.isWinner=!0,h.uuid===this.userInfo.uuid&&(a.isWinner=!0)):h.gameResultString="Hòa",h.showPoint&&h.totalPoint&&(h.gameResultString=h.gameResultString+" "+h.totalPoint+" điểm !");var u=this.getPlayerByUuid(h.uuid);u&&(u.setPlayerStatus(h.playerResult),u.clearTimer(),u.setMoney(h.money),u.showMoneyExchageEffect(h.changeMoney,parseInt(h.changeMoney)>0?"win":"lose"))}setTimeout(function(){s.showResult(a)},2e3)},TWIST.PhomGame=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t,e){this.wrapper=$(t),this.options=$.extend(i,e),this.initSamGame()}var i={maxPlayers:5,numberCardsInHand:10,turnTime:2e4,playerConfig:{showCardLength:!1,showPlayerCard:!1}},e=t.prototype=new TWIST.BaseDemlaGame;e.initSamGame=function(t){this.initBaseDemlaGame(),this.pushSamGameEvent(),this.bindSamButton()},e.pushSamGameEvent=function(){this.on("inviteSam",this.onInviteSam),this.on("endInviteSam",this.onEndInviteSam),this.on("foldSam",this.onFoldSam),this.on("callSam",this.onCallSam),this.on("notifyOne",this.onNotifyOne)},e.bindSamButton=function(){var t=this;this.callSamButton=$(TWIST.HTMLTemplate["buttonBar/callSamButton"]),this.buttonBar.append(this.callSamButton),this.callSamButton.unbind("click"),this.callSamButton.click(function(){t.emit("call-sam"),t.callSamButton.hide()}),this.foldSamButton=$(TWIST.HTMLTemplate["buttonBar/foldSamButton"]),this.buttonBar.append(this.foldSamButton),this.foldSamButton.unbind("click"),this.foldSamButton.click(function(){t.emit("fold-sam"),t.foldSamButton.hide()})},e.onInviteSam=function(t){this.desk.clear(),this.desk.setRemainingTime(parseInt(t.remainingTime)),this.callSamButton.show(),this.foldSamButton.show(),this.sortCardButton.hide(),this.userCallSam=null},e.onEndInviteSam=function(){this.desk.setRemainingTime(0),this.callSamButton.hide(),this.foldSamButton.hide();for(var t=this.playersContainer.children,i=0,e=t.length;e>i;i++){var n=t[i];n&&n.uuid!==this.userCallSam&&n.setPlayerStatus("")}},e.onFoldSam=function(t){var i=this.getPlayerByUuid(t.uuid);i.setPlayerStatus("Hủy sâm !")},e.onCallSam=function(t){var i=this.getPlayerByUuid(t.uuid);i.setPlayerStatus("Báo sâm !",{color:"red"}),this.userCallSam=t.uuid},e.endGame=function(t){this.endIngameEvent();var i={0:"Năm đôi",1:"3 sám cô",2:"Đồng màu",3:"Tứ 2",4:"Sảnh rồng",13:"Thắng",15:"Hòa",16:"Bị ăn sâm",17:"Bị bắt sâm",18:"Phạt báo 1",19:"Bị thua trắng",20:"Thua",21:"Bắt sâm"};this.endDemlaGame(t,i,13==t.winType)},TWIST.SamGame=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t,i){this.wrapper=$(t),this.options=$.extend(e,i),this.initTaiXiu()}var i=location.origin+location.pathname+"../src/images/",e={gameSize:{width:1280,height:720,position:"relative"},chipSize:{width:75,height:75,miniWidth:24,miniHeight:24,miniRatio:.33},bettingChipPositions:[{y:640,x:390},{y:629,x:550},{y:640,x:710},{y:640,x:868}],playerPosition:{x:1215,y:330},hostPosition:{x:620,y:60},userPosition:{y:650,x:210},chipSrcList:["1st-chip.png","2nd-chip.png","3rd-chip.png","4th-chip.png"],width:1280,height:720,timer:{x:1165,y:129,radius:35},moveChipAnimationTime:500,diskPosition:{x:539,y:155,width:300,initWidth:646,initHeight:647,scale:300/646},bowlPosition:{x:25,y:25,width:534,height:542},chipResultPosition:{x:50,y:50,width:100,height:100,diceWidth:107,diceHeight:108}},n=t.prototype=new TWIST.InRoomGame;n.initTaiXiu=function(){this.initInRoomGame(),this.initVariable(),this.initTemplate(),this.initButton(),this.bindButton(),this.pushTaiXiuEvent()},n.initVariable=function(){this.info={betting:1e3},this.userInfo=$.extend(this.userInfo,{avatar:"https://s.gravatar.com/avatar/a4fae1e89a441c83f656a7ae59f9c19f?s=80",uuid:"",username:"",money:0,isHost:!1}),this.imagePath=(TWIST.imagePath||i)+"taixiu/",this.bettingPositions=[{id:0,name:"Tam nhất",top:0,left:0,width:195,height:112,types:[1,"top-left","top","left"]},{id:1,name:"Tam nhị",top:0,left:195,width:135,height:112,types:[1,"top"]},{id:2,name:"Tam tam",top:0,left:335,width:135,height:112,types:[1,"top"]},{id:3,name:"Tam trùng",top:0,left:475,width:275,height:112,types:[2,"top"]},{id:4,name:"Tam tứ",top:0,left:755,width:135,height:112,types:[1,"top"]},{id:5,name:"Tam ngũ",top:0,left:895,width:135,height:112,types:[1,"top"]},{id:6,name:"Tam lục",top:0,left:1035,width:193,height:112,types:[1,"top","right","top-right"]},{id:7,name:"Xỉu",top:112,left:0,width:195,height:215,types:[3,"left"]},{id:8,name:"Bốn điểm",top:112,left:195,width:115,height:105,types:[4]},{id:9,name:"Năm điểm",top:112,left:315,width:115,height:105,types:[4]},{id:10,name:"Sáu điểm",top:112,left:435,width:115,height:105,types:[4]},{id:11,name:"Bẩy điểm",top:112,left:555,width:115,height:105,types:[4]},{id:12,name:"Tám điểm",top:112,left:675,width:115,height:105,types:[4]},{id:13,name:"Chín điểm",top:112,left:795,width:115,height:105,types:[4]},{id:14,name:"Mười điểm",top:112,left:915,width:115,height:105,types:[4]},{id:15,name:"Tài",top:112,left:1035,width:193,height:215,types:[3,"right"]},{id:16,name:"Mười một điểm",top:222,left:195,width:115,height:105,types:[4,7]},{id:17,name:"Mười hai điểm",top:222,left:315,width:115,height:105,types:[4,7]},{id:18,name:"Mười ba điểm",top:222,left:435,width:115,height:105,types:[4,7]},{id:19,name:"Mười bốn điểm",top:222,left:555,width:115,height:105,types:[4,7]},{id:20,name:"Mười lăm điểm",top:222,left:675,width:115,height:105,types:[4,7]},{id:21,name:"Mười sáu điểm",top:222,left:795,width:115,height:105,types:[4,7]},{id:22,name:"Mười bẩy điểm",top:222,left:915,width:115,height:105,types:[4,7]},{id:23,name:"Chẵn",top:332,left:0,width:195,height:105,types:[6,"left","bottom-left","bottom"]},{id:24,name:"Nhất",top:332,left:195,width:135,height:105,types:[5,"bottom"]},{id:25,name:"Nhị",top:332,left:335,width:135,height:105,types:[5,"bottom"]},{id:26,name:"Tam",top:332,left:475,width:135,height:105,types:[5,"bottom"]},{id:27,name:"Tứ",top:332,left:615,width:135,height:105,types:[5,"bottom"]},{id:28,name:"Ngũ",top:332,left:755,width:135,height:105,types:[5,"bottom"]},{id:29,name:"Lục",top:332,left:895,width:135,height:105,types:[5,"bottom"]},{id:30,name:"Lẻ",top:332,left:1035,width:193,height:105,types:[6,"bottom","right","bottom-right"]}],this.bettingPositions.reverse(),this.statusList={1:"STATUS_WAITING_FOR_START",2:"STATUS_SHAKE_DISK",3:"STATUS_BETTING",4:"STATUS_ARRANGING",5:"END_GAME"}},n.bindButton=function(){},n.drawRoom=function(){this.desk=new TWIST.Desk(this.options),this.desk.name="desk",this.stage.addChild(this.desk),this.wrapper.css(e.gameSize)},n.drawGameInfo=function(t){this.setHost(t.host),this.changeStatus(t),this.roomBetting=t.betting,this.setBettingChipValue(t.listBettingChip),this.addHistoryList(t.historyList),this.drawBettingPositions(t.bettingPositions)},n.initButtonBar=function(){},n.initInviteList=function(){},n.initResultPanel=function(){},n.initTemplate=function(){var t=document.createElement("div");t.id="taixiu-wrapper",t.className="taixiu-wrapper",this.wrapperTemplate=$(t),this.wrapper.append(t),this.initBettingPositionList(),this.initProfile(),this.initHost(),this.initTotalTable(),this.initGameCanvas(),this.initVitualBetting(),this.initListPlayer(),this.initChipButton(),this.initSellPopup(),this.initHistory(),this.wrapperTemplate.append(this.errorPanel),this.effectWrapper=$(TWIST.HTMLTemplate["effect/wrapper"]),this.wrapperTemplate.append(this.effectWrapper),this.money=this.user.find(".money"),this.setBetting(this.chipButtons[0])},n.setBetting=function(t){this.chipButtons.active&&(this.chipButtons.forEach(function(t,i){t.template.removeClass("active")}),t.template.addClass("active"),this.currentBetting=t)},n.pushTaiXiuEvent=function(){var t=this;this.on("userInfo",function(){t.renderUserInfo(arguments[0])}),this.on("userBetting",function(i){t.userBetting(i)}),this.on("updateBettings",function(i){t.updateBettings(i),t.emit("getListPlayer")}),this.on("updateListPlayer",function(t){this.listPlayer.html(t.count||"1")}),this.on("xocDia",function(i){t.xocDia(i)}),this.on("endXocDia",function(i){t.endXocDia(i)}),this.on("openDisk",function(i){t.openDisk(i)}),this.on("hostPayment",function(i){t.hostPaymentData=i}),this.on("changeHost",function(i){t.setHost(i)}),this.on("suggetstHost",function(i){t.isSuggestHost=!0}),this.on("reBettingResult",function(i){t.reBetting(i)}),this.on("resignationSuccess",function(i){t.setHost()}),this.on("cancelBettingResult",function(i){t.cancelBetting(i)}),this.on("sellBettingResult",function(i){t.showError({message:"Bán cửa thành công !"})}),this.on("historyToggle",function(i){t.history.toggle()})},n.cancelBetting=function(t){var i=this;this.totalTable.setTotalBetting(0),this.cancelBettingButton.hide(),this.bettingPositions.forEach(function(t,e){i.moveChipToUser(t.id,t.mineValue),t.setMineBetting(0)})},n.hostPaymentPhase1=function(){var t=this,i=this.hostPaymentData;this.totalTable.setTotalWin(i&&i.changeMoney),i&&(this.bettingPositions.hasChipsMove=!1,this.bettingPositions.forEach(function(i,e){i.status||(t.moveChipToHost(i.id),i.setMineBetting(0),i.setTotalBetting(0))}),this.bettingPositions.hasChipsMove||t.hostPaymentPhase2())},n.hostPaymentPhase2=function(){var t=this,i=this.hostPaymentData;i&&(TWIST.Sound.play("chip/multichip"),this.userInfo.isHost&&this.showChangeMoney(i),this.bettingPositions.forEach(function(i,e){i.status&&(t.paymentChipToSlotBetting(i.id,i.totalValue*i.ratio),i.setTotalBetting(i.totalValue*(i.ratio+1)),i.setMineBetting(i.mineValue*(i.ratio+1)))}))},n.showChangeMoney=function(t){this.userInfo.money=t.money,this.userMoney.runEffect(this.userInfo.money);var i=$(TWIST.HTMLTemplate["taiXiu/changeMoney"]);this.user.append(i),i.text(Global.numberWithDot3(parseInt(t.changeMoney))),i.one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){i.remove()}),t.changeMoney>=0&&i.addClass("plus")},n.hostPaymentPhase3=function(){var t=this,i=this.hostPaymentData;i&&(this.userInfo.isHost||this.showChangeMoney(i),TWIST.Sound.play("chip/multichip"),this.bettingPositions.forEach(function(i,e){i.status&&(!function(e,n){setTimeout(function(){t.moveChipToPlayers(i.id,e,n)},500)}(i.mineValue,i.totalValue),i.setMineBetting(0),i.setTotalBetting(0))}))},n.paymentChipToSlotBetting=function(t,i){var e=this,n=this.convertValueToChips(i),s=300/n.length;n.forEach(function(i,n){e.timeOutList.push(setTimeout(function(){e.paymentChipAction(t,i)},s*n))})},n.moveChipToHost=function(t){var i=this,n=this.moveChipContainer.children.find(function(i,e){return i.name==t}),s=n.children,a=s.length;a>0&&(this.bettingPositions.hasChipsMove=!0),i._numberChipMove=i._numberChipMove||0,s.forEach(function(t,n){var s=t.localToGlobal(0,0),o=i.userInfo.isHost?e.userPosition:e.hostPosition;setTimeout(function(){i._numberChipMove++,i.stage.addChild(t),t.move(s,o,function(){i.stage.removeChild(t),i._numberChipMove--,i._numberChipMove||setTimeout(function(){i.hostPaymentPhase2()},500)})},300/a*n)})},n.moveChipToUser=function(t,i){var n=this.moveChipContainer.children.find(function(i,e){return i.name==t}),s=n.children,a=e.userPosition;this.moveChipsToPosition(i,s,a)},n.moveChipToPlayers=function(t,i,n){var s=this.moveChipContainer.children.find(function(i,e){return i.name==t}),a=s.children;i&&this.moveChipsToPosition(i,a,e.userPosition),this.moveRemainChipToPlayers(a,e.playerPosition)},n.moveChipsToPosition=function(t,i,e){var n=this,s=this.convertValueToChipContainers(t,i),a=s.length;s.forEach(function(t,i){var s=t.localToGlobal(0,0),o=e;t.set(s),n.stage.addChild(t),setTimeout(function(){t.move(s,o,function(){n.stage.removeChild(t)})},300/a*i)})},n.moveRemainChipToPlayers=function(t,i){var e=this,n=t.length;t.forEach(function(t,s){var a=t;if(a){var o=a.localToGlobal(0,0),r=i;setTimeout(function(){e.stage.addChild(a),a.move(o,r,function(){e.stage.removeChild(a)})},300/n*s)}})},n.userBetting=function(t){this.totalTable.totalBettingValue+=this.currentBetting.value,this.totalTable.setTotalBetting(this.totalTable.totalBettingValue);var i=this.bettingPositions.find(function(i,e){return i.id==t.id});TWIST.Sound.play("chip/singlechip"),this.reBettingButton.hide(),this.cancelBettingButton.show(),i.setMineBetting(t.mineBetting),i.setTotalBetting(t.totalBetting);var e=this.currentBetting.id;this.bettingChipAction(t.id,e,!0)},n.updateBettings=function(t){var i=this;this.bettingPositions.forEach(function(e,n){var s=t.find(function(t,i){return t.id==e.id});s&&(i.playersBetting(e,s.totalBetting-e.totalValue),e.setTotalBetting(s.totalBetting))})},n.reBetting=function(t){TWIST.Sound.play("chip/multichip");var i=this;this.reBettingButton.hide(),this.cancelBettingButton.show(),this.bettingPositions.forEach(function(e,n){var s=t.find(function(t,i){return t.id==e.id});s&&(e.setMineBetting(s.mineBetting),s.mineBetting&&(i.totalTable.totalBettingValue+=parseInt(s.mineBetting)),e.setTotalBetting(s.totalBetting),i.userReBetting(e,s.mineBetting))}),this.totalTable.setTotalBetting(this.totalTable.totalBettingValue)},n.bettingChipAction=function(t,i,n){var s=this.moveChipContainer.getChildByName(t),a=this.createChip(i);a.isMine=n;var o=n?e.bettingChipPositions[i]:e.playerPosition,r={x:o.x-s.x,y:o.y-s.y},h={x:Math.random()*(s.width-e.chipSize.miniWidth),y:Math.random()*(s.height-e.chipSize.miniHeight)};s.addChild(a),a.move(r,h)},n.paymentChipAction=function(t,i){var n=this,s=this.moveChipContainer.getChildByName(t),a=this.createChip(i),o=this.userInfo.isHost?e.userPosition:e.hostPosition,r={x:o.x-s.x,y:o.y-s.y},h={x:Math.random()*(s.width-e.chipSize.miniWidth),y:Math.random()*(s.height-e.chipSize.miniHeight)};s.addChild(a),this._numberChipMove=this._numberChipMove||0,this._numberChipMove++,a.move(r,h,function(){n._numberChipMove--,n._numberChipMove||n.hostPaymentPhase3()})},n.playersBetting=function(t,i){var e=this,n=this.convertValueToChips(i),s=1e3/n.length;n.forEach(function(i,n){e.timeOutList.push(setTimeout(function(){e.bettingChipAction(t.id,i)},s*n))})},n.userReBetting=function(t,i){var e=this,n=this.convertValueToChips(i),s=500/n.length;n.forEach(function(i,n){e.timeOutList.push(setTimeout(function(){e.bettingChipAction(t.id,i,!0)},s*n))})},n.convertValueToChips=function(t){var i=[],e=this.chipButtons[0].value,n=[],s=0;this.chipButtons.forEach(function(t,i){s+=t.value*t.concentration;for(var e=0;e<t.concentration;e++)n.push(t.id)});for(var a=parseInt(t/s),o=0;a>o;o++)i=i.concat(n);for(var r=parseInt(t%s/e),o=0;r>o;o++)i.push(this.chipButtons[0].id);return Global.shuffle(i)},n.convertValueToChipContainers=function(t,i){function e(){return r=o>=d}function n(t){return h=h.filter(function(i,e){return t>=i}),h[0]}function s(){if(d=n(o)){var t=i.find(function(t,i){return t.value==d&&!t._isChecked});t?(o-=d,a.push(t),t._isChecked=!0):(h.shift(),s())}}var a=[],o=t,r=!0,h=this.chipButtons.map(function(t,i){return t.value});h.sort(function(t,i){return i-t});for(var d=n(t);e();)s();return a},n.xocDia=function(){var t,i,n,s=this;n=80,"STATUS_SHAKE_DISK"===this.status?(i={y:this.diskContainer.isTop?e.diskPosition.shakeY:e.diskPosition.shakeY+.05*e.diskPosition.width},t="xocDia"):(i={y:e.diskPosition.shakeY,scaleY:e.diskPosition.scaleY},t="endXocDia"),createjs.Tween.get(this.diskContainer).to(i,n).call(function(){s.diskContainer.isTop=!s.diskContainer.isTop,s.emit(t)})},n.endXocDia=function(){var t=this;createjs.Tween.get(this.diskContainer).to({y:e.diskPosition.y},1500).call(function(){t.history._toggle(!0)})},n.showResult=function(t){var i=this;this.playResultSounds(t);var n=e.bowlPosition.y-e.bowlPosition.height;this.history.addResult(t.map.map(function(t){return t+1}));this.chipResultContainer.removeAllChildren();var s=Global.shuffle(t.map);s.forEach(function(t,e){i.createResultDice(t,e)}),this.bowl.set({y:e.bowlPosition.y}),createjs.Tween.get(this.bowl).to({y:n},1e3).call(function(){i.hostPaymentPhase1()}),this.bettingPositions.forEach(function(i,e){i.setStatus(t.winnerSlots)})},n.playResultSounds=function(t){var i=(t.map,t.winnerSlots),e=0;t.map.forEach(function(t,i){e+=t+1});var n="",s="",a="",o=["news/ddungdatcuoc","news/mobat"],r=["news/nhat","news/nhi","news/tam","news/tu","news/ngu","news/luc"],h=["news/so_4","news/so_5","news/so_6","news/so_7","news/so_8","news/so_9","news/so_10",["news/so_10","news/so_1"],["news/so_10","news/so_2"],["news/so_10","news/so_3"],["news/so_10","news/so_4"],["news/so_10","news/so_5"],["news/so_10","news/so_6"],["news/so_10","news/so_7"]],d=[0,1,2,4,5,6].findIndex(function(t,e){return i.indexOf(t)>-1}),u=[8,9,10,11,12,13,14,16,17,18,19,20,21,22].findIndex(function(t,e){return i.indexOf(t)>-1}),c=d>-1;n=c?"news/dong":"news/tong",s=c?r[d]:h[u],console.log("numberType",u),!c&&u>-1&&(a=7>u?"news/xiu":"news/tai");var l=[o,n,s,a],p=[];l.forEach(function(t){t instanceof Array?p=p.concat(t):t&&p.push(t)}),TWIST.Sound.playQueue(p)},n.openDisk=function(t){this.history._toggle(!1);var i,n=this;i={x:e.diskPosition.x,y:e.diskPosition.shakeY},createjs.Tween.get(this.diskContainer).to(i,1e3).call(function(){n.showResult(t)})},n.closeDisk=function(t){this.history._toggle(!1),createjs.Tween.get(this.bowl).to(e.bowlPosition,1e3).call(function(){})},n.createResultDice=function(t,i){var n=this.imagePath+"dice"+(t+1)+"-big.png",s=new createjs.Bitmap(n),a=this.chipResultContainer.width/2,o=this.chipResultContainer.height/2,r=(e.diskPosition.scaleX,{x:Math.random()*(a-e.chipResultPosition.diceWidth)+parseInt(i/2)*a,y:Math.random()*(o-e.chipResultPosition.diceHeight)+parseInt(i%2)*o});return s.set(r),this.chipResultContainer.addChild(s),s},n.createChip=function(t){var i=e.chipSize,n=this.chipImages[t],s=new createjs.Bitmap(n),a=this.chipButtons.find(function(i,e){return i.id==t}).value;return s.set({scaleX:i.miniRatio,scaleY:i.miniRatio,type:t,value:a}),s.move=function(t,i,n){s.set(t);var a=i.x+5*(Math.random()-.5),o=i.y+5*(Math.random()-.5);createjs.Tween.get(s).to({x:a,y:o},e.moveChipAnimationTime).call(function(){"function"==typeof n&&n()})},s},n.renderUserInfo=function(){var t=this.user.find(".avatar"),i=this.user.find(".username");t.css("background-image","url("+(this.userInfo.avatar?"./"+this.userInfo.avatar:e.avatar)+")"),i.text(this.userInfo.username),this.userMoney.runEffect(this.userInfo.money)},n.initHistory=function(){var t=this;this.history=$(TWIST.HTMLTemplate["taiXiu/history"]),this.wrapperTemplate.append(this.history),this.historyInner=this.history.find(".history"),this.historyList=[],this.history._toggle=function(i){"undefined"!=typeof i?i?t.historyInner.addClass("active"):t.historyInner.removeClass("active"):t.historyInner.toggleClass("active")},this.historyInner.on("click",function(){t.history._toggle()}),this.history.addResult=function(i){var e=$(TWIST.HTMLTemplate["taiXiu/history-item"]),n=e.find(".history-item-type"),s=0;i.forEach(function(t,i){s+=t;var n=e.find("#dice-position"+i);n.addClass("dice"+(t-1))});var a=18>s&&s>10,o=11>s&&s>3,n=e.find(".history-item-type");a&&n.addClass("tai"),o&&n.addClass("xiu");var r=e.find(".history-item-number");r.html(s),t.historyInner.append(e),t.historyList.push(e),t.historyList.length>15&&(t.historyList[0].remove(),t.historyList.shift())}},n.addHistoryList=function(t){var i=this;t.forEach(function(t,e){i.history.addResult(t)})},n.initHost=function(){this.host=$(TWIST.HTMLTemplate["taiXiu/host"]),this.wrapperTemplate.append(this.host),this.host.background=this.host.find(".host-background"),this.host.hostName=this.host.find(".host-name"),this.host.chatBox=this.host.find(".chat-box"),this.host.hostMessage=this.host.find(".chat-box-inner"),this.host.setMessage=function(t){t?(this.show(),this.hostMessage.html(t)):this.hide()}},n.initTotalTable=function(){var t=this;this.totalTable=$(TWIST.HTMLTemplate["taiXiu/totalTable"]),this.wrapperTemplate.append(this.totalTable),this.totalTable.totalBetting=this.totalTable.find(".total-table-betting"),this.totalTable.totalWin=this.totalTable.find(".total-table-win"),this.addNumberEffect(this.totalTable.totalBetting),this.addNumberEffect(this.totalTable.totalWin),this.totalTable.setTotalBetting=function(i){this.totalBettingValue=i,t.totalBettingValue=i,this.totalBetting.runEffect(i)},this.totalTable.setTotalWin=function(t){this.totalWinValue=t,this.totalWin.runEffect(t)}},n.setHost=function(t){this.host.hostName.removeClass("active"),this.userInfo.isHost=(t&&t.uuid)==this.userInfo.uuid,this.resignationButton.hide(),this.userInfo.isHost&&this.showError({message:"Bạn đã làm nhà cái !"}),this.setShowChipButtons(),t&&t.username?(this.host.name=t.username,this.getHostButton.hide(),this.host.hostName.addClass("active"),this.host.hostName.html(t.username)):this.host.name=void 0},n.initListPlayer=function(){var t=this;this.listPlayer=$(TWIST.HTMLTemplate["taiXiu/listPlayer"]),this.wrapperTemplate.append(this.listPlayer),this.listPlayer.on("click",function(){t.activeListPlayer=!0,t.emit("getListPlayer")})},n.initBettingPositionList=function(){var t=this;this.table=$(TWIST.HTMLTemplate["taiXiu/table"]),this.wrapperTemplate.append(this.table);var i=this.bettingPositions,e=document.createDocumentFragment();i.forEach(function(i,n){var s=t.createBettingPosition(i,n);e.append(s)}),this.table.append(e),i.forEach(function(i,e){t.setBettingPositionsPrototype(i,e)});var n=$('<div class="over-table">');this.wrapperTemplate.append(n)},n.initVitualBetting=function(){var t=this,i=this.bettingPositions,e=$('<div class="vitual-table">');this.wrapperTemplate.append(e);var n=document.createDocumentFragment();i.forEach(function(i,e){var s=t.createVitualBetting(i,e);n.append(s)}),e.append(n),i.forEach(function(i,e){t.setVitualBettingPrototype(i,e)})},n.initProfile=function(){this.user=$(TWIST.HTMLTemplate["taiXiu/user"]),this.wrapperTemplate.append(this.user),this.userMoney=this.user.find(".money"),this.addNumberEffect(this.userMoney)},n.initGameCanvas=function(){this.wrapperTemplate.append(this.canvas),this.initDisk(),this.initMoveChipContainer();var t=e.timer;this.desk.createTimer({x:t.x-t.radius,y:t.y-t.radius,radius:t.radius,strokeThick:5,__type:1}),this.stage.addChild(this.moveChipContainer,this.diskContainer,this.desk)},n.initChipButton=function(){var t=this;this.chipWrapper=$(TWIST.HTMLTemplate["taiXiu/chips"]),this.wrapperTemplate.append(this.chipWrapper),this.chipImages=[new Image,new Image,new Image,new Image],this.chipImages[0].src=this.imagePath+"1st-chip.png",this.chipImages[1].src=this.imagePath+"2nd-chip.png",this.chipImages[2].src=this.imagePath+"3rd-chip.png",this.chipImages[3].src=this.imagePath+"4th-chip.png",this.chipButtons=[{id:0,value:1e3,concentration:1,template:this.chipWrapper.find(".chip-1st")},{id:1,value:1e4,concentration:1,template:this.chipWrapper.find(".chip-2nd")},{id:2,value:1e5,concentration:1,template:this.chipWrapper.find(".chip-3rd")},{id:3,value:1e6,concentration:1,template:this.chipWrapper.find(".chip-4th")}],this.chipButtons.active=!0,this.chipButtons.forEach(function(i,e){i.template.on("click",function(){TWIST.Sound.play("minigame/Common_Click"),t.setBetting(i)})})},n.initSellPopup=function(){function t(){a.sellPopup.hide()}function i(){a.sellPopup.scroller.css("left",0),s(0)}function e(){a.sellPopup.scroller.css("left",h),s(1)}function n(){var t={id:o.id,value:a.sellPopup.currentValue};a.sellPopup.hide(),a.emit("sellBetting",t)}function s(t){a.sellPopup.dragbarInner.css("width",t*h+r);var i=parseInt(t*a.sellPopup.maxValue);a.sellPopup.currentValue=i,a.sellPopup.scrollerValue.html(i)}var a=this;this.sellPopup=$(TWIST.HTMLTemplate["taiXiu/sellPopup"]);var o;this.sellPopup.initPopup=function(t){o=t;var i=t.totalValue;a.sellPopup.maxValue=i,a.sellPopup.plusButton.html(i),a.sellPopup.title.html(t.name)},this.wrapperTemplate.append(this.sellPopup);var r=5,h=256;this.sellPopup.hide(),this.sellPopup.title=this.sellPopup.find(".sell-popup-title"),this.sellPopup.background=this.sellPopup.find(".sell-popup-background"),this.sellPopup.background.on("click",t),this.sellPopup.cancel=this.sellPopup.find("#cancel"),this.sellPopup.cancel.on("click",t),this.sellPopup.accept=this.sellPopup.find("#accept"),this.sellPopup.accept.on("click",n),this.sellPopup.minusButton=this.sellPopup.find(".sell-popup-minus"),this.sellPopup.minusButton.on("click",i),this.sellPopup.plusButton=this.sellPopup.find(".sell-popup-plus"),this.sellPopup.plusButton.on("click",e),this.sellPopup.dragbarInner=this.sellPopup.find(".sell-popup-dragbar-inner"),this.sellPopup.scroller=this.sellPopup.find("#scroller"),this.sellPopup.scrollerValue=this.sellPopup.scroller.find(".sell-popup-scroller-content");var d={axis:"x",scroll:!1,containment:"#sell-popup-drag-container",drag:function(t,i){var e=i.position.left/h;s(e)}};this.sellPopup.scroller.draggable(d)},n.showSellPopup=function(){var t=this.bettingPositions.find(function(t,i){return t.isSelected});t?t.totalValue&&(this.sellPopup.show(),this.sellPopup.initPopup(t)):this.showError({message:"Chưa chọn cửa bán !"})},n.initButton=function(){var t=this;this.buttons=[];var i=$(TWIST.HTMLTemplate["taiXiu/buttons"]);this.wrapperTemplate.append(i),this.reBettingButton=i.find("#reBetting"),this.buttons.push(this.reBettingButton),this.reBettingButton.on("click",function(){t._listenChangeMoney=!0,t.emit("reBetting")}),this.cancelBettingButton=i.find("#cancelBetting"),this.buttons.push(this.cancelBettingButton),this.cancelBettingButton.on("click",function(){t._listenChangeMoney=!0,t.emit("cancelBetting")}),this.sellOddButton=i.find("#sellOdd"),this.buttons.push(this.sellOddButton),this.sellOddButton.on("click",function(){t.showSellPopup()}),this.resignationButton=i.find("#resignation"),this.buttons.push(this.resignationButton),this.resignationButton.on("click",function(){t.emit("resignation")}),this.sellEvenButton=i.find("#sellEven"),
this.buttons.push(this.sellEvenButton),this.sellEvenButton.on("click",function(){t.showSellPopup()}),this.getHostButton=i.find("#getHost"),this.buttons.push(this.getHostButton),this.getHostButton.on("click",function(){t.emit("getHost")}),this.buttons.hide=function(){t.buttons.forEach(function(t,i){t.hide()})}},n.initDisk=function(){this.diskContainer=new createjs.Container;var t=e.diskPosition,n=e.chipResultPosition,s=e.bowlPosition;t.x=(e.gameSize.width-t.width)/2,t.y=3*-t.width/5,t.shakeY=0,t.scaleX=t.scaleY=t.scale,this.diskContainer.set(t),this.disk=new createjs.Bitmap((TWIST.imagePath||i)+"taixiu/disk.png"),this.chipResultContainer=new createjs.Container,n.height=n.width=s.width/Math.sqrt(2),n.x=n.y=(t.initWidth-n.width)/2,this.chipResultContainer.set(e.chipResultPosition),this.bowl=new createjs.Bitmap((TWIST.imagePath||i)+"taixiu/bowl.png"),s.x=(t.initWidth-s.width)/2,s.y=(t.initHeight-s.height)/2,this.bowl.set(e.bowlPosition),this.diskContainer.addChild(this.disk,this.chipResultContainer,this.bowl)},n.initMoveChipContainer=function(){this.moveChipContainer=new createjs.Container;var t=this.moveChipContainer;this.bettingPositions.forEach(function(i,e){var n=new createjs.Container,s={x:i.left+5+22.5+5,y:i.top+5+173+5,width:i.width,height:i.height-35,name:i.id};i.bettingSlot=n,n.set(s),t.addChild(n)})},n.createVitualBetting=function(t){var i=(TWIST.HTMLTemplate["taiXiu/vitualBetting"],document.createElement("div"));return i.className="vitual-betting-position",i.id="vitualBetting"+t.id,i},n.setSelectedBetting=function(t){this.bettingPositions.forEach(function(t,i){t.setSelected(!1)}),t.setSelected(!0)},n.emitBetting=function(t){return this.userInfo.money<t.value?void this.showError({message:"Bạn không đủ tiền đặt cược !"}):(this._listenChangeMoney=!0,void this.emit("betting",t))},n.createBettingPosition=function(t,i){var e=TWIST.HTMLTemplate["taiXiu/bettingPosition"],n=document.createElement("div");return n.className="betting-position",n.id="bettingPosition"+t.id,n.innerHTML=e,n},n.setBettingPositionsPrototype=function(t){var i=this,e=$("#bettingPosition"+t.id);e.css(t),t.template=e,e.addClass("type-id"+t.id),t.types.forEach(function(t,i){e.addClass("type-"+t)}),e.mineBetting=e.find(".mine-betting"),this.addNumberEffect(e.mineBetting,3),e.totalBetting=e.find(".total-betting"),this.addNumberEffect(e.totalBetting,3),e.displayNameContainer=e.find(".name"),e.displayNameContainer.html(t.displayName),e.ratioContainer=e.find(".ratio"),e.displayNameContainer.html(t.displayName),e.setMineBetting=function(i){this.mineBetting.html(Global.numberWithDot3(i)),t.mineValue=i},e.setTotalBetting=function(i){this.totalBetting.html(Global.numberWithDot3(i)),t.totalValue=i},t.setMineBetting=function(e){i.userInfo.isHost?(t.template.mineBetting.hide(),t.mineValue=0):(t.template.mineBetting.show(),t.template.mineBetting.runEffect(e),t.mineValue=e)},t.setTotalBetting=function(i){t.template.totalBetting.runEffect(i),t.totalValue=i},t.setStatus=function(i){t.template.removeClass("active disabled"),t.status=0,i&&(i.indexOf(t.id)>-1?(t.template.addClass("active"),t.status=1):t.template.addClass("disabled"))},t.setSelected=function(i){t.isSelected=i,t.template.removeClass("selected"),i&&t.template.addClass("selected")},t.setRatio=function(i){t.ratio=i,t.template.ratioContainer.html(i)}},n.setVitualBettingPrototype=function(t){var i=this,e=$("#vitualBetting"+t.id);e.css({top:t.top+3,left:t.left+3,width:t.width+3,height:t.height+3}),t.vitualBetting=e,e.on("click",function(){if(i.userInfo.isHost)i.setSelectedBetting(t);else{var e={value:i.currentBetting.value,currentBettingId:i.currentBetting.id,slotBettingId:t.id};i.emitBetting(e)}})},n.addCoins=function(t,i){var e=$(TWIST.HTMLTemplate["taiXiu/coin-item"]);t&&e.addClass("red-coin"),i.append(e)},n.setBettingChipValue=function(t){this.chipButtons.forEach(function(i,e){var n=t.find(function(t,e){return i.id==t.id});i.value=n.value,i.template.html(Global.numberWithDot2(i.value))})},n.setRemainingTime=function(t,i){if(["STATUS_BETTING"].indexOf(this.status)>-1){var e=this.options.timer;this.desk.setRemainingTime(parseInt(t),{x:e.x,y:e.y-e.radius/2-2,font:"bold 36px Roboto Condensed",color:"#ffde00"}),this.desk.setCicleTime(parseInt(t),parseInt(i))}else this.desk.setRemainingTime(-1),this.desk.clearTimer()},n.drawBettingPositions=function(t){var i=this,e=0;this.bettingPositions.forEach(function(n,s){var a=t.find(function(t,i){return t.id==n.id});a&&(n.setRatio(a.ratio),n.setMineBetting(a.mineBetting),i.userReBetting(n,a.mineBetting),e+=parseInt(a.mineBetting),n.setTotalBetting(a.totalBetting),i.playersBetting(n,a.totalBetting-a.mineBetting))}),this.totalTable.setTotalBetting(e)},n.setShowChipButtons=function(t){var i=this.userInfo.isHost();this.chipButtons.forEach(function(t,e){i?t.template.hide():t.template.show()})},n.setShowChipButtons=function(t){var i=this.userInfo.isHost;this.chipButtons.forEach(function(t,e){i?t.template.hide():t.template.show()})},n.setShowVitualBettings=function(t){var i=this.userInfo.isHost&&4==t||!this.userInfo.isHost&&3==t;this.bettingPositions.forEach(function(t,e){i?t.vitualBetting.show():t.vitualBetting.hide()})},n.removeSelectedBetting=function(t){this.bettingPositions.forEach(function(t,i){t.setSelected(!1)})},n.changeStatus=function(t){if(this.status!=this.statusList[t.status]){this.status=this.statusList[t.status];var i=this[this.status];this.buttons.hide(),this.setShowChipButtons(),this.setShowVitualBettings(t.status),this.removeSelectedBetting(t.status),this.setRemainingTime(t.remainingTime,t.totalTime),TWIST.Sound.stop(),"function"==typeof i&&i.call(this,t),this.emit("ping")}},n.STATUS_WAITING_FOR_START=function(){this.bettingPositions.forEach(function(t,i){t.template.removeClass("active disabled"),t.bettingSlot.removeAllChildren(),t.setMineBetting(0),t.setTotalBetting(0)}),this.totalTable.setTotalBetting(0),this.totalTable.setTotalWin(0),this.closeDisk(),this.host.setMessage("")},n.STATUS_SHAKE_DISK=function(){this.host.background.show(),this.emit("xocDia"),this.host.setMessage("Nhà cái xóc đĩa !")},n.STATUS_BETTING=function(t){var i=["news/anhoidatcuoc","news/batdaudatcuoc","news/moidatcuoc","news/datcuocdianh"],e=i[Math.floor(Math.random()*i.length)];TWIST.Sound.play(e),this.host.background.hide(),this.host.setMessage(""),t.showReBetting&&this.reBettingButton.show(),t.showCancelBetting&&this.cancelBettingButton.show()},n.STATUS_ARRANGING=function(t){this.host.setMessage(""),this.userInfo.isHost&&(this.sellEvenButton.show(),this.sellOddButton.show())},n.END_GAME=function(){this.sellPopup.hide(),this.host.setMessage("Mở bát !"),this.totalBettingValue=0},TWIST.TaiXiu=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t,i){this.wrapper=$(t),this.options=$.extend(v,i),this.initTinyHightLowGame()}var i,e,n,s,a,o,r,h,d,u,c,l,p,f,m,g,v={resultTab:[]},T=t.prototype=new TWIST.BaseGame;T.initTinyHightLowGame=function(){this.initVariable(),$.extend(this.options,c),this.info={betting:1e3,potData:{1e3:0,1e4:0,1e5:0}},TWIST.Card.RankMapIndex=["1","2","3","4","5","6","7","8","9","10","11","12","13"],this.userInfo={},this.initCanvas(),this.initEvent(),this.initTemplate(),this.draw(),this.pushEventListener(),this.status="pause"},T.initVariable=function(){i=["pause","endding","running"],d=["getCards","selectHightLow"],e=[{value:0,name:"2"},{value:1,name:"3"},{value:2,name:"4"},{value:3,name:"5"},{value:4,name:"6"},{value:5,name:"7"},{value:6,name:"8"},{value:7,name:"9"},{value:8,name:"10"},{value:9,name:"J"},{value:10,name:"Q"},{value:11,name:"K"},{value:12,name:"A"}],n=2.5,s=52,a=[],c={width:630,height:340},l={width:188,height:245},p={width:38,height:46},o=[1e3,1e4,1e5],r=2e3,u=[],h=0,f={},m={width:360,height:62,top:260,left:0},g=0},T.initTemplate=function(){this.wrapperTemplate=$(TWIST.HTMLTemplate["tinyHightLow/wrapper"]),this.wrapper.append(this.wrapperTemplate),this.centerTempalte=$(TWIST.HTMLTemplate["tinyHightLow/center"]),this.wrapperTemplate.append(this.centerTempalte),this.centerTempalte.find(".canvas-wrapper").append(this.canvas),this.initStage(),this.topTempalte=$(TWIST.HTMLTemplate["tinyHightLow/top"]),this.wrapperTemplate.append(this.topTempalte),this.bottomTempalte=$(TWIST.HTMLTemplate["tinyHightLow/bottom"]),this.wrapperTemplate.append(this.bottomTempalte),this._initExplodePot(),this._initPot(),this._initCurrentBetting(),this._initPotCards(),this._initSupportText(),this._initRemainTime(),this._initHightLowButton(),this._initHightLowBettingText(),this._initNewTurnText(),this._initVirtualCard(),this._initProfile(),this._initChipsButton(),this._initOtherButtons(),this._initSessionId(),this._initNewTurnButton(),this._initErrorPanel()},T._initExplodePot=function(){var t=this;this.effect=$('<div class="effect">'+TWIST.HTMLTemplate["effect/explodePot"]+"</div>"),this.wrapperTemplate.append(this.effect),this.effect.explorerPot=t.effect.find(".explorer-pot"),this.effect.moneyFalling=t.effect.find(".money-falling"),this.effect.showEffect=function(){t.effect.explorerPot.show(),t.effect.moneyFalling.show()},this.effect.hideEffect=function(){t.effect.explorerPot.hide(),t.effect.moneyFalling.hide()},this.effect.on("click",t.effect.hideEffect)},T._initPot=function(){this.pot=this.topTempalte.find(".pot-value"),this.addNumberEffect(this.pot)},T._initCurrentBetting=function(){this.currentBetting=this.topTempalte.find(".bank-value"),this.addNumberEffect(this.currentBetting)},T._initPotCards=function(){var t=this;this.potCards=[];var i=this.topTempalte.find(".pot-card");i.each(function(i,e){t.potCards.push($(e))}),this.potCards.addActiveCard=function(){var i=t.potCards.find(function(t,i){return!t.active});i&&(i.active=!0,i.addClass("active"))},this.potCards.removeActiveCard=function(){i.removeClass("active"),t.potCards.forEach(function(t,i){t.active=!1,t.removeClass("active")})}},T._initSupportText=function(){this.supportText=this.centerTempalte.find(".text-support"),this.supportText.text("")},T._initRemainTime=function(){this.remainTime=this.centerTempalte.find(".remain-time"),this.addRemainTimeEffect(this.remainTime)},T._initHightLowButton=function(){var t=this;this.lowButton=this.centerTempalte.find(".low-button"),this.addDisbaleEffect(this.lowButton),this.lowButton.runEffect(),this.hightButton=this.centerTempalte.find(".hight-button"),this.addDisbaleEffect(this.hightButton),this.hightButton.runEffect(),this.lowButton.on("click",function(i){t.lowButton.disabled||t.emitHightLow(!1)}),this.hightButton.on("click",function(i){t.hightButton.disabled||t.emitHightLow(!0)})},T._initHightLowBettingText=function(){this.lowBetting=this.centerTempalte.find(".low-value"),this.addNumberEffect(this.lowBetting),this.hightBetting=this.centerTempalte.find(".hight-value"),this.addNumberEffect(this.hightBetting)},T._initVirtualCard=function(){var t=this;this.virtualCard=this.centerTempalte.find(".virtual-card"),this.getCardButton=this.bottomTempalte.find(".get-card"),this.virtualCard.on("click",function(i){t.checkStart()}),this.getCardButton.on("click",function(i){t.checkStart()})},T.checkStart=function(){var t=this;"pause"===t.status&&0===h&&(this.userInfo.money<this.info.betting?this.emit("error","Bạn không đủ tiền !"):(TWIST.Sound.play("minigame/ButtonClick"),TWIST.Sound.play("minigame/coin_spin"),t.emit("start",this.info.betting),this.newTurnText.hide(),this.changeStatus("running"),t.moneyContainer.runEffect(this.userInfo.money-this.info.betting,{duration:500}),this.moveChip.runEffect(!0)))},T.emitHightLow=function(t){var i=this;"pause"===i.status&&1===h&&(TWIST.Sound.play("minigame/ButtonClick"),this.emit("choose",t))},T._initNewTurnText=function(){this.newTurnText=this.centerTempalte.find(".new-turn-text")},T._initProfile=function(){var t=this;this.user=$(TWIST.HTMLTemplate["tinyMiniPoker/user"]),this.bottomTempalte.find(".profile-hight-low").append(this.user),this.moneyContainer=this.user.find(".money"),this.addNumberEffect(this.moneyContainer),this.user.renderUserInfo=function(i){$.extend(t.userInfo,i);var e=t.user.find(".avatar"),n=t.user.find(".username"),s=(t.user.find(".money"),Global.md5Avatar(i.avatar));e.addClass("avatar"+s),n.text(i.username),t.moneyContainer.runEffect(i.money,{duration:10})},this.moveChip=$(TWIST.HTMLTemplate["tinyVideoPoker/moveChip"]),this.user.append(this.moveChip),this.addChipEffect(this.moveChip),this.moveChip.hide()},T._initChipsButton=function(){var t=this;this.chipWrapper=$(TWIST.HTMLTemplate["tinyMiniPoker/chips"]),this.bottomTempalte.find(".chips-hight-low").append(this.chipWrapper),this.chipButtons=[{value:1e3,template:this.chipWrapper.find(".chip:first-child")},{value:1e4,template:this.chipWrapper.find(".chip:nth-child(2)")},{value:1e5,template:this.chipWrapper.find(".chip:nth-child(3)")}],this.chipButtons.forEach(function(i,e){i.template.on("click",function(e){"pause"===t.status&&0===h&&(this.resultSound=TWIST.Sound.play("minigame/Common_Click"),t.setBetting(i))})}),this.setBetting(this.chipButtons[0])},T._initErrorPanel=function(){this.errorPanel=$(TWIST.HTMLTemplate["tinyMiniPoker/errorPanel"]),this.wrapperTemplate.append(this.errorPanel),this.errorPanel.hide()},T._initOtherButtons=function(){var t=this;this.closeButton=this.bottomTempalte.find(".button-close"),this.closeButton.on("click",function(i){t.emit("closePopup")}),this.showHelp=this.bottomTempalte.find(".button-help"),this.showHelp.on("click",function(i){t.emit("showHelp")}),this.showHistory=this.bottomTempalte.find(".button-history"),this.showHistory.on("click",function(i){t.emit("showHistory")})},T._initSessionId=function(){this.sessionId=$(TWIST.HTMLTemplate["tinyMiniPoker/sessionId"]),this.wrapperTemplate.append(this.sessionId)},T.setBetting=function(t){this.chipWrapper.find(".chip").removeClass("active"),t.template.addClass("active"),this.info.betting=t.value,this.pot.runEffect(this.info.potData[this.info.betting],{duration:200})},T._initNewTurnButton=function(){var t=this;this.newTurnButton=this.bottomTempalte.find(".new-turn-button"),this.addDisbaleEffect(this.newTurnButton),this.newTurnButton.hide(),this.newTurnButton.on("click",function(i){t.newTurnButton.disabled||t.emit("newTurn")})},T.draw=function(){this.mainContainer=new createjs.Container,this.mainContainer.set({x:(c.width-l.width)/2,y:0}),this.winCardContainer=new createjs.Container,this.winCardContainer.set({x:m.left,y:m.top}),this.stage.addChild(this.mainContainer,this.winCardContainer),this.addMainCard(-1)},T.addMainCard=function(t){this.mainContainer.removeAllChildren();var i,e;if(t>-1)e=l.width/TWIST.Card.size.width,i=new TWIST.Card(t),i.set({scaleX:e,scaleY:e});else{var n=new Image;n.src=TWIST.imagePath+"tinyHightLow/card-back.png";var i=new createjs.Bitmap(n);i.set({scaleX:l.width/400,scaleY:l.width/400})}this.mainContainer.addChild(i)},T.storeMainCard=function(){var t=this,i=this.mainContainer.children[0],e=this.winCardContainer.children.length;this.winCardContainer.addChild(i),i.set({x:i.x+this.mainContainer.x-this.winCardContainer.x,y:i.y+this.mainContainer.y-this.winCardContainer.y});var n=10+(p.width+10)*e;if(createjs.Tween.get(i).to({x:n,y:10,scaleX:p.width/TWIST.Card.size.width,scaleY:p.height/TWIST.Card.size.height},500).call(function(){t.emit("_storeComplete")}),n+p.width>m.width){var s=m.width-(n+p.width);createjs.Tween.get(this.winCardContainer).to({x:s},500).call(function(){})}},T.drawListCard=function(t){function i(t,i){var n=new TWIST.Card(t);e.winCardContainer.addChild(n),n.set({x:10+(p.width+10)*i,y:10,scaleX:p.width/TWIST.Card.size.width,scaleY:p.height/TWIST.Card.size.height})}var e=this;this.winCardContainer.removeAllChildren(),t.forEach(i)},T.changeStatus=function(t){var i=this;this.clear(),"pause"===t&&this.newTurnButton.setDisabled(!1),"running"===t&&(this.playingInterval=setInterval(function(){i.addMainCard(parseInt(52*Math.random()))},100),u.push(this.playingInterval),this.hightButton.setDisabled(!0),this.lowButton.setDisabled(!0),this.newTurnButton.setDisabled(!0))},T.changeGameState=function(t){h=t,this.clearGameState(),0==h?(this.changeStatus("pause"),this.addMainCard(-1),this.getCardButton.show(),this.virtualCard.show(),this.newTurnText.show(),this.newTurnButton.hide(),this.hightButton.setDisabled(!0),this.lowButton.setDisabled(!0),this.lowBetting.runEffect(0,{duration:10}),this.hightBetting.runEffect(0,{duration:10}),this.effect.hide()):1==h&&(this.newTurnText.hide(),this.getCardButton.hide(),this.virtualCard.hide(),this.newTurnButton.show())},T.clear=function(){this.supportText.text(""),this.remainTime.endEffect(),u.forEach(function(t){clearTimeout(t)})},T.clearGameState=function(){this.clear(),this.potCards.removeActiveCard(),this.winCardContainer.set({x:0}),this.winCardContainer.removeAllChildren(),this.currentBetting.runEffect(0)},T.setNewCard=function(t){this.addMainCard(t.cardId),this.hightButton.setDisabled(!1),this.lowButton.setDisabled(!1),this.hightBetting.runEffect(t.hightMoney,{duration:300}),this.lowBetting.runEffect(t.lowMoney,{duration:300}),t.isPotCard&&this.potCards.addActiveCard(),g=t.currentBetting,this.currentBetting.runEffect(t.currentBetting||0,{duration:300}),t.currentBetting>0?(t.currentBetting!=this.info.betting&&TWIST.Sound.play("minigame/NormalWin"),this.supportText.text("Quân bài tiếp theo là cao hay thấp hơn ?"),this.remainTime.runEffect(t.remainTime||12e4),this.hightButton.setDisabled(!1),this.lowButton.setDisabled(!1),0==t.hightMoney&&this.hightButton.setDisabled(!0),0==t.lowMoney&&this.lowButton.setDisabled(!0),t.explorerPot&&this.effect.showEffect()):(TWIST.Sound.play("minigame/slot_result"),this.supportText.text("Bạn chọn sai, chúc bạn may mắn lần sau !"),this.hightButton.setDisabled(!0),this.lowButton.setDisabled(!0))},T.pushEventListener=function(){var t=this;this.on("userInfo",function(){t.user.renderUserInfo(arguments[0])}),this.on("getFirstCard",function(i){t.getFirstCard(i)}),this.on("updatePots",function(i){t.bindPots(i)}),this.on("newCard",function(i){t.newCard(i)}),this.on("getWin",function(i){t.getWin(i)}),this.on("updateMoney",function(i){t.updateMoney(i)}),this.on("error",function(i){t.showError(i)}),this.on("reconnect",function(i){t.reconnect(i)})},T.getFirstCard=function(t){this.changeGameState(1),this.changeStatus("pause"),t.currentBetting=t.currentBetting||this.info.betting,this.setNewCard(t),this.newTurnButton.setDisabled(!0),this.sessionId.text(t.sessionId)},T.bindPots=function(t){$.extend(this.info.potData,t.pots),this.pot.runEffect(this.info.potData[this.info.betting],{duration:500})},T.newCard=function(t){var i=this;this.storeMainCard(),this.changeStatus("running"),this.once("_storeComplete",function(){i.changeStatus("pause"),i.setNewCard(t)})},T.getWin=function(t){var i=this;this.sessionId.text(""),g>0?(TWIST.Sound.play("minigame/coin_spin"),this.moveChip.isTracking=!0,this.moveChip.runEffect(),this.moneyContainer.runEffect(parseInt(this.userInfo.money)+g,{duration:500}),this.currentBetting.runEffect(0,{duration:500}),i.changeGameState(0),this.once("_moveChipComplete",function(){i.changeGameState(0)})):this.changeGameState(0)},T.updateMoney=function(t){this.userInfo.money=t.newMoney},T.showError=function(t){var i=$('<div class="error-item-mini">'+t+"</div>"),e=this;this.errorPanel.empty(),this.errorPanel.show(),this.errorPanel.append(i);var e=this;i.one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(i).remove(),e.errorPanel.hide()})},T.reconnect=function(t){var i;if(this.chipButtons.forEach(function(e,n){e.value==t.betting&&(i=e)}),this.changeGameState(1),this.setBetting(i),this.setNewCard(t),this.drawListCard(t.listCard),t.listCard.length||this.newTurnButton.setDisabled(!0),t.numberPotCards)for(var e=0;e<t.numberPotCards;e++)this.potCards.addActiveCard()},TWIST.TinyHightLowGame=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t,i){this.wrapper=$(t),this.options=$.extend(C,i),this.initTinyMiniPoker()}var i,e,n,s,a,o,r,h,d,u,c,l,p,f,m,g,v,T,C={resultTab:[{name:"Sảnh rồng(Nỗ hũ)",value:-1,code:"1"},{name:"Thùng phá sảnh",value:1e3,code:"2"},{name:"Tứ quý",value:150,code:"3"},{name:"Cù lũ",value:50,code:"4"},{name:"Thùng",value:20,code:"5"},{name:"Sảnh",value:13,code:"6"},{name:"Ba lá",value:8,code:"7"},{name:"Hai đôi",value:5,code:"8"},{name:"Đôi J hoặc cao hơn",value:2.5,code:"9"},{name:"Không ăn !",value:0,code:"10"}],cardSize:{width:115,height:153}},w=t.prototype=new TWIST.BaseGame;w.initTinyMiniPoker=function(){this.initVariable(),$.extend(this.options,i),this.info={betting:1e3,potData:{1e3:0,1e4:0,1e5:0}},TWIST.Card.RankMapIndex=["1","2","3","4","5","6","7","8","9","10","11","12","13"],this.userInfo={},this.initCanvas(),this.initEvent(),this.initTemplate(),this.initButton(),this.draw(),this.pushEventListener(),this.status="pause"},w.initVariable=function(){o=["pause","running","ending","effecting"],v=[{value:0,name:"2"},{value:1,name:"3"},{value:2,name:"4"},{value:3,name:"5"},{value:4,name:"6"},{value:5,name:"7"},{value:6,name:"8"},{value:7,name:"9"},{value:8,name:"10"},{value:9,name:"J"},{value:10,name:"Q"},{value:11,name:"K"},{value:12,name:"A"}],r=-1,d=1,e={width:130,height:270,padding:10},i={width:5*e.width,height:e.height,x:5,y:1},n=e.height,s=[],a=2.5,h=52,u={x:166,y:233},l=[],c=[1e3,1e4,1e5],p=2e3,f=0,m=0,g=[],T=!1},w.draw=function(){this.mapData=TWIST.MiniPokerLogic.generateMap();var t=new createjs.Container;this.spinArea=t;for(var n=0;n<i.x;n++){s[n]=new createjs.Container,s[n].set({x:n*e.width,y:0});var a=new createjs.Container;s[n].addChild(a);var o=(this.mapData[n],this.createSlotItem(this.mapData[n],0));a.addChild(o),t.addChild(s[n])}this.stage.addChild(t)},w.initTemplate=function(){var t=this;this.wrapperTemplate=$(TWIST.HTMLTemplate["tinyMiniPoker/wrapper"]),this.wrapper.append(this.wrapperTemplate),this.canvasWrapper=$(TWIST.HTMLTemplate["tinyMiniPoker/canvasWrapper"]),this.wrapperTemplate.append(this.canvasWrapper),this.canvasWrapper.append(this.canvas),this.initStage(),this.resultText=$(TWIST.HTMLTemplate["tinyMiniPoker/resultText"]),this.wrapperTemplate.append(this.resultText),this.wrapperTemplate.append($(TWIST.HTMLTemplate["tinyMiniPoker/pot"])),this.pot=this.wrapperTemplate.find(".pot-value"),this.buttonSpin=$(TWIST.HTMLTemplate["tinyMiniPoker/buttonSpin"]),this.wrapperTemplate.append(this.buttonSpin),this.buttonClose=$(TWIST.HTMLTemplate["tinyMiniPoker/buttonClose"]),this.wrapperTemplate.append(this.buttonClose),this.buttonHelp=$(TWIST.HTMLTemplate["tinyMiniPoker/buttonHelp"]),this.wrapperTemplate.append(this.buttonHelp),this.buttonHistory=$(TWIST.HTMLTemplate["tinyMiniPoker/buttonHistory"]),this.wrapperTemplate.append(this.buttonHistory);var i=$(TWIST.HTMLTemplate["tinyMiniPoker/autospin"]);this.wrapperTemplate.append(i),this.autoSpin=i.find('input[type="checkbox"]'),this.chipWrapper=$(TWIST.HTMLTemplate["tinyMiniPoker/chips"]),this.wrapperTemplate.append(this.chipWrapper),this.chipButtons=[{value:1e3,template:this.chipWrapper.find(".chip:first-child")},{value:1e4,template:this.chipWrapper.find(".chip:nth-child(2)")},{value:1e5,template:this.chipWrapper.find(".chip:nth-child(3)")}],this.errorPanel=$(TWIST.HTMLTemplate["tinyMiniPoker/errorPanel"]),this.wrapperTemplate.append(this.errorPanel),this.errorPanel.hide(),this.resultTab=$(TWIST.HTMLTemplate["tinyMiniPoker/resultTab"]),this.wrapperTemplate.append(this.resultTab),this.resultItemList=[],this.resultItem=_.template(TWIST.HTMLTemplate["tinyMiniPoker/resultItem"]),this.options.resultTab.forEach(function(i,e){if("10"!==i.code){var n={code:i.code,template:$(t.resultItem({name:i.name,value:i.value<=0?"":"X"+i.value}))};t.resultTab.append(n.template),t.resultItemList.push(n)}}),this.user=$(TWIST.HTMLTemplate["tinyMiniPoker/user"]),this.wrapperTemplate.append(this.user),this.sessionId=$(TWIST.HTMLTemplate["tinyMiniPoker/sessionId"]),this.wrapperTemplate.append(this.sessionId),this.effectWrapper=$(TWIST.HTMLTemplate["effect/wrapper"]),this.wrapperTemplate.append(this.effectWrapper),this.explodePot=$(TWIST.HTMLTemplate["effect/explodePot"]),this.effectWrapper.append(this.explodePot),this.money=this.user.find(".money"),this.setBetting(this.chipButtons[0])},w.initButton=function(){var t=this;this.chipButtons.forEach(function(i,e){i.template.on("click",function(e){"pause"!==t.status&&"effecting"!==t.status||(TWIST.Sound.play("minigame/Common_Click"),t.setBetting(i))})}),this.autoSpin.on("change",function(i){t.isAutoSpin=i.target.checked,"pause"!=t.status&&"effecting"!=t.status||t.checkStart()}),this.buttonSpin.on("click",function(i){t.buttonSpin.hasClass("disabled")||t.checkStart()}),this.buttonClose.on("click",function(i){t.emit("closePopup")}),this.buttonHelp.on("click",function(i){t.emit("showHelp")}),this.buttonHistory.on("click",function(i){t.emit("showHistory")})},w.setBetting=function(t){this.chipWrapper.find(".chip").removeClass("active"),t.template.addClass("active"),this.info.betting=t.value,this.changeNumberEffect(this.pot,this.info.potData[this.info.betting],{duration:200}).runEffect()},w.pushEventListener=function(){var t=this;this.on("endSpin",function(i){t.endSpin(i)}),this.on("userInfo",function(){t.renderUserInfo(arguments[0])}),this.on("spin",function(){t.startSpin()}),this.on("spinCompleted",function(){t.effecting()}),this.on("endEffect",function(){}),this.on("updateMoney",function(i){t.updateMoney(i)}),this.on("updatePots",function(i){t.bindPots(i)}),this.on("error",function(i){t.showError(i)})},w.showError=function(t){var i=$('<div class="error-item-mini">'+t+"</div>"),e=this;this.errorPanel.empty(),this.errorPanel.show(),this.errorPanel.append(i);var e=this;i.one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(i).remove(),e.errorPanel.hide()})},w.checkStart=function(){var t=this;if("pause"===t.status||"effecting"===t.status){var t=this;this.userInfo.money<this.info.betting?this.emit("error","Bạn không đủ tiền !"):("pause"!==t.status&&t.changeStatus("pause"),this.startSound=TWIST.Sound.play("minigame/bonus_spin"),t.emit("spin",this.info.betting),t.changeNumberEffect(t.money,t.userInfo.money-t.info.betting,{duration:200}).runEffect())}},w.renderUserInfo=function(t){$.extend(this.userInfo,t);var i=this.user.find(".avatar"),e=this.user.find(".username"),n=this.user.find(".money"),s=Global.md5Avatar(t.avatar);i.addClass("avatar"+s),e.text(t.username);var a=Global.numberWithDot(t.money);n.text(a)},w.bindPots=function(t){$.extend(this.info.potData,t.pots),this.changeNumberEffect(this.pot,this.info.potData[this.info.betting],{duration:200}).runEffect()},w.changeStatus=function(t){var i=this;if(this.status=t,this.timeOutList.forEach(function(t){clearTimeout(t)}),this.timeOutList=[],"pause"==t){this.result={},f>=l.length&&(f=0);var e=l[f];if(e&&e.length)for(var n=0;n<e.length;n++)e[n].isDone||e[n].endEffect();if(l=[],f=0,this.isAutoSpin){var s=setTimeout(function(){i.status="pause",i.checkStart()},500);this.timeOutList.push(s)}}"running"==t&&(this.resultSound&&this.resultSound.stop(),this.buttonSpin.addClass("disabled"),this.autoSpin.find("input").attr("disabled",!0),this.resultText.text("")),"effecting"==t&&(this.startSound&&this.startSound.stop(),this.isAutoSpin?this.buttonSpin.addClass("disabled"):this.buttonSpin.removeClass("disabled"),this.autoSpin.find("input").attr("disabled",!1))},w.startSpin=function(){r=-1;var t=this,i=s[0].getChildAt(0);this.changeStatus("running"),createjs.Tween.get(i).to({y:-50},150).call(function(){}).to({y:0},150).call(function(){t.spinAllColumns()})},w.spinAllColumns=function(){for(var t=this,e=0;e<i.x;e++)t.spinColumn(e)},w.spinColumn=function(t){var e=this.options.speed||a,o=!1,h=!1;r>-1&&t==Math.floor((10*r+9)/10/i.y)&&r%1==0&&(o=!0,h=r%i.y==i.y);var u,c=this,l=s[t].getChildAt(0);u=o?this.createSlotItem(this.mapData[t],-1):this.createSlotItem(Math.floor(4*Math.random())+52,-1),l.addChild(u);var p=h?createjs.Ease.getBackOut(5):createjs.Ease.linear,f=h?2*n/e:n/e;createjs.Tween.get(l).to({y:n},f,p).call(function(){var t=this.parent.parent.getChildIndex(this.parent);this.set({y:0});var e=this.children;if(e.forEach(function(t,i){t.state++,t.goNextStep()}),this.removeChild(e.find(function(t){return t.state==i.y})),r>-1){Math.floor(Math.floor((r+.9)/i.y));if(t==Math.floor((10*r+9)/10/i.y)){var n=r%i.y==i.y-1;n?d=.2:r%i.y==0&&(d=1),r=(10*r+10*d)/10,n?r=(10*r+10*d)/10:c.spinColumn(t)}else c.spinColumn(t);r>i.x*i.y-1&&c.emit("spinCompleted")}else c.spinColumn(t)})},w.endSpin=function(t){"running"===this.status&&(this.changeStatus("ending"),this.result=this.result||{},$.extend(this.result,t),this.mapData=t.map,this.showSessionId(t.sessionId),r=-.8,d=.2)},w.updateMoney=function(t){this.result=this.result||{},$.extend(this.result,t),this.userInfo.money=t.newMoney},w.effecting=function(){var t=this;t.emit("endSpinTinyPoker"),this.changeStatus("effecting");var i=this.result;l=[];var e=[],n=this.hightLightWinCards(i.hightLightCards);if(e.push(n),this.showResultText(i.cardListRank,i.rankOfVerticalGroup),1==i.cardListRank){var s=this.explodePotEffect();e.push(s)}if(parseInt(i.winMoney)>0){var a=this.winMoneyEffect(i.winMoney),o=this.changeNumberEffect(this.money,i.newMoney,{duration:p}),r=this.hightlightWinRank(i.cardListRank);e.push(a,o,r),this.resultSound=TWIST.Sound.play("minigame/NormalWin")}else this.resultSound=TWIST.Sound.play("minigame/slot_result");if(e.oneTime=!0,e.forEach(function(t,i){t.isTracking=!0}),l.push(e),this.isAutoSpin){var h=setTimeout(function(){t.checkStart()},2e3);this.timeOutList.push(h)}this.runNextEffect()},w.runNextEffect=function(){function t(){m=0;for(var t=0;t<i.length;t++)i[t].runEffect()}var i=l[f];if(i&&i.length)if(i.oneTime)i.done?(f++,f==l.length&&(T?f=0:this.changeStatus("pause")),"effecting"===this.status):t();else{var e=setTimeout(t,300);this.timeOutList.push(e)}},w.endEffect=function(){var t=this;if(m++,m==(l[f]&&l[f].length)){if(l[f].oneTime&&(l[f].done=!0),f++,f==l.length)if(T)f=0;else if(this.isAutoSpin){var i=setTimeout(function(){t.status="pause",t.checkStart()},500);this.timeOutList.push(i)}else t.status="pause";"effecting"===this.status}},w.createSlotItem=function(t,i){var n=new createjs.Container,s=new TWIST.Card(t);return t>51&&(t-=52,s.bg.sourceRect={width:TWIST.Card.size.width,height:152,x:TWIST.Card.size.width*(9+t),y:4*TWIST.Card.size.height}),s.set({scaleX:TWIST.Card.miniPoker.scale,scaleY:TWIST.Card.miniPoker.scale,x:(e.width-TWIST.Card.miniPoker.width)/2,y:(e.height-TWIST.Card.miniPoker.scale*TWIST.Card.size.height)/2}),n.addChild(s),n.set({x:0,y:e.height*i,state:i}),n.goNextStep=function(){var t=e.height*this.state;this.set({y:t})},n},w.changeNumberEffect=function(t,i,e){var n=$(t),s=this;return n.newValue=i,n.options=e,n.runEffect=function(){n.finish(),n.isDone=!0;var t=this.text(),i={duration:1e3,step:function(t){n.text(Global.numberWithDot(Math.ceil(t)))},done:function(){n.endEffect()}};$.extend(i,n.options),t=parseInt(t.replace(/\,/g,"")),isNaN(t)&&(t=0),this.prop("Counter",t).animate({Counter:n.newValue},i)},n.endEffect=function(){n.finish(),this.isTracking&&(this.isTracking=!1,s.emit("endEffect"))},n},w.explodePotEffect=function(){var t=this,i=$("#effect .explorer-pot");new Date;return i.runEffect=function(){this.show()},i.click(function(){i.isDone=!1,i.endEffect()}),i.endEffect=function(){this.hide(),this.isDone=!0,this.isTracking&&(this.isTracking=!1,t.emit("endEffect"))},i},w.winMoneyEffect=function(t){var i=this,e=$(TWIST.HTMLTemplate["tinyMiniPoker/winMoney"]);return e.text(Global.numberWithDot(t)),e.one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){e.endEffect()}),e.runEffect=function(){e.isDone=!1,t>0&&i.user.append(e)},e.endEffect=function(){e.remove(),e.isDone=!0,this.isTracking&&(this.isTracking=!1,i.emit("endEffect"))},e},w.hightlightWinRank=function(t){var i=this,e=this.resultItemList.find(function(i,e){return i.code==t}),n=e?e.template:$("<div></div>");return n.one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){n.endEffect()}),n.runEffect=function(){n.isDone=!1,n.addClass("active"),this.isTracking&&(this.isTracking=!1,i.emit("endEffect"))},n.endEffect=function(){n.removeClass("active"),
n.isDone=!0},n},w.hightLightWinCards=function(t){for(var e=this,n=[],a=0;a<i.x;a++){var o=s[a].children[0].children[0].children[0];o.active=t[a],o.border.sourceRect.x=4*TWIST.Card.size.width,n.push(o)}return n.runEffect=function(){n.isDone=!0,n.forEach(function(t,i){parseInt(t.active)?t.hightLight():t.Overlay()}),this.isTracking&&(this.isTracking=!1,e.emit("endEffect"))},n.endEffect=function(){n.isDone=!0},n},w.showResultText=function(t,i){var e=this,n=this.options.resultTab.find(function(i,e){return i.code==t}),s=v.find(function(t,e){return t.value==i}),a=n.name;3!=n.code&&7!=n.code&&9!=n.code||!s||(a=a+" "+s.name,9==n.code&&(a="Đôi "+s.name)),this.resultText.text(a);var o={};return o.runEffect=function(){o.isDone=!1,e.resultText.text(a),this.isTracking&&(this.isTracking=!1,e.emit("endEffect"))},o.endEffect=function(){e.resultText.text(""),o.isDone=!0},o},w.explodePotEffect=function(){var t=this,i=this.explodePot;new Date;return i.runEffect=function(){this.isDone=!1,this.show()},i.click(function(){i.endEffect()}),i.endEffect=function(){this.hide(),this.isDone=!0,this.isTracking&&(this.isTracking=!1,t.emit("endEffect"))},i},w.showSessionId=function(t){this.sessionId.text(t)},TWIST.TinyMiniPoker=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t,i){this.wrapper=$(t),this.options=$.extend(I,i),this.initTinyVideoPoker()}var i,e,n,s,a,o,r,h,d,u,c,l,p,f,m,g,v,T,C,w,y,b,S,B,P,I;I={resultTab:[{name:"Sảnh rồng(Nỗ hũ)",value:-1,code:"0"},{name:"Thùng phá sảnh",value:50,code:"1"},{name:"Tứ quý",value:25,code:"2"},{name:"Cù lũ",value:9,code:"3"},{name:"Thùng",value:6,code:"4"},{name:"Sảnh",value:4,code:"5"},{name:"Ba lá",value:3,code:"6"},{name:"Hai đôi",value:2,code:"7"},{name:"Đôi J hoặc cao hơn",value:1,code:"8"},{name:"Không ăn !",value:0,code:"9"}]};var x=t.prototype=new TWIST.BaseGame;x.initTinyVideoPoker=function(){this.initVariable(),$.extend(this.options,i),this.info={betting:1e3,potData:{1e3:0,1e4:0,1e5:0}},TWIST.Card.RankMapIndex=["1","2","3","4","5","6","7","8","9","10","11","12","13"],this.userInfo={},this.initCanvas(),this.initTemplate(),this.initEvent(),this.initButton(),this.draw(),this.pushEventListener(),this.status="pause"},x.initVariable=function(){o=["pause","running","ending","effecting"],v=[{value:0,name:"2"},{value:1,name:"3"},{value:2,name:"4"},{value:3,name:"5"},{value:4,name:"6"},{value:5,name:"7"},{value:6,name:"8"},{value:7,name:"9"},{value:8,name:"10"},{value:9,name:"J"},{value:10,name:"Q"},{value:11,name:"K"},{value:12,name:"A"}],r=-1,d=1,e={width:130,height:270,padding:10},i={width:5*e.width,height:e.height,x:5,y:1},n=e.height,s=[],a=2.5,h=52,u={x:166,y:233},l=[],c=[1e3,1e4,1e5],p=2e3,f=0,m=0,g=[],T=0,w=["selectCard","selectDouble","getWin"],C=[],y=[],b=0,S=[0,1,2,3,4],B=[],P=!1},x.draw=function(){this.mapData=TWIST.MiniPokerLogic.generateMap();var t=new createjs.Container;this.spinArea=t;for(var n=0;n<i.x;n++){s[n]=new createjs.Container,s[n].set({x:n*e.width,y:0});var a=new createjs.Container;s[n].addChild(a);var o=(this.mapData[n],this.createSlotItem(this.mapData[n],0));a.addChild(o),C[n]=o.bg,t.addChild(s[n])}this.stage.addChild(t)},x.initTemplate=function(){var t=this;this.wrapperTemplate=$(TWIST.HTMLTemplate["tinyVideoPoker/wrapper"]),this.wrapper.append(this.wrapperTemplate),this.canvasWrapper=$(TWIST.HTMLTemplate["tinyVideoPoker/canvasWrapper"]),this.wrapperTemplate.append(this.canvasWrapper),this.canvasWrapper.append(this.canvas),this.initStage(),this.resultText=$(TWIST.HTMLTemplate["tinyVideoPoker/resultText"]),this.wrapperTemplate.append(this.resultText),this.wrapperTemplate.append($(TWIST.HTMLTemplate["tinyVideoPoker/pot"])),this.pot=this.wrapperTemplate.find(".pot-value"),this.buttonSpin=$(TWIST.HTMLTemplate["tinyVideoPoker/button"]),this.wrapperTemplate.append(this.buttonSpin),this.buttonClose=$(TWIST.HTMLTemplate["tinyMiniPoker/buttonClose"]),this.wrapperTemplate.append(this.buttonClose),this.buttonHelp=$(TWIST.HTMLTemplate["tinyMiniPoker/buttonHelp"]),this.wrapperTemplate.append(this.buttonHelp),this.buttonHistory=$(TWIST.HTMLTemplate["tinyMiniPoker/buttonHistory"]),this.wrapperTemplate.append(this.buttonHistory),this.doubleButton=$(TWIST.HTMLTemplate["tinyVideoPoker/doubleButton"]),this.wrapperTemplate.append(this.doubleButton),this.doubleButton._disabled=!0,this.doubleButton.hide(),this.getWinButton=$(TWIST.HTMLTemplate["tinyVideoPoker/getWinButton"]),this.wrapperTemplate.append(this.getWinButton),this.getWinButton._disabled=!0,this.chipWrapper=$(TWIST.HTMLTemplate["tinyVideoPoker/chips"]),this.wrapperTemplate.append(this.chipWrapper),this.chipButtons=[{value:1e3,template:this.chipWrapper.find(".chip:first-child")},{value:1e4,template:this.chipWrapper.find(".chip:nth-child(2)")},{value:1e5,template:this.chipWrapper.find(".chip:nth-child(3)")}],this.errorPanel=$(TWIST.HTMLTemplate["tinyVideoPoker/errorPanel"]),this.wrapperTemplate.append(this.errorPanel),this.errorPanel.hide(),this.resultTab=$(TWIST.HTMLTemplate["tinyVideoPoker/resultTab"]),this.wrapperTemplate.append(this.resultTab),this.virtualCardsList=[],this.virtualCards=$(TWIST.HTMLTemplate["tinyVideoPoker/virtualCards"]),this.wrapperTemplate.append(this.virtualCards);for(var i=0;5>i;i++)this.virtualCardsList.push(this.virtualCards.find(".vitualCard"+(i+1)));this.resultItemList=[],this.resultItem=_.template(TWIST.HTMLTemplate["tinyVideoPoker/resultItem"]),this.options.resultTab.forEach(function(i,e){if(i.code!==t.options.resultTab[t.options.resultTab.length-1].code){var n={code:i.code,template:$(t.resultItem({name:i.name,value:i.value<=0?"":"X"+i.value}))};t.resultTab.append(n.template),t.resultItemList.push(n)}}),this.user=$(TWIST.HTMLTemplate["tinyVideoPoker/user"]),this.wrapperTemplate.append(this.user),this.sessionId=$(TWIST.HTMLTemplate["tinyVideoPoker/sessionId"]),this.wrapperTemplate.append(this.sessionId),this.effectWrapper=$(TWIST.HTMLTemplate["effect/wrapper"]),this.wrapperTemplate.append(this.effectWrapper),this.explodePot=$(TWIST.HTMLTemplate["effect/explodePot"]),this.effectWrapper.append(this.explodePot),this.supportText=$(TWIST.HTMLTemplate["tinyVideoPoker/supportText"]),this.wrapperTemplate.append(this.supportText),this.moveChip=$(TWIST.HTMLTemplate["tinyVideoPoker/moveChip"]),this.user.append(this.moveChip),this.moveChip.hide(),this.money=this.user.find(".money"),this.setBetting(this.chipButtons[0])},x.initButton=function(){var t=this;this.chipButtons.forEach(function(i,e){i.template.on("click",function(e){"pause"!==t.status&&"effecting"!==t.status||0!=T||(TWIST.Sound.play("minigame/Common_Click"),t.setBetting(i))})}),this.virtualCardsList.forEach(function(i,e){i.on("click",function(n){"effecting"==t.status&&1==T?(TWIST.Sound.play("minigame/Common_Click"),i._active=!i._active,i.toggleClass("active")):3==T&&(C[e].isOpened||(TWIST.Sound.play("minigame/Common_Click"),t.emit("cardSelect",e),T=-1))})}),this.getWinButton.on("click",function(i){2!=T&&3!=T||t.getWinButton._disabled||(TWIST.Sound.play("minigame/Common_Click"),t.emit("getWin"))}),this.doubleButton.on("click",function(i){2!=T&&3!=T||t.doubleButton._disabled||(TWIST.Sound.play("minigame/Common_Click"),t.emit("double"))}),this.buttonSpin.on("click",function(i){t.checkStart()}),this.buttonClose.on("click",function(i){t.emit("closePopup")}),this.buttonHelp.on("click",function(i){t.emit("showHelp")}),this.buttonHistory.on("click",function(i){t.emit("showHistory")})},x.setBetting=function(t){this.chipWrapper.find(".chip").removeClass("active"),t.template.addClass("active"),this.info.betting=t.value,this.changeNumberEffect(this.pot,this.info.potData[this.info.betting],{duration:200}).runEffect()},x.pushEventListener=function(){var t=this;this.on("reconnect",function(i){t.reconnect(i)}),this.on("endSpin",function(i){t.endSpin(i)}),this.on("userInfo",function(){t.renderUserInfo(arguments[0])}),this.on("spin",function(){t.startSpin()}),this.on("seconSpin",function(){t.startSpin()}),this.on("spinCompleted",function(){t.effecting()}),this.on("endEffect",function(){t.endEffect()}),this.on("updateMoney",function(i){t.updateMoney(i)}),this.on("updatePots",function(i){t.bindPots(i)}),this.on("error",function(i){t.showError(i)}),this.on("getWinResult",function(i){t.getWin(i)}),this.on("doubleResult",function(i){t.doubleTurn(i)}),this.on("updateDoubleList",function(t){S=t.doubleList}),this.on("cardSelectResult",function(i){t.setCardSelected(i)})},x.reconnect=function(t){var i=this;this.showSessionId(t.sessionId);var e=this.chipButtons.find(function(i,e){return i.value==t.betting});i.changeNumberEffect(i.resultText,t.currentMoney,{duration:100}).runEffect(),this.setBetting(e);var n={1:i.reDrawFirstTurn,2:i.reDrawSeconTurn,3:i.reDrawDoubleTurn},s=n[t.status];"function"==typeof s&&s.call(i,t)},x.reDrawFirstTurn=function(t){C.forEach(function(i,e){i.setValue(t.map[e])}),this.endSpin(t)},x.reDrawSeconTurn=function(t){C.forEach(function(i,e){i.setValue(t.map[e])}),this.virtualCardsList.forEach(function(i,e){t.holdCards[e]&&i.toggleClass("active")}),T=1,this.endSpin(t)},x.reDrawDoubleTurn=function(t){this.buttonSpin.hide(),this.doubleButton.show(),this.doubleButton._disabled=!0,this.doubleButton.addClass("disabled"),1==t.doubleStatus?this.reDrawDoubleTurnPhase1(t):2==t.doubleStatus&&this.reDrawDoubleTurnPhase2(t)},x.reDrawDoubleTurnPhase1=function(t){T=2,this.doubleTurn(t)},x.reDrawDoubleTurnPhase2=function(t){T=3,C[0].openCard(t.cardId,TWIST.Card.miniPoker),this.setCardSelected(t)},x.setCardSelected=function(t){function i(i){var n=0;e.virtualCardsList[t.selectedIndex];if(C.forEach(function(i,e){0!=e&&e!=t.selectedIndex&&(createjs.Tween.get(i).wait(200*n).to({},10).call(function(){this.Overlay(),this.openCard(S[e],TWIST.Card.miniPoker)}),n++)}),t.isNext){e.changeNumberEffect(e.resultText,t.winMoney,{duration:700}).runEffect(),e.setTextEffect(e.supportText,"Nhân đôi "+t.winMoney+" thành "+2*parseInt(t.winMoney)+"!").runEffect();e.buttonSpin.hide(),e.doubleButton._disabled=!1,e.doubleButton.removeClass("disabled"),e.doubleButton.show(),e.getWinButton._disabled=!1,e.getWinButton.addClass("active"),b=parseInt(t.winMoney),T=2}else{b=0;e.setTextEffect(e.supportText,"Không ăn !").runEffect(),e.changeNumberEffect(e.resultText,0,{duration:700}).runEffect();T=0,e.buttonSpin.show(),e.doubleButton.hide(),e.doubleButton._disabled=!1,e.doubleButton.addClass("disabled"),e.getWinButton._disabled=!0,e.getWinButton.removeClass("active"),e.virtualCardsList.forEach(function(t,i){t._active=!1,t.removeClass("active")})}}var e=this,n=C[t.selectedIndex];n.isTracking=!0,S=t.map,n.openCard(S[t.selectedIndex],TWIST.Card.miniPoker),TWIST.Observer.once("cardOpened",i)},x.showError=function(t){var i=$('<div class="error-item-mini">'+t+"</div>"),e=this;this.errorPanel.empty(),this.errorPanel.show(),this.errorPanel.append(i);var e=this;i.one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(i).remove(),e.errorPanel.hide()})},x.checkStart=function(){var t=this;if("pause"===t.status||"effecting"===t.status){var t=this;0==T?this.userInfo.money<this.info.betting?this.emit("error","Bạn không đủ tiền !"):("pause"!==t.status&&t.changeStatus("pause"),this.startSound=TWIST.Sound.play("minigame/bonus_spin"),t.emit("spin",this.info.betting),t.changeNumberEffect(t.money,t.userInfo.money-t.info.betting,{duration:800}).runEffect(),t.changeNumberEffect(t.resultText,t.info.betting,{duration:800}).runEffect()):1==T&&(this.startSound=TWIST.Sound.play("minigame/bonus_spin"),B=[],this.virtualCardsList.forEach(function(t,i){B.push(t._active)}),t.emit("seconSpin",B))}},x.renderUserInfo=function(t){$.extend(this.userInfo,t);var i=this.user.find(".avatar"),e=this.user.find(".username"),n=this.user.find(".money"),s=Global.md5Avatar(t.avatar);i.addClass("avatar"+s),e.text(t.username);var a=Global.numberWithDot(t.money);n.text(a)},x.bindPots=function(t){$.extend(this.info.potData,t.pots),this.changeNumberEffect(this.pot,this.info.potData[this.info.betting],{duration:200}).runEffect()},x.changeStatus=function(t){if(this.status=t,g.forEach(function(t){clearTimeout(t)}),g=[],"pause"==t){this.result={},f>=l.length&&(f=0);var i=l[f];if(i&&i.length)for(var e=0;e<i.length;e++)i[e].isDone||i[e].endEffect();l=[],f=0}"running"==t&&(this.resultSound&&this.resultSound.stop(),this.buttonSpin.addClass("disabled"),0==T&&this.resultText.text("")),"effecting"==t&&(this.startSound&&this.startSound.stop(),this.buttonSpin.removeClass("disabled"))},x.startSpin=function(){r=-1;var t,i=this,e=this.virtualCardsList.findIndex(function(t,i){return!t._active});e>-1?(t=s[e].getChildAt(0),this.changeStatus("running"),createjs.Tween.get(t).to({y:-50},150).call(function(){}).to({y:0},150).call(function(){i.spinAllColumns()})):i.changeStatus("effecting")},x.spinAllColumns=function(){var t=this;y=[],this.virtualCardsList.forEach(function(i,e){t.virtualCardsList[e]._active||y.push(e)}),y.forEach(function(i,e){t.spinColumn(i,e)})},x.spinColumn=function(t,e){var o=this.options.speed||a,h=!1,u=!1;r>-1&&e==Math.floor((10*r+9)/10/i.y)&&r%1==0&&(h=!0,u=r%i.y==i.y);var c,l=this,p=s[t].getChildAt(0);c=h?this.createSlotItem(this.mapData[t],-1):this.createSlotItem(Math.floor(4*Math.random())+52,-1),p.addChild(c),C[t]=c.children[0];var f=u?createjs.Ease.getBackOut(5):createjs.Ease.linear,m=u?2*n/o:n/o;createjs.Tween.get(p).to({y:n},m,f).call(function(){this.set({y:0});var n=this.children;if(n.forEach(function(t,i){t.state++,t.goNextStep()}),this.removeChild(n.find(function(t){return t.state==i.y})),r>-1){Math.floor(Math.floor((r+.9)/i.y));if(e==Math.floor((10*r+9)/10/i.y)){var s=r%i.y==i.y-1;s?d=.2:r%i.y==0&&(d=1),r=(10*r+10*d)/10,s?r=(10*r+10*d)/10:l.spinColumn(t,e)}else l.spinColumn(t,e);r>y.length-1&&l.emit("spinCompleted")}else l.spinColumn(t,e)})},x.endSpin=function(t){function i(){e.result=e.result||{},$.extend(e.result,t),e.mapData=t.map,e.showSessionId(t.sessionId)}var e=this;"running"==this.status?(this.changeStatus("ending"),i(),r=-.8,d=.2):(i(),this.effecting())},x.updateMoney=function(t){this.result=this.result||{},$.extend(this.result,t),this.userInfo.money=t.newMoney},x.effecting=function(){this.changeStatus("effecting");this.result;l=[];var t=[];t=0==T?this.getFistEffectTurn():this.getSeconEffectTurn(),t.oneTime=!0,t.forEach(function(t,i){t.isTracking=!0}),l.push(t),this.runNextEffect()},x.getFistEffectTurn=function(){var t=this.result,i=[],e=this.setTextEffect(this.supportText,"Chọn quân bài muốn giữ lại"),n=this.hightlightHoldCards(t.holdCards);return i.push(e,n),T=1,i},x.getSeconEffectTurn=function(){var t=this.result,i=[];if(parseInt(t.winMoney)>0){this.resultSound=TWIST.Sound.play("minigame/NormalWin");var e=this.changeNumberEffect(this.resultText,t.winMoney,{duration:700}),n=this.setTextEffect(this.supportText,"Nhân đôi "+t.winMoney+" thành "+2*parseInt(t.winMoney)+"!"),s=this.hightLightWinCards(t.hightLightCards),a=this.hightlightWinRank(t.cardListRank);i.push(e,n,s,a),this.buttonSpin.hide(),this.doubleButton._disabled=!1,this.doubleButton.removeClass("disabled"),this.doubleButton.show(),this.getWinButton._disabled=!1,this.getWinButton.addClass("active"),b=parseInt(t.winMoney),T=2}else{this.resultSound=TWIST.Sound.play("minigame/slot_result"),b=0;var n=this.setTextEffect(this.supportText,"Không ăn !"),e=this.changeNumberEffect(this.resultText,0,{duration:700}),s=this.hightLightWinCards([]),o=this.hightlightHoldCards([]);i.push(e,n,s,o),T=0,this.virtualCardsList.forEach(function(t,i){t._active=!1,t.removeClass("active")})}return i},x.hightlightHoldCards=function(t){var i=this.virtualCardsList,e=this;return i.runEffect=function(){this.isDone=!1,this.forEach(function(i,e){t[e]?(i._active=!0,i.addClass("active")):(i._active=!1,i.removeClass("active"))})},i.endEffect=function(){this.forEach(function(t,i){t.removeClass("active")}),this.isDone=!0,this.isTracking&&(this.isTracking=!1,e.emit("endEffect"))},i},x.getWin=function(t){var i=this;TWIST.Sound.play("minigame/coin_spin"),i.changeStatus("effecting"),i.changeNumberEffect(i.money,i.userInfo.money,{duration:800}).runEffect(),i.changeNumberEffect(i.resultText,0,{duration:800}).runEffect(),i.setTextEffect(i.supportText,"").runEffect(),b=0,T=0,this.buttonSpin.show(),this.doubleButton.hide(),this.doubleButton._disabled=!1,this.doubleButton.addClass("disabled"),this.getWinButton._disabled=!0,this.getWinButton.removeClass("active"),this.virtualCardsList.forEach(function(t,i){t._active=!1,t.removeClass("active")})},x.doubleTurn=function(t){var i=this;"pause"!==i.status&&i.changeStatus("pause"),T=3;this.setTextEffect(this.supportText,"Chọn quân bài cao hơn").runEffect(),this.hightlightHoldCards([]).runEffect();this.doubleButton._disabled=!0,this.doubleButton.addClass("disabled"),this.getWinButton._disabled=!0,this.getWinButton.removeClass("active"),this.virtualCardsList.forEach(function(t,i){t.removeClass("active")}),C.forEach(function(i,e){i.unHightLight(),i.UnOverlay(),0==e?(i.isOpened=!0,i.openCard(t.cardId,TWIST.Card.miniPoker)):i.upSideDown(TWIST.Card.miniPoker)})},x.runNextEffect=function(){function t(){m=0;for(var t=0;t<i.length;t++)i[t].runEffect()}var i=l[f];if(i&&i.length)if(i.oneTime)i.done?(f++,f==l.length&&(P?f=0:this.changeStatus("pause")),"effecting"===this.status&&this.runNextEffect()):t();else{var e=setTimeout(t,300);g.push(e)}},x.endEffect=function(){m++,m==(l[f]&&l[f].length)&&(l[f].oneTime&&(l[f].done=!0),f++,f==l.length&&(P?f=0:this.changeStatus("pause")),"effecting"===this.status&&this.runNextEffect())},x.createSlotItem=function(t,i){var n=new createjs.Container,s=new TWIST.Card(t);return n.bg=s,t>51&&(t-=52,s.bg.sourceRect={width:TWIST.Card.size.width,height:152,x:TWIST.Card.size.width*(9+t),y:4*TWIST.Card.size.height}),s.set({scaleX:TWIST.Card.miniPoker.scale,scaleY:TWIST.Card.miniPoker.scale,x:(e.width-TWIST.Card.miniPoker.width)/2,y:(e.height-TWIST.Card.miniPoker.scale*TWIST.Card.size.height)/2}),n.addChild(s),n.set({x:0,y:e.height*i,state:i}),n.goNextStep=function(){var t=e.height*this.state;this.set({y:t})},n},x.changeNumberEffect=function(t,i,e){var n=$(t),s=this;return n.newValue=i,n.options=e,n.runEffect=function(){n.finish(),n.isDone=!0;var t=this.text(),i={duration:1e3,step:function(t){n.text(Global.numberWithDot(Math.ceil(t)))},done:function(){n.endEffect()}};$.extend(i,n.options),t=parseInt(t.replace(/\,/g,"")),isNaN(t)&&(t=0),this.prop("Counter",t).animate({Counter:n.newValue},i)},n.endEffect=function(){n.finish(),this.isTracking&&(this.isTracking=!1,s.emit("endEffect"))},n},x.setTextEffect=function(t,i){var e=$(t),n=this;return e.newValue=i,e.runEffect=function(){e.isDone=!1,e.text(i)},e.endEffect=function(){e.text(""),e.isDone=!0,this.isTracking&&(this.isTracking=!1,n.emit("endEffect"))},e},x.explodePotEffect=function(){var t=this,i=$("#effect .explorer-pot");new Date;return i.runEffect=function(){i.isDone=!1,this.show()},i.click(function(){i.endEffect()}),i.endEffect=function(){this.hide(),this.isDone=!0,this.isTracking&&(this.isTracking=!1,t.emit("endEffect"))},i},x.hightlightWinRank=function(t){var i=this,e=this.resultItemList.find(function(i,e){return i.code==t}),n=e?e.template:$("<div></div>");return n.runEffect=function(){n.isDone=!1,n.addClass("active"),this.isTracking&&(this.isTracking=!1,i.emit("endEffect"))},n.endEffect=function(){n.removeClass("active"),n.isDone=!0},n},x.hightLightWinCards=function(t){for(var e=this,n=[],s=0;s<i.x;s++){var a=C[s];a.active=t[s],a.border.sourceRect.x=4*TWIST.Card.size.width,n.push(a)}return n.runEffect=function(){n.isDone=!1,n.forEach(function(t,i){parseInt(t.active)?t.hightLight():t.Overlay()}),this.isTracking&&(this.isTracking=!1,e.emit("endEffect"))},n.endEffect=function(){n.forEach(function(t,i){parseInt(t.active)?t.unHightLight():t.UnOverlay()}),n.isDone=!0},n},x.showResultText=function(t,i){var e=this,n=this.options.resultTab.find(function(i,e){return i.code==t}),s=v.find(function(t,e){return t.value==i}),a=n.name;3!=n.code&&7!=n.code&&9!=n.code||!s||(a=a+" "+s.name,9==n.code&&(a="Đôi "+s.name)),this.resultText.text(a);var o={};return o.runEffect=function(){o.isDone=!1,e.resultText.text(a),this.isTracking&&(this.isTracking=!1,e.emit("endEffect"))},o.endEffect=function(){e.resultText.text(""),o.isDone=!0},o},x.explodePotEffect=function(){var t=this,i=this.explodePot;new Date;return i.runEffect=function(){this.isDone=!1,this.show()},i.click(function(){i.endEffect()}),i.endEffect=function(){this.hide(),this.isDone=!0,this.isTracking&&(this.isTracking=!1,t.emit("endEffect"))},i},x.moveChipEffect=function(t){var i=this,e=this.moveChip;new Date;return e.runEffect=function(){this.isDone=!0,this.removeClass("plus decrease");var i=t?"plus":"decrease";this.removeClass("plus decrease"),this.show(),e.find("i").show(),this.addClass(i),e.find("i").each(function(t){$(this).one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(this).hide()})})},e.endEffect=function(){this.isTracking&&(this.isTracking=!1,i.emit("endEffect"))},e},x.showSessionId=function(t){this.sessionId.text(t)},TWIST.TinyVideoPoker=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t,e){this.wrapper=$(t),this.options=$.extend(i,e),this.initTLMNDemlaGame()}var i={maxPlayers:4,numberCardsInHand:13,turnTime:2e4,playerConfig:{showCardLength:!0,showPlayerCard:!0}},e=t.prototype=new TWIST.BaseDemlaGame;e.initTLMNDemlaGame=function(t){this.initBaseDemlaGame()},e.endGame=function(t){this.endIngameEvent();var i={0:"Tứ quý 3",1:"3 đôi thông chứa 3 bích",2:"Tứ quý 2",3:"6 Đôi",4:"5 Đôi thông",5:"Sảnh rồng",16:"Thắng !"};this.endDemlaGame(t,i,16==t.winType)},TWIST.TLMNDemlaGame=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t,i){this.wrapper=$(t),this.options=$.extend(I,i),this.initVideoPoker()}var i,e,n,s,a,o,r,h,d,u,c,l,p,f,m,g,v,T,C,w,y,b,S,B,P,I;I={resultTab:[{name:"Sảnh rồng(Nỗ hũ)",value:-1,code:"0"},{name:"Thùng phá sảnh",value:50,code:"1"},{name:"Tứ quý",value:25,code:"2"},{name:"Cù lũ",value:9,code:"3"},{name:"Thùng",value:6,code:"4"},{name:"Sảnh",value:4,code:"5"},{name:"Ba lá",value:3,code:"6"},{name:"Hai đôi",value:2,code:"7"},{name:"Đôi J hoặc cao hơn",value:1,code:"8"},{name:"Không ăn !",value:0,code:"9"}]};var x=t.prototype=new TWIST.BaseGame;x.initVideoPoker=function(){this.initVariable(),$.extend(this.options,i),this.info={betting:1e3,potData:{1e3:0,1e4:0,1e5:0}},TWIST.Card.RankMapIndex=["1","2","3","4","5","6","7","8","9","10","11","12","13"],this.userInfo={},this.initCanvas(),this.initTemplate(),this.initEvent(),this.initButton(),this.draw(),this.pushEventListener(),this.status="pause"},x.initVariable=function(){o=["pause","running","ending","effecting"],v=[{value:0,name:"2"},{value:1,name:"3"},{value:2,name:"4"},{value:3,name:"5"},{value:4,name:"6"},{value:5,name:"7"},{value:6,name:"8"},{value:7,name:"9"},{value:8,name:"10"},{value:9,name:"J"},{value:10,name:"Q"},{value:11,name:"K"},{value:12,name:"A"}],r=-1,d=1,e={width:160,height:205,padding:10},i={width:5*e.width,height:e.height,x:5,y:1},n=e.height,s=[],a=2.5,h=52,u={x:100,y:100},l=[],c=[1e3,1e4,1e5],p=2e3,f=0,m=0,g=[],T=0,w=["selectCard","selectDouble","getWin"],C=[],y=[],b=0,S=[0,1,2,3,4],B=[],P=!1},x.draw=function(){this.mapData=TWIST.MiniPokerLogic.generateMap();var t=new createjs.Container;this.spinArea=t;for(var n=0;n<i.x;n++){s[n]=new createjs.Container,s[n].set({x:n*e.width,y:0});var a=new createjs.Container;s[n].addChild(a);var o=(this.mapData[n],this.createSlotItem(this.mapData[n],0));a.addChild(o),C[n]=o.bg,t.addChild(s[n])}this.stage.addChild(t)},x.initTemplate=function(){var t=this;this.wrapperTemplate=$(TWIST.HTMLTemplate["videoPoker/wrapper"]),this.wrapper.append(this.wrapperTemplate),this.wrapperTemplate.append(this.canvas),this.initStage(),this.resultText=$(TWIST.HTMLTemplate["videoPoker/resultText"]),this.wrapperTemplate.append(this.resultText),this.wrapperTemplate.append($(TWIST.HTMLTemplate["videoPoker/pot"])),this.pot=this.wrapperTemplate.find(".pot-value"),this.buttonSpin=$(TWIST.HTMLTemplate["videoPoker/button"]),this.wrapperTemplate.append(this.buttonSpin),this.doubleButton=$(TWIST.HTMLTemplate["videoPoker/doubleButton"]),this.wrapperTemplate.append(this.doubleButton),this.doubleButton._disabled=!0,this.doubleButton.hide(),this.getWinButton=$(TWIST.HTMLTemplate["videoPoker/getWinButton"]),this.wrapperTemplate.append(this.getWinButton),this.getWinButton._disabled=!0,this.chipWrapper=$(TWIST.HTMLTemplate["videoPoker/chips"]),this.wrapperTemplate.append(this.chipWrapper),this.chipButtons=[{value:1e3,template:this.chipWrapper.find(".chip.violet")},{value:1e4,template:this.chipWrapper.find(".chip.green")},{value:1e5,template:this.chipWrapper.find(".chip.blue")}],this.errorPanel=$(TWIST.HTMLTemplate["videoPoker/errorPanel"]),this.wrapperTemplate.append(this.errorPanel),this.errorPanel.hide(),this.resultTab=$(TWIST.HTMLTemplate["videoPoker/resultTab"]),this.wrapperTemplate.append(this.resultTab),this.virtualCardsList=[],this.virtualCards=$(TWIST.HTMLTemplate["videoPoker/virtualCards"]),this.wrapperTemplate.append(this.virtualCards);for(var i=0;5>i;i++)this.virtualCardsList.push(this.virtualCards.find(".vitualCard"+(i+1)));this.resultItemList=[],this.resultItem=_.template(TWIST.HTMLTemplate["videoPoker/resultItem"]),this.options.resultTab.forEach(function(i,e){if(i.code!==t.options.resultTab[t.options.resultTab.length-1].code){var n={code:i.code,template:$(t.resultItem({name:i.name,value:i.value<=0?"":"X"+i.value}))};t.resultTab.append(n.template),t.resultItemList.push(n)}}),this.user=$(TWIST.HTMLTemplate["videoPoker/user"]),this.wrapperTemplate.append(this.user),this.sessionId=$(TWIST.HTMLTemplate["videoPoker/sessionId"]),this.wrapperTemplate.append(this.sessionId),this.effectWrapper=$(TWIST.HTMLTemplate["effect/wrapper"]),this.wrapperTemplate.append(this.effectWrapper),this.explodePot=$(TWIST.HTMLTemplate["effect/explodePot"]),this.effectWrapper.append(this.explodePot),this.supportText=$(TWIST.HTMLTemplate["videoPoker/supportText"]),this.wrapperTemplate.append(this.supportText),this.moveChip=$(TWIST.HTMLTemplate["videoPoker/moveChip"]),this.user.append(this.moveChip),this.moveChip.hide(),this.money=this.user.find(".money"),this.setBetting(this.chipButtons[0])},x.initButton=function(){var t=this;this.chipButtons.forEach(function(i,e){i.template.on("click",function(e){"pause"!==t.status&&"effecting"!==t.status||0!=T||(TWIST.Sound.play("minigame/Common_Click"),t.setBetting(i))})}),this.virtualCardsList.forEach(function(i,e){i.on("click",function(n){"effecting"==t.status&&1==T?(TWIST.Sound.play("minigame/Common_Click"),i._active=!i._active,i.toggleClass("active")):3==T&&(C[e].isOpened||(TWIST.Sound.play("minigame/Common_Click"),t.emit("cardSelect",e),T=-1))})}),this.getWinButton.on("click",function(i){2!=T&&3!=T||t.getWinButton._disabled||(TWIST.Sound.play("minigame/Common_Click"),t.emit("getWin"))}),this.doubleButton.on("click",function(i){2!=T&&3!=T||t.doubleButton._disabled||(TWIST.Sound.play("minigame/Common_Click"),t.emit("double"))}),this.buttonSpin.on("click",function(i){t.checkStart()})},x.setBetting=function(t){this.chipWrapper.find(".chip").removeClass("active"),t.template.addClass("active"),this.info.betting=t.value,this.changeNumberEffect(this.pot,this.info.potData[this.info.betting],{duration:200}).runEffect()},x.pushEventListener=function(){var t=this;this.on("reconnect",function(i){t.reconnect(i)}),this.on("endSpin",function(i){t.endSpin(i)}),this.on("userInfo",function(){t.renderUserInfo(arguments[0])}),this.on("spin",function(){t.startSpin()}),this.on("seconSpin",function(){t.startSpin()}),this.on("spinCompleted",function(){t.effecting()}),this.on("endEffect",function(){t.endEffect()}),this.on("updateMoney",function(i){t.updateMoney(i)}),this.on("updatePots",function(i){t.bindPots(i)}),this.on("error",function(i){t.showError(i)}),this.on("getWinResult",function(i){t.getWin(i)}),this.on("doubleResult",function(i){t.doubleTurn(i)}),this.on("updateDoubleList",function(t){S=t.doubleList}),this.on("cardSelectResult",function(i){t.setCardSelected(i)})},x.reconnect=function(t){var i=this;this.showSessionId(t.sessionId);var e=this.chipButtons.find(function(i,e){return i.value==t.betting});i.changeNumberEffect(i.resultText,t.currentMoney,{duration:100}).runEffect(),this.setBetting(e);var n={1:i.reDrawFirstTurn,2:i.reDrawSeconTurn,3:i.reDrawDoubleTurn},s=n[t.status];"function"==typeof s&&s.call(i,t)},x.reDrawFirstTurn=function(t){C.forEach(function(i,e){i.setValue(t.map[e])}),this.endSpin(t)},x.reDrawSeconTurn=function(t){C.forEach(function(i,e){i.setValue(t.map[e])}),this.virtualCardsList.forEach(function(i,e){t.holdCards[e]&&i.toggleClass("active")}),T=1,this.endSpin(t)},x.reDrawDoubleTurn=function(t){this.buttonSpin.hide(),this.doubleButton.show(),this.doubleButton._disabled=!0,this.doubleButton.addClass("disabled"),1==t.doubleStatus?this.reDrawDoubleTurnPhase1(t):2==t.doubleStatus&&this.reDrawDoubleTurnPhase2(t)},x.reDrawDoubleTurnPhase1=function(t){T=2,this.doubleTurn(t)},x.reDrawDoubleTurnPhase2=function(t){T=3,C[0].openCard(t.cardId,TWIST.Card.miniPoker),this.setCardSelected(t)},x.setCardSelected=function(t){function i(i){var n=0;e.virtualCardsList[t.selectedIndex];if(C.forEach(function(i,e){0!=e&&e!=t.selectedIndex&&(createjs.Tween.get(i).wait(200*n).to({},10).call(function(){this.Overlay(),this.openCard(S[e],TWIST.Card.miniPoker)}),n++)}),t.isNext){e.changeNumberEffect(e.resultText,t.winMoney,{duration:700}).runEffect(),e.setTextEffect(e.supportText,"Nhân đôi "+t.winMoney+" thành "+2*parseInt(t.winMoney)+"!").runEffect();e.buttonSpin.hide(),e.doubleButton._disabled=!1,e.doubleButton.removeClass("disabled"),e.doubleButton.show(),e.getWinButton._disabled=!1,e.getWinButton.addClass("active"),b=parseInt(t.winMoney),T=2}else{b=0;e.setTextEffect(e.supportText,"Không ăn !").runEffect(),e.changeNumberEffect(e.resultText,0,{duration:700}).runEffect();T=0,e.buttonSpin.show(),e.doubleButton.hide(),e.doubleButton._disabled=!1,e.doubleButton.addClass("disabled"),e.getWinButton._disabled=!0,e.getWinButton.removeClass("active"),e.virtualCardsList.forEach(function(t,i){t._active=!1,t.removeClass("active")})}}var e=this,n=C[t.selectedIndex];n.isTracking=!0,S=t.map,n.openCard(S[t.selectedIndex],TWIST.Card.miniPoker),TWIST.Observer.once("cardOpened",i)},x.showError=function(t){var i=$('<div class="error-item-mini">'+t+"</div>"),e=this;this.errorPanel.empty(),this.errorPanel.show(),this.errorPanel.append(i);var e=this;i.one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(i).remove(),e.errorPanel.hide()})},x.checkStart=function(){var t=this;if("pause"===t.status||"effecting"===t.status){var t=this;0==T?this.userInfo.money<this.info.betting?this.emit("error","Bạn không đủ tiền !"):("pause"!==t.status&&t.changeStatus("pause"),this.startSound=TWIST.Sound.play("minigame/bonus_spin"),t.emit("spin",this.info.betting),t.changeNumberEffect(t.money,t.userInfo.money-t.info.betting,{duration:800}).runEffect(),t.changeNumberEffect(t.resultText,t.info.betting,{duration:800}).runEffect(),t.moveChipEffect(1).runEffect()):1==T&&(this.startSound=TWIST.Sound.play("minigame/bonus_spin"),B=[],this.virtualCardsList.forEach(function(t,i){B.push(t._active)}),t.emit("seconSpin",B))}},x.renderUserInfo=function(t){$.extend(this.userInfo,t);var i=this.user.find(".avatar"),e=this.user.find(".username"),n=this.user.find(".money"),s=Global.md5Avatar(t.avatar);i.addClass("avatar"+s),e.text(t.username);var a=Global.numberWithDot(t.money);n.text(a)},x.bindPots=function(t){$.extend(this.info.potData,t.pots),this.changeNumberEffect(this.pot,this.info.potData[this.info.betting],{duration:200}).runEffect()},x.changeStatus=function(t){if(this.status=t,g.forEach(function(t){clearTimeout(t)}),g=[],"pause"==t){this.result={},f>=l.length&&(f=0);var i=l[f];if(i&&i.length)for(var e=0;e<i.length;e++)i[e].isDone||i[e].endEffect();l=[],f=0}"running"==t&&(this.resultSound&&this.resultSound.stop(),this.buttonSpin.addClass("disabled"),0==T&&this.resultText.text("")),"effecting"==t&&(this.startSound&&this.startSound.stop(),this.buttonSpin.removeClass("disabled"))},x.startSpin=function(){r=-1;var t,i=this,e=this.virtualCardsList.findIndex(function(t,i){
return!t._active});e>-1?(t=s[e].getChildAt(0),this.changeStatus("running"),createjs.Tween.get(t).to({y:-50},150).call(function(){}).to({y:0},150).call(function(){i.spinAllColumns()})):i.changeStatus("effecting")},x.spinAllColumns=function(){var t=this;y=[],this.virtualCardsList.forEach(function(i,e){t.virtualCardsList[e]._active||y.push(e)}),y.forEach(function(i,e){t.spinColumn(i,e)})},x.spinColumn=function(t,e){var o=this.options.speed||a,h=!1,u=!1;r>-1&&e==Math.floor((10*r+9)/10/i.y)&&r%1==0&&(h=!0,u=r%i.y==i.y);var c,l=this,p=s[t].getChildAt(0);c=h?this.createSlotItem(this.mapData[t],-1):this.createSlotItem(Math.floor(4*Math.random())+52,-1),p.addChild(c),C[t]=c.children[0];var f=u?createjs.Ease.getBackOut(5):createjs.Ease.linear,m=u?2*n/o:n/o;createjs.Tween.get(p).to({y:n},m,f).call(function(){this.set({y:0});var n=this.children;if(n.forEach(function(t,i){t.state++,t.goNextStep()}),this.removeChild(n.find(function(t){return t.state==i.y})),r>-1){Math.floor(Math.floor((r+.9)/i.y));if(e==Math.floor((10*r+9)/10/i.y)){var s=r%i.y==i.y-1;s?d=.2:r%i.y==0&&(d=1),r=(10*r+10*d)/10,s?r=(10*r+10*d)/10:l.spinColumn(t,e)}else l.spinColumn(t,e);r>y.length-1&&l.emit("spinCompleted")}else l.spinColumn(t,e)})},x.endSpin=function(t){function i(){e.result=e.result||{},$.extend(e.result,t),e.mapData=t.map,e.showSessionId(t.sessionId)}var e=this;"running"==this.status?(this.changeStatus("ending"),i(),r=-.8,d=.2):(i(),this.effecting())},x.updateMoney=function(t){this.result=this.result||{},$.extend(this.result,t),this.userInfo.money=t.newMoney},x.effecting=function(){this.changeStatus("effecting");this.result;l=[];var t=[];t=0==T?this.getFistEffectTurn():this.getSeconEffectTurn(),t.oneTime=!0,t.forEach(function(t,i){t.isTracking=!0}),l.push(t),this.runNextEffect()},x.getFistEffectTurn=function(){var t=this.result,i=[],e=this.setTextEffect(this.supportText,"Chọn quân bài muốn giữ lại"),n=this.hightlightHoldCards(t.holdCards);return i.push(e,n),T=1,i},x.getSeconEffectTurn=function(){var t=this.result,i=[];if(parseInt(t.winMoney)>0){this.resultSound=TWIST.Sound.play("minigame/NormalWin");var e=this.changeNumberEffect(this.resultText,t.winMoney,{duration:700}),n=this.setTextEffect(this.supportText,"Nhân đôi "+t.winMoney+" thành "+2*parseInt(t.winMoney)+"!"),s=this.hightLightWinCards(t.hightLightCards),a=this.hightlightWinRank(t.cardListRank);i.push(e,n,s,a),this.buttonSpin.hide(),this.doubleButton._disabled=!1,this.doubleButton.removeClass("disabled"),this.doubleButton.show(),this.getWinButton._disabled=!1,this.getWinButton.addClass("active"),b=parseInt(t.winMoney),T=2}else{this.resultSound=TWIST.Sound.play("minigame/slot_result"),b=0;var n=this.setTextEffect(this.supportText,"Không ăn !"),e=this.changeNumberEffect(this.resultText,0,{duration:700}),s=this.hightLightWinCards([]),o=this.hightlightHoldCards([]);i.push(e,n,s,o),T=0,this.virtualCardsList.forEach(function(t,i){t._active=!1,t.removeClass("active")})}return i},x.hightlightHoldCards=function(t){var i=this.virtualCardsList,e=this;return i.runEffect=function(){this.isDone=!1,this.forEach(function(i,e){t[e]?(i._active=!0,i.addClass("active")):(i._active=!1,i.removeClass("active"))})},i.endEffect=function(){this.forEach(function(t,i){t.removeClass("active")}),this.isDone=!0,this.isTracking&&(this.isTracking=!1,e.emit("endEffect"))},i},x.getWin=function(t){var i=this;TWIST.Sound.play("minigame/coin_spin"),i.changeStatus("effecting"),i.changeNumberEffect(i.money,i.userInfo.money,{duration:800}).runEffect(),i.changeNumberEffect(i.resultText,0,{duration:800}).runEffect(),i.setTextEffect(i.supportText,"").runEffect(),i.moveChipEffect(0).runEffect(),b=0,T=0,this.buttonSpin.show(),this.doubleButton.hide(),this.doubleButton._disabled=!1,this.doubleButton.addClass("disabled"),this.getWinButton._disabled=!0,this.getWinButton.removeClass("active"),this.virtualCardsList.forEach(function(t,i){t._active=!1,t.removeClass("active")})},x.doubleTurn=function(t){var i=this;"pause"!==i.status&&i.changeStatus("pause"),T=3;this.setTextEffect(this.supportText,"Chọn quân bài cao hơn").runEffect(),this.hightlightHoldCards([]).runEffect();this.doubleButton._disabled=!0,this.doubleButton.addClass("disabled"),this.getWinButton._disabled=!0,this.getWinButton.removeClass("active"),this.virtualCardsList.forEach(function(t,i){t.removeClass("active")}),C.forEach(function(i,e){i.unHightLight(),i.UnOverlay(),0==e?(i.isOpened=!0,i.openCard(t.cardId,TWIST.Card.miniPoker)):i.upSideDown(TWIST.Card.miniPoker)})},x.runNextEffect=function(){function t(){m=0;for(var t=0;t<i.length;t++)i[t].runEffect()}var i=l[f];if(i&&i.length)if(i.oneTime)i.done?(f++,f==l.length&&(P?f=0:this.changeStatus("pause")),"effecting"===this.status&&this.runNextEffect()):t();else{var e=setTimeout(t,300);g.push(e)}},x.endEffect=function(){m++,m==(l[f]&&l[f].length)&&(l[f].oneTime&&(l[f].done=!0),f++,f==l.length&&(P?f=0:this.changeStatus("pause")),"effecting"===this.status&&this.runNextEffect())},x.createSlotItem=function(t,i){var n=new createjs.Container,s=new TWIST.Card(t);return n.bg=s,t>51&&(t-=52,s.bg.sourceRect={width:TWIST.Card.size.width,height:152,x:TWIST.Card.size.width*(9+t),y:4*TWIST.Card.size.height}),s.set({scaleX:TWIST.Card.miniPoker.scale,scaleY:TWIST.Card.miniPoker.scale,x:(e.width-TWIST.Card.miniPoker.width)/2,y:(e.height-TWIST.Card.miniPoker.scale*TWIST.Card.size.height)/2}),n.addChild(s),n.set({x:0,y:e.height*i,state:i}),n.goNextStep=function(){var t=e.height*this.state;this.set({y:t})},n},x.changeNumberEffect=function(t,i,e){var n=$(t),s=this;return n.newValue=i,n.options=e,n.runEffect=function(){n.finish(),n.isDone=!0;var t=this.text(),i={duration:1e3,step:function(t){n.text(Global.numberWithDot(Math.ceil(t)))},done:function(){n.endEffect()}};$.extend(i,n.options),t=parseInt(t.replace(/\,/g,"")),isNaN(t)&&(t=0),this.prop("Counter",t).animate({Counter:n.newValue},i)},n.endEffect=function(){n.finish(),this.isTracking&&(this.isTracking=!1,s.emit("endEffect"))},n},x.setTextEffect=function(t,i){var e=$(t),n=this;return e.newValue=i,e.runEffect=function(){e.isDone=!1,e.text(i)},e.endEffect=function(){e.text(""),e.isDone=!0,this.isTracking&&(this.isTracking=!1,n.emit("endEffect"))},e},x.explodePotEffect=function(){var t=this,i=$("#effect .explorer-pot");new Date;return i.runEffect=function(){i.isDone=!1,this.show()},i.click(function(){i.endEffect()}),i.endEffect=function(){this.hide(),this.isDone=!0,this.isTracking&&(this.isTracking=!1,t.emit("endEffect"))},i},x.hightlightWinRank=function(t){var i=this,e=this.resultItemList.find(function(i,e){return i.code==t}),n=e?e.template:$("<div></div>");return n.runEffect=function(){n.isDone=!1,n.addClass("active"),this.isTracking&&(this.isTracking=!1,i.emit("endEffect"))},n.endEffect=function(){n.removeClass("active"),n.isDone=!0},n},x.hightLightWinCards=function(t){for(var e=this,n=[],s=0;s<i.x;s++){var a=C[s];a.active=t[s],a.border.sourceRect.x=4*TWIST.Card.size.width,n.push(a)}return n.runEffect=function(){n.isDone=!1,n.forEach(function(t,i){parseInt(t.active)?t.hightLight():t.Overlay()}),this.isTracking&&(this.isTracking=!1,e.emit("endEffect"))},n.endEffect=function(){n.forEach(function(t,i){parseInt(t.active)?t.unHightLight():t.UnOverlay()}),n.isDone=!0},n},x.showResultText=function(t,i){var e=this,n=this.options.resultTab.find(function(i,e){return i.code==t}),s=v.find(function(t,e){return t.value==i}),a=n.name;3!=n.code&&7!=n.code&&9!=n.code||!s||(a=a+" "+s.name,9==n.code&&(a="Đôi "+s.name)),this.resultText.text(a);var o={};return o.runEffect=function(){o.isDone=!1,e.resultText.text(a),this.isTracking&&(this.isTracking=!1,e.emit("endEffect"))},o.endEffect=function(){e.resultText.text(""),o.isDone=!0},o},x.explodePotEffect=function(){var t=this,i=this.explodePot;new Date;return i.runEffect=function(){this.isDone=!1,this.show()},i.click(function(){i.endEffect()}),i.endEffect=function(){this.hide(),this.isDone=!0,this.isTracking&&(this.isTracking=!1,t.emit("endEffect"))},i},x.moveChipEffect=function(t){var i=this,e=this.moveChip;new Date;return e.runEffect=function(){this.isDone=!0,this.removeClass("plus decrease");var i=t?"plus":"decrease";this.removeClass("plus decrease"),this.show(),e.find("i").show(),this.addClass(i),e.find("i").each(function(t){$(this).one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(this).hide()})})},e.endEffect=function(){this.isTracking&&(this.isTracking=!1,i.emit("endEffect"))},e},x.showSessionId=function(t){this.sessionId.text(t)},TWIST.VideoPoker=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t,i){this.wrapper=$(t),this.options=$.extend(e,i),this.initXocDia()}var i=location.origin+location.pathname+"../src/images/",e={avatar:"https://s.gravatar.com/avatar/a4fae1e89a441c83f656a7ae59f9c19f?s=80",gameSize:{width:1280,height:720,position:"relative"},chipSize:{width:75,height:75,miniWidth:24,miniHeight:24,miniRatio:.33},bettingChipPositions:[{y:640,x:390},{y:629,x:550},{y:640,x:710},{y:640,x:868}],playerPosition:{x:1215,y:330},hostPosition:{x:620,y:60},userPosition:{y:650,x:210},chipSrcList:["1st-chip.png","2nd-chip.png","3rd-chip.png","4th-chip.png"],width:1280,height:720,timerRadius:60,moveChipAnimationTime:500,diskPosition:{x:539,y:155,width:400,initWidth:646,initHeight:647,scale:400/646},bowlPosition:{x:25,y:25,width:534,height:542},chipResultPosition:{x:50,y:50,width:100,height:100,chipWidth:96,chipHeight:96}},n=t.prototype=new TWIST.InRoomGame;n.initXocDia=function(){this.initInRoomGame(),this.initVariable(),this.initTemplate(),this.initButton(),this.bindButton(),this.pushXocDiaEvent()},n.initVariable=function(){this.info={betting:1e3},this.userInfo=$.extend(this.userInfo,{uuid:"",username:"",money:0,isHost:!1}),this.bettingPositions=[{name:"Bốn Trắng",displayName:"1:10",valueMap:[0,0,0,0],resultMap:[0],ratio:10,id:2,top:440,left:40,width:220,height:148},{name:"Bốn Đỏ",displayName:"1:10",valueMap:[1,1,1,1],resultMap:[4],ratio:10,id:3,top:440,left:285,width:220,height:148},{name:"Ba Trắng",displayName:"1:3",valueMap:[0,0,0,1],resultMap:[1],ratio:3,id:4,top:440,left:775,width:220,height:148},{name:"Ba đỏ",displayName:"1:3",valueMap:[0,1,1,1],resultMap:[3],ratio:3,id:5,top:440,left:1020,width:220,height:148},{name:"Hai đỏ",displayName:"1:1.5",valueMap:[0,0,1,1],resultMap:[2],ratio:1.5,id:6,top:440,left:530,width:220,height:148},{name:"Chẵn",displayName:"Chẵn",valueMap:[0],resultMap:[0,2,4],ratio:1,id:0,top:230,left:100,width:320,height:186},{name:"Lẻ",displayName:"Lẻ",valueMap:[1],resultMap:[1,3],ratio:1,id:1,top:230,left:860,width:320,height:186}],this.statusList={1:"STATUS_WAITING_FOR_START",2:"STATUS_SHAKE_DISK",3:"STATUS_BETTING",4:"STATUS_ARRANGING",5:"END_GAME"}},n.bindButton=function(){},n.drawRoom=function(){this.desk=new TWIST.Desk(this.options),this.desk.name="desk",this.stage.addChild(this.desk),this.wrapper.css(e.gameSize)},n.drawGameInfo=function(t){this.setHost(t.host),this.changeStatus(t),this.roomBetting=t.betting,this.setBettingChipValue(t.listBettingChip),this.addHistoryList(t.historyList),this.drawBettingPositions(t.bettingPositions)},n.initButtonBar=function(){},n.initInviteList=function(){},n.initResultPanel=function(){},n.initTemplate=function(){this.wrapperTemplate=$(TWIST.HTMLTemplate["xocDia/wrapper"]),this.wrapper.append(this.wrapperTemplate),this.initBettingPositionList(),this.initProfile(),this.initHost(),this.initTotalTable(),this.initGameCanvas(),this.initVitualBetting(),this.initListPlayer(),this.initChipButton(),this.initSellPopup(),this.initHistory(),this.wrapperTemplate.append(this.errorPanel),this.effectWrapper=$(TWIST.HTMLTemplate["effect/wrapper"]),this.wrapperTemplate.append(this.effectWrapper),this.money=this.user.find(".money"),this.setBetting(this.chipButtons[0])},n.setBetting=function(t){this.chipButtons.active&&(this.chipButtons.forEach(function(t,i){t.template.removeClass("active")}),t.template.addClass("active"),this.currentBetting=t)},n.pushXocDiaEvent=function(){var t=this;this.on("userInfo",function(){t.renderUserInfo(arguments[0])}),this.on("userBetting",function(i){t.userBetting(i)}),this.on("updateBettings",function(i){t.updateBettings(i),t.emit("getListPlayer")}),this.on("updateListPlayer",function(t){this.listPlayer.html(t.count||"1")}),this.on("xocDia",function(i){t.xocDia(i)}),this.on("endXocDia",function(i){t.endXocDia(i)}),this.on("openDisk",function(i){t.openDisk(i)}),this.on("hostPayment",function(i){t.hostPaymentData=i}),this.on("changeHost",function(i){t.setHost(i)}),this.on("suggetstHost",function(i){t.isSuggestHost=!0}),this.on("reBettingResult",function(i){t.reBetting(i)}),this.on("resignationSuccess",function(i){t.setHost()}),this.on("cancelBettingResult",function(i){t.cancelBetting(i)}),this.on("sellBettingResult",function(i){t.showError({message:"Bán cửa thành công !"})})},n.cancelBetting=function(t){var i=this;this.totalTable.setTotalBetting(0),this.cancelBettingButton.hide(),this.bettingPositions.forEach(function(t,e){i.moveChipToUser(t.id,t.mineValue),t.setMineBetting(0)})},n.hostPaymentPhase1=function(){var t=this,i=this.hostPaymentData;this.totalTable.setTotalWin(i&&i.changeMoney),i&&(this.bettingPositions.hasChipsMove=!1,this.bettingPositions.forEach(function(i,e){i.status||(t.moveChipToHost(i.id),i.setMineBetting(0),i.setTotalBetting(0))}),this.bettingPositions.hasChipsMove||t.hostPaymentPhase2())},n.hostPaymentPhase2=function(){var t=this,i=this.hostPaymentData;i&&(TWIST.Sound.play("chip/multichip"),this.userInfo.isHost&&this.showChangeMoney(i),this.bettingPositions.forEach(function(i,e){i.status&&(t.paymentChipToSlotBetting(i.id,i.totalValue*i.ratio),i.setTotalBetting(i.totalValue*(i.ratio+1)),i.setMineBetting(i.mineValue*(i.ratio+1)))}))},n.showChangeMoney=function(t){this.userInfo.money=t.money,this.userMoney.runEffect(this.userInfo.money);var i=$(TWIST.HTMLTemplate["xocDia/changeMoney"]);this.user.append(i),i.text(Global.numberWithDot(parseInt(t.changeMoney))),i.one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){i.remove()}),t.changeMoney>=0&&i.addClass("plus")},n.hostPaymentPhase3=function(){var t=this,i=this.hostPaymentData;i&&(this.userInfo.isHost||this.showChangeMoney(i),TWIST.Sound.play("chip/multichip"),this.bettingPositions.forEach(function(i,e){i.status&&(!function(e,n){setTimeout(function(){t.moveChipToPlayers(i.id,e,n)},500)}(i.mineValue,i.totalValue),i.setMineBetting(0),i.setTotalBetting(0))}))},n.paymentChipToSlotBetting=function(t,i){var e=this,n=this.convertValueToChips(i),s=300/n.length;n.forEach(function(i,n){e.timeOutList.push(setTimeout(function(){e.paymentChipAction(t,i)},s*n))})},n.moveChipToHost=function(t){var i=this,n=this.moveChipContainer.children.find(function(i,e){return i.name==t}),s=n.children,a=s.length;a>0&&(this.bettingPositions.hasChipsMove=!0),i._numberChipMove=i._numberChipMove||0,s.forEach(function(t,n){var s=t.localToGlobal(0,0),o=i.userInfo.isHost?e.userPosition:e.hostPosition;setTimeout(function(){i._numberChipMove++,i.stage.addChild(t),t.move(s,o,function(){i.stage.removeChild(t),i._numberChipMove--,i._numberChipMove||setTimeout(function(){i.hostPaymentPhase2()},500)})},300/a*n)})},n.moveChipToUser=function(t,i){var n=this.moveChipContainer.children.find(function(i,e){return i.name==t}),s=n.children,a=e.userPosition;this.moveChipsToPosition(i,s,a)},n.moveChipToPlayers=function(t,i,n){var s=this.moveChipContainer.children.find(function(i,e){return i.name==t}),a=s.children;i&&this.moveChipsToPosition(i,a,e.userPosition),this.moveRemainChipToPlayers(a,e.playerPosition)},n.moveChipsToPosition=function(t,i,e){var n=this,s=this.convertValueToChipContainers(t,i),a=s.length;s.forEach(function(t,i){var s=t.localToGlobal(0,0),o=e;t.set(s),n.stage.addChild(t),setTimeout(function(){t.move(s,o,function(){n.stage.removeChild(t)})},300/a*i)})},n.moveRemainChipToPlayers=function(t,i){var e=this,n=t.length;t.forEach(function(t,s){var a=t;if(a){var o=a.localToGlobal(0,0),r=i;setTimeout(function(){e.stage.addChild(a),a.move(o,r,function(){e.stage.removeChild(a)})},300/n*s)}})},n.userBetting=function(t){this.totalTable.totalBettingValue+=this.currentBetting.value,this.totalTable.setTotalBetting(this.totalTable.totalBettingValue);var i=this.bettingPositions.find(function(i,e){return i.id==t.id});TWIST.Sound.play("chip/singlechip"),this.reBettingButton.hide(),this.cancelBettingButton.show(),i.setMineBetting(t.mineBetting),i.setTotalBetting(t.totalBetting);var e=this.currentBetting.id;this.bettingChipAction(t.id,e,!0)},n.updateBettings=function(t){var i=this;this.bettingPositions.forEach(function(e,n){var s=t.find(function(t,i){return t.id==e.id});s&&(i.playersBetting(e,s.totalBetting-e.totalValue),e.setTotalBetting(s.totalBetting))})},n.reBetting=function(t){TWIST.Sound.play("chip/multichip");var i=this;this.reBettingButton.hide(),this.cancelBettingButton.show(),this.bettingPositions.forEach(function(e,n){var s=t.find(function(t,i){return t.id==e.id});s&&(e.setMineBetting(s.mineBetting),s.mineBetting&&(i.totalTable.totalBettingValue+=parseInt(s.mineBetting)),e.setTotalBetting(s.totalBetting),i.userReBetting(e,s.mineBetting))}),this.totalTable.setTotalBetting(this.totalTable.totalBettingValue)},n.bettingChipAction=function(t,i,n){var s=this.moveChipContainer.getChildByName(t),a=this.createChip(i);a.isMine=n;var o=n?e.bettingChipPositions[i]:e.playerPosition,r={x:o.x-s.x,y:o.y-s.y},h={x:Math.random()*(s.width-e.chipSize.miniWidth),y:Math.random()*(s.height-e.chipSize.miniHeight)};s.addChild(a),a.move(r,h)},n.paymentChipAction=function(t,i){var n=this,s=this.moveChipContainer.getChildByName(t),a=this.createChip(i),o=this.userInfo.isHost?e.userPosition:e.hostPosition,r={x:o.x-s.x,y:o.y-s.y},h={x:Math.random()*(s.width-e.chipSize.miniWidth),y:Math.random()*(s.height-e.chipSize.miniHeight)};s.addChild(a),this._numberChipMove=this._numberChipMove||0,this._numberChipMove++,a.move(r,h,function(){n._numberChipMove--,n._numberChipMove||n.hostPaymentPhase3()})},n.playersBetting=function(t,i){var e=this,n=this.convertValueToChips(i),s=1e3/n.length;n.forEach(function(i,n){e.timeOutList.push(setTimeout(function(){e.bettingChipAction(t.id,i)},s*n))})},n.userReBetting=function(t,i){var e=this,n=this.convertValueToChips(i),s=500/n.length;n.forEach(function(i,n){e.timeOutList.push(setTimeout(function(){e.bettingChipAction(t.id,i,!0)},s*n))})},n.convertValueToChips=function(t){var i=[],e=this.chipButtons[0].value,n=[],s=0;this.chipButtons.forEach(function(t,i){s+=t.value*t.concentration;for(var e=0;e<t.concentration;e++)n.push(t.id)});for(var a=parseInt(t/s),o=0;a>o;o++)i=i.concat(n);for(var r=parseInt(t%s/e),o=0;r>o;o++)i.push(this.chipButtons[0].id);return Global.shuffle(i)},n.convertValueToChipContainers=function(t,i){function e(){return r=o>=d}function n(t){return h=h.filter(function(i,e){return t>=i}),h[0]}function s(){if(d=n(o)){var t=i.find(function(t,i){return t.value==d&&!t._isChecked});t?(o-=d,a.push(t),t._isChecked=!0):(h.shift(),s())}}var a=[],o=t,r=!0,h=this.chipButtons.map(function(t,i){return t.value});h.sort(function(t,i){return i-t});for(var d=n(t);e();)s();return a},n.xocDia=function(){var t,i,n,s=this;n=this.diskContainer.y<-200?1e3:100,"STATUS_SHAKE_DISK"===this.status?(i={x:e.diskPosition.x+(Math.random()-.5<0?-1:1)*(10*Math.random()+10),y:e.diskPosition.shakeY+(this.diskContainer.isTop?-1:1)*(10*Math.random()+10)},t="xocDia"):(n=1e3,i=e.diskPosition,t="endXocDia"),createjs.Tween.get(this.diskContainer).to(i,n).call(function(){s.diskContainer.isTop=!s.diskContainer.isTop,s.emit(t)})},n.endXocDia=function(){this.history._toggle(!0)},n.showResult=function(t){var i=this;this.playResultSounds(t);var n=e.bowlPosition.y-e.bowlPosition.height;this.history.addResult(t.winnerSlots);this.chipResultContainer.removeAllChildren();var s=Global.shuffle(t.map);s.forEach(function(t,e){i.createResultChip(t,e)}),this.bowl.set({y:e.bowlPosition.y}),createjs.Tween.get(this.bowl).to({y:n},1e3).call(function(){i.hostPaymentPhase1()}),this.bettingPositions.forEach(function(i,e){i.setStatus(t.winnerSlots)})},n.playResultSounds=function(t){var i=(t.map,t.winnerSlots),e=0;t.map.forEach(function(t,i){e+=t+1});var n="",s="",a=["news/xap4","news/xap1","news/xap3","news/xap2","news/ngua"],o=[3,4,5,6].findIndex(function(t,e){return i.indexOf(t)>-1}),r=i.indexOf(1)>-1,h=o>-1;n=h?a[o]:a[4],s=r?"news/le":"news/chan";var d=[n,s];TWIST.Sound.playQueue(d)},n.openDisk=function(t){this.history._toggle(!1);var i,n=this;i={x:e.diskPosition.x,y:e.diskPosition.shakeY},createjs.Tween.get(this.diskContainer).to(i,1e3).call(function(){n.showResult(t)})},n.closeDisk=function(t){this.history._toggle(!1),createjs.Tween.get(this.bowl).to(e.bowlPosition,1e3).call(function(){})},n.createResultChip=function(t,n){var s=(TWIST.imagePath||i)+"xocdia/"+(t?"red-big.png":"white-big.png"),a=new createjs.Bitmap(s),o=this.chipResultContainer.width/2,r=this.chipResultContainer.height/2,h={x:Math.random()*(o-e.chipResultPosition.chipWidth)+parseInt(n/2)*o,y:Math.random()*(r-e.chipResultPosition.chipHeight)+parseInt(n%2)*r};return a.set(h),this.chipResultContainer.addChild(a),a},n.createChip=function(t){var n=e.chipSize.miniRatio,s=(TWIST.imagePath||i)+"xocdia/"+e.chipSrcList[t],a=new createjs.Bitmap(s),o=this.chipButtons.find(function(i,e){return i.id==t}).value;return a.set({scaleX:n,scaleY:n,type:t,value:o}),a.move=function(t,i,n){a.set(t);var s=i.x+3*(Math.random()-.5),o=i.y+3*(Math.random()-.5);createjs.Tween.get(a).to({x:s,y:o},e.moveChipAnimationTime).call(function(){"function"==typeof n&&n()})},a},n.renderUserInfo=function(){var t=this.user.find(".avatar"),i=this.user.find(".username");t.css("background-image","url("+(this.userInfo.avatar?"./"+this.userInfo.avatar:e.avatar)+")"),i.text(this.userInfo.username),this.userMoney.runEffect(this.userInfo.money)},n.initHistory=function(){var t=this;this.history=$(TWIST.HTMLTemplate["xocDia/history"]),this.historyInner=this.history.find(".history"),this.wrapperTemplate.append(this.history),this.historyList=[];var i={2:4,3:0,4:1,5:3,6:2};this.history._toggle=function(i){"undefined"!=typeof i?i?t.historyInner.addClass("active"):t.historyInner.removeClass("active"):t.historyInner.toggleClass("active")},this.historyInner.on("click",function(){t.history._toggle()}),this.history.addResult=function(e){var n=e.find(function(t,i){return 2>t}),s=e.find(function(t,i){return t>1}),a=!1,o=t.historyList[t.historyList.length-1];a=!t.historyList[t.historyList.length-1],o&&o.children().length>3&&(a=!0),t.history.lastResult&&t.history.lastResult.isOdd!==n&&(a=!0),a&&(o=$(TWIST.HTMLTemplate["xocDia/resultChipColumn"]),t.historyList.push(o),t.historyInner.append(o));var r=$(TWIST.HTMLTemplate["xocDia/resultChip"]);n&&r.addClass("result-chip-odd"),r.isOdd=n,r.find(".inner-chip").html(i[s]),t.history.lastResult=r,o.append(r),t.historyList.length>15&&(t.historyList[0].remove(),t.historyList.shift())}},n.addHistoryList=function(t){var i=this,e=[],n=this.bettingPositions;e=t.map(function(t,i){var e=[];return n.forEach(function(i,n){i.resultMap.indexOf(t)>-1&&e.push(i.id)}),e}),e.forEach(function(t,e){i.history.addResult(t)})},n.initHost=function(){this.host=$(TWIST.HTMLTemplate["xocDia/host"]),this.wrapperTemplate.append(this.host),this.host.background=this.host.find(".host-background"),this.host.hostName=this.host.find(".host-name"),this.host.chatBox=this.host.find(".chat-box"),this.host.hostMessage=this.host.find(".chat-box-inner"),this.host.setMessage=function(t){t?(this.show(),this.hostMessage.html(t)):this.hide()}},n.initTotalTable=function(){var t=this;this.totalTable=$(TWIST.HTMLTemplate["xocDia/totalTable"]),this.wrapperTemplate.append(this.totalTable),this.totalTable.totalBetting=this.totalTable.find(".total-table-betting"),this.totalTable.totalWin=this.totalTable.find(".total-table-win"),this.addNumberEffect(this.totalTable.totalBetting),this.addNumberEffect(this.totalTable.totalWin),this.totalTable.setTotalBetting=function(i){this.totalBettingValue=i,t.totalBettingValue=i,this.totalBetting.runEffect(i)},this.totalTable.setTotalWin=function(t){this.totalWinValue=t,this.totalWin.runEffect(t)}},n.setHost=function(t){this.host.hostName.removeClass("active"),this.userInfo.isHost=(t&&t.uuid)==this.userInfo.uuid,this.resignationButton.hide(),this.userInfo.isHost&&(this.lastBettings=void 0,this.showError({message:"Bạn đã làm nhà cái !"})),this.setShowChipButtons(),t&&t.username?(this.host.name=t.username,this.getHostButton.hide(),this.host.hostName.addClass("active"),this.host.hostName.html(t.username)):this.host.name=void 0},n.initListPlayer=function(){var t=this;this.listPlayer=$(TWIST.HTMLTemplate["xocDia/listPlayer"]),this.wrapperTemplate.append(this.listPlayer),this.listPlayer.on("click",function(){t.activeListPlayer=!0,t.emit("getListPlayer")})},n.initBettingPositionList=function(){var t=this,i=this.bettingPositions;i.forEach(function(i,e){t.createBettingPosition(i)})},n.initVitualBetting=function(){var t=this,i=this.bettingPositions;i.forEach(function(i,e){t.createVitualBetting(i)})},n.initProfile=function(){this.user=$(TWIST.HTMLTemplate["xocDia/user"]),this.wrapperTemplate.append(this.user),this.userMoney=this.user.find(".money"),this.addNumberEffect(this.userMoney)},n.initGameCanvas=function(){this.wrapperTemplate.append(this.canvas),this.initDisk(),this.initMoveChipContainer(),this.desk.createTimer({x:this.options.width/2-this.options.timerRadius,y:this.options.height/2-this.options.timerRadius-20,radius:this.options.timerRadius,strokeThick:10,__type:1}),this.stage.addChild(this.diskContainer,this.moveChipContainer,this.desk)},n.initChipButton=function(){var t=this;this.chipWrapper=$(TWIST.HTMLTemplate["xocDia/chips"]),this.wrapperTemplate.append(this.chipWrapper),this.chipButtons=[{id:0,value:1e3,concentration:1,template:this.chipWrapper.find(".chip-1st")},{id:1,value:1e4,concentration:1,template:this.chipWrapper.find(".chip-2nd")},{id:2,value:1e5,concentration:1,template:this.chipWrapper.find(".chip-3rd")},{id:3,value:1e6,concentration:1,template:this.chipWrapper.find(".chip-4th")}],this.chipButtons.active=!0,this.chipButtons.forEach(function(i,e){i.template.on("click",function(){TWIST.Sound.play("minigame/Common_Click"),t.setBetting(i)})})},n.initSellPopup=function(){function t(){a.sellPopup.hide()}function i(){a.sellPopup.scroller.css("left",0),s(0)}function e(){a.sellPopup.scroller.css("left",h),s(1)}function n(){var t={id:o.id,value:a.sellPopup.currentValue};a.sellPopup.hide(),a.emit("sellBetting",t)}function s(t){a.sellPopup.dragbarInner.css("width",t*h+r);var i=parseInt(t*a.sellPopup.maxValue);a.sellPopup.currentValue=i,a.sellPopup.scrollerValue.html(i)}var a=this;this.sellPopup=$(TWIST.HTMLTemplate["xocDia/sellPopup"]);var o;this.sellPopup.initPopup=function(t){o=t;var e=t.totalValue;a.sellPopup.maxValue=e,a.sellPopup.plusButton.html(e),a.sellPopup.title.html(t.name),i()},this.wrapperTemplate.append(this.sellPopup);var r=5,h=256;this.sellPopup.hide(),this.sellPopup.title=this.sellPopup.find(".sell-popup-title"),this.sellPopup.background=this.sellPopup.find(".sell-popup-background"),this.sellPopup.background.on("click",t),this.sellPopup.cancel=this.sellPopup.find("#cancel"),this.sellPopup.cancel.on("click",t),this.sellPopup.accept=this.sellPopup.find("#accept"),this.sellPopup.accept.on("click",n),this.sellPopup.minusButton=this.sellPopup.find(".sell-popup-minus"),this.sellPopup.minusButton.on("click",i),this.sellPopup.plusButton=this.sellPopup.find(".sell-popup-plus"),this.sellPopup.plusButton.on("click",e),this.sellPopup.dragbarInner=this.sellPopup.find(".sell-popup-dragbar-inner"),this.sellPopup.scroller=this.sellPopup.find("#scroller"),this.sellPopup.scrollerValue=this.sellPopup.scroller.find(".sell-popup-scroller-content");var d={axis:"x",scroll:!1,containment:"#sell-popup-drag-container",drag:function(t,i){var e=i.position.left/h;s(e)}};this.sellPopup.scroller.draggable(d)},n.showSellPopup=function(t){var i=this.bettingPositions.find(function(i,e){return i.id==t});i?i.totalValue&&(this.sellPopup.show(),this.sellPopup.initPopup(i)):this.showError({message:"Chưa chọn cửa bán !"})},n.initButton=function(){var t=this;this.buttons=[];var i=$(TWIST.HTMLTemplate["xocDia/buttons"]);this.wrapperTemplate.append(i),this.reBettingButton=i.find("#reBetting"),this.buttons.push(this.reBettingButton),this.reBettingButton.on("click",function(){t._listenChangeMoney=!0,t.emit("reBetting")}),this.cancelBettingButton=i.find("#cancelBetting"),this.buttons.push(this.cancelBettingButton),this.cancelBettingButton.on("click",function(){t._listenChangeMoney=!0,t.emit("cancelBetting")}),this.sellOddButton=i.find("#sellOdd"),this.buttons.push(this.sellOddButton),this.sellOddButton.on("click",function(){t.showSellPopup(1)}),this.resignationButton=i.find("#resignation"),this.buttons.push(this.resignationButton),this.resignationButton.on("click",function(){t.emit("resignation")}),this.sellEvenButton=i.find("#sellEven"),this.buttons.push(this.sellEvenButton),this.sellEvenButton.on("click",function(){t.showSellPopup(0)}),this.getHostButton=i.find("#getHost"),this.buttons.push(this.getHostButton),this.getHostButton.on("click",function(){t.emit("getHost")}),this.buttons.hide=function(){t.buttons.forEach(function(t,i){t.hide()})}},n.initDisk=function(){this.diskContainer=new createjs.Container;var t=e.diskPosition,n=e.chipResultPosition,s=e.bowlPosition;t.x=(e.gameSize.width-t.width)/2,t.y=3*-t.width/5,t.shakeY=0,t.scaleX=t.scaleY=t.scale,this.diskContainer.set(t),this.disk=new createjs.Bitmap((TWIST.imagePath||i)+"xocdia/disk.png"),this.chipResultContainer=new createjs.Container,n.height=n.width=s.width/Math.sqrt(2),n.x=n.y=(t.initWidth-n.width)/2,this.chipResultContainer.set(e.chipResultPosition),this.bowl=new createjs.Bitmap((TWIST.imagePath||i)+"xocdia/bowl.png"),s.x=(t.initWidth-s.width)/2,s.y=(t.initHeight-s.height)/2,this.bowl.set(e.bowlPosition),this.diskContainer.addChild(this.disk,this.chipResultContainer,this.bowl)},n.initMoveChipContainer=function(){this.moveChipContainer=new createjs.Container;var t=this.moveChipContainer;this.bettingPositions.forEach(function(i,e){var n=new createjs.Container,s={x:i.left+30,y:i.top+35,width:i.width-80,height:i.height-90,name:i.id};i.bettingSlot=n,n.set(s),t.addChild(n)})},n.createVitualBetting=function(t){var i=this,e=TWIST.HTMLTemplate["xocDia/vitualBetting"],n=$(e);t.id>1&&n.addClass("small-vitual-betting"),n.addClass("betting"+t.id),n.css({top:t.top,left:t.left,width:t.width,height:t.height}),this.wrapperTemplate.append(n),t.vitualBetting=n,n.on("click",function(){if(i.userInfo.isHost)i.setSelectedBetting(t);else{var e={value:i.currentBetting.value,currentBettingId:i.currentBetting.id,slotBettingId:t.id};i.emitBetting(e)}})},n.setSelectedBetting=function(t){this.bettingPositions.forEach(function(t,i){t.setSelected(!1)}),t.setSelected(!0)},n.emitBetting=function(t){return this.userInfo.money<t.value?void this.showError({message:"Bạn không đủ tiền đặt cược !"}):(this._listenChangeMoney=!0,void this.emit("betting",t))},n.createBettingPosition=function(t){var i=this,e=TWIST.HTMLTemplate["xocDia/bettingPosition"],n=$(e);return t.id>1&&n.addClass("small-betting-position"),n.css(t),t.template=n,this.wrapperTemplate.append(n),n.addClass("betting"+t.id),n.mineBetting=n.find(".mine-betting"),this.addNumberEffect(n.mineBetting),n.totalBetting=n.find(".total-betting"),this.addNumberEffect(n.totalBetting),n.displayNameContainer=n.find(".name"),n.displayNameContainer.html(t.displayName),n.coinTittle=n.find(".coin-tittle"),t.valueMap.forEach(function(t,e){i.addCoins(t,n.coinTittle)}),n.setMineBetting=function(i){this.mineBetting.html(Global.numberWithDot(i)),t.mineValue=i},n.setTotalBetting=function(i){this.totalBetting.html(Global.numberWithDot(i)),t.totalValue=i},t.setMineBetting=function(t){i.userInfo.isHost?(this.template.mineBetting.html(""),this.mineValue=0):(this.template.mineBetting.runEffect(t),this.mineValue=t)},t.setTotalBetting=function(t){this.template.totalBetting.runEffect(t),this.totalValue=t},t.setStatus=function(i){t.template.removeClass("active disabled"),
t.status=0,i&&(i.indexOf(t.id)>-1?(t.template.addClass("active"),t.status=1):t.template.addClass("disabled"))},t.setSelected=function(i){t.isSelected=i,t.template.removeClass("selected"),i&&t.template.addClass("selected")},n},n.addCoins=function(t,i){var e=$(TWIST.HTMLTemplate["xocDia/coin-item"]);t&&e.addClass("red-coin"),i.append(e)},n.setBettingChipValue=function(t){this.chipButtons.forEach(function(i,e){var n=t.find(function(t,e){return i.id==t.id});i.value=n.value,i.template.html(Global.numberWithDot2(i.value))})},n.setRemainingTime=function(t,i){["STATUS_BETTING"].indexOf(this.status)>-1?(this.desk.setRemainingTime(parseInt(t),{x:this.options.width/2,y:this.options.height/2-this.options.timerRadius,font:"bold 60px Roboto Condensed",color:"#ffde00"}),this.desk.setCicleTime(parseInt(t),parseInt(i))):(this.desk.setRemainingTime(-1),this.desk.clearTimer())},n.drawBettingPositions=function(t){var i=this,e=0;this.bettingPositions.forEach(function(n,s){var a=t.find(function(t,i){return t.id==n.id});a&&(n.setMineBetting(a.mineBetting),i.userReBetting(n,a.mineBetting),e+=parseInt(a.mineBetting),n.setTotalBetting(a.totalBetting),i.playersBetting(n,a.totalBetting-a.mineBetting))}),this.totalTable.setTotalBetting(e)},n.setShowChipButtons=function(t){var i=this.userInfo.isHost();this.chipButtons.forEach(function(t,e){i?t.template.hide():t.template.show()})},n.setShowChipButtons=function(t){var i=this.userInfo.isHost;this.chipButtons.forEach(function(t,e){i?t.template.hide():t.template.show()})},n.setShowVitualBettings=function(t){var i=this.userInfo.isHost&&4==t||!this.userInfo.isHost&&3==t;this.bettingPositions.forEach(function(t,e){i?t.vitualBetting.show():t.vitualBetting.hide()})},n.removeSelectedBetting=function(t){this.bettingPositions.forEach(function(t,i){t.setSelected(!1)})},n.changeStatus=function(t){if(this.status!=this.statusList[t.status]){this.status=this.statusList[t.status];var i=this[this.status];this.buttons.hide(),this.setShowChipButtons(),this.setShowVitualBettings(t.status),this.removeSelectedBetting(t.status),this.setRemainingTime(t.remainingTime,t.totalTime),TWIST.Sound.stop(),"function"==typeof i&&i.call(this,t),this.emit("ping")}},n.STATUS_WAITING_FOR_START=function(){this.bettingPositions.forEach(function(t,i){t.template.removeClass("active disabled"),t.bettingSlot.removeAllChildren(),t.setMineBetting(0),t.setTotalBetting(0)}),this.totalTable.setTotalBetting(0),this.totalTable.setTotalWin(0),this.closeDisk(),this.host.setMessage(""),this.userInfo.isHost||this.isSuggestHost},n.STATUS_SHAKE_DISK=function(){this.isSuggestHost=!1,this.host.background.show(),this.emit("xocDia"),this.host.setMessage("Nhà cái xóc đĩa !")},n.STATUS_BETTING=function(t){var i=["news/anhoidatcuoc","news/batdaudatcuoc","news/moidatcuoc","news/datcuocdianh"],e=i[Math.floor(Math.random()*i.length)];TWIST.Sound.play(e),this.host.background.hide(),this.host.setMessage(""),t.showReBetting&&this.reBettingButton.show(),t.showCancelBetting&&this.cancelBettingButton.show()},n.STATUS_ARRANGING=function(t){var i=3;this.host.name&&(i=15),this.userInfo.isHost?(this.sellEvenButton.show(),this.sellOddButton.show()):this.lastBettings=this.bettingPositions.map(function(t){return{id:t.id,value:t.mineValue}})},n.END_GAME=function(){this.sellPopup.hide(),this.host.setMessage("Mở bát !"),this.totalBettingValue=0},TWIST.XocDia=t}(),this.gbjs=this.gbjs||{},function(){"use strict";var t=gbjs.Info=gbjs.Info||{};t.version="",t.buildDate=""}();