this.gbjs=this.gbjs||{},function(){"use strict";var t=gbjs.Info=gbjs.Info||{};t.version="",t.buildDate=""}(),this.gbjs=this.gbjs||{},function(){"use strict";function t(t){this.Bitmap_constructor(t)}createjs.extend(t,createjs.Bitmap);gbjs.BitmapAvatar=createjs.promote(t,"Bitmap")}(),this.gbjs=this.gbjs||{},function(){"use strict";function t(t,e,n){this.Bitmap_constructor(t),this.value=e,this.ready=!1,this.cursor=n,this._hoverShadow,this._shadow,this.cursor&&(this.cursor=n,this.addEventListener("click",this.handleEventClick.bind(this)),this.addEventListener("rollover",this),this.addEventListener("rollout",this))}var e=createjs.extend(t,createjs.Bitmap);e.draw=function(t,e){this.shadow=this._shadow,this.Bitmap_draw(t,e),this.hover&&(this.shadow=this._hoverShadow)},e.getValue=function(){return this.value},e.setHoverShadow=function(t,e,n,i){this._hoverShadow=new createjs.Shadow(t,e,n,i)},e.setShadow=function(t,e,n,i){this._shadow=new createjs.Shadow(t,e,n,i)},e.handleEventClick=function(){var t=this.y;this.ready===!0?t+=30:t-=30,createjs.Tween.get(this).to({y:t},100),this.ready=!this.ready},e.handleEvent=function(t){this.hover="rollover"==t.type},gbjs.BitmapCard=createjs.promote(t,"Bitmap")}(),this.gbjs=this.gbjs||{},function(){"use strict";function t(){this.Container_constructor()}createjs.extend(t,createjs.Bitmap);gbjs.BitmapDesk=createjs.promote(t,"Bitmap")}(),this.gbjs=this.gbjs||{},function(){"use strict";function t(t){this.Container_constructor()}createjs.extend(t,createjs.Container);gbjs.CardContainer=createjs.promote(t,"Container")}(),this.gbjs=this.gbjs||{},function(){"use strict";function t(){this.Container_constructor()}createjs.extend(t,createjs.Container);gbjs.ChairContainer=createjs.promote(t,"Container")}(),this.gbjs=this.gbjs||{},function(){"use strict";function t(){this.Container_constructor()}createjs.extend(t,createjs.Container);gbjs.Container=createjs.promote(t,"Container")}(),this.gbjs=this.gbjs||{},function(){"use strict";function t(){this.Container_constructor()}createjs.extend(t,createjs.Container);gbjs.DeskContainer=createjs.promote(t,"Container")}(),this.gbjs=this.gbjs||{},function(){"use strict";function t(){this.Container_constructor(),this.sortable=new gbjs.Sortable(this)}var e=createjs.extend(t,createjs.Container);e.dealCard=function(){},gbjs.HandContainer=createjs.promote(t,"Container")}(),this.gbjs=this.gbjs||{},function(){"use strict";function t(t,e,n){this.Container_constructor(),this.username=new gbjs.TextUsername(t),this.avatar=new gbjs.BitmapAvatar(e),this.money=new gbjs.TextMoney(n),this.addChild(this.username),this.addChild(this.avatar),this.addChild(this.money)}createjs.extend(t,createjs.Container);gbjs.Player=createjs.promote(t,"Container")}(),this.gbjs=this.gbjs||{},function(){"use strict";function t(t){this.parent=t,this.oldIndex,this.oldOffset,this.dragObj,this.newIndex,t.on("mousedown",this._onDragStart,this),t.on("pressmove",this._onTouchMove,this),t.on("pressup",this._onDragOver,this)}t.prototype._onDragStart=function(t){var e=this.dragObj=t.target,n=this.parent;this.oldIndex=n.getChildIndex(t.target),e.parent.addChild(e),this.oldOffset={x:e.x,y:e.y},e.offset={x:e.x-t.stageX,y:e.y-t.stageY}},t.prototype._onTouchMove=function(e){if(this.dragObj){t.active||this._dragStarted();var n=e.target;n.x=e.stageX+n.offset.x||0,n.y=e.stageY+n.offset.y||0}},t.prototype._onDragOver=function(t){if(this.dragObj){var e=t.target;e.parent.addChildAt(e,this.oldIndex),e.x=this.oldOffset.x,e.y=this.oldOffset.y,this.dragObj=null}},gbjs.Sortable=t}(),this.gbjs=this.gbjs||{},function(){"use strict";function t(t,e,n){this.Text_constructor(t,e,n)}createjs.extend(t,createjs.Text);gbjs.TextMoney=createjs.promote(t,"Text")}(),this.gbjs=this.gbjs||{},function(){"use strict";function t(t,e,n){this.Text_constructor(t,e,n)}createjs.extend(t,createjs.Text);gbjs.TextUsername=createjs.promote(t,"Text")}(),this.gbjs=this.gbjs||{},function(){"use strict";function t(e,n){return this instanceof t?(this.card=n,this.parent=this.card.parent,this.value=this.card.getValue(),this.index=this.parent.getChildIndex(this.card),this.rank=t.getRank(this.value),this.handCards=this.parent.children,void(this.cardsFire=e)):new t(e,n)}t.prototype.getCards=function(){var e,n=this,i=n.cardsFire;if(n.value>n._getMinPush()&&2!=i.length&&1!=i.length)return[];if(i.sort(function(t,e){return t>e}),this.parent.sortChildren(function(t,e){return t.getValue()>e.getValue()}),this.index=this.parent.getChildIndex(this.card),1===i.length){if(i[0]>=48)return n._getCardsChat2()}else{if(t.getRank(i[0])!=t.getRank(i[1]))return this._getDoc();if(e=t.getPhomSpecial(i),e>0)return n._getArrSpecialSuit(e);if(2==i.length&&i[0]>47)return n._getChatDoi2();if(2==i.length&&this.rank==t.getRank(i[0])){var s=n._getSelectNgang();if(2==s.length){var r=i[1]%4,a=s[0].getValue()%4,o=s[1].getValue()%4;if(o>a&&(a=o),a>r)return s}}else if(n.rank>t.getRank(i[0])){var s=n._getSelectNgang();return _.filter(s,function(t){return t.getValue()>=n.value})}}return[]},t.prototype._getCardsChat2=function(){var t=this._getTuQuy();return 0==t.length&&(t=this._getDoithong(4)),0==t.length&&(t=this._getDoithong(3)),t},t.prototype._getChatDoi2=function(){var t=this._getTuQuy();return 0==t.length&&(t=this._getDoithong(4)),t},t.prototype._getTuQuyTohon=function(){var e=this.cardsFire[0];return t.getRank(e)>this.rank?[]:this._getTuQuy()},t.prototype._getMinPush=function(){return this.handCards[this.handCards.length-1].getValue()},t.prototype._getSodoithongChon=function(e){return t.getRank(this.cardsFire[0])>this.rank?void 0:this._getDoithong(e)},t.prototype._getTuQuy=function(){var e=this,n=_.filter(e.handCards,function(n){return t.getRank(n.getValue())==e.rank});return n.length<4&&(n=[]),n.length>0&&n[0].getValue()!=e.value&&(n=[]),n},t.prototype._getDoithong=function(e){for(var n=[],i=this.rank,s=this.index,r=0;e>r;r++){for(var a=0,o=s+r;o<this.handCards.length&&(t.getRank(this.handCards[o].getValue())!=i||(a++,n.push(this.handCards[o]),2!=a));o++);if(2>a){n=[];break}i++}return n.length/2!=e&&(n=[]),n},t.prototype._getArrSpecialSuit=function(t){var e=[];switch(t){case 3:e=this._getDoithong(t),0==e.length&&(e=this._getTuQuy());break;case 4:e=this._getDoithong(t);break;case 5:e=this._getTuQuyTohon(),0==e.length&&(e=this._getDoithong(3))}return e},t.prototype._getSelectNgang=function(){var e=this;return _.filter(this.handCards,function(n){return t.getRank(n.getValue())==e.rank})},t.prototype.getCartByRank=function(e){return _.find(this.handCards,function(n){return t.getRank(n.getValue())==e})},t.isUndefined=function(t){return"undefined"==typeof t},t.prototype._getDoc=function(){var e,n=this,i=[],s=n.rank,r=t.getRank(n.cardsFire[0]);if(r>s)return[];i.push(n.card);for(var a=0;a<this.cardsFire.length-1;a++){if(s++,e=this.getCartByRank(s),t.isUndefined(e))return[];i.push(e)}return i},t.getRank=function(t){return Math.floor(t/4)},t.getPhomSpecial=function(e){var n,i,s=0;switch(e.length){case 4:n=t.getRank(e[0]),i=t.getRank(e[1]),n==i&&(s=5);break;case 6:n=t.getRank(e[0]),i=t.getRank(e[2]),n==i-1&&(s=3);break;case 8:n=t.getRank(e[0]),i=t.getRank(e[2]),n==i-1&&(s=4)}return s},gbjs.TUPhom=t}(),describe("Test TUPhom",function(){function t(t){n.removeAllChildren();for(var e in t)n.addChild(new gbjs.BitmapCard("card/3b.png",t[e]))}function e(t){return t.getValue()}var n=new gbjs.HandContainer;it("Không có quân bài chặt 2",function(){t([0,1]);var i=gbjs.TUPhom([48],n.getChildAt(0)).getCards();expect(i.map(e)).toEqual([])}),it("Chặt 2 bằng tứ quý",function(){t([0,1,2,3]);var i=gbjs.TUPhom([48],n.getChildAt(0)).getCards();expect(i.map(e)).toEqual([0,1,2,3])}),it("Chặt 2 bằng 3 đôi thông",function(){t([0,1,4,5,8,9]);var i=gbjs.TUPhom([48],n.getChildAt(0)).getCards();expect(i.map(e)).toEqual([0,1,4,5,8,9])}),it("Chặt 2 bằng 4 đôi thông",function(){t([0,1,4,5,8,9,12,13]);var i=gbjs.TUPhom([48],n.getChildAt(0)).getCards();expect(i.map(e)).toEqual([0,1,4,5,8,9,12,13])}),it("Chặt tứ quý",function(){t([4,5,6,7]);var i=gbjs.TUPhom([0,1,2,3],n.getChildAt(0)).getCards();expect(i.map(e)).toEqual([4,5,6,7])}),it("Chặt 3 đôi thông",function(){t([4,5,8,9,12,13]);var i=gbjs.TUPhom([0,1,4,5,8,9],n.getChildAt(0)).getCards();expect(i.map(e)).toEqual([4,5,8,9,12,13])}),it("Chặt bốn đôi thông",function(){t([4,5,8,9,12,13,16,17]);var i=gbjs.TUPhom([0,1,4,5,8,9,12,13],n.getChildAt(0)).getCards();expect(i.map(e)).toEqual([4,5,8,9,12,13,16,17])}),it("Chặt tứ quý bằng 3 đôi thông",function(){t([4,5,8,9,12,13]);var i=gbjs.TUPhom([0,1,2,3],n.getChildAt(0)).getCards();expect(i.map(e)).toEqual([4,5,8,9,12,13])}),it("Chặt tứ quý bằng tứ quý to hơn",function(){t([4,5,6,7]);var i=gbjs.TUPhom([0,1,2,3],n.getChildAt(0)).getCards();expect(i.map(e)).toEqual([4,5,6,7])}),it("Chặt đôi 2 bằng tứ quý",function(){t([4,5,6,7]);var i=gbjs.TUPhom([48,49],n.getChildAt(0)).getCards();expect(i.map(e)).toEqual([4,5,6,7])}),it("Chặt đôi 2 bằng 4 đôi thông",function(){t([0,1,4,5,8,9,12,13]);var i=gbjs.TUPhom([48,49],n.getChildAt(0)).getCards();expect(i.map(e)).toEqual([0,1,4,5,8,9,12,13])}),it("Chặt dọc khong thanh cong",function(){t([4,8,12]);var e=gbjs.TUPhom([0,4,8,12],n.getChildAt(0)).getCards();expect(e.length).toEqual(0)}),it("Chặt dọc",function(){t([4,8,12,16]);var i=gbjs.TUPhom([0,4,8,12],n.getChildAt(0)).getCards();expect(i.map(e)).toEqual([4,8,12,16])})}),this.gbjs=this.gbjs||{},function(){"use strict";gbjs.utils=gbjs.utils||{}}();