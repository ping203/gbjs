this.Global=this.Global||{},function(){"use strict";Global={autoFit:function(){var t=1280,e=720;_autoFit=function(){var i=window.innerWidth,a=window.innerHeight,r=i/t,n=a/e,s=r>n?n:r;s=s>1?1:s;var h=$("#main"),o=$("#gameplayStage"),d=(i-1e3*s)/2;return o.css({width:t*s,height:e*s,left:d+"px"}),h.css("zoom",s),{zoom:s}},_autoFit(),window.removeEventListener("resize",_autoFit,!0),window.addEventListener("resize",_autoFit,!0)},getParameterByName:function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)"),i=e.exec(location.search);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))},numberWithDot:function(t){if(isNaN(t))return 0;var e=t.toString().split(".");return e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g,"."),e.join(".")},_generateUniqueId:function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}()},getUniqueId:function(){var t=localStorage.getItem("___uniqueId___");return t||(t=this._generateUniqueId(),localStorage.setItem("___uniqueId___",t)),t},converEsObject:function(t){var e=t.data;if(e||(e=t),e){var i="{";for(var a in e){"{"!=i&&(i+=",");var r=e[a];i=i+'"'+a+'":'+JSON.stringify(r.value)}return i+="}",JSON.parse(i)}},convertData:function(t){var e={};for(var i in t)e[AppKeysConvert[i]?AppKeysConvert[i]:i]=t[i];return e},convertBettingToChip:function(t,e){if(isNaN(t)||isNaN(e))return[1];var i=Math.floor(t/e),a=ChipRatio.findIndex(function(t){return i>=t});0>a&&(a=ChipRatio.length);for(var r=[],n=ChipRatio.length;n>0;n--){var s=Math.floor(i/ChipRatio[n-1]);s>0&&r.push({type:n-1,number:s})}return r}}}(),function(t){"use strict";function e(t,e){var i=(65535&t)+(65535&e),a=(t>>16)+(e>>16)+(i>>16);return a<<16|65535&i}function i(t,e){return t<<e|t>>>32-e}function a(t,a,r,n,s,h){return e(i(e(e(a,t),e(n,h)),s),r)}function r(t,e,i,r,n,s,h){return a(e&i|~e&r,t,e,n,s,h)}function n(t,e,i,r,n,s,h){return a(e&r|i&~r,t,e,n,s,h)}function s(t,e,i,r,n,s,h){return a(e^i^r,t,e,n,s,h)}function h(t,e,i,r,n,s,h){return a(i^(e|~r),t,e,n,s,h)}function o(t,i){t[i>>5]|=128<<i%32,t[(i+64>>>9<<4)+14]=i;var a,o,d,c,l,u=1732584193,g=-271733879,f=-1732584194,C=271733878;for(a=0;a<t.length;a+=16)o=u,d=g,c=f,l=C,u=r(u,g,f,C,t[a],7,-680876936),C=r(C,u,g,f,t[a+1],12,-389564586),f=r(f,C,u,g,t[a+2],17,606105819),g=r(g,f,C,u,t[a+3],22,-1044525330),u=r(u,g,f,C,t[a+4],7,-176418897),C=r(C,u,g,f,t[a+5],12,1200080426),f=r(f,C,u,g,t[a+6],17,-1473231341),g=r(g,f,C,u,t[a+7],22,-45705983),u=r(u,g,f,C,t[a+8],7,1770035416),C=r(C,u,g,f,t[a+9],12,-1958414417),f=r(f,C,u,g,t[a+10],17,-42063),g=r(g,f,C,u,t[a+11],22,-1990404162),u=r(u,g,f,C,t[a+12],7,1804603682),C=r(C,u,g,f,t[a+13],12,-40341101),f=r(f,C,u,g,t[a+14],17,-1502002290),g=r(g,f,C,u,t[a+15],22,1236535329),u=n(u,g,f,C,t[a+1],5,-165796510),C=n(C,u,g,f,t[a+6],9,-1069501632),f=n(f,C,u,g,t[a+11],14,643717713),g=n(g,f,C,u,t[a],20,-373897302),u=n(u,g,f,C,t[a+5],5,-701558691),C=n(C,u,g,f,t[a+10],9,38016083),f=n(f,C,u,g,t[a+15],14,-660478335),g=n(g,f,C,u,t[a+4],20,-405537848),u=n(u,g,f,C,t[a+9],5,568446438),C=n(C,u,g,f,t[a+14],9,-1019803690),f=n(f,C,u,g,t[a+3],14,-187363961),g=n(g,f,C,u,t[a+8],20,1163531501),u=n(u,g,f,C,t[a+13],5,-1444681467),C=n(C,u,g,f,t[a+2],9,-51403784),f=n(f,C,u,g,t[a+7],14,1735328473),g=n(g,f,C,u,t[a+12],20,-1926607734),u=s(u,g,f,C,t[a+5],4,-378558),C=s(C,u,g,f,t[a+8],11,-2022574463),f=s(f,C,u,g,t[a+11],16,1839030562),g=s(g,f,C,u,t[a+14],23,-35309556),u=s(u,g,f,C,t[a+1],4,-1530992060),C=s(C,u,g,f,t[a+4],11,1272893353),f=s(f,C,u,g,t[a+7],16,-155497632),g=s(g,f,C,u,t[a+10],23,-1094730640),u=s(u,g,f,C,t[a+13],4,681279174),C=s(C,u,g,f,t[a],11,-358537222),f=s(f,C,u,g,t[a+3],16,-722521979),g=s(g,f,C,u,t[a+6],23,76029189),u=s(u,g,f,C,t[a+9],4,-640364487),C=s(C,u,g,f,t[a+12],11,-421815835),f=s(f,C,u,g,t[a+15],16,530742520),g=s(g,f,C,u,t[a+2],23,-995338651),u=h(u,g,f,C,t[a],6,-198630844),C=h(C,u,g,f,t[a+7],10,1126891415),f=h(f,C,u,g,t[a+14],15,-1416354905),g=h(g,f,C,u,t[a+5],21,-57434055),u=h(u,g,f,C,t[a+12],6,1700485571),C=h(C,u,g,f,t[a+3],10,-1894986606),f=h(f,C,u,g,t[a+10],15,-1051523),g=h(g,f,C,u,t[a+1],21,-2054922799),u=h(u,g,f,C,t[a+8],6,1873313359),C=h(C,u,g,f,t[a+15],10,-30611744),f=h(f,C,u,g,t[a+6],15,-1560198380),g=h(g,f,C,u,t[a+13],21,1309151649),u=h(u,g,f,C,t[a+4],6,-145523070),C=h(C,u,g,f,t[a+11],10,-1120210379),f=h(f,C,u,g,t[a+2],15,718787259),g=h(g,f,C,u,t[a+9],21,-343485551),u=e(u,o),g=e(g,d),f=e(f,c),C=e(C,l);return[u,g,f,C]}function d(t){var e,i="";for(e=0;e<32*t.length;e+=8)i+=String.fromCharCode(t[e>>5]>>>e%32&255);return i}function c(t){var e,i=[];for(i[(t.length>>2)-1]=void 0,e=0;e<i.length;e+=1)i[e]=0;for(e=0;e<8*t.length;e+=8)i[e>>5]|=(255&t.charCodeAt(e/8))<<e%32;return i}function l(t){return d(o(c(t),8*t.length))}function u(t,e){var i,a,r=c(t),n=[],s=[];for(n[15]=s[15]=void 0,r.length>16&&(r=o(r,8*t.length)),i=0;16>i;i+=1)n[i]=909522486^r[i],s[i]=1549556828^r[i];return a=o(n.concat(c(e)),512+8*e.length),d(o(s.concat(a),640))}function g(t){var e,i,a="0123456789abcdef",r="";for(i=0;i<t.length;i+=1)e=t.charCodeAt(i),r+=a.charAt(e>>>4&15)+a.charAt(15&e);return r}function f(t){return unescape(encodeURIComponent(t))}function C(t){return l(f(t))}function v(t){return g(C(t))}function m(t,e){return u(f(t),f(e))}function p(t,e){return g(m(t,e))}function T(t,e,i){return e?i?m(e,t):p(e,t):i?C(t):v(t)}"function"==typeof define&&define.amd?define(function(){return T}):"object"==typeof module&&module.exports?module.exports=T:t.md5=T}(this),this.TWIST=this.TWIST||{},function(){"use strict";TWIST.Observer=new EventEmitter}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(e,i){return this instanceof t?(this.card=i,this.parent=this.card.parent,this.value=this.card.getValue(),this.index=this.parent.getChildIndex(this.card),this.rank=this.getRank(this.value),this.handCards=this.parent.children,void(this.cardsFire=e)):new t(e,i)}var e=t.prototype;e.getCards=function(){var t,e=this,i=e.cardsFire;return e.value>e._getMinPush()&&2!=i.length&&1!=i.length?[]:(i.sort(function(t,e){return t>e}),1!==i.length?this.getRank(i[0])==this.getRank(i[1])?(t=this.getPhomSpecial(i),t>0?e._getArrSpecialSuit(t):2==i.length&&i[0]>47?e._getChatDoi2():e._getSelectNgang()):this._getDoc():i[0]>=48?e._getCardsChat2():[])},e._getCardsChat2=function(){var t=this._getTuQuy();return 0==t.length&&(t=this._getDoithong(4)),0==t.length&&(t=this._getDoithong(3)),t},e._getChatDoi2=function(){var t=this._getTuQuy();return 0==t.length&&(t=this._getDoithong(4)),t},e._getTuQuyTohon=function(){var t=this.cardsFire[0];return this.getRank(t)>this.rank?[]:this._getTuQuy()},e._getMinPush=function(){return this.handCards[this.handCards.length-1].getValue()},e._getSodoithongChon=function(t){return this.getRank(this.cardsFire[0])>this.rank?void 0:this._getDoithong(t)},e._getTuQuy=function(){var t=this,e=_.filter(t.handCards,function(e){return this.getRank(e.getValue())==t.rank});return e.length<4&&(e=[]),e},e._getDoithong=function(t){for(var e=[],i=this.rank,a=this.index,r=0;t>r;r++){for(var n=0,s=a+r;s<this.handCards.length&&(this.getRank(this.handCards[s].getValue())!=i||(n++,e.push(this.handCards[s]),2!=n));s++);if(2>n){e=[];break}i++}return e.length/2!=t&&(e=[]),e},e._getArrSpecialSuit=function(t){var e=[];switch(t){case 3:e=this._getDoithong(t),0==e.length&&(e=this._getTuQuy());break;case 4:e=this._getDoithong(t);break;case 5:e=this._getTuQuyTohon(),0==e.length&&(e=this._getDoithong(3))}return e},e._getSelectNgang=function(){var t=this,e=[],i=t.cardsFire.length;if(e=t.getCartsByRank(t.rank),e.length<i.length)return[];if(2==i&&this.getRank(t.cardsFire[0])==t.rank){var a=t.cardsFire[1]%4,r=e[0].getValue()%4,n=e[1].getValue()%4;n>r&&(r=n),a>r&&(e=[])}else t.rank>this.getRank(t.cardsFire[0])?(e=e.slice(0,i-1),-1==e.indexOf(t.card)&&e.push(t.card)):e=[];return e},e.getCartByRank=function(t){return _.find(this.handCards,function(e){return this.getRank(e.getValue())==t})},e.getCartsByRank=function(t){var e=this;return _.filter(this.handCards,function(i){return e.getRank(i.getValue())==t})},e.isUndefined=function(t){return"undefined"==typeof t},e._getDoc=function(){var t=this,e=[],i=t.card,a=t.rank,r=this.getRank(t.cardsFire[0]);if(r>a)return[];e.push(i);for(var n=1;n<this.cardsFire.length;n++){if(a++,i=_.find(t.handCards,function(e){if(this.getRank(e.getValue())==a){if(n!=t.cardsFire.length-1)return!0;if(e.getValue()>t.cardsFire[n])return!0}return!1}),this.isUndefined(i))return[];e.push(i)}return e},e.getRank=function(t){return Math.floor(t/4)},e.getPhomSpecial=function(t){var e,i,a=0;switch(t.length){case 4:e=this.getRank(t[0]),i=this.getRank(t[1]),e==i&&(a=5);break;case 6:e=this.getRank(t[0]),i=this.getRank(t[2]),e==i-1&&(a=3);break;case 8:e=this.getRank(t[0]),i=this.getRank(t[2]),e==i-1&&(a=4)}return a},TWIST.TLMNLogic=t}(),this.FATE=this.FATE||{},function(){"use strict";function t(t,i){return e?e:void this.init()}var e,i=t.prototype;i.init=function(){this.rooms=[]},FATE.MockupServer=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t){("number"!=typeof t||0>t||t>51)&&(t=-1),this.initialize(t)}function e(t){var e=Math.floor(t/4),i=Math.floor(t%4);return(0>t||t>=52)&&(e=-1,i=4),{rank:e,suite:i}}var i=location.origin+location.pathname+"../src/images/";t.size={width:88,height:115},t.userCard={width:53,height:69,seperator:59,cardDraggable:!0,selectedHeight:20,scale:.6},t.playerCard={width:29,height:37,seperator:0,cardDraggable:!1,scale:.33},t.draftCard={width:53,height:69,seperator:55,scale:.6},t.threeCards={width:54,height:73.8,seperator:55,scale:.6},t.threeCardsBanker={width:63,height:86.1,seperator:64,scale:.7},t.image={width:67*1.2,height:109.2},t.bai={width:67,height:91,seperator:70,baiDraggable:!0,selectedHeight:30},t.bacay={width:67,height:91,seperator:72,baiDraggable:!0,selectedHeight:30},t.bacayOther={width:35,height:45,seperator:39,baiDraggable:!1},t.chinesePoker={width:53.6,height:72.8,seperator:60,baiDraggable:!0,selectedHeight:30},t.chinesePokerOther={width:35,height:45,seperator:39,baiDraggable:!1},t.baiOther={width:35,height:45,seperator:0,baiDraggable:!1},t.baiLoc={width:18,height:24,seperator:.2,baiDraggable:!1,defaultValue:52},t.baiDraft={width:35,height:45,seperator:21,baiDraggable:!1},t.baiDown={width:54,height:72,seperator:21,baiDraggable:!1,selectedHeight:30},t.newImage={width:30.24,height:40.32,seperator:21,baiDraggable:!1,selectedHeight:30},t.shadow=new createjs.Shadow("#0ff",0,0,10),t.Suite={3:0,2:1,1:3,0:2,4:4},t.NumberCardInHand=13,t.SuitMap=["♠","♣","♦","♥"],t.SuitNameMap=["b","t","r","c"],t.SuitImageIndex=["♠","♣","♦","♥"];var a=t.prototype=new createjs.Container;a.container_initialize=a.initialize,a.initialize=function(t){this.container_initialize(),this.setValue(t)},a.setValue=function(a){var r=e(a);this.cardValue=a,this.rank=r.rank,this.suite=r.suite;var n=new Image;n.src=(TWIST.imagePath.imagePath||i)+"card/cards.png";var s=new createjs.Bitmap(n);if(s.sourceRect=$.extend({},t.size),-1!==a){t.RankMapIndex=t.RankMapIndex||["1","2","3","4","5","6","7","8","9","10","11","12","13"];var h=t.RankMapIndex[r.rank];t.SuitMap[r.suite];s.sourceRect.x=(h-1)*t.size.width,s.sourceRect.y=r.suite*t.size.height}else s.sourceRect.x=0,s.sourceRect.y=t.size.height*t.SuitNameMap.length;this.inPhom=new createjs.Bitmap(n),this.inPhom.sourceRect={width:25,height:25,x:1*t.size.width,y:t.size.height*t.SuitNameMap.length},this.inPhom.set({x:55,y:10}),this.inPhom.visible=!1,this.border=new createjs.Bitmap(n),this.border.sourceRect={width:t.size.width,height:t.size.height,x:2*t.size.width,y:t.size.height*t.SuitNameMap.length},this.border.set({x:-2,y:-1.5}),this.border.visible=this.showBorder,this.addChild(s)},a.getValue=function(){return this.cardValue},a.removeAllSelected=function(){this.parent.children.forEach(function(t,e){t.setSelected(!1)})},a.baiTrenTay=function(e,i,a){if(i){var r=e.cardValue?e.cardValue:t.baiLoc.defaultValue,n=this.pos||i.children.length,s="card"+r;if(a){var h=0+n*t.bai.seperator,o=this.selected?-t.bai.selectedHeight:0;i.multiSelectCard&&(e.IsDraggable=!0,this.multiSelect=!0),this.set({name:s,cardValue:r,x:h,y:o,width:t.baiOther.width,height:t.baiOther.height,scaleX:t.baiOther.width/t.image.width,scaleY:t.baiOther.height/t.image.height}),this.bindEventListener()}else{e&&e.IsFlip?(this.name=s,this.setValue(r)):this.name=n;var d=0+n*t.baiOther.seperator;this.set({x:d,y:0,cardValue:r,width:t.baiOther.width,height:t.baiOther.height,scaleX:t.baiOther.width/t.image.width,scaleY:t.baiOther.height/t.image.height})}this.pos=n,i.addChildAt(this,n)}},a.danhBai=function(e,i,a){if(i){var r=i.children,n=r.length;this.removeAllEventListeners(),this.set({x:n*t.baiDraft.seperator,y:0,width:t.baiDraft.width,height:t.baiDraft.height,scaleX:t.baiDraft.width/t.image.width,scaleY:t.baiDraft.height/t.image.height}),i.addChild(this)}},a.openCard=function(e,i){var a=this.x;return createjs.Tween.get(this).to({scaleX:.1,x:a+this.width/2},150).call(function(){this.setValue(e),this.cardValue=e}).to({scaleX:t.userCard.scale,x:a},150).call(function(){this.setInPhom(this.isInPhom),"function"==typeof i&&i()})},a.tipOff=function(){if(this.IsFlip!==!1){var e=this.x;return this.removeAllEventListeners(),createjs.Tween.get(this).to({scaleX:.1,x:e+this.width/2},150).call(function(){this.setValue(-1)}).to({scaleX:t.draftCard.scale,x:e},150).call(function(){this.filters=[new createjs.ColorMatrixFilter(new createjs.ColorMatrix(0,0,0,0))];try{this.updateCache()}catch(t){console.log(t)}})}},a.movePosition=function(t){this.parent&&createjs.Tween.get(this).to({x:t.x,y:t.y},150).call(function(){})},a.setSelected=function(e){if(e){var i=-t.userCard.selectedHeight;createjs.Tween.get(this).to({y:i},100).call(function(){this.selected=!0})}else this.selected=!1,this.y=0},a.toggedSelected=function(){var t=this;if(this.isSelected)this.isSelected=!1,this.y=this.y+15,t.parent.swapCardX=void 0,t.parent.swapCardY=void 0,t.parent.selectedCard=void 0;else{var e=this.y-15;t.parent.setChildIndex(t,12),t.isSelected=!0,createjs.Tween.get(this).to({y:e},100).call(function(){t.parent.selectedCard=t})}},a.setDraggable=function(t){var e=this;this.removeAllEventListeners("mousedown"),this.removeAllEventListeners("pressmove"),this.removeAllEventListeners("pressup"),t&&(this.addEventListener("mousedown",function(t){e.startPositionX=e.x,e.startPositionY=e.y,e.startMousePositionX=t.stageX,e.startMousePositionY=t.stageY,e.parent.addChild(e)}),this.addEventListener("pressmove",function(t){e.parent.addChild(e);var i=t.stageX-e.startMousePositionX,a=t.stageY-e.startMousePositionY;if(!(Math.abs(i)+Math.abs(a)<=10)){e.isDragging=!0,e.x=e.startPositionX+i,e.y=e.startPositionY+a;var r=e.parent,n=r.indexLeft,s=r.globalToLocal(t.stageX-n,t.stageY);if(s.y>0&&s.y<=e.height){var h=Math.floor(s.x/e.seperator);if(h=0>h?0:h>=r.children.length-1?r.children.length-1:h,h!=e.position){var o=(Math.abs(h-e.position),(h-e.position)/Math.abs(h-e.position));r.children.forEach(function(t,i){(t.position-h)*(t.position-e.position)<=0&&t.position!=e.position&&(t.position-=o,t.moveToPosition(t.position))})}e.position=h}}}),this.addEventListener("pressup",function(t){e.isDragging&&(e.selected=!1,e.moveToPosition(e.position),e.parent.children.sort(function(t,e){return t.position-e.position})),e.isDragging=!1}))},a.moveTo=function(t,e,i){createjs.Tween.get(this).to({x:t,y:e},100,createjs.Ease.sineOut()).call(function(){})},a.moveToPosition=function(e,i){e=e||this.position||0;var a=this.parent.indexLeft||0,r=this.seperator||t.userCard.seperator,n=a+r*e;this.moveTo(n,0,i)},a.setInPhom=function(t){t?this.inPhom.visible=!0:this.inPhom.visible=!1},a.setClick=function(t){this.removeAllEventListeners("click"),t&&this.addEventListener("click",function(t){var e=t.target.parent;e.isDragging||(e.parent.selectedCard&&e.parent.selectedCard.cardValue!=e.cardValue?($rootScope.playerEvent={evt:"swapSelected",data:[e.parent.selectedCard.cardValue,e.cardValue]},$rootScope.digest()):e.toggedSelected())})},a.bindMouseOver=function(t){var e=this;return this.removeAllEventListeners("mouseover"),this.removeAllEventListeners("mouseout"),t?void this.addEventListener("mouseover",function(t){console.log("moserOver ",e.cardValue)}):void 0},a.bindEventListener=function(){this.removeAllEventListeners("click");var t=this;this.addEventListener("click",function(e){t.isDragging||(t.selected||TWIST.Observer.emit("cardSelected",t),t.setSelected(!t.selected))})},a.bindOpenCard=function(){this.removeAllEventListeners("click");var t=this;this.addEventListener("click",function(e){try{t.isDragging||t.openCard(t.cardValue)}catch(e){console.warn(e)}})},a.Overlay=function(){this.isOverlay=!0,this.filters=[new createjs.ColorMatrixFilter(new createjs.ColorMatrix(0,-60,0,0))],this.cache(0,0,90,122)},a.UnOverlay=function(){this.isOverlay=!1,this.filters=[new createjs.ColorMatrixFilter(new createjs.ColorMatrix(0,0,0,0))],this.updateCache()},a.addMouseMoveEvent=function(){this.card.IsDraggable&&!this.card.IsInPhom&&(this.addEventListener("mouseover",function(t){}),this.addEventListener("mouseout",function(t){}))},a.hightLight=function(){this.showBorder=!0,this.border.visible=!0},TWIST.Card=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t){this.initialize(t)}location.origin+location.pathname+"../src/images/";t.playerPositions={4:[{x:12,y:410},{x:790,y:160},{x:450,y:17},{x:110,y:160}],2:[{x:12,y:410},{x:583,y:17}],5:[{x:12,y:410},{x:1110,y:184},{x:783,y:17},{x:383,y:17},{x:71,y:193}],9:[{x:380,y:410},{x:970,y:540},{x:1090,y:320},{x:1e3,y:140},{x:783,y:67},{x:383,y:67},{x:170,y:140},{x:70,y:320},{x:160,y:540}],6:[{x:550,y:410},{x:1080,y:400},{x:1080,y:170},{x:550,y:70},{x:130,y:170},{x:130,y:400}]},t.handPositions={center:{x:150,y:-110,align:"center"},left:{x:-50,y:20,align:"left"},right:{x:150,y:-110,align:"center"}},t.draftPositions={};var e=t.prototype=new createjs.Container;e.container_initialize=e.initialize,t.width=1e3,t.height=580,t.position={x:(t.width-TWIST.Card.playerCard.width)/2,y:(t.height-TWIST.Card.playerCard.height)/2},t.draftPosition={x:t.width/2,y:t.height/5,rotateDeg:0},e.initialize=function(t){this.container_initialize();this.gameType=t||{},this.config={},this.initPosition(t);var e=this.createDeckCard(),i=this.createRemainingTime(),a=this.createRemainingCard(),r=this.createDraftCards();this.addChild(e,r,i,a)},e.createDeckCard=function(){return this.deckCard=new createjs.Container,this.deckCard.set({x:t.position.x-20,y:t.position.y-60,visible:!1}),this.deckCard},e.createRemainingTime=function(){return this.remainingTime=new createjs.Text("","bold 50px Roboto Condensed","white"),this.remainingTime.set({x:t.position.x-10,y:t.position.y+40,visible:!1,textAlign:"center"}),this.remainingTime},e.createRemainingCard=function(){return this.remainingCard=new createjs.Text("","bold 30px Roboto Condensed","greenyellow"),this.remainingCard.set({x:this.deckCard.x+35,y:this.deckCard.y+65,textAlign:"center",textBaseline:"bottom"}),this.remainingCard},e.createDraftCards=function(){return this.draftCards=new createjs.Container,this.draftCards.set({x:t.draftPosition.x,y:t.draftPosition.y}),this.draftCards},e.initPosition=function(e){for(var i=e.maxUser||4,a=new Array(i),r=new Array(i),n=new Array(i),s=0;i>s;s++)a[s]={x:0,y:0},n[s]={x:50,y:50},r[s]={x:110,y:10,align:"left"};4===i&&(a=t.playerPositions[i],r[0]={x:150,y:-50,align:"center"},r[1]={x:-50,y:20,align:"right"}),this.config.playerPositions=a,this.config.handPositions=r,this.config.draftPositions=n},e.generateCards=function(t){t=t||0;for(var e=0;t>e;e++){var i=new TWIST.Card,a=TWIST.Card.playerCard.scale;i.set({scaleX:a,scaleY:a}),this.deckCard.addChild(i)}this.deckCard.visible=!0},e.generateDealCards=function(t){t=t||0;for(var e=0;t>e;e++){var i=new TWIST.Card;i.set({scaleX:.5,scaleY:.5}),this.deckCard.addChild(i)}this.deckCard.visible=!0},e.scaleDeckCard=function(t){for(var e=this.deckCard.children,i=0;i<e.length;i++){var a=e[i];a.set({scaleX:.3,scaleY:.3})}},e.renderDraftCards=function(t){for(var e=0;e<t.length;e++){var i=new TWIST.Card(t[e]),a=TWIST.Card.baiDraft.seperator*e,r=0;i.set({x:a,y:r,scaleX:TWIST.Card.baiDraft.width/TWIST.Card.image.width,scaleY:TWIST.Card.baiDraft.height/TWIST.Card.image.height}),TWIST.Card.addChild(i)}},e.getCard=function(){var t;return t=this.deckCard.children.pop(),t.set({x:this.deckCard.x,y:this.deckCard.y}),t},e.setRemainingTime=function(t){var e=t>1e3?t:1e3*t,i=(new Date).getTime(),a=this.remainingTime;a.visible=!0,e>0?(this.remainingTimeTween&&(this.remainingTimeTween.removeAllEventListeners(),a.text=""),this.remainingTimeTween=createjs.Tween.get(a).to({},e,createjs.Ease.linear).call(function(){a.text=""}),this.remainingTimeTween.addEventListener("change",function(){var t=(new Date).getTime();a.text=Math.floor((e-(t-i))/1e3)})):this.remainingTimeTween&&(this.remainingTimeTween.removeAllEventListeners(),a.text="")},e.clearRemainingTime=function(){this.remainingTimeTween&&this.remainingTimeTween.removeAllEventListeners(),this.remainingTime.text=""},e.clear=function(){this.deckCard.removeAllChildren(),this.draftCards.removeAllChildren(),this.deckCard.visible=!1,this.remainingCard.text=""},e.tipOff=function(){for(var t=this.draftCards.children,e=0;e<t.length;e++)t[e].cardValue>-1&&t[e].tipOff()},e.overlayDraftCards=function(){for(var t=this.draftCards.children,e=0;e<t.length;e++)t[e].cardValue>-1&&t[e].Overlay()},e.removeOverlayCards=function(){for(var t=this.draftCards.children,e=0,i=t.length;i>e;e++)t[e]&&t[e].isOverlay&&(t.splice(e,1),e--)},e.setZeroVetical=function(){var t=(this.draftCard,this.draftCards.children);t.forEach(function(t,e){t.moveTo(t.x,0)})},TWIST.Desk=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t){this.set({startTime:0,totalTime:0,remainingTime:0,currentTimer:0}),this.initialize(t)}var e=t.prototype=new createjs.Container;e.Container_initialize=e.initialize,e.initialize=function(t){this.Container_initialize(),$.extend(this,t),this.timerLine=new createjs.Shape,this.addChild(this.timerLine),this.startAngle=0,this.endAngle=0},e.drawPercentRect=function(t){this.timerLine.graphics.clear(),this.startAngle=1*-Math.PI/2,this.endAngle=1*-Math.PI/2+t*Math.PI*2,this.timerLine.graphics.s("#fee802").ss(this.strokeThick).arc(this.radius,this.radius,this.radius,this.startAngle,this.endAngle,!1)},e.setCounter=function(t,e){this.totalTime=t||2e4,this.remainingTime=e||2e4,this.startTime=(new Date).getTime()-(this.totalTime-this.remainingTime),this.currentTimer=(this.totalTime-this.remainingTime)/this.totalTime},e.clearTimer=function(){this.tween&&this.tween.removeAllEventListeners(),this.timerLine.graphics.clear(),this.totalTime=0,this.remainingTime=0,this.currentTimer=0,this.callback&&delete this.callback},e.tick=function(){return this.currentTimer=((new Date).getTime()-this.startTime)/this.totalTime,this.currentTimer>=1?void this.clearTimer():void this.drawPercentRect(this.currentTimer)},e.startTimer=function(t,e){this.clearTimer(),this.setCounter(t,e);var i=this;this.tween=createjs.Tween.get(this.timerLine).to({},e).call(function(){i.clearTimer()});var i=this;this.tween.addEventListener("change",function(){i.tick()})},TWIST.Timer=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t){this.initialize(t)}var e=location.origin+location.pathname+"../src/images/",i=300;t.Defaults={UserName:"username",Position:0},t.usernameConfig={x:0,y:70,width:100,height:40},t.avatarConfig={x:15,y:0,radius:35,innerRadius:33,AvatarDefault:e+"avatars/1.png"},t.handConfig={x:100,y:100},t.draftCardsConfig={x:100,y:100,align:"left"};var a=t.prototype=new createjs.Container;a.contructor_initialize=a.initialize,a.initialize=function(t){this.contructor_initialize(),$.extend(this,t),this.initCanvas()},a.initCanvas=function(){var e=this,i=this.config||{},a=i.avartar||t.avatarConfig;this.initUsername(i,e),this.initAvatar(i,e),this.initDraftCards(i,e),this.initHandCards(i,e),this.initChatMessage(i,e),this.initMoneyEffect(i,e),this.initStatus(i,e),this.timer=new TWIST.Timer({x:a.x,y:a.y,radius:a.radius,strokeThick:10}),this.addChild(this.timer,this.avatarContainer,this.usernameContainer,this.draftCards,this.hand,this.status,this.chat,this.moneyChangeEffect),this.render()},a.initUsername=function(e,i){var a=new createjs.Container,r=e.username||t.usernameConfig;$.extend(a,r);var n=new createjs.Text(this.username,"18px Roboto Condensed","white");n.set({x:50,y:20,textAlign:"center",textBaseline:"bottom"});var s=new createjs.Text(this.money,"14px Roboto Condensed","#f3ba04");s.set({x:50,y:40,textAlign:"center",textBaseline:"bottom"});var h=new createjs.Shape;h.graphics.beginFill("black").drawRoundRectComplex(0,0,r.width,r.height,10,10,10,10),h.alpha=.2,a.addChild(h,n,s),this.usernameContainer=a},a.initAvatar=function(i,a){var r=new createjs.Container,n=i.avartar||t.avatarConfig,s=2*n.innerRadius;$.extend(r,n);var h=new Image,o=md5(this.username),d=parseInt((o.match(/\d+/)[0]||1)[0])||10;h.src=(TWIST.imagePath||e)+"player/avatars/"+d+".png";var c=new createjs.Bitmap(h);h.onload=function(){c.set({width:s,height:s,scaleX:s/h.width,scaleY:s/h.height})},c.set({x:n.radius-n.innerRadius,y:n.radius-n.innerRadius});var l=new createjs.Shape;l.graphics.drawCircle(n.radius,n.radius,n.innerRadius),c.mask=l;var u=new createjs.Shape;u.graphics.beginFill("#000").drawCircle(n.radius,n.radius,n.radius),u.set({alpha:.7});var g=new Image;g.src=(TWIST.imagePath||e)+"player/icon_chuphong.png";var f=new createjs.Bitmap(g);f.set({x:.7*s,y:.7*s,name:"roomMaster",visible:this.isRoomMaster});var C=.3*s;g.onload=function(){f.set({width:C,height:C,scaleX:C/g.width,scaleY:C/g.height})};var v=new createjs.Shape;v.graphics.beginFill("#fff").drawRect(0,0,s,s),r.hitArea=v,r.addChild(u,c,f),this.avatarContainer=r},a.initDraftCards=function(e,i){var a=e.draftCards||t.draftCardsConfig;this.draftCards=new createjs.Container,$.extend(this.draftCards,a)},a.initHandCards=function(e,i){var a=e.handPositions||t.handConfig;this.hand=new createjs.Container,$.extend(this.hand,a);var r=TWIST.Card.playerCard,n=(r.width-3)/2;this.handCards=new createjs.Container,this.numberOfCards=new createjs.Container,this.numberOfCards.set({x:0,y:0});var s=new createjs.Shape;s.graphics.beginFill("#000").drawCircle(r.width/2,r.height/2,n),s.set({alpha:.3,visible:!1});var h=new createjs.Text("",1.5*n+"px Roboto Condensed","#7fc100");h.set({x:r.width/2,y:r.height/2,textAlign:"center",visible:!1,name:"numberOfCard",textBaseline:"middle"}),this.numberOfCards.addChild(s,h),this.hand.addChild(this.handCards,this.numberOfCards)},a.initChatMessage=function(t,e){this.chat=new createjs.Container,this.chat.set({name:"chat"});var i=new createjs.Text("","22px Roboto Condensed","#000");i.set({textAlign:"center",textBaseline:"bottom"});var a=new createjs.Shape;this.chat.addChild(a,i)},a.initMoneyEffect=function(t,e){this.moneyChangeEffect=new createjs.Container,this.moneyChangeEffect.set({name:"moneyChangeEffect",x:50,y:50});var i=new createjs.Text("","30px Roboto Condensed","black");i.set({x:1,y:11,textAlign:"center",textBaseline:"bottom"});var a=new createjs.Text("","30px Roboto Condensed");a.set({x:0,y:10,textAlign:"center",textBaseline:"bottom"}),a.shadow=new createjs.Shadow("#000",0,0,10),this.moneyChangeEffect.addChild(i,a)},a.initStatus=function(t,e){this.status=new createjs.Container,this.status.set({x:50,y:50});var i=new createjs.Text,a=new createjs.Text;this.status.addChild(i,a)},a.render=function(t){this.setPlayerName(this.username),this.setMoney(this.money),this.setRoomMaster(this.isRoomMaster)},a.setRemainingTime=function(t,e){t=t||2e4,e=e||2e4,this.timer.startTimer(e,t)},a.clearTimer=function(t,e){this.timer.clearTimer()},a.setPlayerName=function(e){var i=this.usernameContainer,a=i.getChildAt(1);a.text=e;var r=a.getMeasuredWidth(),n=t.usernameConfig.width;if(r>n){var s=n/r,h=Math.round(a.text.length*s)-3;a.text=a.text.substring(0,h)+"..."}},a.setMoney=function(t){var e=this.usernameContainer;this.money=t;var i=e.getChildAt(2);i.text=Global.numberWithDot(t)},a.setRoomMaster=function(t,e){void 0===typeof t?t=this.isRoomMaster:this.isRoomMaster=t;var a=this.avatarContainer.getChildByName("roomMaster");if(a.visible=t,t){var r={scaleX:a.scaleX,scaleY:a.scaleY};a.set({scaleX:1,scaleY:1});var n=a.globalPosition=a.globalToLocal(0,0);if(a.set(r),e){var s={x:a.x,y:a.y},h={x:s.x+n.x-e.x,y:s.y+n.y-e.y};a.set(h),createjs.Tween.get(a).to({x:s.x,y:s.y},i).call(function(){})}}return a},a.clearHand=function(){this.handCards.removeAllChildren();var t=this.hand.getChildAt(1),e=this.hand.getChildAt(2);t.visible=!1,e.visible=!1},a.clearDraftCards=function(){this.draftCards&&this.draftCards.removeAllChildren()},a.clearShowPhomArea=function(){this.showPhomArea&&this.showPhomArea.removeAllChildren()},a.setPlayerStatus=function(t,e){var i=this.status,a=i.getChildAt(1),r=i.getChildAt(0);return t&&t.length?(e||(e={}),e.color=e.color||"yellowgreen",e.font=e.font||"bold 20px Roboto Condensed",e.x=e.x||0,e.y=e.y||10,e.textAlign=e.textAlign||"center",e.textBaseline=e.textBaselinex||"bottom",$.extend(a,e),$.extend(r,e),i.visible=!0,a.text=r.text=t,a.shadow=new createjs.Shadow("black",0,0,10),r.x=e.x+1,r.y=e.y+1,void(r.color="black")):void(i.visible=!1)},a.renderCards=function(t){var e=this.hand;e.visible=!0,this._renderHandCards(this.handCards.cardList,t);var i=this;this.hideCardLength?this.numberOfCards.visible=!1:setTimeout(function(){i.setNumberCards(i.handCards.cardList.length)},1e3)},a._renderHandCards=function(t,e){e=e||{},this.handCards.removeAllChildren();for(var i,a=(this.handCards,e.cardType||(0==this.position?TWIST.Card.userCard:TWIST.Card.playerCard),t.length),r=this.parent.parent.getChildAt(1),n=150,s=30,h=!("undefined"==typeof e.reSort),o=0;a>o;o++){var d;t[o];d=r.getCard(),d||(d=new TWIST.Card),d.cardValue=t[o],d.position=o,i=n+o*s,$.extend(e,{animationTime:i}),o!=a-1||h||(e.reSort=!0),this.addHandCards(d,e)}},a.setNumberCards=function(t){var e=this.numberOfCards.getChildAt(0),i=this.numberOfCards.getChildAt(1);0!==this.position&&t>0?(e.visible=!0,i.visible=!0,i.text=t):(e.visible=!1,i.visible=!1)},a.addHandCards=function(t,e){var a=e.animationTime||i,r=e.reSort||!1,n=this.handCards,s=this,h=TWIST.Card.draftCard,o=(t.pos||n.children.length,t.x,t.y,e.cardType||(0===this.position?TWIST.Card.userCard:TWIST.Card.playerCard));if(t.set({x:t.x-this.x-this.hand.x,y:t.y-this.y-this.hand.y,scaleX:h.scale,scaleY:h.scale}),this.listPhom&&this.listPhom.length&&t.cardValue&&0==this.position){var d=[];this.listPhom.forEach(function(t,e){d=d.concat(t.meldItem)}),t.isInPhom=d.indexOf(t.cardValue)>-1}n.addChild(t),createjs.Tween.get(t).to({x:isNaN(e.x)?o.seperator*n.getNumChildren():e.x,y:isNaN(e.y)?0:e.y,width:o.width,height:o.height,position:n.getNumChildren()-1,seperator:o.seperator,scaleX:o.scale,scaleY:o.scale},a,createjs.Ease.sineOut()).call(function(){0==s.position?(e.sideDown?this.bindOpenCard():(this.bindEventListener(),e.dragable&&this.setDraggable(!0)),e.sideDown||this.openCard(this.cardValue),e.sortPhom&&s.sortPhom(),r&&s.sortCard()):(this.visible=e.showPlayerCard,e.openCard&&this.openCard(this.cardValue))})},a.showThreeCards=function(){for(var t=this.handCards.children,e=0;e<t.length;e++){var i=t[e];i.openCard(i.cardValue),i.removeAllEventListeners()}},a.getDeckCard=function(t,e){e=e||{};var i=this.parent.parent.getChildByName("desk"),a=i.getCard();a.cardValue=t,$.extend(e,{animationTime:200,reSort:!0,dragable:!0}),this.addHandCards(a,e),this.markEatedCard()},a.getChuong=function(t){var e=this;t=t||{};var a=this.avatarContainer,r=a.getChildByName("chuongIcon");if(t.isChuong){var n=r.x,s=r.y,h=t.x||640,o=t.y||360,d=h-this.x-this.avatarContainer.x,c=o-this.y-this.avatarContainer.y;r.set({x:d,y:c,visible:!0}),createjs.Tween.get(r).to({x:n,y:s},i).call(function(){e.playerModel.isBanker=!0})}else e.playerModel.isBanker=!1,r.set({visible:!1})},a.draftCardsInHand=function(t,e){var e=e||{},i=[],a=TWIST.Card.draftCard,i=this.getCardsInHand(t),r=e.draftCards||this.draftCards,n=e.position||{x:r.children.length*a.seperator,y:0};"right"!==this.draftCards.align||e.position||(n.x=300-n.x);
for(var s=0,h=i.length;h>s;s++){var o=i[s];o.cardValue=t[s];var d=$.extend(e,{draftCards:r,position:n,reSort:s===h-1});this.draftSingleCard(o,d),"right"!=this.draftCards.align||e.position?n.x+=a.seperator:n.x-=a.seperator}this.setNumberCards(this.handCards.children.length)},a.draftSingleCard=function(t,e){t.visible=!0,t.removeAllEventListeners();var a=this,r=TWIST.Card.draftCard,n=e.draftCards||this.draftCards,s=n.localToGlobal(0,0);t.set({x:t.x+this.hand.x+this.x-s.x,y:t.y+this.hand.y+this.y-s.y,rotation:e.rotateAble?30*(Math.random()-.5):0}),n.addChild(t),createjs.Tween.get(t).to({scaleX:1.2*t.scaleX,scaleY:1.2*t.scaleY},1*i/2).to({x:e.position.x,y:e.position.y,width:r.width,height:r.height,scaleX:r.scale,scaleY:r.scale},1*i/2).call(function(){0!==a.position?this.openCard(this.cardValue):e.reSort&&(this.setInPhom(!1),a.sortCard())})},a.sortDraftCards=function(){for(var t=this.draftCards.children,e=t.length,a=(1280-e*TWIST.Card.draftCard.seperator-2*(this.draftCards.x+this.x))/2,r=0;r<t.length;r++){var n=t[r],s=a+r*TWIST.Card.draftCard.seperator;createjs.Tween.get(n).to({x:s},i,createjs.Ease.sineOut()).call(function(){})}},a.getCardsInHand=function(t){if(t){var e=[],i=this.handCards.children,a=i.map(function(t){return t.cardValue});if(0!=this.position)for(var r=0;r<t.length;r++){var n=t[r],a=i.map(function(t){return t.cardValue});if(a.indexOf(n)>-1)var s=i.splice(a.indexOf(n),1);else var s=i.splice(a.indexOf(void 0),1);s[0]||(s[0]=new TWIST.Card),e=e.concat(s)}else for(var r=0;r<t.length;r++)for(var h=0;h<i.length;h++)t[r]==i[h].cardValue&&(e=e.concat(i.splice(h,1)),h--);return i.sort(function(t,e){return t.position-e.position}),i.forEach(function(t,e){t.position=e}),e.sort(function(t,e){return t.cardValue-e.cardValue}),e}},a.getSelectedCards=function(){var t=[],e=this.handCards.children;for(var i in e)e[i]&&1==e[i].selected&&t.push(e[i].cardValue);return t},a.sortPhom=function(t){t||(t=this.listPhom),t||(t=[]),t=t;for(var e=this.handCards.children,i=[],a=0;a<t.length;a++){var r=t[a].meldItem;r.sort(function(t,e){return t-e});for(var n=0;n<r.length;n++)i.push(r[n])}this.handCards.sortType||(this.handCards.sortType=""),"rankSort"==this.handCards.sortType?this.handCards.sortType="suiteSort":this.handCards.sortType="rankSort";var s=this;e.forEach(function(t,e){t.setInPhom(i.indexOf(t.cardValue)>-1)}),e.sort(function(t,e){return i.indexOf(t.cardValue)>-1&&!(i.indexOf(e.cardValue)>-1)?!1:i.indexOf(e.cardValue)>-1&&!(i.indexOf(t.cardValue)>-1)?!0:i.indexOf(t.cardValue)>-1&&i.indexOf(e.cardValue)>-1?i.indexOf(t.cardValue)-i.indexOf(e.cardValue):"rankSort"==s.handCards.sortType?t.cardValue-e.cardValue:t.suite==e.suite?t.rank-e.rank:t.suite-e.suite})},a.sortTL=function(){var t=this.handCards.children;this.handCards.sortType="rankSort"==this.handCards.sortType?"suiteSort":"rankSort";var e=this;t.sort(function(t,i){return"rankSort"==e.handCards.sortType?t.cardValue-i.cardValue:t.suite-i.suite||t.cardValue-i.cardValue}),this.sortCard()},a.sortCard=function(){function t(){var t=e.length,r=(TWIST.Desk.width-t*TWIST.Card.userCard.seperator-2*(a.hand.x+a.x))/2;a.handCards.indexLeft=r;for(var n=0;n<e.length;n++){var s=e[n];s.isDragging&&(s.isDragging=!1),s.selected=!1;var h=r+n*TWIST.Card.userCard.seperator;s.position=n,createjs.Tween.get(s).to({y:0,x:h},i,createjs.Ease.sineOut()).call(function(){})}}var e=this.handCards.children,a=this;setTimeout(t,100)},a.preparedShowPhom=function(){var t=this.listPhom,e=[];t=t;for(var i=0;i<t.length;i++){var a=t[i].meldItem;a.sort(function(t,e){return t-e});for(var r=0;r<a.length;r++)e.push(a[r])}for(var n=this.handCards.children,i=0;i<n.length;i++)i<e.length?!function(t){setTimeout(function(){t.setSelected(!0)},500)}(n[i]):n[i].setSelected(!1)},a.preparedSendCard=function(t){for(var e=this.handCards.children,i=0;i<e.length;i++){e[i].setSelected(!1);for(var a=0;a<t.length;a++)e[i].cardValue==t[a]&&!function(t){setTimeout(function(){t.setSelected(!0)},500)}(e[i])}},a.getLastDraftCards=function(t){if(t){for(var e=[],i=this.draftCards.children,a=0;a<t.length;a++)for(var r=0;r<i.length;r++)if(t[a]==i[r].cardValue){var n=i[r].localToGlobal(0,0);i[r].x=n.x,i[r].y=n.y,e=e.concat(i.splice(r,1)),r--}return e}},a.getDraftCardsAbsolutePosition=function(){return{x:this.x+this.draftCards.x,y:this.y+this.draftCards.y}},a.eatCard=function(t,e,a){this.playerModel.numberEatedCard++;var r=0==this.position?TWIST.Card.userCard:TWIST.Card.draftCard;if(t.hightLight(),0==this.position)this.addHandCards(t,{animationTime:200,reSort:!0,sortPhom:!0,dragable:!0}),this.markEatedCard();else{var n=r.seperator*this.draftCards.children.length,s=0;this.handCards.addChild(t),t.set({x:t.x-this.hand.x-this.x,y:t.y-this.hand.y-this.y}),s=0,n="right"==this.draftCards.align?0-this.hand.x+this.draftCards.x+300-(this.playerModel.numberEatedCard-1)*r.seperator:0-this.hand.x+this.draftCards.x+r.seperator*(this.playerModel.numberEatedCard-1),createjs.Tween.get(t).to({x:n,y:s,width:r.width,height:r.height,scaleX:r.scale,scaleY:r.scale},i,createjs.Ease.sineOut()).call(function(){})}},a.markEatedCard=function(){var t=[];if(this.listPhom){this.listPhom.forEach(function(e,i){t=t.concat(e.meldItem)});for(var e=this.handCards.children,i=0;i<e.length;i++)e[i].isInPhom=t.indexOf(e[i].cardValue)>-1,e[i].setInPhom(e[i].isInPhom)}},a.moveDraftCard=function(t,e){this.cardsEated++;for(var a=TWIST.Card.draftCard,r=0;r<t.length;r++){var n=t[r],s=(n.x,n.y,a.seperator*this.draftCards.children.length),h=0;this.draftCards.addChild(n),n.set({x:n.x+e.x-this.draftCards.x-this.x,y:n.y+e.y-this.draftCards.y-this.y}),"right"==this.draftCards.align&&(s=300-a.seperator*(this.draftCards.children.length-1));createjs.Tween.get(n).to({x:s,y:h,width:a.width,height:a.height,scaleX:a.scale,scaleY:a.scale},i,createjs.Ease.sineOut()).call(function(){})}},a.showPhom=function(t){for(var e=0;e<t.length;e++){var i=t[e].meldItem;this.showSinglePhom(i,e)}var a=this;setTimeout(function(){a.sortPhomArea()},550)},a.addShowPhomArea=function(t){var e=this.parent.parent.getChildByName("desk"),i=e.draftPosition[this.position],a=0;0==this.position&&(a=i.y-TWIST.Card.draftCard.height-10),this.showPhomArea=new createjs.Container,this.showPhomArea.set({name:"showPhomArea",x:i.x,y:a}),this.addChild(this.showPhomArea)},a.addChipContainer=function(t){var i=this.parent.parent.getChildByName("desk"),a=i.chipPosition[this.position];this.chipContainer=new createjs.Container,this.chipContainer.set({name:"chipContainer",x:a.x,y:a.y,width:117,height:42,visible:!0});var r=new createjs.Bitmap((TWIST.imagePath||e)+"player/money-container.png"),n=new createjs.Text("0","20px Roboto Condensed","white");n.set({x:45,y:30,textAlign:"center",textBaseline:"bottom"}),this.chipContainer.addChild(r,n),this.addChild(this.chipContainer)},a.pushChip=function(t,e,i){for(var a=this,r=0;e>r;r++){var n=new TWIST.Chip(t);this.chipContainer.addChild(n);var s=this.chipContainer.width-n.width;n.set({x:50-this.chipContainer.x,y:10-this.chipContainer.y}),createjs.Tween.get(n).wait(100*r).to({x:s,y:0},200).call(function(){var e=a.chipContainer.getChildAt(1),i=isNaN(parseInt(e.text))?0:parseInt(e.text);e.text=i+ChipValues[t]})}},a.pushChicken=function(t,e){function i(t,e){for(var i=0;t>i;i++){var s=new TWIST.Chip(e);r.chickenTotal.addChild(s);var h=r.chickenTotal.localToGlobal(0,0),o=a.localToGlobal(50,10);s.set({x:o.x-h.x,y:o.y-h.y}),createjs.Tween.get(s).wait(n+=100).to({x:140,y:50},200).call(function(){r.chickenTotal.removeChild(this);var t=r.chickenTotal.getChildAt(1),i=isNaN(parseInt(t.value))?0:parseInt(t.value);t.value=i+ChipValues[e],t.text="Tổng gà : "+t.value})}}var a=this,r=this.parent.parent.getChildByName("desk"),n=0;r.chickenTotal.visible=!0,console.log("chipArray",t);for(var s=0;s<t.length;s++)i(t[s].number,t[s].type)},a.showSinglePhom=function(t,e){if(t){for(var a=this.getCardsInHand(t),r=0;r<a.length;r++){var n=a[r];n.visible=!0,n.cardValue=t[r];var s=this,h=TWIST.Card.draftCard,o=this.showPhomArea,d=h.seperator*o.children.length,c=0;"right"==this.draftCards.align&&(d=300-h.seperator*o.children.length),this.showPhomArea.addChild(n),n.set({x:n.x+this.hand.x-o.x,y:n.y+this.hand.y-o.y}),n.removeAllEventListeners(),createjs.Tween.get(n).to({x:d,y:c,width:h.width,height:h.height,scaleX:h.scale,scaleY:h.scale},i,createjs.Ease.sineOut()).call(function(){this.setInPhom(!1),0!=s.position&&this.openCard(this.cardValue)})}return a}},a.addCardInShowPhom=function(t,e){var a=TWIST.Card.draftCard,r=t.x,n=t.y,s=a.seperator*this.showPhomArea.children.length,h=0,o=this.showPhomArea;this.showPhomArea.addChild(t),t.set({x:r+e.x-this.showPhomArea.x-this.x,y:n+e.y-this.showPhomArea.y-this.y,visible:!0}),"right"==this.draftCards.align&&(s=300-a.seperator*(o.children.length-1)),t.removeAllEventListeners(),createjs.Tween.get(t).to({x:s,y:h,width:a.width,height:a.height,scaleX:a.scale,scaleY:a.scale},i,createjs.Ease.sineOut()).call(function(){this.openCard(this.cardValue)})},a.sortPhomArea=function(){var t=this.showPhomArea.children,e=t.length,i=TWIST.Card.draftCard,a=i.seperator,r=e*a;this.isCurrent;r>300&&(r=300);var n=0;0==this.position&&(n=(1280-r-2*(this.showPhomArea.x+this.x))/2);for(var s=0;s<t.length;s++){var h=t[s],o=n+s*r/e;"right"==this.draftCards.align&&(o=300-r/e*s),createjs.Tween.get(h).to({x:o},100,createjs.Ease.sineOut()).call(function(){})}},a.showMoneyExchageEffect=function(t,e,a){var r=this.getChildByName("moneyChangeEffect");r.set({visible:!0,y:50});var n=r.getChildAt(0),s=r.getChildAt(1),h=Global.numberWithDot(Math.abs(parseInt(t)));"lose"===e?(s.color="red",n.text=s.text="- "+h):(s.color="yellow",n.text=s.text="+ "+h),createjs.Tween.get(r).to({y:a&&a.y?a.y:-20},i).call(function(){setTimeout(function(){r.visible=!1,s.text=""},2e3)})},a.setHandCardsValue=function(t){for(var e=this.handCards.children,i=0;i<t.length;i++){var a=e[i];a&&(a.cardValue=t[i])}},a.getHandCardAbsolutePosition=function(){return{x:this.x+this.hand.x+this.handCards.x,y:this.y+this.hand.y+this.handCards.y}},a.rerenderDraftPhom=function(t){if(t){console.log(t);for(var e=[],i=TWIST.Card.draftCard,a=0;a<t.length;a++){var r=new TWIST.Card(t[a]),n=i.seperator*a,s=0;"right"==this.draftCards.align&&(n=300-i.seperator*a),r.set({x:n,y:s,scaleX:i.scale,scaleY:i.scale}),this.draftCards.addChild(r)}return e}},a.hightLightEatCards=function(t){for(var e=this.handCards.children,i=0;i<e.length;i++)t.indexOf(e[i].cardValue)>-1&&e[i].hightLight();for(var e=this.showPhomArea.children,i=0;i<e.length;i++)t.indexOf(e[i].cardValue)>-1&&e[i].hightLight()},a.reEatCards=function(t){if(t){for(var e=[],i=TWIST.Card.draftCard,a=0;a<t.length;a++){var r=new TWIST.Card(t[a]),n=i.seperator*a,s=0;n="right"==this.draftCards.align?-0-this.handCards.x-this.hand.x+this.draftCards.x+300-a*i.seperator:0-this.handCards.x-this.hand.x+this.draftCards.x+a*i.seperator,r.set({x:n,y:s,scaleX:i.scale,scaleY:i.scale}),this.handCards.addChild(r)}return e}},a.showMessage=function(t){var e,a,r=this.getChildByName("chat"),n="rgba(255, 255, 0, 1)",s="rgba(0, 0, 0, 1)",h="rgba(0, 0, 0, 1)",o={};if(a=r.getChildAt(0),e=r.getChildAt(1),a.graphics.c(),e.set({color:n,text:t}),o.x=e.getMeasuredWidth(),o.y=e.getMeasuredHeight(),t&&t.length>28){var d=t.indexOf(" ",25);(25>d||d>35)&&(d=28),t=t.substring(0,d)+"\n"+t.substring(d),e.text=t;var c=e.clone();c.text=t.substring(0,d),o.x=c.getMeasuredWidth(),o.y=e.getMeasuredHeight()}e.set({x:o.x/2,y:(o.y+10)/5+18}),a.graphics.beginFill(s).beginStroke(h).setStrokeStyle(1).drawRoundRect(-10,-10,o.x+20,o.y+20,20);var l=this.hand.x<0?-(o.x+20):120,u=0;r.set({x:l,y:u,visible:!0}),createjs.Tween.get(r).to({alpha:1},i).to({x:l+1,y:u+1},100).to({x:l-1,y:u-2},100).to({x:l+1,y:u+1},100).to({x:l-1,y:u-2},100).to({x:l+1,y:u+1},100).to({x:l-1,y:u-2},100).wait(3500).to({alpha:0,visible:!1},500)},TWIST.Player=t}(),this.gbjs=this.gbjs||{},function(){"use strict";function t(t){this.parent=t,this.oldIndex,this.oldOffset,this.dragObj,this.dragIndex,this.newIndex,this.nextIndex,this.nextObj,this.cloneObj,this.space,t.on("mousedown",this._onDragStart,this),t.on("pressmove",this._onTouchMove,this),t.on("pressup",this._onDragOver,this)}t.active=!1,t.prototype._onDragStart=function(t){var e=t.target;if(this.dragObj=e,this.space)return!0;var i=e.parent.getChildAt(0),a=e.parent.getChildAt(1);i&&a&&(this.space=a.x-i.x)},t.prototype._dragStarted=function(e){var i=e.target;i.offset={x:i.x-e.stageX,y:i.y-e.stageY},i.draggable=!0,t.active=this,this.updateDragIndex(),this.cloneObj=i.clone()},t.prototype.updateDragIndex=function(){var t=this.parent.getChildAt(this.parent.numChildren-1);t!=this.dragObj&&this.parent.addChild(this.dragObj)},t.prototype._onTouchMove=function(e){if(this.dragObj){t.active||this._dragStarted(e);var i=e.target,a=this.parent.children,r=e.stageX+i.offset.x,n=e.stageY+i.offset.y;this.updateDragIndex(),i.x=r,i.y=n,0>r&&(r=0);var s=Math.round(r/this.space);s>=a.length&&(s=a.length-1),s!=this.newIndex&&(this.newIndex=s,this._sort())}},t.prototype._sort=function(){for(var t=this.newIndex,e=this.parent.children,i=this.space,a=0;t>a;a++){var r=e[a];createjs.Tween.get(r).to({x:a*i},100)}for(var a=t;a<e.length-1;a++){var r=e[a];createjs.Tween.get(r).to({x:(a+1)*i},100)}},t.prototype.handleEvent=function(t){},t.prototype._onDragOver=function(e){if(t.active){t.active=!1;var i=e.target;i.parent.addChildAt(i,this.newIndex),i.x=this.newIndex*this.space,i.y=this.cloneObj.y,i.draggable=!1}},t.prototype._onDrop=function(t){},t.prototype.destroy=function(){parent.on("pressmove",this._onTouchMove,this),parent.on("pressup",this._onDragOver,this)},gbjs.Sortable=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(){}var e=t.prototype=new EventEmitter;e.initBaseGame=function(){this.events={info:"drawInfo"},this.player=[],this.initCanvas()},e.initCanvas=function(){function t(){a.update()}var e=this.wrapper.find("canvas")[0];if(e){var i=this,a=new createjs.Stage(e);a.enableMouseOver(20);var r=a.canvas.getContext("2d");r.mozImageSmoothingEnabled=!0,createjs.Touch.enable(a),createjs.Ticker.setFPS(60),a.width=e.width,a.height=e.height,createjs.Ticker.addEventListener("tick",t),this.on("destroy",function(){createjs.Ticker.removeEventListener("tick",t),i.removeAllListeners()}),this.canvas=a}},e.initEvent=function(){var t=this.events;for(var e in t)this.on(e,this[t[e]])},TWIST.BaseGame=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(){}t.statusList={1:"STATUS_WAITING_FOR_PLAYER",2:"STATUS_WAITING_FOR_READY",3:"STATUS_WAITING_FOR_START",4:"STATUS_PLAYING",5:"STATUS_ENDING",6:"STATUS_WAITING_FOR_DEALING",7:"STATUS_DEALING",8:"STATUS_SHAKE_DISK",9:"STATUS_BETTING",10:"STATUS_END_BETTING",11:"STATUS_OPEN_DISK",12:"STATUS_CLOSE_DISK",13:"STATUS_ARRANGING",14:"STATUS_NOTIFY_SAM",15:"STATUS_DEAL_MASTER"};var e=t.prototype=new TWIST.BaseGame;e.initInRoomGame=function(){this.initBaseGame(),this.drawRoom(),this.pushInRoomGameEvent(),this.initErrotPanel(),this.initButtonBar(),this.userInfo={}},e.initErrotPanel=function(){this.errorPanel=this.wrapper.find(".error-panel"),this.errorList=this.errorList||{},$.extend(this.errorList,{0:"Lỗi hệ thống !",1:"Lỗi game !",1470:"Chưa chọn cây bài !"})},e.initButtonBar=function(){this.buttonBar=this.wrapper.find(".button-bar"),this.buttonBar.hide(),this.startButton=this.buttonBar.find("#start-button")},e.drawRoom=function(){this.playersContainer=new createjs.Container,this.desk=new TWIST.Desk(this.options),this.canvas.addChild(this.playersContainer,this.desk)},e.pushInRoomGameEvent=function(){this.on("userInfo",this.setUserInfo),this.on("gameInfo",this.drawGameInfo),this.on("userJoin",this.addPlayer),this.on("userQuit",this.removePlayer),this.on("error",this.showError),this.on("changeMaster",this.changeRoomMaster),this.on("isolateUpdateMoney",this.isolateUpdateMoney),this.on("userChat",this.userChat),this.on("changeStatus",this.changeStatus),this.on("dealCards",this.dealCards),this.on("hitTurn",this.onHitTurn),this.on("draftCards",this.onDraftCards),this.on("endTurn",this.onEndTurn),this.on("endGame",this.endGame),this.on("reconnect",this.reconnect),this.on("updateUuid",this.updateUuid)},e.setUserInfo=function(t){this.userInfo=t||{}},e.drawGameInfo=function(t){var e=this.model||{};this.model=e,$.extend(e,t),this.drawPlayers(),"STATUS_PLAYING"===t.gameState&&this.drawPlayingState(t)},e.addPlayer=function(t){var e=this.desk.config.playerPositions;$.extend(t,e[t.position]),this.model.players.push(t),this.playersContainer.children.length<this.options.maxPlayers&&this.drawPlayer(t)},e.removePlayer=function(t){var e=this.getPlayerByUuid(t.uuid);e&&this.playersContainer.removeChild(e);this.removePlayerData(t.uuid)},e.showError=function(t){var e=this.errorList[t.code],i=$('<div class="error-item">'+e+"</div>");$(i).css({margin:"0 auto",display:"inline-block"}),this.errorPanel.empty(),this.errorPanel.append(i);i.one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(i).remove()})},e.changeRoomMaster=function(t){for(var e=this.roomMasterIcon.globalPosition,i=t.uuid,a=this.model.players||[],r=0,n=a.length;n>r;r++){var s=a[r],h=this.getPlayerByUuid(s.uuid);s.uuid===i?(s.isRoomMaster=!0,h&&(this.roomMasterIcon=h.setRoomMaster(!0,e))):(s.isRoomMaster=!1,h&&h.setRoomMaster(!1))}},e.isolateUpdateMoney=function(t){var e=t.players,i=this;e.forEach(function(t,e){var a=i.getPlayerDataByUuid(t.uuid);if(a){a.money=parseInt(a.money)+t.changeMoney;var r=i.getPlayerByUuid(t.uuid);if(r){r.setMoney(a.money);var n=t.changeMoney<0?"lose":"win";r.showMoneyExchageEffect(t.changeMoney,n)}}})},e.userChat=function(t){},e.changeStatus=function(e){var i=t.statusList[e.newStatus],a=this[i];"function"==typeof a&&a.call(this),this.emit("ping")},e.endGame=function(t){},e.reconnect=function(t){},e.drawPlayers=function(){var t=this.model.players||[],e=this;t.sort(function(t,e){return t.position-e.position});var i=this.desk.config;t.forEach(function(t,a){$.extend(t,i.playerPositions[a]);var r={};for(var n in i)r[n]=i[n][a];t.config=r,e.drawPlayer(t)})},e.drawPlayer=function(t){t.config=t.config||{},t.index=t.index||0;var e=new TWIST.Player(t);this.playersContainer.addChild(e),t.isRoomMaster&&(this.roomMasterIcon=e.setRoomMaster(!0))},e.getPlayerByUuid=function(t){for(var e=this.playersContainer.children||[],i=0,a=e.length;a>i;i++){var r=e[i];if(r.uuid===t)return r}},e.getPlayerDataByUuid=function(t){for(var e=this.model.players||[],i=0,a=e.length;a>i;i++){var r=e[i];if(r.uuid===t)return r}},e.getCurrentPlayer=function(t){var e=this.userInfo.uuid;return this.getPlayerByUuid(e)},e.removePlayerData=function(t){for(var e=this.model.players||[],i=e.length,a=0,r=e.length;r>a;a++){var n=e[a];if(n.uuid===t){i=a;break}}e.splice(i,1)},e.updateUuid=function(t){var e=t.username;if(this.model&&this.model.players){for(var i=this.model.players,a=0,r=i.length;r>a;a++)i[a].username===e&&(i[a].uuid=t.uuid);for(var n=this.playersContainer.children,a=0,r=n.length;r>a;a++)n[a].username===e&&(n[a].uuid=t.uuid)}},TWIST.InRoomGame=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t,i){this.options=i||{},$.extend(this.options,e),this.wrapper=$(t),this.initTLMNDemlaGame()}var e={maxPlayers:4,numberCardsInHand:13,turnTime:2e4},i=t.prototype=new TWIST.InRoomGame;i.initTLMNDemlaGame=function(t){TWIST.Card.RankMapIndex=["3","4","5","6","7","8","9","10","11","12","13","1","2"],this.initInRoomGame(),this.pushTLMNDemlaEvent(),this.initResultPanel(),this.initEvent(),this.bindButton(),this.observerEvent()},i.pushTLMNDemlaEvent=function(){this.on("gameInfo",this.drawGameInfo)},i.STATUS_WAITING_FOR_PLAYER=function(){this.buttonBar.hide()},i.STATUS_WAITING_FOR_START=function(){this.buttonBar.show(),this.buttonBar.find(".button").hide();var t=this.getPlayerDataByUuid(this.userInfo.uuid);t&&t.isRoomMaster&&this.startButton.show()},i.initResultPanel=function(){this.resultPanel=this.wrapper.find("#result-panel"),this.resultPanel.hide()},i.observerEvent=function(){var t=this;TWIST.Observer.on("cardSelected",function(e){t.handCardSelected(e)})},i.handCardSelected=function(t){var e=this.desk.lastDraftCards;if(t&&e){var i=TWIST.TLMNLogic(e,t).getCards();i.length>0&&t.removeAllSelected(),i.forEach(function(t,e){t.setSelected(!0)})}},i.STATUS_PLAYING=function(){this.startButton.hide()},i.dealCards=function(t){var e=t.players,i=e.length,a=i*this.options.numberCardsInHand,r=this;this.desk.generateCards(a),e.forEach(function(t,e){var i=t.handCards;i.sort(function(t,e){return t-e});var a=r.getPlayerByUuid(t.uuid);a&&(i.length=i.length||r.options.numberCardsInHand,a.handCards.cardList=i,a.renderCards({showPlayerCard:!0,dragable:!0}))})},i.onHitTurn=function(t){var e=(t.uuid,this.getCurrentPlayer());e.handCards.children.length>0&&this.sortCardButton.show(),this.setPlayerTurn(t.uuid),t.uuid===this.userInfo.uuid&&(this.hitButton.show(),this.foldTurnButton.show())},i.setPlayerTurn=function(t){for(var e=this.playersContainer.children,i=0,a=e.length;a>i;i++){var r=e[i];r&&(r.uuid===t?r.setRemainingTime():r.clearTimer())}},i.onDraftCards=function(t){var e=t.cardList,i=t.uuid;this.desk.lastDraftCards=t.cardList;var a=this.getPlayerByUuid(i);if(!a)return void this.showError({code:1});i===this.userInfo.uuid&&(this.hitButton.hide(),this.foldTurnButton.hide()),this.desk.removeOverlayCards(),this.desk.setZeroVetical(),this.desk.overlayDraftCards();var r=TWIST.Card.userCard,n={};n.x=(TWIST.Desk.width-r.seperator*e.length)/2-TWIST.Desk.draftPosition.x,n.y=.8*r.height,a.draftCardsInHand(e,{draftCards:this.desk.draftCards,position:n,rotateAble:!0})},i.onEndTurn=function(t){this.desk.lastDraftCard=void 0,this.desk.clear(),this.onHitTurn(t)},i.bindButton=function(){var t=this;this.startButton.unbind("click"),this.startButton.click(function(){t.emit("start")}),this.hitButton=this.wrapper.find("#hit-card"),this.hitButton.unbind("click"),this.hitButton.click(function(){var e=t.getCurrentPlayer(),i=e.getSelectedCards();return 0===i.length?void t.showError({code:1470}):void t.emit("hitCards",{cards:i})}),this.sortCardButton=this.wrapper.find("#sort-card"),this.sortCardButton.unbind("click"),this.sortCardButton.click(function(){var e=t.getCurrentPlayer();e.sortTL()}),this.foldTurnButton=this.wrapper.find("#fold-turn"),this.foldTurnButton.unbind("click"),this.foldTurnButton.click(function(){t.emit("foldTurn")})},i.STATUS_ENDING=function(){this.buttonBar.hide(),this.errorPanel.empty(),this.desk.lastDraftCards=void 0,this.setPlayerTurn()},i.endGame=function(t){var e=this,i={};switch(t.winType){case 0:i.winTypeString="Tứ quý 3";break;case 1:i.winTypeString="3 đôi thông chứa 3 bích";break;case 2:i.winTypeString="Tứ quý 2";break;case 3:i.winTypeString="6 Đôi";break;case 4:i.winTypeString="5 Đôi thông";break;case 5:i.winTypeString="Sảnh rồng";break;case 99:i.winTypeString="Thắng !";break;default:i.winTypeString="Thắng !"}i.listPlayers=t.listPlayers;for(var a=0,r=i.listPlayers.length;r>a;a++){var n=i.listPlayers[a],s=n.remainCards;s.sort(function(t,e){return t-e}),parseInt(n.changeMoney)<0?99==t.winType?s.length==this.options.numberCardsInHand?n.gameResultString="Thua cóng":n.gameResultString="Thua "+s.length+" lá!":n.gameResultString="Thua !":parseInt(n.changeMoney)>0?n.gameResultString=i.winTypeString:n.gameResultString="";var h=this.getPlayerByUuid(n.uuid);h&&(h.setMoney(n.money),h.showMoneyExchageEffect(n.changeMoney,parseInt(n.changeMoney)>0?"win":"lose"))}setTimeout(function(){e.emit("showResult",i)},2e3)},TWIST.TLMNDemlaGame=t}(),this.gbjs=this.gbjs||{},function(){"use strict";var t=gbjs.Info=gbjs.Info||{};t.version="",t.buildDate=""}();