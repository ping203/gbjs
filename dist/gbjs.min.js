this.Global=this.Global||{},function(){"use strict";Global={autoFit:function(){var t=1280,e=720;_autoFit=function(){var i=window.innerWidth,n=window.innerHeight,a=i/t,s=n/e,r=a>s?s:a;r=r>1?1:r;var o=$("#main"),h=$("#gameplayStage"),d=(i-1e3*r)/2;return h.css({width:t*r,height:e*r,left:d+"px"}),o.css("zoom",r),{zoom:r}},_autoFit(),window.removeEventListener("resize",_autoFit,!0),window.addEventListener("resize",_autoFit,!0)},getParameterByName:function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)"),i=e.exec(location.search);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))},numberWithDot:function(t){if(isNaN(t))return 0;var e=t.toString().split(".");return e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g,"."),e.join(".")},_generateUniqueId:function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}()},getUniqueId:function(){var t=localStorage.getItem("___uniqueId___");return t||(t=this._generateUniqueId(),localStorage.setItem("___uniqueId___",t)),t},converEsObject:function(t){var e=t.data;if(e||(e=t),e){var i="{";for(var n in e){"{"!=i&&(i+=",");var a=e[n];i=i+'"'+n+'":'+JSON.stringify(a.value)}return i+="}",JSON.parse(i)}},convertData:function(t){var e={};for(var i in t)e[AppKeysConvert[i]?AppKeysConvert[i]:i]=t[i];return e},md5Avatar:function(t){var e=md5(t);return parseInt((e.match(/\d+/)[0]||1)[0])},convertBettingToChip:function(t,e){if(isNaN(t)||isNaN(e))return[1];var i=Math.floor(t/e),n=ChipRatio.findIndex(function(t){return i>=t});0>n&&(n=ChipRatio.length);for(var a=[],s=ChipRatio.length;s>0;s--){var r=Math.floor(i/ChipRatio[s-1]);r>0&&a.push({type:s-1,number:r})}return a}}}(),function(t){"use strict";function e(t,e){var i=(65535&t)+(65535&e),n=(t>>16)+(e>>16)+(i>>16);return n<<16|65535&i}function i(t,e){return t<<e|t>>>32-e}function n(t,n,a,s,r,o){return e(i(e(e(n,t),e(s,o)),r),a)}function a(t,e,i,a,s,r,o){return n(e&i|~e&a,t,e,s,r,o)}function s(t,e,i,a,s,r,o){return n(e&a|i&~a,t,e,s,r,o)}function r(t,e,i,a,s,r,o){return n(e^i^a,t,e,s,r,o)}function o(t,e,i,a,s,r,o){return n(i^(e|~a),t,e,s,r,o)}function h(t,i){t[i>>5]|=128<<i%32,t[(i+64>>>9<<4)+14]=i;var n,h,d,u,c,l=1732584193,f=-271733879,p=-1732584194,m=271733878;for(n=0;n<t.length;n+=16)h=l,d=f,u=p,c=m,l=a(l,f,p,m,t[n],7,-680876936),m=a(m,l,f,p,t[n+1],12,-389564586),p=a(p,m,l,f,t[n+2],17,606105819),f=a(f,p,m,l,t[n+3],22,-1044525330),l=a(l,f,p,m,t[n+4],7,-176418897),m=a(m,l,f,p,t[n+5],12,1200080426),p=a(p,m,l,f,t[n+6],17,-1473231341),f=a(f,p,m,l,t[n+7],22,-45705983),l=a(l,f,p,m,t[n+8],7,1770035416),m=a(m,l,f,p,t[n+9],12,-1958414417),p=a(p,m,l,f,t[n+10],17,-42063),f=a(f,p,m,l,t[n+11],22,-1990404162),l=a(l,f,p,m,t[n+12],7,1804603682),m=a(m,l,f,p,t[n+13],12,-40341101),p=a(p,m,l,f,t[n+14],17,-1502002290),f=a(f,p,m,l,t[n+15],22,1236535329),l=s(l,f,p,m,t[n+1],5,-165796510),m=s(m,l,f,p,t[n+6],9,-1069501632),p=s(p,m,l,f,t[n+11],14,643717713),f=s(f,p,m,l,t[n],20,-373897302),l=s(l,f,p,m,t[n+5],5,-701558691),m=s(m,l,f,p,t[n+10],9,38016083),p=s(p,m,l,f,t[n+15],14,-660478335),f=s(f,p,m,l,t[n+4],20,-405537848),l=s(l,f,p,m,t[n+9],5,568446438),m=s(m,l,f,p,t[n+14],9,-1019803690),p=s(p,m,l,f,t[n+3],14,-187363961),f=s(f,p,m,l,t[n+8],20,1163531501),l=s(l,f,p,m,t[n+13],5,-1444681467),m=s(m,l,f,p,t[n+2],9,-51403784),p=s(p,m,l,f,t[n+7],14,1735328473),f=s(f,p,m,l,t[n+12],20,-1926607734),l=r(l,f,p,m,t[n+5],4,-378558),m=r(m,l,f,p,t[n+8],11,-2022574463),p=r(p,m,l,f,t[n+11],16,1839030562),f=r(f,p,m,l,t[n+14],23,-35309556),l=r(l,f,p,m,t[n+1],4,-1530992060),m=r(m,l,f,p,t[n+4],11,1272893353),p=r(p,m,l,f,t[n+7],16,-155497632),f=r(f,p,m,l,t[n+10],23,-1094730640),l=r(l,f,p,m,t[n+13],4,681279174),m=r(m,l,f,p,t[n],11,-358537222),p=r(p,m,l,f,t[n+3],16,-722521979),f=r(f,p,m,l,t[n+6],23,76029189),l=r(l,f,p,m,t[n+9],4,-640364487),m=r(m,l,f,p,t[n+12],11,-421815835),p=r(p,m,l,f,t[n+15],16,530742520),f=r(f,p,m,l,t[n+2],23,-995338651),l=o(l,f,p,m,t[n],6,-198630844),m=o(m,l,f,p,t[n+7],10,1126891415),p=o(p,m,l,f,t[n+14],15,-1416354905),f=o(f,p,m,l,t[n+5],21,-57434055),l=o(l,f,p,m,t[n+12],6,1700485571),m=o(m,l,f,p,t[n+3],10,-1894986606),p=o(p,m,l,f,t[n+10],15,-1051523),f=o(f,p,m,l,t[n+1],21,-2054922799),l=o(l,f,p,m,t[n+8],6,1873313359),m=o(m,l,f,p,t[n+15],10,-30611744),p=o(p,m,l,f,t[n+6],15,-1560198380),f=o(f,p,m,l,t[n+13],21,1309151649),l=o(l,f,p,m,t[n+4],6,-145523070),m=o(m,l,f,p,t[n+11],10,-1120210379),p=o(p,m,l,f,t[n+2],15,718787259),f=o(f,p,m,l,t[n+9],21,-343485551),l=e(l,h),f=e(f,d),p=e(p,u),m=e(m,c);return[l,f,p,m]}function d(t){var e,i="";for(e=0;e<32*t.length;e+=8)i+=String.fromCharCode(t[e>>5]>>>e%32&255);return i}function u(t){var e,i=[];for(i[(t.length>>2)-1]=void 0,e=0;e<i.length;e+=1)i[e]=0;for(e=0;e<8*t.length;e+=8)i[e>>5]|=(255&t.charCodeAt(e/8))<<e%32;return i}function c(t){return d(h(u(t),8*t.length))}function l(t,e){var i,n,a=u(t),s=[],r=[];for(s[15]=r[15]=void 0,a.length>16&&(a=h(a,8*t.length)),i=0;16>i;i+=1)s[i]=909522486^a[i],r[i]=1549556828^a[i];return n=h(s.concat(u(e)),512+8*e.length),d(h(r.concat(n),640))}function f(t){var e,i,n="0123456789abcdef",a="";for(i=0;i<t.length;i+=1)e=t.charCodeAt(i),a+=n.charAt(e>>>4&15)+n.charAt(15&e);return a}function p(t){return unescape(encodeURIComponent(t))}function m(t){return c(p(t))}function g(t){return f(m(t))}function v(t,e){return l(p(t),p(e))}function T(t,e){return f(v(t,e))}function C(t,e,i){return e?i?v(e,t):T(e,t):i?m(t):g(t)}"function"==typeof define&&define.amd?define(function(){return C}):"object"==typeof module&&module.exports?module.exports=C:t.md5=C}(this),this.TWIST=this.TWIST||{},function(){"use strict";function t(){this._isInited=!1,this.settings}var e=t.prototype;e.init=function(t){t=t||{},this.settings=t&&t.settings||{};var e=(t&&t.assetPath||TWIST.assetPath||"../src/themes/gb-web/")+"sounds/";createjs.Sound.registerSounds(this._sounds,e),this._isInited=!0},e.play=function(t){if(this._isInited){var e=createjs.Sound.play(t);return e.volume="undefined"==typeof this.settings.volume?1:this.settings.volume,e}},e.stop=function(t){createjs.Sound.stop(t)},e._sounds=[{id:"card/chia_bai",src:"card/chia_bai.ogg"},{id:"card/danh_bai",src:"card/danh_bai.ogg"},{id:"card/open_card",src:"card/open_card.ogg"},{id:"chip/call2",src:"chip/call2.ogg"},{id:"chip/multichip",src:"chip/multichip.ogg"},{id:"chip/singlechip",src:"chip/singlechip.ogg"},{id:"inroomgame/join_room",src:"inroomgame/join_room.ogg"},{id:"minigame/BetChips",src:"minigame/BetChips.ogg"},{id:"minigame/bonus_spin",src:"minigame/bonus_spin.ogg"},{id:"minigame/BoostWin",src:"minigame/BoostWin.ogg"},{id:"minigame/ButtonClick",src:"minigame/ButtonClick.ogg"},{id:"minigame/coin_spin",src:"minigame/coin_spin.ogg"},{id:"minigame/CollectChips",src:"minigame/CollectChips.ogg"},{id:"minigame/Common_Click",src:"minigame/Common_Click.ogg"},{id:"minigame/Common_Popup",src:"minigame/Common_Popup.ogg"},{id:"minigame/DoubleOrNothing",src:"minigame/DoubleOrNothing.ogg"},{id:"minigame/FlipCard",src:"minigame/FlipCard.ogg"},{id:"minigame/FlyingCard",src:"minigame/FlyingCard.ogg"},{id:"minigame/GotLevelUp",src:"minigame/GotLevelUp.ogg"},{id:"minigame/HoldCard",src:"minigame/HoldCard.ogg"},{id:"minigame/Nhac nen khi quay chiec non ky dieu 1 - CNKD",src:"minigame/Nhac nen khi quay chiec non ky dieu 1 - CNKD.ogg"},{id:"minigame/NormalWin",src:"minigame/NormalWin.ogg"},{id:"minigame/quay bai",src:"minigame/quay bai.ogg"},{id:"minigame/slot_result",src:"minigame/slot_result.ogg"},{id:"minigame/_GameTheme",src:"minigame/_GameTheme.ogg"},{id:"rotate/lucky_wheel",src:"rotate/lucky_wheel.ogg"},{id:"status/losing",src:"status/losing.ogg"},{id:"status/winning",src:"status/winning.ogg"},{id:"tone/bellopen",src:"tone/bellopen.ogg"},{id:"tone/chuyen_view",src:"tone/chuyen_view.ogg"},{id:"tone/end_vongquay",src:"tone/end_vongquay.ogg"}],TWIST.Sound=new t}(),this.TWIST=this.TWIST||{},function(){"use strict";TWIST.Observer=new EventEmitter,TWIST.imagePath="../src/themes/gbv-city/images/"}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(e,i){return this instanceof t?(this.card=i,this.parent=this.card.parent,this.value=this.card.getValue(),this.index=this.parent.getChildIndex(this.card),this.rank=this.getRank(this.value),this.handCards=this.parent.children,void(this.cardsFire=e)):new t(e,i)}var e=t.prototype;e.getCards=function(){var t,e=this,i=e.cardsFire;return e.value>e._getMinPush()&&2!=i.length&&1!=i.length?[]:(i.sort(function(t,e){return t>e}),1!==i.length?this.getRank(i[0])==this.getRank(i[1])?(t=this.getPhomSpecial(i),t>0?e._getArrSpecialSuit(t):2==i.length&&i[0]>47?e._getChatDoi2():e._getSelectNgang()):this._getDoc():i[0]>=48?e._getCardsChat2():[])},e._getCardsChat2=function(){var t=this._getTuQuy();return 0==t.length&&(t=this._getDoithong(4)),0==t.length&&(t=this._getDoithong(3)),t},e._getChatDoi2=function(){var t=this._getTuQuy();return 0==t.length&&(t=this._getDoithong(4)),t},e._getTuQuyTohon=function(){var t=this.cardsFire[0];return this.getRank(t)>this.rank?[]:this._getTuQuy()},e._getMinPush=function(){return this.handCards[this.handCards.length-1].getValue()},e._getSodoithongChon=function(t){return this.getRank(this.cardsFire[0])>this.rank?void 0:this._getDoithong(t)},e._getTuQuy=function(){var t=this,e=_.filter(t.handCards,function(e){return t.getRank(e.getValue())==t.rank});return e.length<4&&(e=[]),e},e._getDoithong=function(t){for(var e=[],i=this.rank,n=(this.index,0);t>n;n++){for(var a=0,s=0;s<this.handCards.length&&(this.getRank(this.handCards[s].getValue())!=i||(a++,e.push(this.handCards[s]),2!=a));s++);if(2>a){e=[];break}i++}return e.length/2!=t&&(e=[]),e},e._getArrSpecialSuit=function(t){var e=[];switch(t){case 3:e=this._getDoithong(t),0==e.length&&(e=this._getTuQuy());break;case 4:e=this._getDoithong(t);break;case 5:e=this._getTuQuyTohon(),0==e.length&&(e=this._getDoithong(3))}return e},e._getSelectNgang=function(){var t=this,e=[],i=t.cardsFire.length;if(e=t.getCartsByRank(t.rank),e.length<i.length)return[];if(2==i&&this.getRank(t.cardsFire[0])==t.rank){var n=t.cardsFire[1]%4,a=e[0].getValue()%4,s=e[1].getValue()%4;s>a&&(a=s),n>a&&(e=[])}else t.rank>this.getRank(t.cardsFire[0])?(e=e.slice(0,i-1),-1==e.indexOf(t.card)&&e.push(t.card)):e=[];return e},e.getCartByRank=function(t){var e=this;return _.find(this.handCards,function(i){return e.getRank(i.getValue())==t})},e.getCartsByRank=function(t){var e=this;return _.filter(this.handCards,function(i){return e.getRank(i.getValue())==t})},e.isUndefined=function(t){return"undefined"==typeof t},e._getDoc=function(){var t=this,e=[],i=t.card,n=t.rank,a=this.getRank(t.cardsFire[0]);if(a>n)return[];e.push(i);for(var s=1;s<this.cardsFire.length;s++){if(n++,i=_.find(t.handCards,function(e){var i=t.getRank(e.getValue());if(12==i)return!1;if(t.getRank(e.getValue())==n){if(s!=t.cardsFire.length-1)return!0;if(e.getValue()>t.cardsFire[s])return!0}return!1}),this.isUndefined(i))return[];e.push(i)}return e},e.getRank=function(t){return Math.floor(t/4)},e.getPhomSpecial=function(t){var e,i,n=0;switch(t.length){case 4:e=this.getRank(t[0]),i=this.getRank(t[1]),e==i&&(n=5);break;case 6:e=this.getRank(t[0]),i=this.getRank(t[2]),e==i-1&&(n=3);break;case 8:e=this.getRank(t[0]),i=this.getRank(t[2]),e==i-1&&(n=4)}return n},TWIST.TLMNLogic=t}(),this.TWIST=this.TWIST||{},function(){var t,e;t=52,e=[100,1e3,1e4,1e5];var i=new EventEmitter,n=i;n.generateMap=function(e){for(var i=[],n=0;5>n;n++)i[n]=e?e[n]:Math.floor(Math.random()*t);return i},TWIST.MiniPokerLogic=i}(),this.FATE=this.FATE||{},function(){"use strict";function t(t,i){return e?e:void this.init()}var e,i=t.prototype;i.init=function(){this.rooms=[]},FATE.MockupServer=t}(),function(){window.TWIST=window.TWIST||{},TWIST.HTMLTemplate={canvas:'<canvas id="testCanvas" width="1000" height="580" ></canvas>',errorPanel:'<div class="error-panel">\r\n    \r\n</div>',"buttonBar/callSamButton":'<div class="button fourth red" id="call-sam">Báo sâm</div>',"buttonBar/eatCardButton":'<div class="button second red" id="eat-card">Ăn</div>',"buttonBar/entiretyButton":'<div class="button second red" id="entirety-card">Ù</div>',"buttonBar/foldSamButton":'<div class="button third blue" id="fold-sam">Bỏ sâm</div>',"buttonBar/foldTurnButton":'<div class="button fourth red" id="fold-turn">Bỏ lượt</div>\r\n',"buttonBar/getCardButton":'<div class="button first red" id="get-card">Bốc bài</div>',"buttonBar/hitButton":'<div class="button first yellow" id="hit-card">Đánh bài</div>',"buttonBar/sendCardButton":'<div class="button second red" id="send-card">Gửi bài</div>',"buttonBar/showPhomButton":'<div class="button second red" id="eat-card">Hạ bài</div>',"buttonBar/sortCardButton":'<div class="button third blue" id="sort-card">Xắp xếp</div>',"buttonBar/startButton":'<div class="button first green" id="start-button">Bắt đầu</div>',"buttonBar/wrapper":'<div class="button-bar"></div>',"effect/explodePot":'<div class="explorer-pot">\n    <span class="effect"></span>\n    <span class="txt"></span>\n</div>\n<div class="money-falling">\n    <div class="text-light pos-1">\n        <i class="l-obj lobj-1"></i>\n        <i class="l-obj lobj-2"></i>\n        <i class="l-obj lobj-3"></i>\n        <i class="l-obj lobj-4"></i>\n        <i class="l-obj lobj-5"></i>\n        <i class="l-obj lobj-6"></i>\n        <i class="l-obj lobj-7"></i>\n        <i class="l-obj lobj-8"></i>\n    </div>\n    <div class="text-light pos-2">\n        <i class="l-obj lobj-1"></i>\n        <i class="l-obj lobj-2"></i>\n        <i class="l-obj lobj-3"></i>\n        <i class="l-obj lobj-4"></i>\n        <i class="l-obj lobj-5"></i>\n        <i class="l-obj lobj-6"></i>\n        <i class="l-obj lobj-7"></i>\n        <i class="l-obj lobj-8"></i>\n    </div>\n    <div class="text-light pos-3">\n        <i class="l-obj lobj-1"></i>\n        <i class="l-obj lobj-2"></i>\n        <i class="l-obj lobj-3"></i>\n        <i class="l-obj lobj-4"></i>\n        <i class="l-obj lobj-5"></i>\n        <i class="l-obj lobj-6"></i>\n        <i class="l-obj lobj-7"></i>\n        <i class="l-obj lobj-8"></i>\n    </div>\n    <div class="text-light pos-4">\n        <i class="l-obj lobj-1"></i>\n        <i class="l-obj lobj-2"></i>\n        <i class="l-obj lobj-3"></i>\n        <i class="l-obj lobj-4"></i>\n        <i class="l-obj lobj-5"></i>\n        <i class="l-obj lobj-6"></i>\n        <i class="l-obj lobj-7"></i>\n        <i class="l-obj lobj-8"></i>\n    </div>\n</div>',"effect/wrapper":'<div class="effect"></div>',"hightLow/bottom":'<div class="bottom">\n    <div class="profile-hight-low">\n\n    </div>\n    <div class="chips-hight-low">\n\n    </div>\n    <div class="new-turn-button">Lượt mới</div>\n</div>\n',"hightLow/center":'<div class="center">\n    <div class="text-support">Quân bài tiếp theo là cao hay thấp ?</div>\n    <div class="remain-time"></div>\n    <div class="canvas-wrapper">\n        <div class="game-button left-button">\n            <div class="low-button"></div>\n            <div class="low-value">0</div>\n        </div>\n        <div class="game-button right-button">\n            <div class="hight-button"></div>\n            <div class="hight-value">0</div>\n        </div>\n        <div class="virtual-card">\n            <div class="new-turn-text">\n                Bốc bài\n            </div>\n        </div>\n        <div class="card-store">\n            \n        </div>\n    </div>\n</div>\n',"hightLow/top":'<div class="top">\n    <div class="pot">\n        <div class="title">Hũ thưởng</div>\n        <div class="pot-value">0</div>\n    </div>\n    <div class="bank">\n        <div class="title"></div>\n        <div class="bank-value">0</div>\n    </div>\n    <div class="pot-cards">\n        <div class="pot-card"></div>\n        <div class="pot-card"></div>\n        <div class="pot-card"></div>\n    </div>\n</div>\n',"hightLow/wrapper":'<div class="hight-low"></div>\n',"inviteList/inviteItem":'<div class="invite-item">\n    <div class="invite-item-inner"></div>\n</div>\n',"inviteList/wrapper":'<div class="invite-wrapper">\n    \n</div>\n',"miniPoker/autospin":'<div class="autospin">\n    <input id="autospin" type="checkbox" />\n    <label for="autospin"></label>\n    <span>Tự động quay</span>\n</div>\n',"miniPoker/button":'<div class="button-spin"></div>',"miniPoker/chips":'<div class="chip-group">\n    <div class="chip violet">1K</div>\n    <div class="chip green">10k</div>\n    <div class="chip blue">100k</div>\n</div>\n',"miniPoker/errorPanel":'<div class="error-panel-mini">\r\n    \r\n</div>',"miniPoker/pot":'<div class="pot">\n    Hũ thưởng\n    <div class="pot-value"></div>\n</div>',"miniPoker/resultItem":'<div class="result-mini-item">\n    <span class="icon"></span>\n    <%- name %> \n    <div class="value"><%- value %> </div>\n</div>',"miniPoker/resultTab":'<div class="result-mini-poker-tab"></div>',"miniPoker/resultText":'<div class="result-text"></div>',"miniPoker/sessionId":'<div class="session-id"></div>',"miniPoker/user":'<div class="profile">\n    <div class="profile-left">\n        <div class="user avatar" ></div>\n    </div>\n    <div class="profile-right">\n        <div class="username "></div>\n        <div class="money "></div>\n    </div>\n</div>',"miniPoker/winMoney":'<div class="win-money"></div>',"miniPoker/wrapper":'<div class="mini-poker-bg"></div>\n',"resultPanel/card":'<div class="card card<%- id %>"></div>',"resultPanel/user":'<div class="result-item <%- isWinnerClass %>">\n    <div class="result-item-info"> \n        <div class="result-item-username"><%- username %> </div>\n        <div class="result-item-result-info">\n            <span class="result-item-money"><%- moneyChange %></span>\n            <div class="user-result-string"x><%- resultText %></div>\n        </div>\n    </div>\n    <div class="result-card-list-container">\n        <%= cardList %>\n    </div>\n</div>',"resultPanel/wrapper":'<div class="game-result">\n    <div class="global-mask"></div>\n    <div class="game-result-popup">\n        <div class="popup-header">\n            <div class="popup-icon"></div> \n            <div class="close-popup">X</div>\n        </div>\n        <div class="popup-content">\n            <div class="container">\n                <div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>',"videoPoker/doubleButton":'<div class="button-spin double-button"></div>',"videoPoker/getWinButton":'<div class="get-win-button">\n    Nhận thưởng\n</div>',"videoPoker/moveChip":'<div class="move-chip">\n    <i class="chip1"></i>\n    <i class="chip2"></i>\n    <i class="chip3"></i>\n    <i class="chip4"></i>\n    <i class="chip5"></i>\n    <i class="chip6"></i>\n    <i class="chip7"></i>\n    <i class="chip8"></i>\n</div>',"videoPoker/supportText":'<div class="support-text"></div>',"videoPoker/virtualCards":'<div class="virtualCards">\n    <div class="card vitualCard1">\n        \n    </div>\n    <div class="card vitualCard2">\n        \n    </div>\n    <div class="card vitualCard3">\n        \n    </div>\n    <div class="card vitualCard4">\n        \n    </div>\n    <div class="card vitualCard5">\n        \n    </div>\n</div>',"videoPoker/wrapper":'<div class="mini-poker-bg video-poker"></div>\n'}}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t){("number"!=typeof t||0>t||t>51)&&(t=-1),this.initialize(t)}function e(t){var e=Math.floor(t/4),i=Math.floor(t%4);return(0>t||t>=52)&&(e=-1,i=4),{rank:e,suite:i}}var i=location.origin+location.pathname+"../src/images/";t.size={width:88,height:115},t.userCard={width:53,height:69,cardDraggable:!0,selectedHeight:20,scale:.6,seperator:54},t.userCard.scale=t.userCard.width/t.size.width,t.playerCard={width:29,height:37,seperator:0,cardDraggable:!1,scale:.33},t.playerCard.scale=t.playerCard.width/t.size.width,t.deckCard={width:40,seperator:.1},t.deckCard.scale=t.deckCard.width/t.size.width,t.draftCard={width:30,height:40,seperator:31},t.draftCard.scale=t.draftCard.width/t.size.width,t.threeCards={width:54,height:73.8,seperator:55,scale:.6},t.threeCards.scale=t.threeCards.width/t.size.width,t.threeCardsBanker={width:63,height:86.1,seperator:64,scale:.7},t.threeCardsBanker.scale=t.threeCardsBanker.width/t.size.width,t.miniPoker={width:102,height:133},t.miniPoker.scale=t.miniPoker.width/t.size.width,t.shadow=new createjs.Shadow("#0ff",0,0,10),t.Suite={3:0,2:1,1:3,0:2,4:4},t.NumberCardInHand=13,t.SuitMap=["♠","♣","♦","♥"],t.SuitNameMap=["b","t","r","c"],t.SuitImageIndex=["♠","♣","♦","♥"];var n=t.prototype=new createjs.Container;n.container_initialize=n.initialize,n.initialize=function(t){this.container_initialize(),this._init(),this.setValue(t)},n._init=function(){var e=new Image;e.src=(TWIST.imagePath||i)+"card/cards.png";var n=new createjs.Bitmap(e);this.bg=n,n.sourceRect=$.extend({},t.size),n.sourceRect.x=0,n.sourceRect.y=t.size.height*t.SuitNameMap.length,this.inPhom=new createjs.Shape,this.inPhom.graphics.beginFill("#fedc32").drawRect(0,0,30,3),this.inPhom.set({x:t.size.width/2-15,y:t.size.height+2}),this.inPhom.visible=!1,this.eatEffect=new createjs.Shape,this.eatEffect.graphics.beginFill("#000").drawRect(0,0,t.size.width,t.size.height),this.eatEffect.set({alpha:.5}),this.eatEffect.visible=this.showEatEffect,this.addChild(n,this.inPhom,this.eatEffect)},n.setValue=function(i){var n=e(i);this.cardValue=i,this.rank=n.rank,this.suite=n.suite;var a=this.bg;if(a.sourceRect=$.extend({},t.size),-1!==i){t.RankMapIndex=t.RankMapIndex||["1","2","3","4","5","6","7","8","9","10","11","12","13"];var s=t.RankMapIndex[n.rank];t.SuitMap[n.suite];a.sourceRect.x=(s-1)*t.size.width,a.sourceRect.y=n.suite*t.size.height}else a.sourceRect.x=0,a.sourceRect.y=t.size.height*t.SuitNameMap.length},n.getValue=function(){return this.cardValue},n.removeAllSelected=function(){this.parent.children.forEach(function(t,e){t.setSelected(!1)})},n.openCard=function(e,i){var n=this.x;return i=i||t.userCard,createjs.Tween.get(this).to({scaleX:.1,x:n+i.width/2},150).call(function(){this.setValue(e),this.cardValue=e;try{this.updateCache()}catch(t){}}).to({scaleX:i.scale,scaleY:i.scale,x:n},150).call(function(){this.isTracking&&TWIST.Observer.emit("cardOpened",this),this.setInPhom(this.isInPhom)})},n.upSideDown=function(e){var i=this.x;return e=e||t.userCard,createjs.Tween.get(this).to({scaleX:.1,x:i+e.width/2},150).call(function(){this.cardValue=-1,this.setValue(-1);try{this.updateCache()}catch(t){}}).to({scaleX:e.scale,scaleY:e.scale,x:i},150).call(function(){})},n.tipOff=function(){if(this.IsFlip!==!1){var e=this.x;return this.removeAllEventListeners(),createjs.Tween.get(this).to({scaleX:.1,x:e+this.width/2},150).call(function(){this.setValue(-1)}).to({scaleX:t.draftCard.scale,x:e},150).call(function(){this.filters=[new createjs.ColorMatrixFilter(new createjs.ColorMatrix(0,0,0,0))];try{this.updateCache()}catch(t){console.log(t)}})}},n.movePosition=function(t){this.parent&&createjs.Tween.get(this).to({x:t.x,y:t.y},150).call(function(){})},n.setSelected=function(e){if(e){var i=-t.userCard.selectedHeight;createjs.Tween.get(this).to({y:i},100).call(function(){this.selected=!0})}else this.selected=!1,this.y=0},n.toggedSelected=function(){var t=this;if(this.isSelected)this.isSelected=!1,this.y=this.y+15,t.parent.swapCardX=void 0,t.parent.swapCardY=void 0,t.parent.selectedCard=void 0;else{var e=this.y-15;t.parent.setChildIndex(t,12),t.isSelected=!0,createjs.Tween.get(this).to({y:e},100).call(function(){t.parent.selectedCard=t})}},n.setDraggable=function(t){var e=this;this.removeAllEventListeners("mousedown"),this.removeAllEventListeners("pressmove"),this.removeAllEventListeners("pressup"),t&&(this.addEventListener("mousedown",function(t){e.startPositionX=e.x,e.startPositionY=e.y,e.startMousePositionX=t.stageX,e.startMousePositionY=t.stageY,e.parent.addChild(e)}),this.addEventListener("pressmove",function(t){e.parent.addChild(e);var i=t.stageX-e.startMousePositionX,n=t.stageY-e.startMousePositionY;if(!(Math.abs(i)+Math.abs(n)<=10)){e.isDragging=!0,e.x=e.startPositionX+i,e.y=e.startPositionY+n;var a=e.parent,s=a.indexLeft,r=a.globalToLocal(t.stageX-s,t.stageY);if(r.y>0&&r.y<=e.height){var o=Math.floor(r.x/e.seperator);if(o=0>o?0:o>=a.children.length-1?a.children.length-1:o,o!=e.position){var h=(Math.abs(o-e.position),(o-e.position)/Math.abs(o-e.position));a.children.forEach(function(t,i){(t.position-o)*(t.position-e.position)<=0&&t.position!=e.position&&(t.position-=h,t.moveToPosition(t.position))})}e.position=o}}}),this.addEventListener("pressup",function(t){e.isDragging&&(e.selected=!1,e.moveToPosition(e.position),e.parent.children.sort(function(t,e){return t.position-e.position})),e.isDragging=!1}))},n.moveTo=function(t,e,i){createjs.Tween.get(this).to({x:t,y:e},100,createjs.Ease.sineOut()).call(function(){})},n.moveToPosition=function(e,i){e=e||this.position||0;var n=this.parent.indexLeft||0,a=this.seperator||t.userCard.seperator,s=n+a*e;this.moveTo(s,0,i)},n.setInPhom=function(t){t?this.inPhom.visible=!0:this.inPhom.visible=!1;try{this.updateCache()}catch(e){}},n.setClick=function(t){this.removeAllEventListeners("click"),t&&this.addEventListener("click",function(t){var e=t.target.parent;e.isDragging||(e.parent.selectedCard&&e.parent.selectedCard.cardValue!=e.cardValue?($rootScope.playerEvent={evt:"swapSelected",data:[e.parent.selectedCard.cardValue,e.cardValue]},$rootScope.digest()):e.toggedSelected())})},n.bindMouseOver=function(t){return this.removeAllEventListeners("mouseover"),this.removeAllEventListeners("mouseout"),t?void this.addEventListener("mouseover",function(t){}):void 0},n.bindEventListener=function(){this.removeAllEventListeners("click");var t=this;this.addEventListener("click",function(e){t.isDragging||(t.selected||TWIST.Observer.emit("cardSelected",t),t.setSelected(!t.selected))})},n.bindOpenCard=function(){this.removeAllEventListeners("click");var t=this;this.addEventListener("click",function(e){try{t.isDragging||t.openCard(t.cardValue)}catch(e){console.warn(e)}})},n.Overlay=function(){this.isOverlay=!0,this.filters=[new createjs.ColorMatrixFilter(new createjs.ColorMatrix(0,-60,0,0))],this.cache(0,0,t.size.width,t.size.height);try{this.updateCache()}catch(e){}},n.UnOverlay=function(){this.isOverlay=!1,this.filters=[new createjs.ColorMatrixFilter(new createjs.ColorMatrix(0,0,0,0))];try{this.updateCache()}catch(t){}},n.addMouseMoveEvent=function(){this.card.IsDraggable&&!this.card.IsInPhom&&(this.addEventListener("mouseover",function(t){}),this.addEventListener("mouseout",function(t){}))},n.hightLight=function(){this.showEatEffect=!0,this.eatEffect.visible=!0},n.unHightLight=function(){this.showEatEffect=!1,this.eatEffect.visible=!1},TWIST.Card=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t){this.initialize(t)}location.origin+location.pathname+"../src/images/";t.playerPositions={4:[{x:12,y:430},{x:840,y:190},{x:450,y:17},{x:70,y:190}],2:[{x:12,y:410},{x:450,y:17}],5:[{x:12,y:410},{x:790,y:160},{x:350,y:17},{x:650,y:17},{x:110,y:160}],9:[{x:380,y:410},{x:970,y:540},{x:1090,y:320},{x:1e3,y:140},{x:783,y:67},{x:383,y:67},{x:170,y:140},{x:70,y:320},{x:160,y:540}],6:[{x:550,y:410},{x:1080,y:400},{x:1080,y:170},{x:550,y:70},{x:130,y:170},{x:130,y:400}]},t.handPositions={center:{x:150,y:-110,align:"center"},left:{x:-4,y:32,align:"left"},right:{x:52,y:32,align:"center"}},t.draftPositionList={};var e=t.prototype=new createjs.Container;e.container_initialize=e.initialize,t.width=1e3,t.height=580,t.position={x:t.width/2,y:t.height/2-50},t.draftPosition={x:t.width/2,y:t.height/4,rotateDeg:0},e.initialize=function(t){this.container_initialize();this.gameType=t||{},this.config={},this.initPosition(t);var e=this.createDeckCard(),i=this.createRemainingTime(),n=this.createRemainingCard(),a=this.createDraftCards();this.addChild(e,a,i,n)},e.createDeckCard=function(){return this.deckCard=new createjs.Container,this.deckCard.set({x:t.position.x-TWIST.Card.userCard.width/2,y:t.position.y-TWIST.Card.userCard.height/2,visible:!1}),this.deckCard},e.createRemainingTime=function(){return this.remainingTime=new createjs.Text("","bold 50px Roboto Condensed","white"),this.remainingTime.set({x:t.position.x,y:t.position.y,visible:!1,textAlign:"center",textBaseLine:"top"}),this.remainingTime},e.createRemainingCard=function(){return this.remainingCard=new createjs.Text("","bold 30px Roboto Condensed","greenyellow"),this.remainingCard.set({x:t.position.x,y:t.position.y,textAlign:"center",textBaseline:"middle"}),this.remainingCard},e.showRemainingDeckCard=function(){this.remainingCard.text=this.deckCard.children.length},e.createDraftCards=function(){return this.draftCards=new createjs.Container,this.draftCards.set({x:t.draftPosition.x,y:t.draftPosition.y}),this.draftCards},e.initPosition=function(e){for(var i=e.maxPlayers||4,n=new Array(i),a=new Array(i),s=new Array(i),r=0;i>r;r++)a[r]={x:63,y:30,align:"left"},s[r]={x:a[r].x+1.5*TWIST.Card.draftCard.width,y:a[r].y};n=t.playerPositions[i],a[0]={x:150,y:-50,align:"center"},4===i&&(a[1]={x:6,y:30,align:"center"},s[0]={x:t.width/2-2*TWIST.Card.draftCard.width-n[0].x,y:-100,align:"left"},s[1].x=-340,s[1].align="right",s[2]={x:t.width/2-2*TWIST.Card.draftCard.width-n[2].x,y:120,align:"left"}),this.config.playerPositions=n,this.config.handPositions=a,this.config.draftPositions=s},e.generateCards=function(t,e){var i=this.deckCard.children.length,n=t-i;if(n>0)for(var a=0;n>a;a++){var s=new TWIST.Card,r=e&&e.scale||TWIST.Card.playerCard.scale;s.set({scaleX:r,scaleY:r}),this.deckCard.addChild(s)}else this.deckCard.children.splice(0,-n);this.deckCard.visible=!0},e.createLastDraftCards=function(t){var e=this.draftCards,i=TWIST.Card.draftCard;t.forEach(function(n,a){var s=new TWIST.Card(n);s.set({x:(a-.5*t.length)*i.seperator,rotation:30*(Math.random()-.5),scaleX:i.scale,scaleY:i.scale}),e.addChild(s)})},e.scaleDeckCard=function(t){for(var e=this.deckCard.children,i=0;i<e.length;i++){var n=e[i];n.set({scaleX:.3,scaleY:.3})}},e.renderDraftCards=function(t){for(var e=0;e<t.length;e++){var i=new TWIST.Card(t[e]),n=TWIST.Card.baiDraft.seperator*e,a=0;i.set({x:n,y:a,scaleX:TWIST.Card.baiDraft.width/TWIST.Card.image.width,scaleY:TWIST.Card.baiDraft.height/TWIST.Card.image.height}),TWIST.Card.addChild(i)}},e.getCard=function(){var t;return t=this.deckCard.children.pop(),t&&t.set({x:this.deckCard.x,y:this.deckCard.y}),t},e.setRemainingTime=function(t){var e=t>1e3?t:1e3*t,i=(new Date).getTime(),n=this.remainingTime;n.visible=!0,e>0?(this.remainingTimeTween&&(this.remainingTimeTween.removeAllEventListeners(),n.text=""),this.remainingTimeTween=createjs.Tween.get(n).to({},e,createjs.Ease.linear).call(function(){n.text=""}),this.remainingTimeTween.addEventListener("change",function(){var t=(new Date).getTime(),a=Math.floor((e-(t-i))/1e3);n.text=a>0?a:""})):this.remainingTimeTween&&(this.remainingTimeTween.removeAllEventListeners(),n.text="")},e.clearRemainingTime=function(){this.remainingTimeTween&&this.remainingTimeTween.removeAllEventListeners(),this.remainingTime.text=""},e.clear=function(){this.deckCard.removeAllChildren(),this.draftCards.removeAllChildren(),this.deckCard.visible=!1,this.remainingCard.text=""},e.tipOff=function(){for(var t=this.draftCards.children,e=0;e<t.length;e++)t[e].cardValue>-1&&t[e].tipOff()},e.overlayDraftCards=function(){for(var t=this.draftCards.children,e=0;e<t.length;e++)t[e].cardValue>-1&&t[e].Overlay()},e.removeOverlayCards=function(){for(var t=this.draftCards.children,e=0,i=t.length;i>e;e++)t[e]&&t[e].isOverlay&&(t.splice(e,1),e--)},e.setZeroVetical=function(){var t=(this.draftCard,this.draftCards.children);t.forEach(function(t,e){t.moveTo(t.x,0)})},TWIST.Desk=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t){this.set({startTime:0,totalTime:0,remainingTime:0,currentTimer:0}),this.initialize(t)}var e=t.prototype=new createjs.Container;e.Container_initialize=e.initialize,e.initialize=function(t){this.Container_initialize(),$.extend(this,t),this.timerLine=new createjs.Shape,this.addChild(this.timerLine),this.startAngle=0,this.endAngle=0},e.drawPercentRect=function(t){
this.timerLine.graphics.clear(),this.startAngle=1*-Math.PI/2,this.endAngle=1*-Math.PI/2+t*Math.PI*2,this.timerLine.graphics.s("#fee802").ss(this.strokeThick).arc(this.radius,this.radius,this.radius,this.startAngle,this.endAngle,!1)},e.setCounter=function(t,e){this.totalTime=t||2e4,this.remainingTime=e||2e4,this.startTime=(new Date).getTime()-(this.totalTime-this.remainingTime),this.currentTimer=(this.totalTime-this.remainingTime)/this.totalTime},e.clearTimer=function(){this.tween&&(this.tween.pause(),this.tween.removeAllEventListeners()),createjs.Tween.get(this.timerLine,{override:!0}),this.timerLine.graphics.clear(),this.totalTime=0,this.remainingTime=0,this.currentTimer=0,this.callback&&delete this.callback},e.tick=function(){return this.currentTimer=((new Date).getTime()-this.startTime)/this.totalTime,this.currentTimer>=1?void this.clearTimer():void this.drawPercentRect(this.currentTimer)},e.startTimer=function(t,e){e>t&&(e=t),this.clearTimer(),this.setCounter(t,e);var i=this;this.tween=createjs.Tween.get(this.timerLine,{override:!0}).to({},e).call(function(){i.clearTimer()});var i=this;this.tween.addEventListener("change",function(){i.tick()})},TWIST.Timer=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t){this.initialize(t)}var e=location.origin+location.pathname+"../src/images/",i=300,n=TWIST.Desk;t.Defaults={UserName:"username",Position:0},t.usernameConfig={x:0,y:70,width:100,height:40},t.avatarConfig={x:15,y:0,radius:35,innerRadius:33,AvatarDefault:e+"avatars/1.png"},t.handConfig={x:100,y:100},t.draftCardsConfig={x:100,y:100,align:"left"};var a=t.prototype=new createjs.Container;a.contructor_initialize=a.initialize,a.initialize=function(t){this.contructor_initialize(),$.extend(this,t),this.initCanvas()},a.initCanvas=function(){var e=this,i=this.config||{},n=$.extend(t.avatarConfig,i.avartar);this.initUsername(i,e),this.initAvatar(i,e),this.initDraftCards(i,e),this.initHandCards(i,e),this.initChatMessage(i,e),this.initMoneyEffect(i,e),this.initStatus(i,e),this.timer=new TWIST.Timer({x:n.x,y:n.y,radius:n.radius,strokeThick:10}),this.addChild(this.timer,this.avatarContainer,this.usernameContainer,this.draftCards,this.hand,this.status,this.chat,this.moneyChangeEffect),this.render()},a.initUsername=function(e,i){var n=new createjs.Container,a=e.username||t.usernameConfig;$.extend(n,a);var s=new createjs.Text(this.username,"18px Roboto Condensed","white");s.set({x:50,y:20,textAlign:"center",textBaseline:"bottom"});var r=new createjs.Text(this.money,"14px Roboto Condensed","#f3ba04");r.set({x:50,y:40,textAlign:"center",textBaseline:"bottom"});var o=new createjs.Shape;o.graphics.beginFill("black").drawRoundRectComplex(0,0,a.width,a.height,10,10,10,10),o.alpha=.2,n.addChild(o,s,r),this.usernameContainer=n},a.initAvatar=function(i,n){var a=new createjs.Container,s=i.avartar||t.avatarConfig,r=2*s.innerRadius;$.extend(a,s);var o=new Image,h=Global.md5Avatar(this.username)||10;o.src=(TWIST.imagePath||e)+"player/avatars/"+h+".png";var d=new createjs.Bitmap(o);o.onload=function(){d.set({width:r,height:r,scaleX:r/o.width,scaleY:r/o.height})},d.set({x:s.radius-s.innerRadius,y:s.radius-s.innerRadius});var u=new createjs.Shape;u.graphics.drawCircle(s.radius,s.radius,s.innerRadius),d.mask=u;var c=new createjs.Shape;c.graphics.beginFill("#000").drawCircle(s.radius,s.radius,s.radius),c.set({alpha:.7});var l=new Image;l.src=(TWIST.imagePath||e)+"player/icon_chuphong.png";var f=new createjs.Bitmap(l);f.set({x:.7*r,y:.7*r,name:"roomMaster",visible:this.isRoomMaster});var p=.3*r;l.onload=function(){f.set({width:p,height:p,scaleX:p/l.width,scaleY:p/l.height})};var m=new createjs.Shape;m.graphics.beginFill("#fff").drawRect(0,0,r,r),a.hitArea=m,a.addChild(c,d,f),this.avatarContainer=a},a.initDraftCards=function(e,i){var n=e.draftPositions||t.draftCardsConfig;this.draftCards=new createjs.Container,$.extend(this.draftCards,n)},a.initHandCards=function(e,i){var n=e.handPositions||t.handConfig;this.hand=new createjs.Container,$.extend(this.hand,n);var a=TWIST.Card.playerCard,s=(a.width-3)/2;this.handCards=new createjs.Container,this.numberOfCards=new createjs.Container,this.numberOfCards.set({x:0,y:0});var r=new createjs.Shape;r.graphics.beginFill("#000").drawCircle(a.width/2,a.height/2,s),r.set({alpha:.3,visible:!1});var o=new createjs.Text("",1.5*s+"px Roboto Condensed","#7fc100");o.set({x:a.width/2,y:a.height/2,textAlign:"center",visible:!1,name:"numberOfCard",textBaseline:"middle"}),this.numberOfCards.addChild(r,o),this.hand.addChild(this.handCards,this.numberOfCards)},a.initChatMessage=function(t,e){this.chat=new createjs.Container,this.chat.set({name:"chat"});var i=new createjs.Text("","22px Roboto Condensed","#000");i.set({textAlign:"center",textBaseline:"bottom"});var n=new createjs.Shape;this.chat.addChild(n,i)},a.initMoneyEffect=function(t,e){this.moneyChangeEffect=new createjs.Container,this.moneyChangeEffect.set({name:"moneyChangeEffect",x:50,y:50});var i=new createjs.Text("","30px Roboto Condensed","black");i.set({x:1,y:11,textAlign:"center",textBaseline:"bottom"});var n=new createjs.Text("","30px Roboto Condensed");n.set({x:0,y:10,textAlign:"center",textBaseline:"bottom"}),n.shadow=new createjs.Shadow("#000",0,0,10),this.moneyChangeEffect.addChild(i,n)},a.initStatus=function(t,e){this.status=new createjs.Container,this.status.set({x:50,y:50});var i=new createjs.Text,n=new createjs.Text;this.status.addChild(i,n)},a.render=function(){this.setPlayerName(this.username),this.setMoney(this.money),this.setRoomMaster(this.isRoomMaster)},a.setRemainingTime=function(t,e){t=t||2e4,50>t&&(t*=1e3),e=e||2e4,50>e&&(e*=1e3),this.timer.startTimer(e,t)},a.clearTimer=function(t,e){this.timer.clearTimer()},a.setPlayerName=function(e){var i=this.usernameContainer,n=i.getChildAt(1);n.text=e;var a=n.getMeasuredWidth(),s=t.usernameConfig.width;if(a>s){var r=s/a,o=Math.round(n.text.length*r)-3;n.text=n.text.substring(0,o)+"..."}},a.setMoney=function(t){var e=this.usernameContainer;this.money=parseInt(t);var i=e.getChildAt(2);i.text=Global.numberWithDot(t)},a.setRoomMaster=function(t,e){void 0===typeof t?t=this.isRoomMaster:this.isRoomMaster=t;var n=this.avatarContainer.getChildByName("roomMaster");if(n.visible=t,t){var a={scaleX:n.scaleX,scaleY:n.scaleY};n.set({scaleX:1,scaleY:1});var s=n.globalPosition=n.globalToLocal(0,0);if(n.set(a),e){var r={x:n.x,y:n.y},o={x:r.x+s.x-e.x,y:r.y+s.y-e.y};n.set(o),createjs.Tween.get(n).to({x:r.x,y:r.y},i).call(function(){})}}return n},a.clearHand=function(){this.handCards.removeAllChildren();var t=this.hand.getChildAt(1),e=this.hand.getChildAt(2);t.visible=!1,e.visible=!1},a.clearDraftCards=function(){this.draftCards&&this.draftCards.removeAllChildren()},a.clearShowPhomArea=function(){this.showPhomArea&&this.showPhomArea.removeAllChildren()},a.setPlayerStatus=function(t,e){var i=this.status,n=i.getChildAt(1),a=i.getChildAt(0);return t&&t.length?(e||(e={}),e.color=e.color||"yellowgreen",e.font=e.font||"bold 20px Roboto Condensed",e.x=e.x||0,e.y=e.y||10,e.textAlign=e.textAlign||"center",e.textBaseline=e.textBaselinex||"bottom",$.extend(n,e),$.extend(a,e),i.visible=!0,n.text=a.text=t,n.shadow=new createjs.Shadow("black",0,0,10),a.x=e.x+1,a.y=e.y+1,void(a.color="black")):void(i.visible=!1)},a.renderCards=function(t){var e=this.hand;e.visible=!0,this._renderHandCards(this.handCards.cardList,t);var i=this;this.showCardLength?setTimeout(function(){i.setNumberCards(i.handCards.cardList.length)},1e3):this.numberOfCards.visible=!1},a._renderHandCards=function(t,e){e=e||{},this.handCards.removeAllChildren();for(var i,n=(this.handCards,e.cardType||(0==this.position?TWIST.Card.userCard:TWIST.Card.playerCard),t.length),a=this.parent.parent.getChildByName("desk"),s=150,r=30,o=!("undefined"==typeof e.reSort),h=0;n>h;h++){var d;t[h];d=a.getCard(),d||(d=new TWIST.Card),d.cardValue=t[h],d.position=h,i=s+h*r,$.extend(e,{animationTime:i}),h!=n-1||o||(e.reSort=!0),this.addHandCards(d,e)}},a.setNumberCards=function(t){var e=this.numberOfCards.getChildAt(0),i=this.numberOfCards.getChildAt(1);0!==this.position&&t>0?(e.visible=!0,i.visible=!0,i.text=t):(e.visible=!1,i.visible=!1)},a.addHandCards=function(t,e){var n=e.animationTime||i,a=e.reSort||!1,s=this.handCards,r=this,o=TWIST.Card.draftCard,h=(t.pos||s.children.length,t.x,t.y,e.cardType||(0===this.position?TWIST.Card.userCard:TWIST.Card.playerCard));if(t.set({x:t.x-this.x-this.hand.x,y:t.y-this.y-this.hand.y,scaleX:o.scale,scaleY:o.scale}),this.listPhom&&this.listPhom.length&&!isNaN(t.cardValue)&&0==this.position){var d=[];this.listPhom.forEach(function(t,e){d=d.concat(t)}),t.isInPhom=d.indexOf(t.cardValue)>-1}s.addChild(t),createjs.Tween.get(t).to({x:isNaN(e.x)?h.seperator*s.getNumChildren():e.x,y:isNaN(e.y)?0:e.y,width:h.width,height:h.height,position:s.getNumChildren()-1,seperator:h.seperator,scaleX:h.scale,scaleY:h.scale},n,createjs.Ease.sineOut()).call(function(){0==r.position?(e.sideDown?this.bindOpenCard():(this.bindEventListener(),e.dragable&&this.setDraggable(!0)),e.sideDown||this.openCard(this.cardValue),e.sortPhom&&r.sortPhom(),a&&r.sortCard()):(this.visible=e.showPlayerCard,e.openCard&&this.openCard(this.cardValue))})},a.showThreeCards=function(){for(var t=this.handCards.children,e=0;e<t.length;e++){var i=t[e];i.openCard(i.cardValue),i.removeAllEventListeners()}},a.getDeckCard=function(t,e){e=e||{};var i=this.parent.parent.getChildByName("desk"),n=i.getCard();n.cardValue=t,$.extend(e,{animationTime:200,reSort:!0,dragable:!0}),this.addHandCards(n,e),this.markEatedCard()},a.getChuong=function(t){var e=this;t=t||{};var n=this.avatarContainer,a=n.getChildByName("chuongIcon");if(t.isChuong){var s=a.x,r=a.y,o=t.x||640,h=t.y||360,d=o-this.x-this.avatarContainer.x,u=h-this.y-this.avatarContainer.y;a.set({x:d,y:u,visible:!0}),createjs.Tween.get(a).to({x:s,y:r},i).call(function(){e.playerModel.isBanker=!0})}else e.playerModel.isBanker=!1,a.set({visible:!1})},a.draftCardsInHand=function(t,e){var e=e||{},i=[],n=TWIST.Card.draftCard,i=this.getCardsInHand(t),a=e.draftCards||this.draftCards,s=e.position||{x:a.children.length*n.seperator,y:0};"right"!==this.draftCards.align||e.position||(s.x=300-s.x);for(var r=0,o=i.length;o>r;r++){var h=i[r];h.cardValue=t[r];var d=$.extend(e,{draftCards:a,position:s,reSort:r===o-1});this.draftSingleCard(h,d),"right"!=this.draftCards.align||e.position?s.x+=n.seperator:s.x-=n.seperator}this.setNumberCards(this.handCards.children.length)},a.draftSingleCard=function(t,e){t.visible=!0,t.removeAllEventListeners();var n=this,a=TWIST.Card.draftCard,s=e.draftCards||this.draftCards,r=s.localToGlobal(0,0);t.set({x:t.x+this.hand.x+this.x-r.x,y:t.y+this.hand.y+this.y-r.y,rotation:e.rotateAble?30*(Math.random()-.5):0}),s.addChild(t),createjs.Tween.get(t).to({scaleX:1.2*t.scaleX,scaleY:1.2*t.scaleY},1*i/2).to({x:e.position.x,y:e.position.y,width:a.width,height:a.height,scaleX:a.scale,scaleY:a.scale},1*i/2).call(function(){0!==n.position?this.openCard(this.cardValue,a):e.reSort&&(this.setInPhom(!1),n.sortCard())})},a.sortDraftCards=function(){for(var t=this.draftCards.children,e=t.length,a=(n.width-e*TWIST.Card.draftCard.seperator-2*(this.draftCards.x+this.x))/2,s=0;s<t.length;s++){var r=t[s],o=a+s*TWIST.Card.draftCard.seperator;createjs.Tween.get(r).to({x:o},i,createjs.Ease.sineOut()).call(function(){})}},a.getCardsInHand=function(t){if(t){var e=[],i=this.handCards.children,n=i.map(function(t){return t.cardValue});if(0!=this.position)for(var a=0;a<t.length;a++){var s=t[a],n=i.map(function(t){return t.cardValue}),r=n.indexOf(s);if(r>-1)var o=i.splice(r,1);else var o=i.splice(n.indexOf(void 0),1);o[0]||(o[0]=new TWIST.Card),e=e.concat(o)}else for(var a=0;a<t.length;a++)for(var h=0;h<i.length;h++)t[a]==i[h].cardValue&&(e=e.concat(i.splice(h,1)),h--);return i.sort(function(t,e){return t.position-e.position}),i.forEach(function(t,e){t.position=e}),e.sort(function(t,e){return t.cardValue-e.cardValue}),e}},a.getSelectedCards=function(){var t=[],e=this.handCards.children;for(var i in e)e[i]&&1==e[i].selected&&t.push(e[i].cardValue);return t},a.sortPhom=function(t){var e=this.handCards.children,i=[];if(t)i=t.sort(function(t,e){return t-e});else for(var n=this.listPhom||[],a=0;a<n.length;a++){var s=n[a];s.sort(function(t,e){return t-e});for(var r=0;r<s.length;r++)i.push(s[r])}this.handCards.sortType=this.handCards.sortType?"":"rankSort";var o=this;e.forEach(function(t,e){t.setInPhom(i.indexOf(t.cardValue)>-1)}),e.sort(function(t,e){return i.indexOf(t.cardValue)>-1&&!(i.indexOf(e.cardValue)>-1)?!1:i.indexOf(e.cardValue)>-1&&!(i.indexOf(t.cardValue)>-1)?!0:i.indexOf(t.cardValue)>-1&&i.indexOf(e.cardValue)>-1?i.indexOf(t.cardValue)-i.indexOf(e.cardValue):"rankSort"==o.handCards.sortType?t.cardValue-e.cardValue:t.suite==e.suite?t.rank-e.rank:t.suite-e.suite})},a.sortTL=function(){var t=this.handCards.children;this.handCards.sortType=this.handCards.sortType?"":"rankSort";var e=this;t.sort(function(t,i){return"rankSort"==e.handCards.sortType?t.cardValue-i.cardValue:t.suite-i.suite||t.cardValue-i.cardValue}),this.sortCard()},a.sortCard=function(){function t(){var t=e.length,a=(TWIST.Desk.width-t*TWIST.Card.userCard.seperator-2*(n.hand.x+n.x))/2;n.handCards.indexLeft=a;for(var s=0;s<e.length;s++){var r=e[s];r.isDragging&&(r.isDragging=!1),r.selected=!1;var o=a+s*TWIST.Card.userCard.seperator;r.position=s,createjs.Tween.get(r).to({y:0,x:o},i,createjs.Ease.sineOut()).call(function(){})}}var e=this.handCards.children,n=this;setTimeout(t,100)},a.preparedShowPhom=function(t){for(var e=this.handCards.children,i=0;i<e.length;i++)i<t.length?!function(t){setTimeout(function(){t.setSelected(!0)},500)}(e[i]):e[i].setSelected(!1)},a.preparedSendCard=function(t){for(var e=this.handCards.children,i=0;i<e.length;i++){e[i].setSelected(!1);for(var n=0;n<t.length;n++)e[i].cardValue==t[n]&&!function(t){setTimeout(function(){t.setSelected(!0)},500)}(e[i])}},a.getLastDraftCards=function(t){if(t){for(var e=[],i=this.draftCards.children,n=0;n<t.length;n++)for(var a=0;a<i.length;a++)if(t[n]==i[a].cardValue){var s=i[a].localToGlobal(0,0);i[a].x=s.x,i[a].y=s.y,e=e.concat(i.splice(a,1)),a--}return e}},a.getDraftCardsAbsolutePosition=function(){return{x:this.x+this.draftCards.x,y:this.y+this.draftCards.y}},a.eatCard=function(t,e,n){this.numberEatedCard=this.numberEatedCard||0,this.numberEatedCard++;var a=0==this.position?TWIST.Card.userCard:TWIST.Card.draftCard;if(t.hightLight(),0==this.position)this.addHandCards(t,{animationTime:200,reSort:!0,sortPhom:!0,dragable:!0});else{var s=a.seperator*this.draftCards.children.length,r=0;this.handCards.addChild(t),t.set({x:t.x-this.hand.x-this.x,y:t.y-this.hand.y-this.y}),2==this.position?(s=0-this.hand.x+100+a.seperator*(this.numberEatedCard-1),r=0):(r=-45,s="right"==this.draftCards.align?0-this.hand.x+this.draftCards.x+300-(this.numberEatedCard-1)*a.seperator:0-this.hand.x+this.draftCards.x+a.seperator*(this.numberEatedCard-1)),createjs.Tween.get(t).to({x:s,y:r,width:a.width,height:a.height,scaleX:a.scale,scaleY:a.scale},i,createjs.Ease.sineOut()).call(function(){})}},a.markEatedCard=function(){var t=[];if(this.listPhom){this.listPhom.forEach(function(e,i){t=t.concat(e)});for(var e=this.handCards.children,i=0;i<e.length;i++)e[i].isInPhom=t.indexOf(e[i].cardValue)>-1,e[i].setInPhom(e[i].isInPhom)}},a.moveDraftCard=function(t,e){this.cardsEated++;for(var n=TWIST.Card.draftCard,a=this,s=0;s<t.length;s++){var r=t[s],o=this.draftCards.localToGlobal(0,0),h=(r.x,r.y,n.seperator*this.draftCards.children.length),d=0;r.localToGlobal(0,0);this.stage.addChild(r),"right"==this.draftCards.align&&(h=300-n.seperator*(this.draftCards.children.length-1));createjs.Tween.get(r).to({x:h+o.x,y:d+o.y,width:n.width,height:n.height,scaleX:n.scale,scaleY:n.scale},i,createjs.Ease.sineOut()).call(function(){a.draftCards.addChild(this),this.set({x:h,y:d})})}},a.showPhom=function(t){for(var e=0;e<t.length;e++){var i=t[e];this.showSinglePhom(i,e)}var n=this;setTimeout(function(){n.sortPhomArea()},550)},a.addShowPhomArea=function(t){var e=this.parent.parent.getChildByName("desk"),i=e.config.draftPositions[this.position],n=0,a=0;0==this.position?(n=i.y-TWIST.Card.draftCard.height-10,a=i.x):2==this.position?(a=this.hand.x+37,n=this.hand.y):(n=i.y-45,a="right"==this.draftCards.align?this.draftCards.x:this.draftCards.x),this.showPhomArea=new createjs.Container,this.showPhomArea.set({name:"showPhomArea",x:a,y:n}),this.addChild(this.showPhomArea)},a.addChipContainer=function(t){var i=this.parent.parent.getChildByName("desk"),n=i.chipPosition[this.position];this.chipContainer=new createjs.Container,this.chipContainer.set({name:"chipContainer",x:n.x,y:n.y,width:117,height:42,visible:!0});var a=new createjs.Bitmap((TWIST.imagePath||e)+"player/money-container.png"),s=new createjs.Text("0","20px Roboto Condensed","white");s.set({x:45,y:30,textAlign:"center",textBaseline:"bottom"}),this.chipContainer.addChild(a,s),this.addChild(this.chipContainer)},a.pushChip=function(t,e,i){for(var n=this,a=0;e>a;a++){var s=new TWIST.Chip(t);this.chipContainer.addChild(s);var r=this.chipContainer.width-s.width;s.set({x:50-this.chipContainer.x,y:10-this.chipContainer.y}),createjs.Tween.get(s).wait(100*a).to({x:r,y:0},200).call(function(){var e=n.chipContainer.getChildAt(1),i=isNaN(parseInt(e.text))?0:parseInt(e.text);e.text=i+ChipValues[t]})}},a.pushChicken=function(t,e){function i(t,e){for(var i=0;t>i;i++){var r=new TWIST.Chip(e);a.chickenTotal.addChild(r);var o=a.chickenTotal.localToGlobal(0,0),h=n.localToGlobal(50,10);r.set({x:h.x-o.x,y:h.y-o.y}),createjs.Tween.get(r).wait(s+=100).to({x:140,y:50},200).call(function(){a.chickenTotal.removeChild(this);var t=a.chickenTotal.getChildAt(1),i=isNaN(parseInt(t.value))?0:parseInt(t.value);t.value=i+ChipValues[e],t.text="Tổng gà : "+t.value})}}var n=this,a=this.parent.parent.getChildByName("desk"),s=0;a.chickenTotal.visible=!0;for(var r=0;r<t.length;r++)i(t[r].number,t[r].type)},a.showSinglePhom=function(t,e){for(var n=this.getCardsInHand(t),a=0;a<n.length;a++){var s=n[a];s.visible=!0,s.cardValue=t[a];var r=this,o=TWIST.Card.draftCard,h=this.showPhomArea,d=o.seperator*h.children.length,u=0;"right"==this.draftCards.align&&(d=300-o.seperator*h.children.length),this.showPhomArea.addChild(s),s.set({x:s.x+this.hand.x-h.x,y:s.y+this.hand.y-h.y}),s.removeAllEventListeners(),createjs.Tween.get(s,{override:!0}).to({x:d,y:u,width:o.width,height:o.height,scaleX:o.scale,scaleY:o.scale},i,createjs.Ease.sineOut()).call(function(){this.isInPhom=!1,0!=r.position?this.openCard(this.cardValue,o):this.setInPhom(!1)})}return n},a.addCardInShowPhom=function(t){var e=this,n=TWIST.Card.draftCard,e=this,a=(t.x,t.y,n.seperator*this.showPhomArea.children.length),s=0,r=this.showPhomArea;"right"==this.draftCards.align&&(a=300-n.seperator*(r.children.length-1)),t.localToGlobal(0,0),this.stage.addChild(t),t.removeAllEventListeners(),createjs.Tween.get(t).to({x:this.x+this.showPhomArea.x+a,y:this.y+this.showPhomArea.y+s,width:n.width,height:n.height,scaleX:n.scale,scaleY:n.scale},i).call(function(){e.showPhomArea.addChild(this),this.set({x:a,y:s}),this.openCard(this.cardValue)})},a.sortPhomArea=function(){var t=this.showPhomArea.children,e=t.length,i=TWIST.Card.draftCard,a=i.seperator,s=e*a;this.isCurrent;s>300&&(s=300);var r=0;0==this.position&&(r=(n.width-s-2*(this.showPhomArea.x+this.x))/2);for(var o=0;o<t.length;o++){var h=t[o],d=r+o*s/e;"right"==this.draftCards.align&&(d=300-s/e*o),createjs.Tween.get(h).to({x:d},100,createjs.Ease.sineOut()).call(function(){})}},a.showMoneyExchageEffect=function(t,e,n){var a=this.getChildByName("moneyChangeEffect");a.set({visible:!0,y:50});var s=a.getChildAt(0),r=a.getChildAt(1),o=Global.numberWithDot(Math.abs(parseInt(t)));"lose"===e?(r.color="red",s.text=r.text="- "+o):(r.color="yellow",s.text=r.text="+ "+o),createjs.Tween.get(a).to({y:n&&n.y?n.y:-20},i).call(function(){setTimeout(function(){a.visible=!1,r.text=""},2e3)})},a.setHandCardsValue=function(t){for(var e=this.handCards.children,i=0;i<t.length;i++){var n=e[i];n&&(n.cardValue=t[i])}},a.getHandCardAbsolutePosition=function(){return{x:this.x+this.hand.x+this.handCards.x,y:this.y+this.hand.y+this.handCards.y}},a.rerenderDraftPhom=function(t){if(t){for(var e=[],i=TWIST.Card.draftCard,n=0;n<t.length;n++){var a=new TWIST.Card(t[n]),s=i.seperator*n,r=0;"right"==this.draftCards.align&&(s=300-i.seperator*n),a.set({x:s,y:r,scaleX:i.scale,scaleY:i.scale}),this.draftCards.addChild(a)}return e}},a.hightLightEatCards=function(t){for(var e=this.handCards.children,i=0;i<e.length;i++)t.indexOf(e[i].cardValue)>-1&&e[i].hightLight();for(var e=this.showPhomArea.children,i=0;i<e.length;i++)t.indexOf(e[i].cardValue)>-1&&e[i].hightLight()},a.reEatCards=function(t){if(t){for(var e=[],i=TWIST.Card.draftCard,n=0;n<t.length;n++){var a=new TWIST.Card(t[n]),s=i.seperator*n,r=0;s="right"==this.draftCards.align?-0-this.handCards.x-this.hand.x+this.draftCards.x+300-n*i.seperator:0-this.handCards.x-this.hand.x+this.draftCards.x+n*i.seperator,a.set({x:s,y:r,scaleX:i.scale,scaleY:i.scale}),this.handCards.addChild(a)}return e}},a.showMessage=function(t){var e,n,a=this.getChildByName("chat"),s="rgba(255, 255, 0, 1)",r="rgba(0, 0, 0, 1)",o="rgba(0, 0, 0, 1)",h={};if(n=a.getChildAt(0),e=a.getChildAt(1),n.graphics.c(),e.set({color:s,text:t}),h.x=e.getMeasuredWidth(),h.y=e.getMeasuredHeight(),t&&t.length>28){var d=t.indexOf(" ",25);(25>d||d>35)&&(d=28),t=t.substring(0,d)+"\n"+t.substring(d),e.text=t;var u=e.clone();u.text=t.substring(0,d),h.x=u.getMeasuredWidth(),h.y=e.getMeasuredHeight()}e.set({x:h.x/2,y:(h.y+10)/5+18}),n.graphics.beginFill(r).beginStroke(o).setStrokeStyle(1).drawRoundRect(-10,-10,h.x+20,h.y+20,20);var c=this.hand.x<0?-(h.x+20):120,l=0;a.set({x:c,y:l,visible:!0}),createjs.Tween.get(a).to({alpha:1},i).to({x:c+1,y:l+1},100).to({x:c-1,y:l-2},100).to({x:c+1,y:l+1},100).to({x:c-1,y:l-2},100).to({x:c+1,y:l+1},100).to({x:c-1,y:l-2},100).wait(3500).to({alpha:0,visible:!1},500)},TWIST.Player=t}(),this.gbjs=this.gbjs||{},function(){"use strict";function t(t){this.parent=t,this.oldIndex,this.oldOffset,this.dragObj,this.dragIndex,this.newIndex,this.nextIndex,this.nextObj,this.cloneObj,this.space,t.on("mousedown",this._onDragStart,this),t.on("pressmove",this._onTouchMove,this),t.on("pressup",this._onDragOver,this)}t.active=!1,t.prototype._onDragStart=function(t){var e=t.target;if(this.dragObj=e,this.space)return!0;var i=e.parent.getChildAt(0),n=e.parent.getChildAt(1);i&&n&&(this.space=n.x-i.x)},t.prototype._dragStarted=function(e){var i=e.target;i.offset={x:i.x-e.stageX,y:i.y-e.stageY},i.draggable=!0,t.active=this,this.updateDragIndex(),this.cloneObj=i.clone()},t.prototype.updateDragIndex=function(){var t=this.parent.getChildAt(this.parent.numChildren-1);t!=this.dragObj&&this.parent.addChild(this.dragObj)},t.prototype._onTouchMove=function(e){if(this.dragObj){t.active||this._dragStarted(e);var i=e.target,n=this.parent.children,a=e.stageX+i.offset.x,s=e.stageY+i.offset.y;this.updateDragIndex(),i.x=a,i.y=s,0>a&&(a=0);var r=Math.round(a/this.space);r>=n.length&&(r=n.length-1),r!=this.newIndex&&(this.newIndex=r,this._sort())}},t.prototype._sort=function(){for(var t=this.newIndex,e=this.parent.children,i=this.space,n=0;t>n;n++){var a=e[n];createjs.Tween.get(a).to({x:n*i},100)}for(var n=t;n<e.length-1;n++){var a=e[n];createjs.Tween.get(a).to({x:(n+1)*i},100)}},t.prototype.handleEvent=function(t){},t.prototype._onDragOver=function(e){if(t.active){t.active=!1;var i=e.target;i.parent.addChildAt(i,this.newIndex),i.x=this.newIndex*this.space,i.y=this.cloneObj.y,i.draggable=!1}},t.prototype._onDrop=function(t){},t.prototype.destroy=function(){parent.on("pressmove",this._onTouchMove,this),parent.on("pressup",this._onDragOver,this)},gbjs.Sortable=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(){}var e={width:1e3,height:580},i=t.prototype=new EventEmitter;i.initBaseGame=function(){this.initEvent(),this.initCanvas(),this.wrapper.append(this.canvas),this.initStage()},i.initCanvas=function(){var t=$(TWIST.HTMLTemplate.canvas);return t.attr({width:this.options.width||e.width,height:this.options.height||e.height}),t.addClass("twist"),this.canvas=t,t},i.initStage=function(){function t(){i.update()}var e=this,i=new createjs.Stage(this.canvas[0]);i.enableMouseOver(20);var n=i.canvas.getContext("2d");n.mozImageSmoothingEnabled=!0,createjs.Touch.enable(i),createjs.Ticker.setFPS(60),i.width=this.canvas.width,i.height=this.canvas.height,createjs.Ticker.addEventListener("tick",t),this.on("destroy",function(){createjs.Ticker.removeEventListener("tick",t),e.removeAllListeners(),e.timeOutList.forEach(function(t,e){clearTimeout(t)})}),this.stage=i},i.initEvent=function(){this.timeOutList=[],this.on("destroy",function(){createjs.Tween.removeAllTweens(),TWIST.Sound.stop()})},i.addNumberEffect=function(t){var e=t,i=this,n=e.text();return n=parseInt(n.replace(/\./g,"")),isNaN(n)&&(n=0),e.prop("_counter",n),e.runEffect=function(t,i){e.finish(),e.isDone=!0;var n={duration:1e3,step:function(t){e.text(Global.numberWithDot(Math.ceil(t)))},done:function(){e.endEffect()}};$.extend(n,i),this.animate({_counter:t},n)},e.endEffect=function(){e.finish(),this.isTracking&&(this.isTracking=!1,i.emit("endEffect"))},e},i.addRemainTimeEffect=function(t,e){function i(){var t=r-(new Date).getTime();if(t>0){var e=Math.floor(t/6e4);10>e&&(e="0"+e);var i=Math.floor(t%6e4/1e3);10>i&&(i="0"+i),a.text(e+" : "+i)}else a.endEffect()}var n,a=t,s=this,r=0;return a.options=e,a.runEffect=function(t){clearInterval(n),t=isNaN(parseInt(t))?0:parseInt(t),r=(new Date).getTime()+t,i(),n=setInterval(i,100)},a.endEffect=function(){clearInterval(n),a.text(""),this.isTracking&&(this.isTracking=!1,s.emit("timeOut",a))},a},i.addDisbaleEffect=function(t,e){var i=t,n=this;return i.setDisabled=function(t){i.disabled=t,t?i.addClass("disabled"):i.removeClass("disabled")},i.runEffect=function(){i.setDisabled(!0)},i.endEffect=function(){i.setDisabled(!1),this.isTracking&&(this.isTracking=!1,n.emit("timeOut",i))},i},i.addChipEffect=function(t){var e=this,i=t;return i.runEffect=function(t){this.isDone=!0,this.removeClass("plus decrease");var e=t?"plus":"decrease";this.show();var n=i.find("i").length,a=0;i.find("i").show(),this.addClass(e),i.find("i").each(function(t){$(this).one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(this).hide(),a++,a==n&&i.endEffect()})})},i.endEffect=function(){this.isTracking&&(this.isTracking=!1,e.emit("_moveChipComplete",i))},i},TWIST.BaseGame=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(){}t.statusList={0:"STATUS_WAITING_FOR_PLAYER",1:"STATUS_WAITING_FOR_START",2:"STATUS_PLAYING",3:"STATUS_ENDING",4:"STATUS_WAITING_FOR_READY",6:"STATUS_WAITING_FOR_DEALING",7:"STATUS_DEALING",8:"STATUS_SHAKE_DISK",9:"STATUS_BETTING",10:"STATUS_END_BETTING",11:"STATUS_OPEN_DISK",12:"STATUS_CLOSE_DISK",13:"STATUS_ARRANGING",14:"STATUS_NOTIFY_SAM",15:"STATUS_DEAL_MASTER"};var e=t.prototype=new TWIST.BaseGame;e.initInRoomGame=function(){this.initBaseGame(),this.drawRoom(),this.pushInRoomGameEvent(),this.initInviteList(),this.initErrotPanel(),this.initButtonBar(),this.initResultPanel(),this.observerEvent(),this.userInfo={},this.status=t.statusList[0],this.model=this.model||{}},e.initInviteList=function(){function t(t,i){var n=$(TWIST.HTMLTemplate["inviteList/inviteItem"]);e.inviteList.push(n),e.inviteListTemplate.append(n),n.css({top:t.y,left:t.x}),i||n.hide(),n.on("click",function(){e.emit("invitePlayer")})}var e=this;this.inviteListTemplate=$(TWIST.HTMLTemplate["inviteList/wrapper"]),this.wrapper.append(this.inviteListTemplate);var i=this.desk.config.playerPositions;this.inviteList=[],i.forEach(function(e,i){t(e,i)})},e.initErrotPanel=function(){this.errorPanel=$(TWIST.HTMLTemplate.errorPanel),this.wrapper.append(this.errorPanel),this.errorList=this.errorList||{},$.extend(this.errorList,{0:"Lỗi hệ thống !",34:"Không được để 2 cuối !",1470:"Chưa chọn cây bài !"})},e.initButtonBar=function(){this.buttonBar=$(TWIST.HTMLTemplate["buttonBar/wrapper"]),this.wrapper.append(this.buttonBar),this.startButton=$(TWIST.HTMLTemplate["buttonBar/startButton"]),this.buttonBar.append(this.startButton),this.buttonBar.hide()},e.drawRoom=function(){var t=this.wrapper.find("canvas");t.css("background","url("+TWIST.imagePath+"Desk-bg.png) center no-repeat"),this.playersContainer=new createjs.Container,this.desk=new TWIST.Desk(this.options),this.desk.name="desk",this.stage.addChild(this.desk,this.playersContainer),this.wrapper.css({width:t.width(),height:t.height()})},e.pushInRoomGameEvent=function(){this.on("userInfo",this.setUserInfo),this.on("gameInfo",this.drawGameInfo),this.on("userJoin",this.addPlayer),this.on("userQuit",this.removePlayer),this.on("error",this.showError),this.on("changeMaster",this.changeRoomMaster),this.on("isolateUpdateMoney",this.isolateUpdateMoney),this.on("userChat",this.userChat),this.on("changeStatus",this.changeStatus),this.on("updateInfo",this.updateInfo),this.on("dealCards",this.dealCards),this.on("endGame",this.endGame),this.on("draftCards",this.onDraftCards),this.on("hitTurn",this.onHitTurn),this.on("reconnect",this.reconnect),this.on("updateUuid",this.updateUuid)},e.setUserInfo=function(t){this.userInfo=t||{},this.userInfo.uuid=this.userInfo.uuid||this.userInfo.id},e.observerEvent=function(){var t=this;TWIST.Observer.on("cardSelected",function(e){t.handCardSelected(e)})},e.drawGameInfo=function(t){this.model=this.model||{},$.extend(this.model,t);for(var e=this.model.players,i=0,n=e.length;n>i;i++)e[i].username===this.userInfo.username&&(this.userInfo.uuid=e[i].uuid);if(this.drawPlayers(),t.status)if("STATUS_PLAYING"===this.status)this.drawPlayingState(t);else if("STATUS_WAITING_FOR_START"===this.status){var a=this.getPlayerDataByUuid(this.userInfo.uuid);a&&a.isRoomMaster&&this.startButton.show()}t.remainingTime&&this.desk.setRemainingTime(t.remainingTime)},e.removePlayer=function(t){var e=this.getPlayerByUuid(t.uuid);if(e){var i=e.position;this.inviteList[i]&&this.inviteList[i].show(),this.playersContainer.removeChild(e)}this.removePlayerData(t.uuid)},e.showError=function(t){var e=this.errorList[t.code];e=e||t.message;var i=$('<div class="error-item">'+e+"</div>");$(i).css({margin:"0 auto",display:"inline-block"}),this.errorPanel.empty(),this.errorPanel.append(i);i.one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(i).remove()})},e.changeRoomMaster=function(t){for(var e=this.roomMasterIcon.globalPosition,i=t.uuid,n=this.model.players||[],a=0,s=n.length;s>a;a++){var r=n[a],o=this.getPlayerByUuid(r.uuid);r.uuid===i?(r.isRoomMaster=!0,o&&(this.roomMasterIcon=o.setRoomMaster(!0,e))):(r.isRoomMaster=!1,o&&o.setRoomMaster(!1))}},e.updateInfo=function(t){var e=this.getPlayerDataByUuid(this.userInfo.uuid);$.extend(e,t);var i=this.getPlayerByUuid(this.userInfo.uuid);i&&($.extend(i,t),i.render())},e.isolateUpdateMoney=function(t){var e=t.players,i=this;e.forEach(function(t,e){var n=i.getPlayerDataByUuid(t.uuid);if(n){n.money=parseInt(t.money);var a=i.getPlayerByUuid(t.uuid);if(a){a.setMoney(n.money);var s=t.changeMoney<0?"lose":"win";a.showMoneyExchageEffect(t.changeMoney,s)}}})},e.userChat=function(t){var e=this.getPlayerByUuid(t.uuid);e&&e.showMessage(t.message)},e.changeStatus=function(e){this.desk.setRemainingTime(parseInt(e.remainingTime)),this.status=t.statusList[e.newStatus];var i=this[this.status];"function"==typeof i&&i.call(this),this.emit("ping")},e.STATUS_WAITING_FOR_PLAYER=function(){this.buttonBar.hide()},e.STATUS_WAITING_FOR_START=function(){this.buttonBar.show(),this.buttonBar.find(".button").hide();var t=this.getPlayerDataByUuid(this.userInfo.uuid);t&&t.isRoomMaster&&this.startButton.show()},e.STATUS_PLAYING=function(){this.buttonBar.show(),this.buttonBar.find(".button").hide();var t=this.model.players||[];t.forEach(function(t,e){t.status="STATUS_PLAYING"}),this.desk.clear()},e.endGame=function(t){},e.reconnect=function(t){},e.addPlayer=function(t){var e=this.userInfo.indexPosition,i=t.indexPosition-e;0>i&&(i+=this.options.maxPlayers);var n=this.desk.config,a={};for(var s in n)a[s]=n[s][i];
t.config=a;var r=this.desk.config.playerPositions;$.extend(t,r[i]),t.position=i,this.model.players.push(t),this.playersContainer.children.length<this.options.maxPlayers&&(this.inviteList[i]&&this.inviteList[i].hide(),this.drawPlayer(t))},e.drawPlayers=function(){var t=this.model.players||[],e=this,i=0;t.forEach(function(t,n){t.uuid===e.userInfo.uuid&&(i=t.indexPosition,$.extend(e.userInfo,t))}),t.sort(function(t,n){var a=t.indexPosition-i;0>a&&(a+=e.options.maxPlayers);var s=n.indexPosition-i;return 0>s&&(s+=e.options.maxPlayers),a-s});var n=this.desk.config;t.forEach(function(t,a){var s={};t.position=t.indexPosition-i,t.position<0&&(t.position+=e.options.maxPlayers);for(var r in n)s[r]=n[r][t.position];t.config=s,$.extend(t,n.playerPositions[t.position])});var a=n.playerPositions;a.forEach(function(i,n){var a=t.find(function(t,e){return n==t.position});a?(e.drawPlayer(a),e.inviteList[n].hide()):e.inviteList[n].show()})},e.setPlayerTurn=function(t,e){for(var i=this.model.turningTime,n=this.playersContainer.children,a=0,s=n.length;s>a;a++){var r=n[a];r&&(r.uuid===t?r.setRemainingTime(e,i):r.clearTimer())}},e.drawPlayer=function(t){t.config=t.config||{},t.index=t.index||0;var e=new TWIST.Player(t);return this.playersContainer.addChild(e),t.isRoomMaster&&(this.roomMasterIcon=e.setRoomMaster(!0)),e},e.getPlayerByUuid=function(t){for(var e=this.playersContainer.children||[],i=0,n=e.length;n>i;i++){var a=e[i];if(a.uuid==t)return a}},e.getPlayerDataByUuid=function(t){for(var e=this.model.players||[],i=0,n=e.length;n>i;i++){var a=e[i];if(a.uuid===t)return a}},e.getCurrentPlayer=function(t){var e=this.userInfo.uuid;return this.getPlayerByUuid(e)},e.removePlayerData=function(t){for(var e=this.model.players||[],i=e.length,n=0,a=e.length;a>n;n++){var s=e[n];if(s.uuid===t){i=n;break}}e.splice(i,1)},e.initResultPanel=function(){var t=this;this.resultPanel=$(TWIST.HTMLTemplate["resultPanel/wrapper"]),this.wrapper.append(this.resultPanel);var e=this.resultPanel.find(".container")[0];this.resultPanel.find(".container").css("height","320px"),this.resultPanel.hide(),this.resultPanelScroll=new IScroll(e,{scrollX:!0,freeScroll:!0}),this.resultPanelScroll.refresh();var i=this.resultPanel.find(".close-popup"),n=this.resultPanel.find(".global-mask");i.on("click",function(){t.resultPanel.hide()}),n.on("click",function(){t.resultPanel.hide()})},e.showResult=function(t){this.resultPanel.show();var e=this.resultPanel.find(".popup-icon");t.isWinner?e.removeClass("lose"):e.addClass("lose");var i=this.resultPanel.find(".container>div");i.empty(),t.listPlayers.forEach(function(t,e){var n="",a=t.remainCards;a.forEach(function(t,e){var i=_.template(TWIST.HTMLTemplate["resultPanel/card"]),a=i({id:t});n+=a});var s=_.template(TWIST.HTMLTemplate["resultPanel/user"]),r=s({username:t.username,moneyChange:Global.numberWithDot(t.changeMoney),resultText:t.gameResultString,cardList:n,isWinnerClass:t.isWinner?"winner":""});i.append($(r))}),this.resultPanelScroll.refresh()},e.endIngameEvent=function(){this.desk.setRemainingTime(0),this.buttonBar.hide(),this.errorPanel.empty()},e.updateUuid=function(t){var e=t.username;if(this.model&&this.model.players){for(var i=this.model.players,n=0,a=i.length;a>n;n++)i[n].username===e&&(i[n].uuid=t.uuid);for(var s=this.playersContainer.children,n=0,a=s.length;a>n;n++)s[n].username===e&&(s[n].uuid=t.uuid)}},TWIST.InRoomGame=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t,e){}var e=t.prototype=new TWIST.InRoomGame;e.initBaseDemlaGame=function(t){TWIST.Card.RankMapIndex=["3","4","5","6","7","8","9","10","11","12","13","1","2"],this.initInRoomGame(),this.pushTLMNDemlaEvent(),this.bindButton()},e.pushTLMNDemlaEvent=function(){this.on("endTurn",this.onEndTurn),this.on("foldTurn",this.foldTurn)},e.handCardSelected=function(t){var e=this.desk.lastDraftCards;if(t&&e){var i=TWIST.TLMNLogic(e,t).getCards();i.length>0&&t.removeAllSelected(),i.forEach(function(t,e){t.setSelected(!0)})}},e.drawPlayingState=function(t){var e=t.players||[],i=this,n=t.playingPlayer,a=this.getPlayerByUuid(n.uuid);a&&(a.setRemainingTime(n.remainingTime,this.model.turningTime),a.uuid===this.userInfo.uuid&&(this.hitButton.show(),this.foldTurnButton.show())),t.lastDraftCards&&(this.desk.lastDraftCards=t.lastDraftCards,this.desk.createLastDraftCards(t.lastDraftCards)),e.forEach(function(e,n){var a=[];e.uuid===i.userInfo.uuid?(a=t.userListCard||[],a.sort(function(t,e){return t-e}),a.length>0&&i.sortCardButton.show()):a.length=e.numberCardsInHand;var s=i.getPlayerByUuid(e.uuid);s&&(s.handCards.cardList=a,s.renderCards({showPlayerCard:!0,dragable:!0}))})},e.dealCards=function(t){var e=t.cardList,i=this.model.players,n=0;i.forEach(function(t,e){"STATUS_PLAYING"===t.status&&n++});var a=n*this.options.numberCardsInHand,s=this;this.desk.generateCards(a),i.forEach(function(t,i){var n=[];if("STATUS_PLAYING"===t.status){t.uuid===s.userInfo.uuid&&(n=e,n.sort(function(t,e){return t-e}));var a=s.getPlayerByUuid(t.uuid);a&&(n.length=n.length||s.options.numberCardsInHand,a.handCards.cardList=n,a.renderCards({showPlayerCard:!0,dragable:!0}))}})},e.onHitTurn=function(t){var e=(t.uuid,this.getCurrentPlayer());e.handCards.children.length>0&&this.sortCardButton.show(),this.setPlayerTurn(t.uuid),t.uuid===this.userInfo.uuid&&(this.hitButton.show(),this.foldTurnButton.show())},e.onNotifyOne=function(t){var e=(t.uuid,this.getCurrentPlayer());e.setPlayerStatus("Báo 1 !")},e.foldTurn=function(t){var e=this.getPlayerByUuid(t.uuid);e&&(e.clearTimer(),t.uuid===this.userInfo.uuid&&(this.hitButton.hide(),this.foldTurnButton.hide()))},e.onDraftCards=function(t){TWIST.Sound.play("danh_bai");var e=t.cardList,i=t.uuid;this.desk.lastDraftCards=t.cardList;var n=this.getPlayerByUuid(i);if(!n)return void this.showError({code:0});i===this.userInfo.uuid&&(this.hitButton.hide(),this.foldTurnButton.hide()),this.desk.removeOverlayCards(),this.desk.setZeroVetical(),this.desk.overlayDraftCards();var a=TWIST.Card.userCard,s={};s.x=(TWIST.Desk.width-a.seperator*e.length)/2-TWIST.Desk.draftPosition.x,s.y=.8*a.height,n.draftCardsInHand(e,{draftCards:this.desk.draftCards,position:s,rotateAble:!0})},e.onEndTurn=function(t){this.desk.lastDraftCards=void 0,this.desk.clear(),this.hitButton.hide(),this.foldTurnButton.hide(),this.onHitTurn(t)},e.bindButton=function(){var t=this;this.startButton.unbind("click"),this.startButton.click(function(){t.emit("start",t.model.players)}),this.hitButton=$(TWIST.HTMLTemplate["buttonBar/hitButton"]),this.buttonBar.append(this.hitButton),this.hitButton.unbind("click"),this.hitButton.click(function(){var e=t.getCurrentPlayer(),i=e.getSelectedCards();return 0===i.length?void t.showError({code:1470}):void t.emit("hitCards",{cards:i})}),this.sortCardButton=$(TWIST.HTMLTemplate["buttonBar/sortCardButton"]),this.buttonBar.append(this.sortCardButton),this.sortCardButton.unbind("click"),this.sortCardButton.click(function(){var e=t.getCurrentPlayer();e.sortTL()}),this.foldTurnButton=$(TWIST.HTMLTemplate["buttonBar/foldTurnButton"]),this.buttonBar.append(this.foldTurnButton),this.foldTurnButton.unbind("click"),this.foldTurnButton.click(function(){t.emit("userFold")})},e.STATUS_ENDING=function(){this.buttonBar.hide(),this.errorPanel.empty(),this.desk.lastDraftCards=void 0,this.setPlayerTurn()},e.endDemlaGame=function(t,e,i){var n=this,a={isWinner:!1,listPlayers:[]};a.listPlayers=t.listPlayers;for(var s=0,r=a.listPlayers.length;r>s;s++){var o=a.listPlayers[s],h=o.remainCards;h.sort(function(t,e){return t-e}),parseInt(o.changeMoney)<0?t.winType===i?h.length===this.options.numberCardsInHand?o.gameResultString="Thua cóng":o.gameResultString="Thua "+h.length+" lá!":o.gameResultString="Thua !":parseInt(o.changeMoney)>0?(o.gameResultString=e[t.winType],o.isWinner=!0,o.uuid===this.userInfo.uuid&&(a.isWinner=!0)):o.gameResultString="Hòa";var d=this.getPlayerByUuid(o.uuid);d&&(d.clearTimer(),d.setMoney(o.money),d.showMoneyExchageEffect(o.changeMoney,parseInt(o.changeMoney)>0?"win":"lose"))}setTimeout(function(){n.showResult(a)},2e3)},TWIST.BaseDemlaGame=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t,e){this.wrapper=$(t),this.options=$.extend(v,e),this.initHightLowGame()}var e,i,n,a,s,r,o,h,d,u,c,l,f,p,m,g,v={resultTab:[]},T=t.prototype=new TWIST.BaseGame;T.initHightLowGame=function(){this.initVariable(),$.extend(this.options,c),this.info={betting:1e3,potData:{1e3:0,1e4:0,1e5:0}},this.userInfo={},this.initCanvas(),this.initEvent(),this.initTemplate(),this.draw(),this.pushEventListener(),this.status="pause"},T.initVariable=function(){e=["pause","endding","running"],d=["getCards","selectHightLow"],i=[{value:0,name:"2"},{value:1,name:"3"},{value:2,name:"4"},{value:3,name:"5"},{value:4,name:"6"},{value:5,name:"7"},{value:6,name:"8"},{value:7,name:"9"},{value:8,name:"10"},{value:9,name:"J"},{value:10,name:"Q"},{value:11,name:"K"},{value:12,name:"A"}],n=2.5,a=52,s=[],c={width:800,height:220},l={width:129,height:169},f={width:30,height:39},r=[1e3,1e4,1e5],o=2e3,u=[],h=0,p={},m={width:60,height:198,top:1,left:721},g=0},T.initTemplate=function(){this.wrapperTemplate=$(TWIST.HTMLTemplate["hightLow/wrapper"]),this.wrapper.append(this.wrapperTemplate),this.centerTempalte=$(TWIST.HTMLTemplate["hightLow/center"]),this.wrapperTemplate.append(this.centerTempalte),this.centerTempalte.find(".canvas-wrapper").append(this.canvas),this.initStage(),this.topTempalte=$(TWIST.HTMLTemplate["hightLow/top"]),this.wrapperTemplate.append(this.topTempalte),this.bottomTempalte=$(TWIST.HTMLTemplate["hightLow/bottom"]),this.wrapperTemplate.append(this.bottomTempalte),this._initExplodePot(),this._initPot(),this._initCurrentBetting(),this._initPotCards(),this._initSupportText(),this._initRemainTime(),this._initHightLowButton(),this._initHightLowBettingText(),this._initNewTurnText(),this._initVirtualCard(),this._initProfile(),this._initChipsButton(),this._initSessionId(),this._initNewTurnButton()},T._initExplodePot=function(){var t=this;this.effect=$('<div class="effect">'+TWIST.HTMLTemplate["effect/explodePot"]+"</div>"),this.wrapperTemplate.append(this.effect),this.effect.explorerPot=t.effect.find(".explorer-pot"),this.effect.moneyFalling=t.effect.find(".money-falling"),this.effect.showEffect=function(){t.effect.explorerPot.show(),t.effect.moneyFalling.show()},this.effect.hideEffect=function(){t.effect.explorerPot.hide(),t.effect.moneyFalling.hide()},this.effect.on("click",t.effect.hideEffect)},T._initPot=function(){this.pot=this.topTempalte.find(".pot-value"),this.addNumberEffect(this.pot)},T._initCurrentBetting=function(){this.currentBetting=this.topTempalte.find(".bank-value"),this.addNumberEffect(this.currentBetting)},T._initPotCards=function(){var t=this;this.potCards=[];var e=this.topTempalte.find(".pot-card");e.each(function(e,i){t.potCards.push($(i))}),this.potCards.addActiveCard=function(){var e=t.potCards.find(function(t,e){return!t.active});e&&(e.active=!0,e.addClass("active"))},this.potCards.removeActiveCard=function(){e.removeClass("active"),t.potCards.forEach(function(t,e){t.active=!1,t.removeClass("active")})}},T._initSupportText=function(){this.supportText=this.centerTempalte.find(".text-support"),this.supportText.text("")},T._initRemainTime=function(){this.remainTime=this.centerTempalte.find(".remain-time"),this.addRemainTimeEffect(this.remainTime)},T._initHightLowButton=function(){var t=this;this.lowButton=this.centerTempalte.find(".low-button"),this.addDisbaleEffect(this.lowButton),this.lowButton.runEffect(),this.hightButton=this.centerTempalte.find(".hight-button"),this.addDisbaleEffect(this.hightButton),this.hightButton.runEffect(),this.lowButton.on("click",function(e){t.lowButton.disabled||t.emitHightLow(!1)}),this.hightButton.on("click",function(e){t.hightButton.disabled||t.emitHightLow(!0)})},T._initHightLowBettingText=function(){this.lowBetting=this.centerTempalte.find(".low-value"),this.addNumberEffect(this.lowBetting),this.hightBetting=this.centerTempalte.find(".hight-value"),this.addNumberEffect(this.hightBetting)},T._initVirtualCard=function(){var t=this;this.virtualCard=this.centerTempalte.find(".virtual-card"),this.virtualCard.on("click",function(e){t.checkStart()})},T.checkStart=function(){var t=this;"pause"===t.status&&0===h&&(this.userInfo.money<this.info.betting?this.emit("error","Bạn không đủ tiền !"):(TWIST.Sound.play("minigame/ButtonClick"),TWIST.Sound.play("minigame/coin_spin"),t.emit("start",this.info.betting),this.newTurnText.hide(),this.changeStatus("running"),t.moneyContainer.runEffect(this.userInfo.money-this.info.betting,{duration:500}),this.moveChip.runEffect(!0)))},T.emitHightLow=function(t){var e=this;"pause"===e.status&&1===h&&(TWIST.Sound.play("minigame/ButtonClick"),this.emit("choose",t))},T._initNewTurnText=function(){this.newTurnText=this.centerTempalte.find(".new-turn-text")},T._initProfile=function(){var t=this;this.user=$(TWIST.HTMLTemplate["miniPoker/user"]),this.bottomTempalte.find(".profile-hight-low").append(this.user),this.moneyContainer=this.user.find(".money"),this.addNumberEffect(this.moneyContainer),this.user.renderUserInfo=function(e){$.extend(t.userInfo,e);var i=t.user.find(".avatar"),n=t.user.find(".username"),a=(t.user.find(".money"),Global.md5Avatar(e.avatar));i.addClass("avatar"+a),n.text(e.username),t.moneyContainer.runEffect(e.money,{duration:10})},this.moveChip=$(TWIST.HTMLTemplate["videoPoker/moveChip"]),this.user.append(this.moveChip),this.addChipEffect(this.moveChip),this.moveChip.hide()},T._initChipsButton=function(){var t=this;this.chipWrapper=$(TWIST.HTMLTemplate["miniPoker/chips"]),this.bottomTempalte.find(".chips-hight-low").append(this.chipWrapper),this.chipButtons=[{value:1e3,template:this.chipWrapper.find(".chip.violet")},{value:1e4,template:this.chipWrapper.find(".chip.green")},{value:1e5,template:this.chipWrapper.find(".chip.blue")}],this.chipButtons.forEach(function(e,i){e.template.on("click",function(i){"pause"===t.status&&0===h&&(this.resultSound=TWIST.Sound.play("minigame/Common_Click"),t.setBetting(e))})}),this.setBetting(this.chipButtons[0])},T._initSessionId=function(){this.sessionId=$(TWIST.HTMLTemplate["miniPoker/sessionId"]),this.wrapperTemplate.append(this.sessionId)},T.setBetting=function(t){this.chipWrapper.find(".chip").removeClass("active"),t.template.addClass("active"),this.info.betting=t.value,this.pot.runEffect(this.info.potData[this.info.betting],{duration:200})},T._initNewTurnButton=function(){var t=this;this.newTurnButton=this.bottomTempalte.find(".new-turn-button"),this.addDisbaleEffect(this.newTurnButton),this.newTurnButton.hide(),this.newTurnButton.on("click",function(e){t.newTurnButton.disabled||t.emit("newTurn")})},T.draw=function(){this.mainContainer=new createjs.Container,this.mainContainer.set({x:(c.width-l.width)/2,y:0}),this.winCardContainer=new createjs.Container,this.winCardContainer.set({x:m.left,y:m.top});var t=new createjs.Shape((new createjs.Graphics).drawRect(m.left,m.top,m.width,m.height));this.winCardContainer.mask=t,this.stage.addChild(this.mainContainer,this.winCardContainer),this.addMainCard(-1)},T.initWinCardDragable=function(){var t=this,e=this.centerTempalte;!function(){function i(e,i){createjs.Tween.get(t.winCardContainer,{override:!0}).to({y:e},200).call(function(){})}var n=e.find(".card-store"),a=($("#main"),1),s=m.height,r=t.winCardContainer,o=0,h=o,d=o-s,u=.5*s,c=.1,l=0,f=0,p=0,g=!1,v={scroll:!1,start:function(t){a=1,g=!0,l=t.clientY,f=r.y},drag:function(t){var e=t.clientY-l,n=e/a;if(p=f+n,p>h){var s=p-h,r=1-1/(s*c+1);p=h+u*r}if(d>p){var s=d-p,r=1-1/(s*c+1);p=d-u*r}i(p)},stop:function(t){g=!1,n.css({position:"absolute",right:125,left:"initial",top:0})}};n.draggable(v),n.on("mousewheel",function(t){var e=$scope.index;t.originalEvent.wheelDelta/120>0?(e--,e=Math.max(e,0)):(e++,e=Math.min(e,2)),p=h-e*s/2,i(p,e)})}()},T.addMainCard=function(t){this.mainContainer.removeAllChildren();var e,i;if(t>-1)e=new TWIST.Card(t),i=l.width/TWIST.Card.size.width,e.set({scaleX:i,scaleY:i,y:20});else{var n=new Image;n.src=TWIST.imagePath+"hightLow/card-back.png",e=new createjs.Bitmap(n),i=l.width/190,e.set({scaleX:i,scaleY:i,y:20})}this.mainContainer.addChild(e)},T.storeMainCard=function(){var t=this,e=this.mainContainer.children[0],i=this.winCardContainer.children.length,n=0,a=e.localToGlobal(e.x,e.y),s=f.height+6;this.stage.addChild(e),e.set(a);var r=m.height-s*i-20;if(r>0)n=s*i+10;else{n=m.height-s;var o=this.winCardContainer.y;createjs.Tween.get(this.winCardContainer).to({y:o-s},500).call(function(){})}createjs.Tween.get(e).to({x:this.winCardContainer.x+9.5,y:m.top+n,scaleX:f.width/TWIST.Card.size.width,scaleY:f.height/TWIST.Card.size.height},500).call(function(){t.winCardContainer.addChild(this),this.set({x:9.5,y:s*i+10}),t.emit("_storeComplete")})},T.drawListCard=function(t){function e(t,e){var n=new TWIST.Card(t);i.winCardContainer.addChild(n),n.set({x:10+(f.width+10)*e,y:10,scaleX:f.width/TWIST.Card.size.width,scaleY:f.height/TWIST.Card.size.height})}var i=this;this.winCardContainer.removeAllChildren(),t.forEach(e)},T.changeStatus=function(t){var e=this;this.clear(),"pause"===t&&this.newTurnButton.setDisabled(!1),"running"===t&&(this.playingInterval=setInterval(function(){e.addMainCard(parseInt(52*Math.random()))},100),u.push(this.playingInterval),this.hightButton.setDisabled(!0),this.lowButton.setDisabled(!0),this.newTurnButton.setDisabled(!0))},T.changeGameState=function(t){h=t,this.clearGameState(),0==h?(this.changeStatus("pause"),this.addMainCard(-1),this.virtualCard.show(),this.newTurnText.show(),this.newTurnButton.hide(),this.hightButton.setDisabled(!0),this.lowButton.setDisabled(!0),this.lowBetting.runEffect(0,{duration:10}),this.hightBetting.runEffect(0,{duration:10}),this.effect.hide()):1==h&&(this.newTurnText.hide(),this.virtualCard.hide(),this.newTurnButton.show())},T.clear=function(){this.supportText.text(""),this.remainTime.endEffect(),u.forEach(function(t){clearTimeout(t)})},T.clearGameState=function(){this.clear(),this.potCards.removeActiveCard(),this.winCardContainer.removeAllChildren(),this.winCardContainer.set({y:0}),this.currentBetting.runEffect(0)},T.setNewCard=function(t){this.addMainCard(t.cardId),this.hightButton.setDisabled(!1),this.lowButton.setDisabled(!1),this.hightBetting.runEffect(t.hightMoney,{duration:300}),this.lowBetting.runEffect(t.lowMoney,{duration:300}),t.isPotCard&&this.potCards.addActiveCard(),g=t.currentBetting,this.currentBetting.runEffect(t.currentBetting||0,{duration:300}),t.currentBetting>0?(t.currentBetting!=this.info.betting&&TWIST.Sound.play("minigame/NormalWin"),this.supportText.text("Quân bài tiếp theo là cao hay thấp hơn ?"),this.remainTime.runEffect(t.remainTime||12e4),this.hightButton.setDisabled(!1),this.lowButton.setDisabled(!1),0==t.hightMoney&&this.hightButton.setDisabled(!0),0==t.lowMoney&&this.lowButton.setDisabled(!0),t.explorerPot&&this.effect.showEffect()):(TWIST.Sound.play("minigame/slot_result"),this.supportText.text("Bạn chọn sai, chúc bạn may mắn lần sau !"),this.hightButton.setDisabled(!0),this.lowButton.setDisabled(!0))},T.pushEventListener=function(){var t=this;this.on("userInfo",function(){t.user.renderUserInfo(arguments[0])}),this.on("getFirstCard",function(e){t.getFirstCard(e)}),this.on("updatePots",function(e){t.bindPots(e)}),this.on("newCard",function(e){t.newCard(e)}),this.on("getWin",function(e){t.getWin(e)}),this.on("updateMoney",function(e){t.updateMoney(e)}),this.on("error",function(e){t.showError(e)}),this.on("reconnect",function(e){t.reconnect(e)})},T.getFirstCard=function(t){this.changeGameState(1),this.changeStatus("pause"),t.currentBetting=t.currentBetting||this.info.betting,this.setNewCard(t),this.newTurnButton.setDisabled(!0),this.sessionId.text(t.sessionId)},T.bindPots=function(t){$.extend(this.info.potData,t.pots),this.pot.runEffect(this.info.potData[this.info.betting],{duration:500})},T.newCard=function(t){var e=this;this.storeMainCard(),this.changeStatus("running"),this.once("_storeComplete",function(){e.changeStatus("pause"),e.setNewCard(t)})},T.getWin=function(t){var e=this;this.sessionId.text(""),g>0?(TWIST.Sound.play("minigame/coin_spin"),this.moveChip.isTracking=!0,this.moveChip.runEffect(),this.moneyContainer.runEffect(parseInt(this.userInfo.money)+g,{duration:500}),this.currentBetting.runEffect(0,{duration:500}),this.once("_moveChipComplete",function(){e.changeGameState(0)})):this.changeGameState(0)},T.updateMoney=function(t){this.userInfo.money=t.newMoney},T.showError=function(t){this.supportText.text(t)},T.reconnect=function(t){var e;if(this.chipButtons.forEach(function(i,n){i.value==t.betting&&(e=i)}),this.changeGameState(1),this.setBetting(e),t.listCard.length?this.setNewCard(t):this.getFirstCard(t),this.drawListCard(t.listCard),t.numberPotCards)for(var i=0;i<t.numberPotCards;i++)this.potCards.addActiveCard()},TWIST.HightLowGame=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t,e){this.wrapper=$(t),this.options=$.extend(C,e),this.initMiniPoker()}var e,i,n,a,s,r,o,h,d,u,c,l,f,p,m,g,v,T,C={resultTab:[{name:"Sảnh rồng(Nỗ hũ)",value:-1,code:"1"},{name:"Thùng phá sảnh",value:1e3,code:"2"},{name:"Tứ quý",value:150,code:"3"},{name:"Cù lũ",value:50,code:"4"},{name:"Thùng",value:20,code:"5"},{name:"Sảnh",value:13,code:"6"},{name:"Ba lá",value:8,code:"7"},{name:"Hai đôi",value:5,code:"8"},{name:"Đôi J hoặc cao hơn",value:2.5,code:"9"},{name:"Không ăn !",value:0,code:"10"}]},y=t.prototype=new TWIST.BaseGame;y.initMiniPoker=function(){this.initVariable(),$.extend(this.options,e),this.info={betting:1e3,potData:{1e3:0,1e4:0,1e5:0}},this.userInfo={},this.initCanvas(),this.initEvent(),this.initTemplate(),this.initButton(),this.draw(),this.pushEventListener(),this.status="pause"},y.initVariable=function(){r=["pause","running","ending","effecting"],v=[{value:0,name:"2"},{value:1,name:"3"},{value:2,name:"4"},{value:3,name:"5"},{value:4,name:"6"},{value:5,name:"7"},{value:6,name:"8"},{value:7,name:"9"},{value:8,name:"10"},{value:9,name:"J"},{value:10,name:"Q"},{value:11,name:"K"},{value:12,name:"A"}],o=-1,d=1,i={width:126,height:168,padding:10},e={width:5*i.width,height:i.height,x:5,y:1},n=i.height,a=[],s=2.5,h=52,u={x:100,y:100},l=[],c=[1e3,1e4,1e5],f=2e3,p=0,m=0,g=[],T=!1},y.draw=function(){this.mapData=TWIST.MiniPokerLogic.generateMap();var t=new createjs.Container;this.spinArea=t;for(var n=0;n<e.x;n++){a[n]=new createjs.Container,a[n].set({x:n*i.width,y:0});var s=new createjs.Container;a[n].addChild(s);var r=(this.mapData[n],this.createSlotItem(this.mapData[n],0));s.addChild(r),t.addChild(a[n])}this.stage.addChild(t)},y.initTemplate=function(){var t=this;this.wrapperTemplate=$(TWIST.HTMLTemplate["miniPoker/wrapper"]),this.wrapper.append(this.wrapperTemplate),this.wrapperTemplate.append(this.canvas),this.initStage(),this.resultText=$(TWIST.HTMLTemplate["miniPoker/resultText"]),this.wrapperTemplate.append(this.resultText),this.wrapperTemplate.append($(TWIST.HTMLTemplate["miniPoker/pot"])),this.pot=this.wrapperTemplate.find(".pot-value"),this.buttonSpin=$(TWIST.HTMLTemplate["miniPoker/button"]),this.wrapperTemplate.append(this.buttonSpin);var e=$(TWIST.HTMLTemplate["miniPoker/autospin"]);this.wrapperTemplate.append(e),this.autoSpin=e.find('input[type="checkbox"]'),this.chipWrapper=$(TWIST.HTMLTemplate["miniPoker/chips"]),this.wrapperTemplate.append(this.chipWrapper),this.chipButtons=[{value:1e3,template:this.chipWrapper.find(".chip.violet")},{value:1e4,template:this.chipWrapper.find(".chip.green")},{value:1e5,template:this.chipWrapper.find(".chip.blue")}],this.errorPanel=$(TWIST.HTMLTemplate["miniPoker/errorPanel"]),this.wrapperTemplate.append(this.errorPanel),this.errorPanel.hide(),this.resultTab=$(TWIST.HTMLTemplate["miniPoker/resultTab"]),this.wrapperTemplate.append(this.resultTab),this.resultItemList=[],this.resultItem=_.template(TWIST.HTMLTemplate["miniPoker/resultItem"]),this.options.resultTab.forEach(function(e,i){if("10"!==e.code){var n={code:e.code,template:$(t.resultItem({name:e.name,value:e.value<=0?"":"X"+e.value}))};t.resultTab.append(n.template),t.resultItemList.push(n)}}),this.user=$(TWIST.HTMLTemplate["miniPoker/user"]),this.wrapperTemplate.append(this.user),this.sessionId=$(TWIST.HTMLTemplate["miniPoker/sessionId"]),this.wrapperTemplate.append(this.sessionId),this.effectWrapper=$(TWIST.HTMLTemplate["effect/wrapper"]),this.wrapperTemplate.append(this.effectWrapper),this.explodePot=$(TWIST.HTMLTemplate["effect/explodePot"]),this.effectWrapper.append(this.explodePot),this.money=this.user.find(".money"),this.setBetting(this.chipButtons[0])},y.initButton=function(){var t=this;this.chipButtons.forEach(function(e,i){e.template.on("click",function(i){"pause"!==t.status&&"effecting"!==t.status||(TWIST.Sound.play("minigame/Common_Click"),t.setBetting(e))})}),this.autoSpin.on("change",function(e){t.isAutoSpin=e.target.checked,"pause"!=t.status&&"effecting"!=t.status||t.checkStart()}),this.buttonSpin.on("click",function(e){t.buttonSpin.hasClass("disabled")||t.checkStart()})},y.setBetting=function(t){this.chipWrapper.find(".chip").removeClass("active"),t.template.addClass("active"),this.info.betting=t.value,this.changeNumberEffect(this.pot,this.info.potData[this.info.betting],{duration:200}).runEffect()},y.pushEventListener=function(){var t=this;this.on("endSpin",function(e){t.endSpin(e)}),this.on("userInfo",function(){t.renderUserInfo(arguments[0])}),this.on("spin",function(){t.startSpin()}),this.on("spinCompleted",function(){t.effecting()}),this.on("endEffect",function(){}),this.on("updateMoney",function(e){t.updateMoney(e)}),this.on("updatePots",function(e){t.bindPots(e)}),this.on("error",function(e){t.showError(e)})},y.showError=function(t){var e=$('<div class="error-item-mini">'+t+"</div>"),i=this;this.errorPanel.empty(),this.errorPanel.show(),this.errorPanel.append(e);var i=this;e.one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(e).remove(),i.errorPanel.hide()})},y.checkStart=function(){var t=this;if("pause"===t.status||"effecting"===t.status){var t=this;this.userInfo.money<this.info.betting?this.emit("error","Bạn không đủ tiền !"):("pause"!==t.status&&t.changeStatus("pause"),this.startSound=TWIST.Sound.play("minigame/bonus_spin"),t.emit("spin",this.info.betting),t.changeNumberEffect(t.money,t.userInfo.money-t.info.betting,{duration:200}).runEffect())}},y.renderUserInfo=function(t){$.extend(this.userInfo,t);var e=this.user.find(".avatar"),i=this.user.find(".username"),n=this.user.find(".money"),a=Global.md5Avatar(t.avatar);e.addClass("avatar"+a),i.text(t.username);var s=Global.numberWithDot(t.money);n.text(s)},y.bindPots=function(t){$.extend(this.info.potData,t.pots),this.changeNumberEffect(this.pot,this.info.potData[this.info.betting],{duration:200}).runEffect()},y.changeStatus=function(t){var e=this;if(this.status=t,this.timeOutList.forEach(function(t){clearTimeout(t)}),this.timeOutList=[],"pause"==t){this.result={},p>=l.length&&(p=0);var i=l[p];if(i&&i.length)for(var n=0;n<i.length;n++)i[n].isDone||i[n].endEffect();if(l=[],p=0,this.isAutoSpin){var a=setTimeout(function(){e.status="pause",e.checkStart()},500);this.timeOutList.push(a)}}"running"==t&&(this.resultSound&&this.resultSound.stop(),this.buttonSpin.addClass("disabled"),this.autoSpin.find("input").attr("disabled",!0),this.resultText.text("")),"effecting"==t&&(this.startSound&&this.startSound.stop(),this.isAutoSpin?this.buttonSpin.addClass("disabled"):this.buttonSpin.removeClass("disabled"),this.autoSpin.find("input").attr("disabled",!1))},y.startSpin=function(){o=-1;var t=this,e=a[0].getChildAt(0);this.changeStatus("running"),createjs.Tween.get(e).to({y:-50},150).call(function(){}).to({y:0},150).call(function(){t.spinAllColumns()})},y.spinAllColumns=function(){for(var t=this,i=0;i<e.x;i++)t.spinColumn(i)},y.spinColumn=function(t){var i=this.options.speed||s,r=!1,h=!1;o>-1&&t==Math.floor((10*o+9)/10/e.y)&&o%1==0&&(r=!0,h=o%e.y==e.y);var u,c=this,l=a[t].getChildAt(0);u=r?this.createSlotItem(this.mapData[t],-1):this.createSlotItem(Math.floor(4*Math.random())+52,-1),l.addChild(u);var f=h?createjs.Ease.getBackOut(5):createjs.Ease.linear,p=h?2*n/i:n/i;createjs.Tween.get(l).to({y:n},p,f).call(function(){var t=this.parent.parent.getChildIndex(this.parent);this.set({y:0});var i=this.children;if(i.forEach(function(t,e){t.state++,t.goNextStep()}),this.removeChild(i.find(function(t){return t.state==e.y})),o>-1){Math.floor(Math.floor((o+.9)/e.y));if(t==Math.floor((10*o+9)/10/e.y)){var n=o%e.y==e.y-1;n?d=.2:o%e.y==0&&(d=1),o=(10*o+10*d)/10,n?o=(10*o+10*d)/10:c.spinColumn(t)}else c.spinColumn(t);o>e.x*e.y-1&&c.emit("spinCompleted")}else c.spinColumn(t)})},y.endSpin=function(t){"running"===this.status&&(this.changeStatus("ending"),this.result=this.result||{},$.extend(this.result,t),this.mapData=t.map,this.showSessionId(t.sessionId),o=-.8,d=.2)},y.updateMoney=function(t){this.result=this.result||{},$.extend(this.result,t),this.userInfo.money=t.newMoney},y.effecting=function(){var t=this;this.changeStatus("effecting");var e=this.result;l=[];var i=[],n=this.hightLightWinCards(e.hightLightCards);if(i.push(n),this.showResultText(e.cardListRank,e.rankOfVerticalGroup),1==e.cardListRank){var a=this.explodePotEffect();i.push(a)}if(parseInt(e.winMoney)>0){var s=this.winMoneyEffect(e.winMoney),r=this.changeNumberEffect(this.money,e.newMoney,{duration:f}),o=this.hightlightWinRank(e.cardListRank);i.push(s,r,o),this.resultSound=TWIST.Sound.play("minigame/NormalWin")}else this.resultSound=TWIST.Sound.play("minigame/slot_result");if(i.oneTime=!0,i.forEach(function(t,e){t.isTracking=!0}),l.push(i),this.isAutoSpin){var h=setTimeout(function(){t.checkStart()},2e3);this.timeOutList.push(h)}this.runNextEffect()},y.runNextEffect=function(){function t(){m=0;for(var t=0;t<e.length;t++)e[t].runEffect()}var e=l[p];if(e&&e.length)if(e.oneTime)e.done?(p++,p==l.length&&(T?p=0:this.changeStatus("pause")),"effecting"===this.status):t();else{var i=setTimeout(t,300);this.timeOutList.push(i)}},y.endEffect=function(){var t=this;if(m++,m==(l[p]&&l[p].length)){if(l[p].oneTime&&(l[p].done=!0),p++,p==l.length)if(T)p=0;else if(this.isAutoSpin){var e=setTimeout(function(){t.status="pause",t.checkStart()},500);this.timeOutList.push(e)}else t.status="pause";"effecting"===this.status}},y.createSlotItem=function(t,e){var n=new createjs.Container,a=new TWIST.Card(t);return t>51&&(t-=52,a.bg.sourceRect={width:TWIST.Card.size.width,height:152,x:TWIST.Card.size.width*(9+t),y:4*TWIST.Card.size.height}),a.set({scaleX:TWIST.Card.miniPoker.scale,scaleY:TWIST.Card.miniPoker.scale,x:(i.width-TWIST.Card.miniPoker.width)/2,y:(i.height-TWIST.Card.miniPoker.scale*TWIST.Card.size.height)/2}),n.addChild(a),n.set({x:0,y:i.height*e,state:e}),n.goNextStep=function(){var t=i.height*this.state;this.set({y:t})},n},y.changeNumberEffect=function(t,e,i){var n=$(t),a=this;return n.newValue=e,n.options=i,n.runEffect=function(){n.finish(),n.isDone=!0;var t=this.text(),e={duration:1e3,step:function(t){n.text(Global.numberWithDot(Math.ceil(t)))},done:function(){n.endEffect()}};$.extend(e,n.options),t=parseInt(t.replace(/\./g,"")),isNaN(t)&&(t=0),this.prop("Counter",t).animate({Counter:n.newValue},e)},n.endEffect=function(){n.finish(),this.isTracking&&(this.isTracking=!1,a.emit("endEffect"))},n},y.explodePotEffect=function(){var t=this,e=$("#effect .explorer-pot");new Date;return e.runEffect=function(){this.show()},e.click(function(){e.isDone=!1,e.endEffect()}),e.endEffect=function(){this.hide(),this.isDone=!0,this.isTracking&&(this.isTracking=!1,t.emit("endEffect"))},e},y.winMoneyEffect=function(t){var e=this,i=$(TWIST.HTMLTemplate["miniPoker/winMoney"]);return i.text(Global.numberWithDot(t)),i.one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){i.endEffect()}),i.runEffect=function(){i.isDone=!1,t>0&&e.user.append(i)},i.endEffect=function(){i.remove(),i.isDone=!0,this.isTracking&&(this.isTracking=!1,e.emit("endEffect"))},i},y.hightlightWinRank=function(t){var e=this,i=this.resultItemList.find(function(e,i){return e.code==t}),n=i?i.template:$("<div></div>");return n.one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){
n.endEffect()}),n.runEffect=function(){n.isDone=!1,n.addClass("active"),this.isTracking&&(this.isTracking=!1,e.emit("endEffect"))},n.endEffect=function(){n.removeClass("active"),n.isDone=!0},n},y.hightLightWinCards=function(t){for(var i=this,n=[],s=0;s<e.x;s++){var r=a[s].children[0].children[0].children[0];r.active=t[s],r.border.sourceRect.x=4*TWIST.Card.size.width,n.push(r)}return n.runEffect=function(){n.isDone=!0,n.forEach(function(t,e){parseInt(t.active)?t.hightLight():t.Overlay()}),this.isTracking&&(this.isTracking=!1,i.emit("endEffect"))},n.endEffect=function(){n.isDone=!0},n},y.showResultText=function(t,e){var i=this,n=this.options.resultTab.find(function(e,i){return e.code==t}),a=v.find(function(t,i){return t.value==e}),s=n.name;3!=n.code&&7!=n.code&&9!=n.code||!a||(s=s+" "+a.name,9==n.code&&(s="Đôi "+a.name)),this.resultText.text(s);var r={};return r.runEffect=function(){r.isDone=!1,i.resultText.text(s),this.isTracking&&(this.isTracking=!1,i.emit("endEffect"))},r.endEffect=function(){i.resultText.text(""),r.isDone=!0},r},y.explodePotEffect=function(){var t=this,e=this.explodePot;new Date;return e.runEffect=function(){this.isDone=!1,this.show()},e.click(function(){e.endEffect()}),e.endEffect=function(){this.hide(),this.isDone=!0,this.isTracking&&(this.isTracking=!1,t.emit("endEffect"))},e},y.showSessionId=function(t){this.sessionId.text(t)},TWIST.MiniPoker=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t,i){this.wrapper=$(t),this.options=$.extend(e,i),this.initPhomGame()}var e={maxPlayers:4,numberCardsInHand:9,turnTime:2e4,numberCardsRender:13,renderCardOptions:{showPlayerCard:!0,dragable:!0}},i=t.prototype=new TWIST.InRoomGame;i.initPhomGame=function(t){TWIST.Card.RankMapIndex=["1","2","3","4","5","6","7","8","9","10","11","12","13"],this.initInRoomGame(),this.bindButton(),this.pushPhomEvent()},i.pushPhomEvent=function(){this.on("getTurn",function(t){this.onGetTurn(t)}),this.on("getCardComplete",function(t){this.getCardComplete(t)}),this.on("enableEatCard",function(t){this.enableEatCard(t)}),this.on("enableU",function(t){this.enableU(t)}),this.on("enableShowPhom",function(t){this.enableShowPhom(t)}),this.on("enableSendCard",function(t){this.enableSendCard(t)}),this.on("eatCardSuccess",function(t){this.eatCardSuccess(t)}),this.on("moveDraftCard",function(t){this.moveDraftCard(t)}),this.on("showPhomComplete",function(t){this.showPhom(t)}),this.on("sendCardComplete",function(t){this.sendCard(t)}),this.on("entiretyCard",function(t){this.entiretyCard(t)})},i.onGetTurn=function(t){var e=(t.uuid,this.getCurrentPlayer());e.handCards.children.length>0&&this.sortCardButton.show(),this.hitButton.hide(),t.uuid===this.userInfo.uuid&&this.getCardButton.show(),this.setPlayerTurn(t.uuid)},i.onHitTurn=function(t){var e=(t.uuid,this.getCurrentPlayer());e.handCards.children.length>0&&this.sortCardButton.show(),this.getCardButton.hide(),this.eatCardButton.hide(),t.uuid===this.userInfo.uuid&&this.hitButton.show(),this.setPlayerTurn(t.uuid)},i.getCardComplete=function(t){this.getCardButton.hide();var e=t.cardIndex,i=t.uuid,n=t.listPhom,a=this.getPlayerByUuid(i);a.listPhom=n,a.getDeckCard(e,n)},i.enableEatCard=function(){this.eatCardButton.show()},i.enableU=function(){this.entiretyButton.show()},i.enableShowPhom=function(t){var e=this,i=this.getCurrentPlayer();i.handCards.sortType="suiteSort",i.sortPhom(t.listCard),setTimeout(function(){i.preparedShowPhom(t.listCard),e.showPhomButton.show()},500)},i.enableSendCard=function(t){var e=this,i=this.getCurrentPlayer();i.preparedSendCard(t.listCard),setTimeout(function(){e.sendCardButton.show()},500)},i.eatCardSuccess=function(t){this.eatCardButton.hide();var e=this.getPlayerByUuid(t.hitPlayer),i=this.getPlayerByUuid(t.eatPlayer);this.getCurrentPlayer();if(i){var n;n=e?e.getLastDraftCards([t.cardIndex])[0]:new TWIST.Card(parseInt(t.cardIndex)),i.listPhom=t.listPhom,i.eatCard(n)}},i.moveDraftCard=function(t){var e=this.getPlayerByUuid(t.fromPlayer),i=this.getPlayerByUuid(t.toPlayer);if(e&&i){var n=e.getLastDraftCards([t.cardIndex]);i.moveDraftCard(n,e)}},i.onDraftCards=function(t){TWIST.Sound.play("danh_bai"),this.hitButton.hide(),this.sendCardButton.hide(),this.showPhomButton.hide(),this.entiretyButton.hide();var e=[t.cardIndex],i=t.uuid,n=this.getPlayerByUuid(i);n.listPhom=t.listPhom||n.listPhom,n.draftCardsInHand(e),n.markEatedCard(),this.desk.lastActivePlayer=t.uuid,this.desk.lastDraftCard=e},i.drawPlayingState=function(t){var i=t.players||[],n=this,a=t.playingPlayer,s=this.getPlayerByUuid(a.uuid);s&&(s.setRemainingTime(a.remainingTime,this.model.turningTime),s.uuid===this.userInfo.uuid&&(this.hitButton.show(),this.foldTurnButton.show())),t.lastDraftCards&&(this.desk.lastDraftCards=t.lastDraftCards,this.desk.createLastDraftCards(t.lastDraftCards)),i.forEach(function(i,a){var s=[];i.uuid===n.userInfo.uuid?(s=t.userListCard||[],s.sort(function(t,e){return t-e}),s.length>0&&n.sortCardButton.show()):s.length=i.numberCardsInHand;var r=n.getPlayerByUuid(i.uuid);r&&(r.handCards.cardList=s,r.renderCards(e.renderCardOptions))})},i.dealCards=function(t){var i=t.cardList,n=this.model.players,a=this.options.maxPlayers*this.options.numberCardsRender,s=this;this.desk.generateCards(a,TWIST.Card.userCard),n.forEach(function(n,a){var r=[];if("STATUS_PLAYING"===n.status){n.uuid===s.userInfo.uuid&&i&&(r=i||[],r.sort(function(t,e){return t-e})),t.firstPlayer&&t.firstPlayer.uuid&&n.uuid==t.firstPlayer.uuid&&(r.length=s.options.numberCardsInHand+1);var o=s.getPlayerByUuid(n.uuid);o&&(r.length=r.length||s.options.numberCardsInHand,0==o.position&&(o.listPhom=t.listPhom),o.handCards.cardList=r,o.renderCards(e.renderCardOptions))}}),this.desk.showRemainingDeckCard()},i.setPlayerTurn=function(t,e){for(var i=this.model.turningTime,n=this.playersContainer.children,a=0,s=n.length;s>a;a++){var r=n[a];r&&(r.uuid===t?r.setRemainingTime(e,i):r.clearTimer())}},i.bindButton=function(){var t=this;this.startButton.unbind("click"),this.startButton.click(function(){t.emit("start",t.model.players)}),this.hitButton=$(TWIST.HTMLTemplate["buttonBar/hitButton"]),this.buttonBar.append(this.hitButton),this.hitButton.unbind("click"),this.hitButton.click(function(){var e=t.getCurrentPlayer(),i=e.getSelectedCards();return 0===i.length?void t.showError({code:1470}):void t.emit("hitCards",{cards:i})}),this.sortCardButton=$(TWIST.HTMLTemplate["buttonBar/sortCardButton"]),this.buttonBar.append(this.sortCardButton),this.sortCardButton.unbind("click"),this.sortCardButton.click(function(){var e=t.getCurrentPlayer();e.sortPhom(),e.sortCard()}),this.getCardButton=$(TWIST.HTMLTemplate["buttonBar/getCardButton"]),this.buttonBar.append(this.getCardButton),this.getCardButton.unbind("click"),this.getCardButton.click(function(){t.emit("getCard")}),this.eatCardButton=$(TWIST.HTMLTemplate["buttonBar/eatCardButton"]),this.buttonBar.append(this.eatCardButton),this.eatCardButton.unbind("click"),this.eatCardButton.click(function(){t.emit("eatCard")}),this.entiretyButton=$(TWIST.HTMLTemplate["buttonBar/entiretyButton"]),this.buttonBar.append(this.entiretyButton),this.entiretyButton.unbind("click"),this.entiretyButton.click(function(){t.emit("entirety")}),this.sendCardButton=$(TWIST.HTMLTemplate["buttonBar/sendCardButton"]),this.buttonBar.append(this.sendCardButton),this.sendCardButton.unbind("click"),this.sendCardButton.click(function(){var e=t.getCurrentPlayer(),i=e.getSelectedCards();return 0===i.length?void t.showError({code:1470}):void t.emit("sendCard",{cards:i})}),this.showPhomButton=$(TWIST.HTMLTemplate["buttonBar/showPhomButton"]),this.buttonBar.append(this.showPhomButton),this.showPhomButton.unbind("click"),this.showPhomButton.click(function(){t.emit("showPhom")})},i.handCardSelected=function(t){},i.STATUS_ENDING=function(){this.buttonBar.hide(),this.errorPanel.empty(),this.desk.lastDraftCards=void 0,this.setPlayerTurn()},i.showPhom=function(t){var e=t.phoms,i=t.uuid,n=this.getPlayerByUuid(i);n.showPhom(e),0==n.position&&n.sortCard(),this.showPhomButton.hide()},i.drawPlayer=function(t){var e=TWIST.InRoomGame.prototype.drawPlayer.call(this,t);e.addShowPhomArea()},i.sendCard=function(t){for(var e=t.cardsSend,i=this.getPlayerByUuid(t.cardsSend[0].transFrom),n=0;n<e.length;n++){var a=e[n],s=this.getPlayerByUuid(a.transTo);if(s&&i){var r=i.getCardsInHand([a.cardIndex])[0];r.set({x:r.x+i.x+i.hand.x,y:r.y+i.y+i.hand.y}),r.cardValue=a.cardIndex,s.addCardInShowPhom(r)}}for(var n=0;n<this.playersContainer.children.length;n++){var o=this.playersContainer.children[n];o&&!function(t){setTimeout(function(){t.sortPhomArea()},700)}(o)}0==i.position&&i.sortCard(),this.sendCardButton.hide()},i.entiretyCard=function(t){var e=t.phoms,i=t.uuid,n=this.getPlayerByUuid(i);n.showPhom(e),n.setPlayerStatus("Ù"),this.buttonBar.children().hide();setTimeout(function(){n.sortPhomArea()},550)},i.STATUS_PLAYING=function(){TWIST.InRoomGame.prototype.STATUS_PLAYING.call(this),this.playersContainer.children.forEach(function(t,e){t&&t.clearDraftCards()&&t.clearHand()&&t.clearShowPhomArea()})},i.endGame=function(t,e,i){var n=this,a={isWinner:!1,listPlayers:[]};a.listPlayers=t.listPlayers;for(var s=0,r=a.listPlayers.length;r>s;s++){var o=a.listPlayers[s],h=o.remainCards;h.sort(function(t,e){return t-e}),parseInt(o.changeMoney)<0?o.gameResultString=o.playerResult:parseInt(o.changeMoney)>0?(o.gameResultString=o.playerResult,o.isWinner=!0,o.uuid===this.userInfo.uuid&&(a.isWinner=!0)):o.gameResultString="Hòa",o.showPoint&&o.totalPoint&&(o.gameResultString=o.gameResultString+" "+o.totalPoint+" điểm !");var d=this.getPlayerByUuid(o.uuid);d&&(d.clearTimer(),d.setMoney(o.money),d.showMoneyExchageEffect(o.changeMoney,parseInt(o.changeMoney)>0?"win":"lose"))}setTimeout(function(){n.showResult(a)},2e3)},TWIST.PhomGame=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t,i){this.wrapper=$(t),this.options=$.extend(e,i),this.initSamGame()}var e={maxPlayers:5,numberCardsInHand:10,turnTime:2e4},i=t.prototype=new TWIST.BaseDemlaGame;i.initSamGame=function(t){this.initBaseDemlaGame(),this.pushSamGameEvent(),this.bindSamButton()},i.pushSamGameEvent=function(){this.on("inviteSam",this.onInviteSam),this.on("endInviteSam",this.onEndInviteSam),this.on("foldSam",this.onFoldSam),this.on("callSam",this.onCallSam),this.on("notifyOne",this.onNotifyOne)},i.bindSamButton=function(){var t=this;this.callSamButton=$(TWIST.HTMLTemplate["buttonBar/callSamButton"]),this.buttonBar.append(this.callSamButton),this.callSamButton.unbind("click"),this.callSamButton.click(function(){t.emit("call-sam")}),this.foldSamButton=$(TWIST.HTMLTemplate["buttonBar/foldSamButton"]),this.buttonBar.append(this.foldSamButton),this.foldSamButton.unbind("click"),this.foldSamButton.click(function(){t.emit("fold-sam")})},i.onInviteSam=function(t){this.desk.clear(),this.desk.setRemainingTime(parseInt(t.remainingTime)),this.callSamButton.show(),this.foldSamButton.show(),this.userCallSam=null},i.onEndInviteSam=function(){this.desk.setRemainingTime(0),this.callSamButton.hide(),this.foldSamButton.hide();for(var t=this.playersContainer.children,e=0,i=t.length;i>e;e++){var n=t[e];n&&n.uuid!==this.userCallSam&&n.setPlayerStatus("")}},i.onFoldSam=function(t){var e=this.getPlayerByUuid(t.uuid);e.setPlayerStatus("Hủy sâm !")},i.onCallSam=function(t){var e=this.getPlayerByUuid(t.uuid);e.setPlayerStatus("Báo sâm !",{color:"red"}),this.userCallSam=t.uuid},i.endGame=function(t){this.endIngameEvent();var e={0:"Năm đôi",1:"3 sám cô",2:"Đồng màu",3:"Tứ 2",4:"Sảnh rồng",15:"Hòa",16:"Bị ăn sâm",17:"Bị bắt sâm",18:"Phạt báo 1",19:"Bị thua trắng",20:"Thua",21:"Bắt sâm"},i=this,n={isWinner:!1,listPlayers:[]};n.listPlayers=t.listPlayers;for(var a=0,s=n.listPlayers.length;s>a;a++){var r=n.listPlayers[a],o=r.remainCards;o.sort(function(t,e){return t-e}),r.gameResultString=e[t.winType],parseInt(r.changeMoney)>0&&(r.isWinner=!0,r.uuid===this.userInfo.uuid&&(n.isWinner=!0));var h=this.getPlayerByUuid(r.uuid);h&&(h.clearTimer(),h.setMoney(r.money),h.showMoneyExchageEffect(r.changeMoney,parseInt(r.changeMoney)>0?"win":"lose"))}setTimeout(function(){i.showResult(n)},2e3)},TWIST.SamGame=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t,i){this.wrapper=$(t),this.options=$.extend(e,i),this.initTLMNDemlaGame()}var e={maxPlayers:4,numberCardsInHand:13,turnTime:2e4},i=t.prototype=new TWIST.BaseDemlaGame;i.initTLMNDemlaGame=function(t){this.initBaseDemlaGame()},i.endGame=function(t){this.endIngameEvent();var e={0:"Tứ quý 3",1:"3 đôi thông chứa 3 bích",2:"Tứ quý 2",3:"6 Đôi",4:"5 Đôi thông",5:"Sảnh rồng",16:"Thắng !"};this.endDemlaGame(t,e,16)},TWIST.TLMNDemlaGame=t}(),this.TWIST=this.TWIST||{},function(){"use strict";function t(t,e){this.wrapper=$(t),this.options=$.extend(P,e),this.initVideoPoker()}var e,i,n,a,s,r,o,h,d,u,c,l,f,p,m,g,v,T,C,y,w,S,b,x,I,P;P={resultTab:[{name:"Sảnh rồng(Nỗ hũ)",value:-1,code:"0"},{name:"Thùng phá sảnh",value:50,code:"1"},{name:"Tứ quý",value:25,code:"2"},{name:"Cù lũ",value:9,code:"3"},{name:"Thùng",value:6,code:"4"},{name:"Sảnh",value:4,code:"5"},{name:"Ba lá",value:3,code:"6"},{name:"Hai đôi",value:2,code:"7"},{name:"Đôi J hoặc cao hơn",value:1,code:"8"},{name:"Không ăn !",value:0,code:"9"}]};var B=t.prototype=new TWIST.BaseGame;B.initVideoPoker=function(){this.initVariable(),$.extend(this.options,e),this.info={betting:1e3,potData:{1e3:0,1e4:0,1e5:0}},this.userInfo={},this.initCanvas(),this.initTemplate(),this.initEvent(),this.initButton(),this.draw(),this.pushEventListener(),this.status="pause"},B.initVariable=function(){r=["pause","running","ending","effecting"],v=[{value:0,name:"2"},{value:1,name:"3"},{value:2,name:"4"},{value:3,name:"5"},{value:4,name:"6"},{value:5,name:"7"},{value:6,name:"8"},{value:7,name:"9"},{value:8,name:"10"},{value:9,name:"J"},{value:10,name:"Q"},{value:11,name:"K"},{value:12,name:"A"}],o=-1,d=1,i={width:126,height:168,padding:10},e={width:5*i.width,height:i.height,x:5,y:1},n=i.height,a=[],s=2.5,h=52,u={x:100,y:100},l=[],c=[1e3,1e4,1e5],f=2e3,p=0,m=0,g=[],T=0,y=["selectCard","selectDouble","getWin"],C=[],w=[],S=0,b=[0,1,2,3,4],x=[],I=!1},B.draw=function(){this.mapData=TWIST.MiniPokerLogic.generateMap();var t=new createjs.Container;this.spinArea=t;for(var n=0;n<e.x;n++){a[n]=new createjs.Container,a[n].set({x:n*i.width,y:0});var s=new createjs.Container;a[n].addChild(s);var r=(this.mapData[n],this.createSlotItem(this.mapData[n],0));s.addChild(r),t.addChild(a[n])}this.stage.addChild(t)},B.initTemplate=function(){var t=this;this.wrapperTemplate=$(TWIST.HTMLTemplate["videoPoker/wrapper"]),this.wrapper.append(this.wrapperTemplate),this.wrapperTemplate.append(this.canvas),this.initStage(),this.resultText=$(TWIST.HTMLTemplate["miniPoker/resultText"]),this.wrapperTemplate.append(this.resultText),this.wrapperTemplate.append($(TWIST.HTMLTemplate["miniPoker/pot"])),this.pot=this.wrapperTemplate.find(".pot-value"),this.buttonSpin=$(TWIST.HTMLTemplate["miniPoker/button"]),this.wrapperTemplate.append(this.buttonSpin),this.doubleButton=$(TWIST.HTMLTemplate["videoPoker/doubleButton"]),this.wrapperTemplate.append(this.doubleButton),this.doubleButton._disabled=!0,this.doubleButton.hide(),this.getWinButton=$(TWIST.HTMLTemplate["videoPoker/getWinButton"]),this.wrapperTemplate.append(this.getWinButton),this.getWinButton._disabled=!0,this.chipWrapper=$(TWIST.HTMLTemplate["miniPoker/chips"]),this.wrapperTemplate.append(this.chipWrapper),this.chipButtons=[{value:1e3,template:this.chipWrapper.find(".chip.violet")},{value:1e4,template:this.chipWrapper.find(".chip.green")},{value:1e5,template:this.chipWrapper.find(".chip.blue")}],this.errorPanel=$(TWIST.HTMLTemplate["miniPoker/errorPanel"]),this.wrapperTemplate.append(this.errorPanel),this.errorPanel.hide(),this.resultTab=$(TWIST.HTMLTemplate["miniPoker/resultTab"]),this.wrapperTemplate.append(this.resultTab),this.virtualCardsList=[],this.virtualCards=$(TWIST.HTMLTemplate["videoPoker/virtualCards"]),this.wrapperTemplate.append(this.virtualCards);for(var e=0;5>e;e++)this.virtualCardsList.push(this.virtualCards.find(".vitualCard"+(e+1)));this.resultItemList=[],this.resultItem=_.template(TWIST.HTMLTemplate["miniPoker/resultItem"]),this.options.resultTab.forEach(function(e,i){if(e.code!==t.options.resultTab[t.options.resultTab.length-1].code){var n={code:e.code,template:$(t.resultItem({name:e.name,value:e.value<=0?"":"X"+e.value}))};t.resultTab.append(n.template),t.resultItemList.push(n)}}),this.user=$(TWIST.HTMLTemplate["miniPoker/user"]),this.wrapperTemplate.append(this.user),this.sessionId=$(TWIST.HTMLTemplate["miniPoker/sessionId"]),this.wrapperTemplate.append(this.sessionId),this.effectWrapper=$(TWIST.HTMLTemplate["effect/wrapper"]),this.wrapperTemplate.append(this.effectWrapper),this.explodePot=$(TWIST.HTMLTemplate["effect/explodePot"]),this.effectWrapper.append(this.explodePot),this.supportText=$(TWIST.HTMLTemplate["videoPoker/supportText"]),this.wrapperTemplate.append(this.supportText),this.moveChip=$(TWIST.HTMLTemplate["videoPoker/moveChip"]),this.user.append(this.moveChip),this.moveChip.hide(),this.money=this.user.find(".money"),this.setBetting(this.chipButtons[0])},B.initButton=function(){var t=this;this.chipButtons.forEach(function(e,i){e.template.on("click",function(i){"pause"!==t.status&&"effecting"!==t.status||0!=T||(TWIST.Sound.play("minigame/Common_Click"),t.setBetting(e))})}),this.virtualCardsList.forEach(function(e,i){e.on("click",function(n){"effecting"==t.status&&1==T?(TWIST.Sound.play("minigame/Common_Click"),e._active=!e._active,e.toggleClass("active")):3==T&&(C[i].isOpened||(TWIST.Sound.play("minigame/Common_Click"),t.emit("cardSelect",i),T=-1))})}),this.getWinButton.on("click",function(e){2!=T&&3!=T||t.getWinButton._disabled||(TWIST.Sound.play("minigame/Common_Click"),t.emit("getWin"))}),this.doubleButton.on("click",function(e){2!=T&&3!=T||t.doubleButton._disabled||(TWIST.Sound.play("minigame/Common_Click"),t.emit("double"))}),this.buttonSpin.on("click",function(e){t.checkStart()})},B.setBetting=function(t){this.chipWrapper.find(".chip").removeClass("active"),t.template.addClass("active"),this.info.betting=t.value,this.changeNumberEffect(this.pot,this.info.potData[this.info.betting],{duration:200}).runEffect()},B.pushEventListener=function(){var t=this;this.on("endSpin",function(e){t.endSpin(e)}),this.on("userInfo",function(){t.renderUserInfo(arguments[0])}),this.on("spin",function(){t.startSpin()}),this.on("seconSpin",function(){t.startSpin()}),this.on("spinCompleted",function(){t.effecting()}),this.on("endEffect",function(){t.endEffect()}),this.on("updateMoney",function(e){t.updateMoney(e)}),this.on("updatePots",function(e){t.bindPots(e)}),this.on("error",function(e){t.showError(e)}),this.on("getWinResult",function(e){t.getWin(e)}),this.on("doubleResult",function(e){t.doubleTurn(e)}),this.on("updateDoubleList",function(t){b=t.doubleList}),this.on("cardSelectResult",function(e){t.setCardSelected(e)})},B.setCardSelected=function(t){function e(e){var n=0,a=i.virtualCardsList[t.selectedIndex];if(a._active=!0,a.addClass("active"),C.forEach(function(e,i){0!=i&&i!=t.selectedIndex&&(createjs.Tween.get(e).wait(200*n).to({},10).call(function(){this.Overlay(),this.openCard(b[i],TWIST.Card.miniPoker)}),n++)}),t.isNext){i.changeNumberEffect(i.resultText,t.winMoney,{duration:700}).runEffect(),i.setTextEffect(i.supportText,"Nhân đôi "+t.winMoney+" thành "+2*parseInt(t.winMoney)+"!").runEffect();i.buttonSpin.hide(),i.doubleButton._disabled=!1,i.doubleButton.removeClass("disabled"),i.doubleButton.show(),i.getWinButton._disabled=!1,i.getWinButton.addClass("active"),S=parseInt(t.winMoney),T=2}else{S=0;i.setTextEffect(i.supportText,"Không ăn !").runEffect(),i.changeNumberEffect(i.resultText,0,{duration:700}).runEffect();T=0,i.buttonSpin.show(),i.doubleButton.hide(),i.doubleButton._disabled=!1,i.doubleButton.addClass("disabled"),i.getWinButton._disabled=!0,i.getWinButton.removeClass("active"),i.virtualCardsList.forEach(function(t,e){t._active=!1,t.removeClass("active")})}}var i=this,n=C[t.selectedIndex];n.isTracking=!0,b=t.map,n.openCard(b[t.selectedIndex],TWIST.Card.miniPoker),TWIST.Observer.once("cardOpened",e)},B.showError=function(t){var e=$('<div class="error-item-mini">'+t+"</div>"),i=this;this.errorPanel.empty(),this.errorPanel.show(),this.errorPanel.append(e);var i=this;e.one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(e).remove(),i.errorPanel.hide()})},B.checkStart=function(){var t=this;if("pause"===t.status||"effecting"===t.status){var t=this;0==T?this.userInfo.money<this.info.betting?this.emit("error","Bạn không đủ tiền !"):("pause"!==t.status&&t.changeStatus("pause"),this.startSound=TWIST.Sound.play("minigame/bonus_spin"),t.emit("spin",this.info.betting),t.changeNumberEffect(t.money,t.userInfo.money-t.info.betting,{duration:800}).runEffect(),t.changeNumberEffect(t.resultText,t.info.betting,{duration:800}).runEffect(),t.moveChipEffect(1).runEffect()):1==T&&(this.startSound=TWIST.Sound.play("minigame/bonus_spin"),x=[],this.virtualCardsList.forEach(function(t,e){x.push(t._active)}),t.emit("seconSpin",x))}},B.renderUserInfo=function(t){$.extend(this.userInfo,t);var e=this.user.find(".avatar"),i=this.user.find(".username"),n=this.user.find(".money"),a=Global.md5Avatar(t.avatar);e.addClass("avatar"+a),i.text(t.username);var s=Global.numberWithDot(t.money);n.text(s)},B.bindPots=function(t){$.extend(this.info.potData,t.pots),this.changeNumberEffect(this.pot,this.info.potData[this.info.betting],{duration:200}).runEffect()},B.changeStatus=function(t){if(this.status=t,g.forEach(function(t){clearTimeout(t)}),g=[],"pause"==t){this.result={},p>=l.length&&(p=0);var e=l[p];if(e&&e.length)for(var i=0;i<e.length;i++)e[i].isDone||e[i].endEffect();l=[],p=0}"running"==t&&(this.resultSound&&this.resultSound.stop(),this.buttonSpin.addClass("disabled"),0==T&&this.resultText.text("")),"effecting"==t&&(this.startSound&&this.startSound.stop(),this.buttonSpin.removeClass("disabled"))},B.startSpin=function(){o=-1;var t,e=this,i=this.virtualCardsList.findIndex(function(t,e){return!t._active});i>-1?(t=a[i].getChildAt(0),this.changeStatus("running"),createjs.Tween.get(t).to({y:-50},150).call(function(){}).to({y:0},150).call(function(){e.spinAllColumns()})):e.changeStatus("effecting")},B.spinAllColumns=function(){var t=this;w=[],this.virtualCardsList.forEach(function(e,i){t.virtualCardsList[i]._active||w.push(i)}),w.forEach(function(e,i){t.spinColumn(e,i)})},B.spinColumn=function(t,i){var r=this.options.speed||s,h=!1,u=!1;o>-1&&i==Math.floor((10*o+9)/10/e.y)&&o%1==0&&(h=!0,u=o%e.y==e.y);var c,l=this,f=a[t].getChildAt(0);c=h?this.createSlotItem(this.mapData[t],-1):this.createSlotItem(Math.floor(4*Math.random())+52,-1),f.addChild(c),C[t]=c.children[0];var p=u?createjs.Ease.getBackOut(5):createjs.Ease.linear,m=u?2*n/r:n/r;createjs.Tween.get(f).to({y:n},m,p).call(function(){this.set({y:0});var n=this.children;if(n.forEach(function(t,e){t.state++,t.goNextStep()}),this.removeChild(n.find(function(t){return t.state==e.y})),o>-1){Math.floor(Math.floor((o+.9)/e.y));if(i==Math.floor((10*o+9)/10/e.y)){var a=o%e.y==e.y-1;a?d=.2:o%e.y==0&&(d=1),o=(10*o+10*d)/10,a?o=(10*o+10*d)/10:l.spinColumn(t,i)}else l.spinColumn(t,i);o>w.length-1&&l.emit("spinCompleted")}else l.spinColumn(t,i)})},B.endSpin=function(t){"running"==this.status?(this.changeStatus("ending"),this.result=this.result||{},$.extend(this.result,t),this.mapData=t.map,this.showSessionId(t.sessionId),o=-.8,d=.2):(this.result=this.result||{},$.extend(this.result,t),this.mapData=t.map,this.effecting())},B.updateMoney=function(t){this.result=this.result||{},$.extend(this.result,t),this.userInfo.money=t.newMoney},B.effecting=function(){this.changeStatus("effecting");this.result;l=[];var t=[];t=0==T?this.getFistEffectTurn():this.getSeconEffectTurn(),t.oneTime=!0,t.forEach(function(t,e){t.isTracking=!0}),l.push(t),this.runNextEffect()},B.getFistEffectTurn=function(){var t=this.result,e=[],i=this.setTextEffect(this.supportText,"Chọn quân bài muốn giữ lại"),n=this.hightlightHoldCards(t.holdCards);return e.push(i,n),T=1,e},B.getSeconEffectTurn=function(){var t=this.result,e=[];if(parseInt(t.winMoney)>0){this.resultSound=TWIST.Sound.play("minigame/NormalWin");var i=this.changeNumberEffect(this.resultText,t.winMoney,{duration:700}),n=this.setTextEffect(this.supportText,"Nhân đôi "+t.winMoney+" thành "+2*parseInt(t.winMoney)+"!"),a=this.hightLightWinCards(t.hightLightCards),s=this.hightlightWinRank(t.cardListRank);e.push(i,n,a,s),this.buttonSpin.hide(),this.doubleButton._disabled=!1,this.doubleButton.removeClass("disabled"),this.doubleButton.show(),this.getWinButton._disabled=!1,this.getWinButton.addClass("active"),S=parseInt(t.winMoney),T=2}else{this.resultSound=TWIST.Sound.play("minigame/slot_result"),S=0;var n=this.setTextEffect(this.supportText,"Không ăn !"),i=this.changeNumberEffect(this.resultText,0,{duration:700}),a=this.hightLightWinCards([]),r=this.hightlightHoldCards([]);e.push(i,n,a,r),T=0,this.virtualCardsList.forEach(function(t,e){t._active=!1,t.removeClass("active")})}return e},B.hightlightHoldCards=function(t){var e=this.virtualCardsList,i=this;return e.runEffect=function(){this.isDone=!1,this.forEach(function(e,i){t[i]?(e._active=!0,e.addClass("active")):(e._active=!1,e.removeClass("active"))})},e.endEffect=function(){this.forEach(function(t,e){t.removeClass("active")}),this.isDone=!0,this.isTracking&&(this.isTracking=!1,i.emit("endEffect"))},e},B.getWin=function(t){var e=this;TWIST.Sound.play("minigame/coin_spin"),e.changeStatus("effecting"),e.changeNumberEffect(e.money,e.userInfo.money,{duration:800}).runEffect(),e.changeNumberEffect(e.resultText,0,{duration:800}).runEffect(),e.setTextEffect(e.supportText,"").runEffect(),e.moveChipEffect(0).runEffect(),S=0,T=0,this.buttonSpin.show(),this.doubleButton.hide(),this.doubleButton._disabled=!1,this.doubleButton.addClass("disabled"),this.getWinButton._disabled=!0,this.getWinButton.removeClass("active"),this.virtualCardsList.forEach(function(t,e){t._active=!1,t.removeClass("active")})},B.doubleTurn=function(t){var e=this;"pause"!==e.status&&e.changeStatus("pause"),T=3;this.setTextEffect(this.supportText,"Chọn quân bài cao hơn").runEffect(),this.hightlightHoldCards([]).runEffect();this.doubleButton._disabled=!0,this.doubleButton.addClass("disabled"),this.getWinButton._disabled=!0,this.getWinButton.removeClass("active"),C.forEach(function(e,i){e.unHightLight(),e.UnOverlay(),0==i?(e.isOpened=!0,e.openCard(t.cardId,TWIST.Card.miniPoker)):e.upSideDown(TWIST.Card.miniPoker)})},B.runNextEffect=function(){function t(){m=0;for(var t=0;t<e.length;t++)e[t].runEffect()}var e=l[p];if(e&&e.length)if(e.oneTime)e.done?(p++,p==l.length&&(I?p=0:this.changeStatus("pause")),"effecting"===this.status&&this.runNextEffect()):t();else{var i=setTimeout(t,300);g.push(i)}},B.endEffect=function(){m++,m==(l[p]&&l[p].length)&&(l[p].oneTime&&(l[p].done=!0),p++,p==l.length&&(I?p=0:this.changeStatus("pause")),"effecting"===this.status&&this.runNextEffect())},B.createSlotItem=function(t,e){var n=new createjs.Container,a=new TWIST.Card(t);return t>51&&(t-=52,a.bg.sourceRect={width:TWIST.Card.size.width,height:152,x:TWIST.Card.size.width*(9+t),y:4*TWIST.Card.size.height}),a.set({scaleX:TWIST.Card.miniPoker.scale,scaleY:TWIST.Card.miniPoker.scale,x:(i.width-TWIST.Card.miniPoker.width)/2,y:(i.height-TWIST.Card.miniPoker.scale*TWIST.Card.size.height)/2}),n.addChild(a),n.set({x:0,y:i.height*e,state:e}),n.goNextStep=function(){var t=i.height*this.state;this.set({y:t})},n},B.changeNumberEffect=function(t,e,i){var n=$(t),a=this;return n.newValue=e,n.options=i,n.runEffect=function(){n.finish(),n.isDone=!0;var t=this.text(),e={duration:1e3,step:function(t){n.text(Global.numberWithDot(Math.ceil(t)))},done:function(){n.endEffect()}};$.extend(e,n.options),t=parseInt(t.replace(/\./g,"")),isNaN(t)&&(t=0),this.prop("Counter",t).animate({Counter:n.newValue},e)},n.endEffect=function(){n.finish(),this.isTracking&&(this.isTracking=!1,a.emit("endEffect"))},n},B.setTextEffect=function(t,e){var i=$(t),n=this;return i.newValue=e,i.runEffect=function(){i.isDone=!1,i.text(e)},i.endEffect=function(){i.text(""),i.isDone=!0,this.isTracking&&(this.isTracking=!1,n.emit("endEffect"))},i},B.explodePotEffect=function(){var t=this,e=$("#effect .explorer-pot");new Date;return e.runEffect=function(){e.isDone=!1,this.show()},e.click(function(){e.endEffect()}),e.endEffect=function(){this.hide(),this.isDone=!0,this.isTracking&&(this.isTracking=!1,t.emit("endEffect"))},e},B.hightlightWinRank=function(t){var e=this,i=this.resultItemList.find(function(e,i){return e.code==t}),n=i?i.template:$("<div></div>");return n.runEffect=function(){n.isDone=!1,n.addClass("active"),this.isTracking&&(this.isTracking=!1,e.emit("endEffect"))},n.endEffect=function(){n.removeClass("active"),n.isDone=!0},n},B.hightLightWinCards=function(t){for(var i=this,n=[],a=0;a<e.x;a++){var s=C[a];s.active=t[a],s.border.sourceRect.x=4*TWIST.Card.size.width,n.push(s)}return n.runEffect=function(){n.isDone=!1,n.forEach(function(t,e){parseInt(t.active)?t.hightLight():t.Overlay()}),this.isTracking&&(this.isTracking=!1,i.emit("endEffect"))},n.endEffect=function(){n.forEach(function(t,e){parseInt(t.active)?t.unHightLight():t.UnOverlay()}),n.isDone=!0},n},B.showResultText=function(t,e){var i=this,n=this.options.resultTab.find(function(e,i){return e.code==t}),a=v.find(function(t,i){return t.value==e}),s=n.name;3!=n.code&&7!=n.code&&9!=n.code||!a||(s=s+" "+a.name,9==n.code&&(s="Đôi "+a.name)),this.resultText.text(s);var r={};return r.runEffect=function(){r.isDone=!1,i.resultText.text(s),this.isTracking&&(this.isTracking=!1,i.emit("endEffect"))},r.endEffect=function(){i.resultText.text(""),r.isDone=!0},r},B.explodePotEffect=function(){var t=this,e=this.explodePot;new Date;return e.runEffect=function(){this.isDone=!1,this.show()},e.click(function(){e.endEffect()}),e.endEffect=function(){this.hide(),this.isDone=!0,this.isTracking&&(this.isTracking=!1,t.emit("endEffect"))},e},B.moveChipEffect=function(t){var e=this,i=this.moveChip;new Date;return i.runEffect=function(){this.isDone=!0,this.removeClass("plus decrease");var e=t?"plus":"decrease";this.removeClass("plus decrease"),this.show(),i.find("i").show(),this.addClass(e),i.find("i").each(function(t){$(this).one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(this).hide()})})},i.endEffect=function(){this.isTracking&&(this.isTracking=!1,e.emit("endEffect"))},i},B.showSessionId=function(t){this.sessionId.text(t)},TWIST.VideoPoker=t}(),this.gbjs=this.gbjs||{},function(){"use strict";var t=gbjs.Info=gbjs.Info||{};t.version="",t.buildDate=""}();